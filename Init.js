parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"vCxL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__extends=e,exports.__rest=n,exports.__decorate=o,exports.__param=a,exports.__metadata=u,exports.__awaiter=i,exports.__generator=c,exports.__exportStar=f,exports.__values=l,exports.__read=s,exports.__spread=p,exports.__await=y,exports.__asyncGenerator=_,exports.__asyncDelegator=h,exports.__asyncValues=b,exports.__makeTemplateObject=v,exports.__importStar=d,exports.__importDefault=x,exports.__assign=void 0;var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return exports.__assign=r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&(r[n[o]]=t[n[o]])}return r}function o(t,e,r,n){var o,a=arguments.length,u=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,r,n);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(u=(a<3?o(u):a>3?o(e,r,u):o(e,r))||u);return a>3&&u&&Object.defineProperty(e,r,u),u}function a(t,e){return function(r,n){e(r,n,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function i(t,e,r,n){return new(r||(r=Promise))(function(o,a){function u(t){try{c(n.next(t))}catch(e){a(e)}}function i(t){try{c(n.throw(t))}catch(e){a(e)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(u,i)}c((n=n.apply(t,e||[])).next())})}function c(t,e){var r,n,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=e.call(t,u)}catch(i){a=[6,i],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}}function f(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function l(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)u.push(n.value)}catch(i){o={error:i}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return u}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function _(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),a=[];return n={},u("next"),u("throw"),u("return"),n[Symbol.asyncIterator]=function(){return this},n;function u(t){o[t]&&(n[t]=function(e){return new Promise(function(r,n){a.push([t,e,r,n])>1||i(t,e)})})}function i(t,e){try{(r=o[t](e)).value instanceof y?Promise.resolve(r.value.v).then(c,f):l(a[0][2],r)}catch(n){l(a[0][3],n)}var r}function c(t){i("next",t)}function f(t){i("throw",t)}function l(t,e){t(e),a.shift(),a.length&&i(a[0][0],a[0][1])}}function h(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,o){e[n]=t[n]?function(e){return(r=!r)?{value:y(t[n](e)),done:"return"===n}:o?o(e):e}:o}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof l?l(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,o,(e=t[r](e)).done,e.value)})}}}function v(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function x(t){return t&&t.__esModule?t:{default:t}}exports.__assign=r;
},{}],"gtkL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Observable=exports.MultiObserver=exports.Observer=exports.EventState=void 0;var e=function(){function e(e,r,t,s){void 0===r&&(r=!1),this.initalize(e,r,t,s)}return e.prototype.initalize=function(e,r,t,s){return void 0===r&&(r=!1),this.mask=e,this.skipNextObservers=r,this.target=t,this.currentTarget=s,this},e}();exports.EventState=e;var r=function(){return function(e,r,t){void 0===t&&(t=null),this.callback=e,this.mask=r,this.scope=t,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}}();exports.Observer=r;var t=function(){function e(){}return e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(r,t,s,n){void 0===s&&(s=-1),void 0===n&&(n=null);var i=new e;i._observers=new Array,i._observables=r;for(var o=0,v=r;o<v.length;o++){var a=v[o].add(t,s,!1,n);a&&i._observers.push(a)}return i},e}();exports.MultiObserver=t;var s=function(){function t(r){this._observers=new Array,this._eventState=new e(0),r&&(this._onObserverAdded=r)}return t.prototype.add=function(e,t,s,n,i){if(void 0===t&&(t=-1),void 0===s&&(s=!1),void 0===n&&(n=null),void 0===i&&(i=!1),!e)return null;var o=new r(e,t,n);return o.unregisterOnNextCall=i,s?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},t.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},t.prototype.remove=function(e){return!!e&&(-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))},t.prototype.removeCallback=function(e,r){for(var t=0;t<this._observers.length;t++)if(this._observers[t].callback===e&&(!r||r===this._observers[t].scope))return this._deferUnregister(this._observers[t]),!0;return!1},t.prototype._deferUnregister=function(e){var r=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){r._remove(e)},0)},t.prototype._remove=function(e){if(!e)return!1;var r=this._observers.indexOf(e);return-1!==r&&(this._observers.splice(r,1),!0)},t.prototype.notifyObservers=function(e,r,t,s){if(void 0===r&&(r=-1),!this._observers.length)return!0;var n=this._eventState;n.mask=r,n.target=t,n.currentTarget=s,n.skipNextObservers=!1,n.lastReturnValue=e;for(var i=0,o=this._observers;i<o.length;i++){var v=o[i];if(!v._willBeUnregistered&&(v.mask&r&&(v.scope?n.lastReturnValue=v.callback.apply(v.scope,[e,n]):n.lastReturnValue=v.callback(e,n),v.unregisterOnNextCall&&this._deferUnregister(v)),n.skipNextObservers))return!1}return!0},t.prototype.notifyObserversWithPromise=function(e,r,t,s){var n=this;void 0===r&&(r=-1);var i=Promise.resolve(e);if(!this._observers.length)return i;var o=this._eventState;return o.mask=r,o.target=t,o.currentTarget=s,o.skipNextObservers=!1,this._observers.forEach(function(t){o.skipNextObservers||t._willBeUnregistered||t.mask&r&&(i=t.scope?i.then(function(r){return o.lastReturnValue=r,t.callback.apply(t.scope,[e,o])}):i.then(function(r){return o.lastReturnValue=r,t.callback(e,o)}),t.unregisterOnNextCall&&n._deferUnregister(t))}),i.then(function(){return e})},t.prototype.notifyObserver=function(e,r,t){void 0===t&&(t=-1);var s=this._eventState;s.mask=t,s.skipNextObservers=!1,e.callback(r,s)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var e=new t;return e._observers=this._observers.slice(0),e},t.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var r=0,t=this._observers;r<t.length;r++){var s=t[r];if(s.mask&e||s.mask===e)return!0}return!1},t}();exports.Observable=s;
},{}],"+D0i":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DomManagement=void 0;var e=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.GetDOMTextContent=function(e){for(var t="",n=e.firstChild;n;)3===n.nodeType&&(t+=n.textContent),n=n.nextSibling;return t},e}();exports.DomManagement=e;
},{}],"V1yO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PrecisionDate=void 0;var e=require("./domManagement"),n=function(){function n(){}return Object.defineProperty(n,"Now",{get:function(){return e.DomManagement.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),n}();exports.PrecisionDate=n;
},{"./domManagement":"+D0i"}],"CVTd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RollingAverage=exports.PerformanceMonitor=void 0;var e=require("./precisionDate"),t=function(){function t(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new r(e)}return t.prototype.sampleFrame=function(t){if(void 0===t&&(t=e.PrecisionDate.Now),this._enabled){if(null!=this._lastFrameTimeMs){var r=t-this._lastFrameTimeMs;this._rollingFrameTime.add(r)}this._lastFrameTimeMs=t}},Object.defineProperty(t.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),t.prototype.enable=function(){this._enabled=!0},t.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},t}();exports.PerformanceMonitor=t;var r=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var r=this._samples[this._pos];t=r-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(r-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}();exports.RollingAverage=r;
},{"./precisionDate":"V1yO"}],"xdbM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StringDictionary=void 0;var t=function(){function t(){this._count=0,this._data={}}return t.prototype.copyFrom=function(t){var o=this;this.clear(),t.forEach(function(t,r){return o.add(t,r)})},t.prototype.get=function(t){var o=this._data[t];if(void 0!==o)return o},t.prototype.getOrAddWithFactory=function(t,o){var r=this.get(t);return void 0!==r?r:((r=o(t))&&this.add(t,r),r)},t.prototype.getOrAdd=function(t,o){var r=this.get(t);return void 0!==r?r:(this.add(t,o),o)},t.prototype.contains=function(t){return void 0!==this._data[t]},t.prototype.add=function(t,o){return void 0===this._data[t]&&(this._data[t]=o,++this._count,!0)},t.prototype.set=function(t,o){return void 0!==this._data[t]&&(this._data[t]=o,!0)},t.prototype.getAndRemove=function(t){var o=this.get(t);return void 0!==o?(delete this._data[t],--this._count,o):null},t.prototype.remove=function(t){return!!this.contains(t)&&(delete this._data[t],--this._count,!0)},t.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){for(var o in this._data){t(o,this._data[o])}},t.prototype.first=function(t){for(var o in this._data){var r=t(o,this._data[o]);if(r)return r}return null},t}();exports.StringDictionary=t;
},{}],"eIrG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArrayTools=void 0;var r=function(){function r(){}return r.BuildArray=function(r,o){for(var e=[],t=0;t<r;++t)e.push(o());return e},r}();exports.ArrayTools=r;
},{}],"7Iig":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scalar=void 0;var n=function(){function n(){}return n.WithinEpsilon=function(n,r,t){void 0===t&&(t=1.401298e-45);var e=n-r;return-t<=e&&e<=t},n.ToHex=function(n){var r=n.toString(16);return n<=15?("0"+r).toUpperCase():r.toUpperCase()},n.Sign=function(n){return 0===(n=+n)||isNaN(n)?n:n>0?1:-1},n.Clamp=function(n,r,t){return void 0===r&&(r=0),void 0===t&&(t=1),Math.min(t,Math.max(r,n))},n.Log2=function(n){return Math.log(n)*Math.LOG2E},n.Repeat=function(n,r){return n-Math.floor(n/r)*r},n.Normalize=function(n,r,t){return(n-r)/(t-r)},n.Denormalize=function(n,r,t){return n*(t-r)+r},n.DeltaAngle=function(r,t){var e=n.Repeat(t-r,360);return e>180&&(e-=360),e},n.PingPong=function(r,t){var e=n.Repeat(r,2*t);return t-Math.abs(e-t)},n.SmoothStep=function(r,t,e){var o=n.Clamp(e);return t*(o=-2*o*o*o+3*o*o)+r*(1-o)},n.MoveTowards=function(r,t,e){return Math.abs(t-r)<=e?t:r+n.Sign(t-r)*e},n.MoveTowardsAngle=function(r,t,e){var o=n.DeltaAngle(r,t),a=0;return-e<o&&o<e?a=t:(t=r+o,a=n.MoveTowards(r,t,e)),a},n.Lerp=function(n,r,t){return n+(r-n)*t},n.LerpAngle=function(r,t,e){var o=n.Repeat(t-r,360);return o>180&&(o-=360),r+o*n.Clamp(e)},n.InverseLerp=function(r,t,e){return r!=t?n.Clamp((e-r)/(t-r)):0},n.Hermite=function(n,r,t,e,o){var a=o*o,u=o*a;return n*(2*u-3*a+1)+t*(-2*u+3*a)+r*(u-2*a+o)+e*(u-a)},n.RandomRange=function(n,r){return n===r?n:Math.random()*(r-n)+n},n.RangeToPercent=function(n,r,t){return(n-r)/(t-r)},n.PercentToRange=function(n,r,t){return(t-r)*n+r},n.NormalizeRadians=function(r){return r-=n.TwoPi*Math.floor((r+Math.PI)/n.TwoPi)},n.TwoPi=2*Math.PI,n}();exports.Scalar=n;
},{}],"Iizi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tmp=exports.PositionNormalTextureVertex=exports.PositionNormalVertex=exports.Curve3=exports.Path3D=exports.Path2=exports.Arc2=exports.Angle=exports.Orientation=exports.BezierCurve=exports.Axis=exports.Space=exports.Frustum=exports.Viewport=exports.Plane=exports.Matrix=exports.Quaternion=exports.Size=exports.Vector4=exports.Vector3=exports.Vector2=exports.Color4=exports.Color3=exports.Epsilon=exports.ToLinearSpace=exports.ToGammaSpace=void 0;var t=require("../Misc/arrayTools"),r=require("./math.scalar"),o=1/2.2;exports.ToGammaSpace=o;var n=2.2;exports.ToLinearSpace=n;var i=.001;exports.Epsilon=i;var e=function(){function t(t,r,o){void 0===t&&(t=0),void 0===r&&(r=0),void 0===o&&(o=0),this.r=t,this.g=r,this.b=o}return t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.getClassName=function(){return"Color3"},t.prototype.getHashCode=function(){var t=this.r||0;return t=397*(t=397*t^(this.g||0))^(this.b||0)},t.prototype.toArray=function(t,r){return void 0===r&&(r=0),t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,this},t.prototype.toColor4=function(t){return void 0===t&&(t=1),new s(this.r,this.g,this.b,t)},t.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(r){return new t(this.r*r.r,this.g*r.g,this.b*r.b)},t.prototype.multiplyToRef=function(t,r){return r.r=this.r*t.r,r.g=this.g*t.g,r.b=this.b*t.b,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},t.prototype.equalsFloats=function(t,r,o){return this.r===t&&this.g===r&&this.b===o},t.prototype.scale=function(r){return new t(this.r*r,this.g*r,this.b*r)},t.prototype.scaleToRef=function(t,r){return r.r=this.r*t,r.g=this.g*t,r.b=this.b*t,this},t.prototype.scaleAndAddToRef=function(t,r){return r.r+=this.r*t,r.g+=this.g*t,r.b+=this.b*t,this},t.prototype.clampToRef=function(t,o,n){return void 0===t&&(t=0),void 0===o&&(o=1),n.r=r.Scalar.Clamp(this.r,t,o),n.g=r.Scalar.Clamp(this.g,t,o),n.b=r.Scalar.Clamp(this.b,t,o),this},t.prototype.add=function(r){return new t(this.r+r.r,this.g+r.g,this.b+r.b)},t.prototype.addToRef=function(t,r){return r.r=this.r+t.r,r.g=this.g+t.g,r.b=this.b+t.b,this},t.prototype.subtract=function(r){return new t(this.r-r.r,this.g-r.g,this.b-r.b)},t.prototype.subtractToRef=function(t,r){return r.r=this.r-t.r,r.g=this.g-t.g,r.b=this.b-t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.copyFromFloats=function(t,r,o){return this.r=t,this.g=r,this.b=o,this},t.prototype.set=function(t,r,o){return this.copyFromFloats(t,r,o)},t.prototype.toHexString=function(){var t=255*this.r|0,o=255*this.g|0,n=255*this.b|0;return"#"+r.Scalar.ToHex(t)+r.Scalar.ToHex(o)+r.Scalar.ToHex(n)},t.prototype.toLinearSpace=function(){var r=new t;return this.toLinearSpaceToRef(r),r},t.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,n),t.g=Math.pow(this.g,n),t.b=Math.pow(this.b,n),this},t.prototype.toGammaSpace=function(){var r=new t;return this.toGammaSpaceToRef(r),r},t.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,o),t.g=Math.pow(this.g,o),t.b=Math.pow(this.b,o),this},t.FromHexString=function(r){if("#"!==r.substring(0,1)||7!==r.length)return new t(0,0,0);var o=parseInt(r.substring(1,3),16),n=parseInt(r.substring(3,5),16),i=parseInt(r.substring(5,7),16);return t.FromInts(o,n,i)},t.FromArray=function(r,o){return void 0===o&&(o=0),new t(r[o],r[o+1],r[o+2])},t.FromInts=function(r,o,n){return new t(r/255,o/255,n/255)},t.Lerp=function(r,o,n){var i=new t(0,0,0);return t.LerpToRef(r,o,n,i),i},t.LerpToRef=function(t,r,o,n){n.r=t.r+(r.r-t.r)*o,n.g=t.g+(r.g-t.g)*o,n.b=t.b+(r.b-t.b)*o},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},Object.defineProperty(t,"BlackReadOnly",{get:function(){return t._BlackReadOnly},enumerable:!0,configurable:!0}),t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t.Teal=function(){return new t(0,1,1)},t.Random=function(){return new t(Math.random(),Math.random(),Math.random())},t._BlackReadOnly=t.Black(),t}();exports.Color3=e;var s=function(){function t(t,r,o,n){void 0===t&&(t=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=1),this.r=t,this.g=r,this.b=o,this.a=n}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},t.prototype.toArray=function(t,r){return void 0===r&&(r=0),t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t[r+3]=this.a,this},t.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},t.prototype.add=function(r){return new t(this.r+r.r,this.g+r.g,this.b+r.b,this.a+r.a)},t.prototype.subtract=function(r){return new t(this.r-r.r,this.g-r.g,this.b-r.b,this.a-r.a)},t.prototype.subtractToRef=function(t,r){return r.r=this.r-t.r,r.g=this.g-t.g,r.b=this.b-t.b,r.a=this.a-t.a,this},t.prototype.scale=function(r){return new t(this.r*r,this.g*r,this.b*r,this.a*r)},t.prototype.scaleToRef=function(t,r){return r.r=this.r*t,r.g=this.g*t,r.b=this.b*t,r.a=this.a*t,this},t.prototype.scaleAndAddToRef=function(t,r){return r.r+=this.r*t,r.g+=this.g*t,r.b+=this.b*t,r.a+=this.a*t,this},t.prototype.clampToRef=function(t,o,n){return void 0===t&&(t=0),void 0===o&&(o=1),n.r=r.Scalar.Clamp(this.r,t,o),n.g=r.Scalar.Clamp(this.g,t,o),n.b=r.Scalar.Clamp(this.b,t,o),n.a=r.Scalar.Clamp(this.a,t,o),this},t.prototype.multiply=function(r){return new t(this.r*r.r,this.g*r.g,this.b*r.b,this.a*r.a)},t.prototype.multiplyToRef=function(t,r){return r.r=this.r*t.r,r.g=this.g*t.g,r.b=this.b*t.b,r.a=this.a*t.a,r},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var t=this.r||0;return t=397*(t=397*(t=397*t^(this.g||0))^(this.b||0))^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.copyFromFloats=function(t,r,o,n){return this.r=t,this.g=r,this.b=o,this.a=n,this},t.prototype.set=function(t,r,o,n){return this.copyFromFloats(t,r,o,n)},t.prototype.toHexString=function(){var t=255*this.r|0,o=255*this.g|0,n=255*this.b|0,i=255*this.a|0;return"#"+r.Scalar.ToHex(t)+r.Scalar.ToHex(o)+r.Scalar.ToHex(n)+r.Scalar.ToHex(i)},t.prototype.toLinearSpace=function(){var r=new t;return this.toLinearSpaceToRef(r),r},t.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,n),t.g=Math.pow(this.g,n),t.b=Math.pow(this.b,n),t.a=this.a,this},t.prototype.toGammaSpace=function(){var r=new t;return this.toGammaSpaceToRef(r),r},t.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,o),t.g=Math.pow(this.g,o),t.b=Math.pow(this.b,o),t.a=this.a,this},t.FromHexString=function(r){if("#"!==r.substring(0,1)||9!==r.length)return new t(0,0,0,0);var o=parseInt(r.substring(1,3),16),n=parseInt(r.substring(3,5),16),i=parseInt(r.substring(5,7),16),e=parseInt(r.substring(7,9),16);return t.FromInts(o,n,i,e)},t.Lerp=function(r,o,n){var i=new t(0,0,0,0);return t.LerpToRef(r,o,n,i),i},t.LerpToRef=function(t,r,o,n){n.r=t.r+(r.r-t.r)*o,n.g=t.g+(r.g-t.g)*o,n.b=t.b+(r.b-t.b)*o,n.a=t.a+(r.a-t.a)*o},t.FromColor3=function(r,o){return void 0===o&&(o=1),new t(r.r,r.g,r.b,o)},t.FromArray=function(r,o){return void 0===o&&(o=0),new t(r[o],r[o+1],r[o+2],r[o+3])},t.FromInts=function(r,o,n,i){return new t(r/255,o/255,n/255,i/255)},t.CheckColors4=function(t,r){if(t.length===3*r){for(var o=[],n=0;n<t.length;n+=3){var i=n/3*4;o[i]=t[n],o[i+1]=t[n+1],o[i+2]=t[n+2],o[i+3]=1}return o}return t},t}();exports.Color4=s;var a=function(){function t(t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.x=t,this.y=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},t.prototype.getClassName=function(){return"Vector2"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0)},t.prototype.toArray=function(t,r){return void 0===r&&(r=0),t[r]=this.x,t[r+1]=this.y,this},t.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.copyFromFloats=function(t,r){return this.x=t,this.y=r,this},t.prototype.set=function(t,r){return this.copyFromFloats(t,r)},t.prototype.add=function(r){return new t(this.x+r.x,this.y+r.y)},t.prototype.addToRef=function(t,r){return r.x=this.x+t.x,r.y=this.y+t.y,this},t.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.addVector3=function(r){return new t(this.x+r.x,this.y+r.y)},t.prototype.subtract=function(r){return new t(this.x-r.x,this.y-r.y)},t.prototype.subtractToRef=function(t,r){return r.x=this.x-t.x,r.y=this.y-t.y,this},t.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.multiply=function(r){return new t(this.x*r.x,this.y*r.y)},t.prototype.multiplyToRef=function(t,r){return r.x=this.x*t.x,r.y=this.y*t.y,this},t.prototype.multiplyByFloats=function(r,o){return new t(this.x*r,this.y*o)},t.prototype.divide=function(r){return new t(this.x/r.x,this.y/r.y)},t.prototype.divideToRef=function(t,r){return r.x=this.x/t.x,r.y=this.y/t.y,this},t.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},t.prototype.scale=function(r){var o=new t(0,0);return this.scaleToRef(r,o),o},t.prototype.scaleToRef=function(t,r){return r.x=this.x*t,r.y=this.y*t,this},t.prototype.scaleAndAddToRef=function(t,r){return r.x+=this.x*t,r.y+=this.y*t,this},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},t.prototype.equalsWithEpsilon=function(t,o){return void 0===o&&(o=i),t&&r.Scalar.WithinEpsilon(this.x,t.x,o)&&r.Scalar.WithinEpsilon(this.y,t.y,o)},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var t=this.length();if(0===t)return this;var r=1/t;return this.x*=r,this.y*=r,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.Zero=function(){return new t(0,0)},t.One=function(){return new t(1,1)},t.FromArray=function(r,o){return void 0===o&&(o=0),new t(r[o],r[o+1])},t.FromArrayToRef=function(t,r,o){o.x=t[r],o.y=t[r+1]},t.CatmullRom=function(r,o,n,i,e){var s=e*e,a=e*s;return new t(.5*(2*o.x+(-r.x+n.x)*e+(2*r.x-5*o.x+4*n.x-i.x)*s+(-r.x+3*o.x-3*n.x+i.x)*a),.5*(2*o.y+(-r.y+n.y)*e+(2*r.y-5*o.y+4*n.y-i.y)*s+(-r.y+3*o.y-3*n.y+i.y)*a))},t.Clamp=function(r,o,n){var i=r.x;i=(i=i>n.x?n.x:i)<o.x?o.x:i;var e=r.y;return new t(i,e=(e=e>n.y?n.y:e)<o.y?o.y:e)},t.Hermite=function(r,o,n,i,e){var s=e*e,a=e*s,h=2*a-3*s+1,u=-2*a+3*s,y=a-2*s+e,c=a-s;return new t(r.x*h+n.x*u+o.x*y+i.x*c,r.y*h+n.y*u+o.y*y+i.y*c)},t.Lerp=function(r,o,n){return new t(r.x+(o.x-r.x)*n,r.y+(o.y-r.y)*n)},t.Dot=function(t,r){return t.x*r.x+t.y*r.y},t.Normalize=function(t){var r=t.clone();return r.normalize(),r},t.Minimize=function(r,o){return new t(r.x<o.x?r.x:o.x,r.y<o.y?r.y:o.y)},t.Maximize=function(r,o){return new t(r.x>o.x?r.x:o.x,r.y>o.y?r.y:o.y)},t.Transform=function(r,o){var n=t.Zero();return t.TransformToRef(r,o,n),n},t.TransformToRef=function(t,r,o){var n=r.m,i=t.x*n[0]+t.y*n[4]+n[12],e=t.x*n[1]+t.y*n[5]+n[13];o.x=i,o.y=e},t.PointInTriangle=function(t,r,o,n){var i=.5*(-o.y*n.x+r.y*(-o.x+n.x)+r.x*(o.y-n.y)+o.x*n.y),e=i<0?-1:1,s=(r.y*n.x-r.x*n.y+(n.y-r.y)*t.x+(r.x-n.x)*t.y)*e,a=(r.x*o.y-r.y*o.x+(r.y-o.y)*t.x+(o.x-r.x)*t.y)*e;return s>0&&a>0&&s+a<2*i*e},t.Distance=function(r,o){return Math.sqrt(t.DistanceSquared(r,o))},t.DistanceSquared=function(t,r){var o=t.x-r.x,n=t.y-r.y;return o*o+n*n},t.Center=function(t,r){var o=t.add(r);return o.scaleInPlace(.5),o},t.DistanceOfPointFromSegment=function(r,o,n){var i=t.DistanceSquared(o,n);if(0===i)return t.Distance(r,o);var e=n.subtract(o),s=Math.max(0,Math.min(1,t.Dot(r.subtract(o),e)/i)),a=o.add(e.multiplyByFloats(s,s));return t.Distance(r,a)},t}();exports.Vector2=a;var h=function(){function t(t,r,o){void 0===t&&(t=0),void 0===r&&(r=0),void 0===o&&(o=0),this.x=t,this.y=r,this.z=o}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},t.prototype.getClassName=function(){return"Vector3"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*(t=397*t^(this.y||0))^(this.z||0)},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,r){return void 0===r&&(r=0),t[r]=this.x,t[r+1]=this.y,t[r+2]=this.z,this},t.prototype.toQuaternion=function(){return c.RotationYawPitchRoll(this.y,this.x,this.z)},t.prototype.addInPlace=function(t){return this.addInPlaceFromFloats(t.x,t.y,t.z)},t.prototype.addInPlaceFromFloats=function(t,r,o){return this.x+=t,this.y+=r,this.z+=o,this},t.prototype.add=function(r){return new t(this.x+r.x,this.y+r.y,this.z+r.z)},t.prototype.addToRef=function(t,r){return r.copyFromFloats(this.x+t.x,this.y+t.y,this.z+t.z)},t.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.subtract=function(r){return new t(this.x-r.x,this.y-r.y,this.z-r.z)},t.prototype.subtractToRef=function(t,r){return this.subtractFromFloatsToRef(t.x,t.y,t.z,r)},t.prototype.subtractFromFloats=function(r,o,n){return new t(this.x-r,this.y-o,this.z-n)},t.prototype.subtractFromFloatsToRef=function(t,r,o,n){return n.copyFromFloats(this.x-t,this.y-r,this.z-o)},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.scale=function(r){return new t(this.x*r,this.y*r,this.z*r)},t.prototype.scaleToRef=function(t,r){return r.copyFromFloats(this.x*t,this.y*t,this.z*t)},t.prototype.scaleAndAddToRef=function(t,r){return r.addInPlaceFromFloats(this.x*t,this.y*t,this.z*t)},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},t.prototype.equalsWithEpsilon=function(t,o){return void 0===o&&(o=i),t&&r.Scalar.WithinEpsilon(this.x,t.x,o)&&r.Scalar.WithinEpsilon(this.y,t.y,o)&&r.Scalar.WithinEpsilon(this.z,t.z,o)},t.prototype.equalsToFloats=function(t,r,o){return this.x===t&&this.y===r&&this.z===o},t.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},t.prototype.multiply=function(t){return this.multiplyByFloats(t.x,t.y,t.z)},t.prototype.multiplyToRef=function(t,r){return r.copyFromFloats(this.x*t.x,this.y*t.y,this.z*t.z)},t.prototype.multiplyByFloats=function(r,o,n){return new t(this.x*r,this.y*o,this.z*n)},t.prototype.divide=function(r){return new t(this.x/r.x,this.y/r.y,this.z/r.z)},t.prototype.divideToRef=function(t,r){return r.copyFromFloats(this.x/t.x,this.y/t.y,this.z/t.z)},t.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},t.prototype.minimizeInPlace=function(t){return this.minimizeInPlaceFromFloats(t.x,t.y,t.z)},t.prototype.maximizeInPlace=function(t){return this.maximizeInPlaceFromFloats(t.x,t.y,t.z)},t.prototype.minimizeInPlaceFromFloats=function(t,r,o){return t<this.x&&(this.x=t),r<this.y&&(this.y=r),o<this.z&&(this.z=o),this},t.prototype.maximizeInPlaceFromFloats=function(t,r,o){return t>this.x&&(this.x=t),r>this.y&&(this.y=r),o>this.z&&(this.z=o),this},t.prototype.isNonUniformWithinEpsilon=function(t){var o=Math.abs(this.x),n=Math.abs(this.y);if(!r.Scalar.WithinEpsilon(o,n,t))return!0;var i=Math.abs(this.z);return!r.Scalar.WithinEpsilon(o,i,t)||!r.Scalar.WithinEpsilon(n,i,t)},Object.defineProperty(t.prototype,"isNonUniform",{get:function(){var t=Math.abs(this.x),r=Math.abs(this.y);if(t!==r)return!0;var o=Math.abs(this.z);return t!==o||r!==o},enumerable:!0,configurable:!0}),t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){return this.normalizeFromLength(this.length())},t.prototype.reorderInPlace=function(t){var r=this;return"xyz"===(t=t.toLowerCase())?this:(b.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(o,n){r[o]=b.Vector3[0][t[n]]}),this)},t.prototype.rotateByQuaternionToRef=function(r,o){return r.toRotationMatrix(b.Matrix[0]),t.TransformCoordinatesToRef(this,b.Matrix[0],o),o},t.prototype.rotateByQuaternionAroundPointToRef=function(t,r,o){return this.subtractToRef(r,b.Vector3[0]),b.Vector3[0].rotateByQuaternionToRef(t,b.Vector3[0]),r.addToRef(b.Vector3[0],o),o},t.prototype.normalizeFromLength=function(t){return 0===t||1===t?this:this.scaleInPlace(1/t)},t.prototype.normalizeToNew=function(){var r=new t(0,0,0);return this.normalizeToRef(r),r},t.prototype.normalizeToRef=function(t){var r=this.length();return 0===r||1===r?t.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/r,t)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(t){return this.copyFromFloats(t.x,t.y,t.z)},t.prototype.copyFromFloats=function(t,r,o){return this.x=t,this.y=r,this.z=o,this},t.prototype.set=function(t,r,o){return this.copyFromFloats(t,r,o)},t.prototype.setAll=function(t){return this.x=this.y=this.z=t,this},t.GetClipFactor=function(r,o,n,i){var e=t.Dot(r,n)-i;return e/(e-(t.Dot(o,n)-i))},t.GetAngleBetweenVectors=function(r,o,n){var i=r.normalizeToRef(b.Vector3[1]),e=o.normalizeToRef(b.Vector3[2]),s=t.Dot(i,e),a=b.Vector3[3];return t.CrossToRef(i,e,a),t.Dot(a,n)>0?Math.acos(s):-Math.acos(s)},t.FromArray=function(r,o){return void 0===o&&(o=0),new t(r[o],r[o+1],r[o+2])},t.FromFloatArray=function(r,o){return t.FromArray(r,o)},t.FromArrayToRef=function(t,r,o){o.x=t[r],o.y=t[r+1],o.z=t[r+2]},t.FromFloatArrayToRef=function(r,o,n){return t.FromArrayToRef(r,o,n)},t.FromFloatsToRef=function(t,r,o,n){n.copyFromFloats(t,r,o)},t.Zero=function(){return new t(0,0,0)},t.One=function(){return new t(1,1,1)},t.Up=function(){return new t(0,1,0)},Object.defineProperty(t,"UpReadOnly",{get:function(){return t._UpReadOnly},enumerable:!0,configurable:!0}),t.Down=function(){return new t(0,-1,0)},t.Forward=function(){return new t(0,0,1)},t.Backward=function(){return new t(0,0,-1)},t.Right=function(){return new t(1,0,0)},t.Left=function(){return new t(-1,0,0)},t.TransformCoordinates=function(r,o){var n=t.Zero();return t.TransformCoordinatesToRef(r,o,n),n},t.TransformCoordinatesToRef=function(r,o,n){t.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,o,n)},t.TransformCoordinatesFromFloatsToRef=function(t,r,o,n,i){var e=n.m,s=t*e[0]+r*e[4]+o*e[8]+e[12],a=t*e[1]+r*e[5]+o*e[9]+e[13],h=t*e[2]+r*e[6]+o*e[10]+e[14],u=1/(t*e[3]+r*e[7]+o*e[11]+e[15]);i.x=s*u,i.y=a*u,i.z=h*u},t.TransformNormal=function(r,o){var n=t.Zero();return t.TransformNormalToRef(r,o,n),n},t.TransformNormalToRef=function(t,r,o){this.TransformNormalFromFloatsToRef(t.x,t.y,t.z,r,o)},t.TransformNormalFromFloatsToRef=function(t,r,o,n,i){var e=n.m;i.x=t*e[0]+r*e[4]+o*e[8],i.y=t*e[1]+r*e[5]+o*e[9],i.z=t*e[2]+r*e[6]+o*e[10]},t.CatmullRom=function(r,o,n,i,e){var s=e*e,a=e*s;return new t(.5*(2*o.x+(-r.x+n.x)*e+(2*r.x-5*o.x+4*n.x-i.x)*s+(-r.x+3*o.x-3*n.x+i.x)*a),.5*(2*o.y+(-r.y+n.y)*e+(2*r.y-5*o.y+4*n.y-i.y)*s+(-r.y+3*o.y-3*n.y+i.y)*a),.5*(2*o.z+(-r.z+n.z)*e+(2*r.z-5*o.z+4*n.z-i.z)*s+(-r.z+3*o.z-3*n.z+i.z)*a))},t.Clamp=function(r,o,n){var i=new t;return t.ClampToRef(r,o,n,i),i},t.ClampToRef=function(t,r,o,n){var i=t.x;i=(i=i>o.x?o.x:i)<r.x?r.x:i;var e=t.y;e=(e=e>o.y?o.y:e)<r.y?r.y:e;var s=t.z;s=(s=s>o.z?o.z:s)<r.z?r.z:s,n.copyFromFloats(i,e,s)},t.Hermite=function(r,o,n,i,e){var s=e*e,a=e*s,h=2*a-3*s+1,u=-2*a+3*s,y=a-2*s+e,c=a-s;return new t(r.x*h+n.x*u+o.x*y+i.x*c,r.y*h+n.y*u+o.y*y+i.y*c,r.z*h+n.z*u+o.z*y+i.z*c)},t.Lerp=function(r,o,n){var i=new t(0,0,0);return t.LerpToRef(r,o,n,i),i},t.LerpToRef=function(t,r,o,n){n.x=t.x+(r.x-t.x)*o,n.y=t.y+(r.y-t.y)*o,n.z=t.z+(r.z-t.z)*o},t.Dot=function(t,r){return t.x*r.x+t.y*r.y+t.z*r.z},t.Cross=function(r,o){var n=t.Zero();return t.CrossToRef(r,o,n),n},t.CrossToRef=function(t,r,o){var n=t.y*r.z-t.z*r.y,i=t.z*r.x-t.x*r.z,e=t.x*r.y-t.y*r.x;o.copyFromFloats(n,i,e)},t.Normalize=function(r){var o=t.Zero();return t.NormalizeToRef(r,o),o},t.NormalizeToRef=function(t,r){t.normalizeToRef(r)},t.Project=function(r,o,n,i){var e=i.width,s=i.height,a=i.x,h=i.y,u=b.Matrix[1];p.FromValuesToRef(e/2,0,0,0,0,-s/2,0,0,0,0,.5,0,a+e/2,s/2+h,.5,1,u);var y=b.Matrix[0];return o.multiplyToRef(n,y),y.multiplyToRef(u,y),t.TransformCoordinates(r,y)},t._UnprojectFromInvertedMatrixToRef=function(o,n,i){t.TransformCoordinatesToRef(o,n,i);var e=n.m,s=o.x*e[3]+o.y*e[7]+o.z*e[11]+e[15];r.Scalar.WithinEpsilon(s,1)&&i.scaleInPlace(1/s)},t.UnprojectFromTransform=function(r,o,n,i,e){var s=b.Matrix[0];i.multiplyToRef(e,s),s.invert(),r.x=r.x/o*2-1,r.y=-(r.y/n*2-1);var a=new t;return t._UnprojectFromInvertedMatrixToRef(r,s,a),a},t.Unproject=function(r,o,n,i,e,s){var a=t.Zero();return t.UnprojectToRef(r,o,n,i,e,s,a),a},t.UnprojectToRef=function(r,o,n,i,e,s,a){t.UnprojectFloatsToRef(r.x,r.y,r.z,o,n,i,e,s,a)},t.UnprojectFloatsToRef=function(r,o,n,i,e,s,a,h,u){var y=b.Matrix[0];s.multiplyToRef(a,y),y.multiplyToRef(h,y),y.invert();var c=b.Vector3[0];c.x=r/i*2-1,c.y=-(o/e*2-1),c.z=2*n-1,t._UnprojectFromInvertedMatrixToRef(c,y,u)},t.Minimize=function(t,r){var o=t.clone();return o.minimizeInPlace(r),o},t.Maximize=function(t,r){var o=t.clone();return o.maximizeInPlace(r),o},t.Distance=function(r,o){return Math.sqrt(t.DistanceSquared(r,o))},t.DistanceSquared=function(t,r){var o=t.x-r.x,n=t.y-r.y,i=t.z-r.z;return o*o+n*n+i*i},t.Center=function(t,r){var o=t.add(r);return o.scaleInPlace(.5),o},t.RotationFromAxis=function(r,o,n){var i=t.Zero();return t.RotationFromAxisToRef(r,o,n,i),i},t.RotationFromAxisToRef=function(t,r,o,n){var i=b.Quaternion[0];c.RotationQuaternionFromAxisToRef(t,r,o,i),i.toEulerAnglesToRef(n)},t._UpReadOnly=t.Up(),t}();exports.Vector3=h;var u=function(){function t(t,r,o,n){this.x=t,this.y=r,this.z=o,this.w=n}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Vector4"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*(t=397*(t=397*t^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},t.prototype.toArray=function(t,r){return void 0===r&&(r=0),t[r]=this.x,t[r+1]=this.y,t[r+2]=this.z,t[r+3]=this.w,this},t.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.prototype.add=function(r){return new t(this.x+r.x,this.y+r.y,this.z+r.z,this.w+r.w)},t.prototype.addToRef=function(t,r){return r.x=this.x+t.x,r.y=this.y+t.y,r.z=this.z+t.z,r.w=this.w+t.w,this},t.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},t.prototype.subtract=function(r){return new t(this.x-r.x,this.y-r.y,this.z-r.z,this.w-r.w)},t.prototype.subtractToRef=function(t,r){return r.x=this.x-t.x,r.y=this.y-t.y,r.z=this.z-t.z,r.w=this.w-t.w,this},t.prototype.subtractFromFloats=function(r,o,n,i){return new t(this.x-r,this.y-o,this.z-n,this.w-i)},t.prototype.subtractFromFloatsToRef=function(t,r,o,n,i){return i.x=this.x-t,i.y=this.y-r,i.z=this.z-o,i.w=this.w-n,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.scale=function(r){return new t(this.x*r,this.y*r,this.z*r,this.w*r)},t.prototype.scaleToRef=function(t,r){return r.x=this.x*t,r.y=this.y*t,r.z=this.z*t,r.w=this.w*t,this},t.prototype.scaleAndAddToRef=function(t,r){return r.x+=this.x*t,r.y+=this.y*t,r.z+=this.z*t,r.w+=this.w*t,this},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.equalsWithEpsilon=function(t,o){return void 0===o&&(o=i),t&&r.Scalar.WithinEpsilon(this.x,t.x,o)&&r.Scalar.WithinEpsilon(this.y,t.y,o)&&r.Scalar.WithinEpsilon(this.z,t.z,o)&&r.Scalar.WithinEpsilon(this.w,t.w,o)},t.prototype.equalsToFloats=function(t,r,o,n){return this.x===t&&this.y===r&&this.z===o&&this.w===n},t.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},t.prototype.multiply=function(r){return new t(this.x*r.x,this.y*r.y,this.z*r.z,this.w*r.w)},t.prototype.multiplyToRef=function(t,r){return r.x=this.x*t.x,r.y=this.y*t.y,r.z=this.z*t.z,r.w=this.w*t.w,this},t.prototype.multiplyByFloats=function(r,o,n,i){return new t(this.x*r,this.y*o,this.z*n,this.w*i)},t.prototype.divide=function(r){return new t(this.x/r.x,this.y/r.y,this.z/r.z,this.w/r.w)},t.prototype.divideToRef=function(t,r){return r.x=this.x/t.x,r.y=this.y/t.y,r.z=this.z/t.z,r.w=this.w/t.w,this},t.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},t.prototype.minimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},t.prototype.maximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var t=this.length();return 0===t?this:this.scaleInPlace(1/t)},t.prototype.toVector3=function(){return new h(this.x,this.y,this.z)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,r,o,n){return this.x=t,this.y=r,this.z=o,this.w=n,this},t.prototype.set=function(t,r,o,n){return this.copyFromFloats(t,r,o,n)},t.prototype.setAll=function(t){return this.x=this.y=this.z=this.w=t,this},t.FromArray=function(r,o){return o||(o=0),new t(r[o],r[o+1],r[o+2],r[o+3])},t.FromArrayToRef=function(t,r,o){o.x=t[r],o.y=t[r+1],o.z=t[r+2],o.w=t[r+3]},t.FromFloatArrayToRef=function(r,o,n){t.FromArrayToRef(r,o,n)},t.FromFloatsToRef=function(t,r,o,n,i){i.x=t,i.y=r,i.z=o,i.w=n},t.Zero=function(){return new t(0,0,0,0)},t.One=function(){return new t(1,1,1,1)},t.Normalize=function(r){var o=t.Zero();return t.NormalizeToRef(r,o),o},t.NormalizeToRef=function(t,r){r.copyFrom(t),r.normalize()},t.Minimize=function(t,r){var o=t.clone();return o.minimizeInPlace(r),o},t.Maximize=function(t,r){var o=t.clone();return o.maximizeInPlace(r),o},t.Distance=function(r,o){return Math.sqrt(t.DistanceSquared(r,o))},t.DistanceSquared=function(t,r){var o=t.x-r.x,n=t.y-r.y,i=t.z-r.z,e=t.w-r.w;return o*o+n*n+i*i+e*e},t.Center=function(t,r){var o=t.add(r);return o.scaleInPlace(.5),o},t.TransformNormal=function(r,o){var n=t.Zero();return t.TransformNormalToRef(r,o,n),n},t.TransformNormalToRef=function(t,r,o){var n=r.m,i=t.x*n[0]+t.y*n[4]+t.z*n[8],e=t.x*n[1]+t.y*n[5]+t.z*n[9],s=t.x*n[2]+t.y*n[6]+t.z*n[10];o.x=i,o.y=e,o.z=s,o.w=t.w},t.TransformNormalFromFloatsToRef=function(t,r,o,n,i,e){var s=i.m;e.x=t*s[0]+r*s[4]+o*s[8],e.y=t*s[1]+r*s[5]+o*s[9],e.z=t*s[2]+r*s[6]+o*s[10],e.w=n},t.FromVector3=function(r,o){return void 0===o&&(o=0),new t(r.x,r.y,r.z,o)},t}();exports.Vector4=u;var y=function(){function t(t,r){this.width=t,this.height=r}return t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){var t=this.width||0;return t=397*t^(this.height||0)},t.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},t.prototype.copyFromFloats=function(t,r){return this.width=t,this.height=r,this},t.prototype.set=function(t,r){return this.copyFromFloats(t,r)},t.prototype.multiplyByFloats=function(r,o){return new t(this.width*r,this.height*o)},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(t){return!!t&&(this.width===t.width&&this.height===t.height)},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(r){return new t(this.width+r.width,this.height+r.height)},t.prototype.subtract=function(r){return new t(this.width-r.width,this.height-r.height)},t.Lerp=function(r,o,n){return new t(r.width+(o.width-r.width)*n,r.height+(o.height-r.height)*n)},t}();exports.Size=y;var c=function(){function t(t,r,o,n){void 0===t&&(t=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=1),this.x=t,this.y=r,this.z=o,this.w=n}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*(t=397*(t=397*t^(this.y||0))^(this.z||0))^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,r,o,n){return this.x=t,this.y=r,this.z=o,this.w=n,this},t.prototype.set=function(t,r,o,n){return this.copyFromFloats(t,r,o,n)},t.prototype.add=function(r){return new t(this.x+r.x,this.y+r.y,this.z+r.z,this.w+r.w)},t.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.prototype.subtract=function(r){return new t(this.x-r.x,this.y-r.y,this.z-r.z,this.w-r.w)},t.prototype.scale=function(r){return new t(this.x*r,this.y*r,this.z*r,this.w*r)},t.prototype.scaleToRef=function(t,r){return r.x=this.x*t,r.y=this.y*t,r.z=this.z*t,r.w=this.w*t,this},t.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.scaleAndAddToRef=function(t,r){return r.x+=this.x*t,r.y+=this.y*t,r.z+=this.z*t,r.w+=this.w*t,this},t.prototype.multiply=function(r){var o=new t(0,0,0,1);return this.multiplyToRef(r,o),o},t.prototype.multiplyToRef=function(t,r){var o=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,i=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,e=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return r.copyFromFloats(o,n,i,e),this},t.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},t.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){return new t(-this.x,-this.y,-this.z,this.w)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(t){void 0===t&&(t="YZX");var r=h.Zero();return this.toEulerAnglesToRef(r),r},t.prototype.toEulerAnglesToRef=function(t){var r=this.z,o=this.x,n=this.y,i=this.w,e=i*i,s=r*r,a=o*o,h=n*n,u=n*r-o*i;return u<-.4999999?(t.y=2*Math.atan2(n,i),t.x=Math.PI/2,t.z=0):u>.4999999?(t.y=2*Math.atan2(n,i),t.x=-Math.PI/2,t.z=0):(t.z=Math.atan2(2*(o*n+r*i),-s-a+h+e),t.x=Math.asin(-2*(r*n-o*i)),t.y=Math.atan2(2*(r*o+n*i),s-a-h+e)),this},t.prototype.toRotationMatrix=function(t){return p.FromQuaternionToRef(this,t),this},t.prototype.fromRotationMatrix=function(r){return t.FromRotationMatrixToRef(r,this),this},t.FromRotationMatrix=function(r){var o=new t;return t.FromRotationMatrixToRef(r,o),o},t.FromRotationMatrixToRef=function(t,r){var o,n=t.m,i=n[0],e=n[4],s=n[8],a=n[1],h=n[5],u=n[9],y=n[2],c=n[6],p=n[10],f=i+h+p;f>0?(o=.5/Math.sqrt(f+1),r.w=.25/o,r.x=(c-u)*o,r.y=(s-y)*o,r.z=(a-e)*o):i>h&&i>p?(o=2*Math.sqrt(1+i-h-p),r.w=(c-u)/o,r.x=.25*o,r.y=(e+a)/o,r.z=(s+y)/o):h>p?(o=2*Math.sqrt(1+h-i-p),r.w=(s-y)/o,r.x=(e+a)/o,r.y=.25*o,r.z=(u+c)/o):(o=2*Math.sqrt(1+p-i-h),r.w=(a-e)/o,r.x=(s+y)/o,r.y=(u+c)/o,r.z=.25*o)},t.Dot=function(t,r){return t.x*r.x+t.y*r.y+t.z*r.z+t.w*r.w},t.AreClose=function(r,o){return t.Dot(r,o)>=0},t.Zero=function(){return new t(0,0,0,0)},t.Inverse=function(r){return new t(-r.x,-r.y,-r.z,r.w)},t.InverseToRef=function(t,r){return r.set(-t.x,-t.y,-t.z,t.w),r},t.Identity=function(){return new t(0,0,0,1)},t.IsIdentity=function(t){return t&&0===t.x&&0===t.y&&0===t.z&&1===t.w},t.RotationAxis=function(r,o){return t.RotationAxisToRef(r,o,new t)},t.RotationAxisToRef=function(t,r,o){var n=Math.sin(r/2);return t.normalize(),o.w=Math.cos(r/2),o.x=t.x*n,o.y=t.y*n,o.z=t.z*n,o},t.FromArray=function(r,o){return o||(o=0),new t(r[o],r[o+1],r[o+2],r[o+3])},t.FromEulerAngles=function(r,o,n){var i=new t;return t.RotationYawPitchRollToRef(o,r,n,i),i},t.FromEulerAnglesToRef=function(r,o,n,i){return t.RotationYawPitchRollToRef(o,r,n,i),i},t.FromEulerVector=function(r){var o=new t;return t.RotationYawPitchRollToRef(r.y,r.x,r.z,o),o},t.FromEulerVectorToRef=function(r,o){return t.RotationYawPitchRollToRef(r.y,r.x,r.z,o),o},t.RotationYawPitchRoll=function(r,o,n){var i=new t;return t.RotationYawPitchRollToRef(r,o,n,i),i},t.RotationYawPitchRollToRef=function(t,r,o,n){var i=.5*o,e=.5*r,s=.5*t,a=Math.sin(i),h=Math.cos(i),u=Math.sin(e),y=Math.cos(e),c=Math.sin(s),p=Math.cos(s);n.x=p*u*h+c*y*a,n.y=c*y*h-p*u*a,n.z=p*y*a-c*u*h,n.w=p*y*h+c*u*a},t.RotationAlphaBetaGamma=function(r,o,n){var i=new t;return t.RotationAlphaBetaGammaToRef(r,o,n,i),i},t.RotationAlphaBetaGammaToRef=function(t,r,o,n){var i=.5*(o+t),e=.5*(o-t),s=.5*r;n.x=Math.cos(e)*Math.sin(s),n.y=Math.sin(e)*Math.sin(s),n.z=Math.sin(i)*Math.cos(s),n.w=Math.cos(i)*Math.cos(s)},t.RotationQuaternionFromAxis=function(r,o,n){var i=new t(0,0,0,0);return t.RotationQuaternionFromAxisToRef(r,o,n,i),i},t.RotationQuaternionFromAxisToRef=function(r,o,n,i){var e=b.Matrix[0];p.FromXYZAxesToRef(r.normalize(),o.normalize(),n.normalize(),e),t.FromRotationMatrixToRef(e,i)},t.Slerp=function(r,o,n){var i=t.Identity();return t.SlerpToRef(r,o,n,i),i},t.SlerpToRef=function(t,r,o,n){var i,e,s=t.x*r.x+t.y*r.y+t.z*r.z+t.w*r.w,a=!1;if(s<0&&(a=!0,s=-s),s>.999999)e=1-o,i=a?-o:o;else{var h=Math.acos(s),u=1/Math.sin(h);e=Math.sin((1-o)*h)*u,i=a?-Math.sin(o*h)*u:Math.sin(o*h)*u}n.x=e*t.x+i*r.x,n.y=e*t.y+i*r.y,n.z=e*t.z+i*r.z,n.w=e*t.w+i*r.w},t.Hermite=function(r,o,n,i,e){var s=e*e,a=e*s,h=2*a-3*s+1,u=-2*a+3*s,y=a-2*s+e,c=a-s;return new t(r.x*h+n.x*u+o.x*y+i.x*c,r.y*h+n.y*u+o.y*y+i.y*c,r.z*h+n.z*u+o.z*y+i.z*c,r.w*h+n.w*u+o.w*y+i.w*c)},t}();exports.Quaternion=c;var p=function(){function t(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}return Object.defineProperty(t.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),t.prototype._markAsUpdated=function(){this.updateFlag=t._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},t.prototype._updateIdentityStatus=function(r,o,n,i){void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===i&&(i=!0),this.updateFlag=t._updateFlagSeed++,this._isIdentity=r,this._isIdentity3x2=r||n,this._isIdentityDirty=!this._isIdentity&&o,this._isIdentity3x2Dirty=!this._isIdentity3x2&&i},t.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var t=this._m;this._isIdentity=1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}return this._isIdentity},t.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]?this._isIdentity3x2=!1:0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},t.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var t=this._m,r=t[0],o=t[1],n=t[2],i=t[3],e=t[4],s=t[5],a=t[6],h=t[7],u=t[8],y=t[9],c=t[10],p=t[11],f=t[12],l=t[13],m=t[14],x=t[15],d=c*x-m*p,w=y*x-l*p,v=y*m-l*c,z=u*x-f*p,R=u*m-c*f,T=u*l-f*y;return r*+(s*d-a*w+h*v)+o*-(e*d-a*z+h*R)+n*+(e*w-s*z+h*T)+i*-(e*v-s*R+a*T)},t.prototype.toArray=function(){return this._m},t.prototype.asArray=function(){return this._m},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){return t.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},t.prototype.add=function(r){var o=new t;return this.addToRef(r,o),o},t.prototype.addToRef=function(t,r){for(var o=this._m,n=r._m,i=t.m,e=0;e<16;e++)n[e]=o[e]+i[e];return r._markAsUpdated(),this},t.prototype.addToSelf=function(t){for(var r=this._m,o=t.m,n=0;n<16;n++)r[n]+=o[n];return this._markAsUpdated(),this},t.prototype.invertToRef=function(r){if(!0===this._isIdentity)return t.IdentityToRef(r),this;var o=this._m,n=o[0],i=o[1],e=o[2],s=o[3],a=o[4],h=o[5],u=o[6],y=o[7],c=o[8],p=o[9],f=o[10],l=o[11],m=o[12],x=o[13],d=o[14],w=o[15],v=f*w-d*l,z=p*w-x*l,R=p*d-x*f,T=c*w-m*l,g=c*d-f*m,_=c*x-m*p,F=+(h*v-u*z+y*R),M=-(a*v-u*T+y*g),A=+(a*z-h*T+y*_),b=-(a*R-h*g+u*_),I=n*F+i*M+e*A+s*b;if(0===I)return r.copyFrom(this),this;var P=1/I,S=u*w-d*y,C=h*w-x*y,V=h*d-x*u,L=a*w-m*y,D=a*d-m*u,H=a*x-m*h,N=u*l-f*y,q=h*l-p*y,B=h*f-p*u,O=a*l-c*y,U=a*f-c*u,Z=a*p-c*h,G=-(i*v-e*z+s*R),k=+(n*v-e*T+s*g),W=-(n*z-i*T+s*_),E=+(n*R-i*g+e*_),Y=+(i*S-e*C+s*V),Q=-(n*S-e*L+s*D),j=+(n*C-i*L+s*H),X=-(n*V-i*D+e*H),J=-(i*N-e*q+s*B),K=+(n*N-e*O+s*U),$=-(n*q-i*O+s*Z),tt=+(n*B-i*U+e*Z);return t.FromValuesToRef(F*P,G*P,Y*P,J*P,M*P,k*P,Q*P,K*P,A*P,W*P,j*P,$*P,b*P,E*P,X*P,tt*P,r),this},t.prototype.addAtIndex=function(t,r){return this._m[t]+=r,this._markAsUpdated(),this},t.prototype.multiplyAtIndex=function(t,r){return this._m[t]*=r,this._markAsUpdated(),this},t.prototype.setTranslationFromFloats=function(t,r,o){return this._m[12]=t,this._m[13]=r,this._m[14]=o,this._markAsUpdated(),this},t.prototype.setTranslation=function(t){return this.setTranslationFromFloats(t.x,t.y,t.z)},t.prototype.getTranslation=function(){return new h(this._m[12],this._m[13],this._m[14])},t.prototype.getTranslationToRef=function(t){return t.x=this._m[12],t.y=this._m[13],t.z=this._m[14],this},t.prototype.removeRotationAndScaling=function(){var r=this.m;return t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,r[12],r[13],r[14],r[15],this),this._updateIdentityStatus(0===r[12]&&0===r[13]&&0===r[14]&&1===r[15]),this},t.prototype.multiply=function(r){var o=new t;return this.multiplyToRef(r,o),o},t.prototype.copyFrom=function(t){t.copyToArray(this._m);var r=t;return this._updateIdentityStatus(r._isIdentity,r._isIdentityDirty,r._isIdentity3x2,r._isIdentity3x2Dirty),this},t.prototype.copyToArray=function(t,r){void 0===r&&(r=0);for(var o=0;o<16;o++)t[r+o]=this._m[o];return this},t.prototype.multiplyToRef=function(t,r){return this._isIdentity?(r.copyFrom(t),this):t._isIdentity?(r.copyFrom(this),this):(this.multiplyToArray(t,r._m,0),r._markAsUpdated(),this)},t.prototype.multiplyToArray=function(t,r,o){var n=this._m,i=t.m,e=n[0],s=n[1],a=n[2],h=n[3],u=n[4],y=n[5],c=n[6],p=n[7],f=n[8],l=n[9],m=n[10],x=n[11],d=n[12],w=n[13],v=n[14],z=n[15],R=i[0],T=i[1],g=i[2],_=i[3],F=i[4],M=i[5],A=i[6],b=i[7],I=i[8],P=i[9],S=i[10],C=i[11],V=i[12],L=i[13],D=i[14],H=i[15];return r[o]=e*R+s*F+a*I+h*V,r[o+1]=e*T+s*M+a*P+h*L,r[o+2]=e*g+s*A+a*S+h*D,r[o+3]=e*_+s*b+a*C+h*H,r[o+4]=u*R+y*F+c*I+p*V,r[o+5]=u*T+y*M+c*P+p*L,r[o+6]=u*g+y*A+c*S+p*D,r[o+7]=u*_+y*b+c*C+p*H,r[o+8]=f*R+l*F+m*I+x*V,r[o+9]=f*T+l*M+m*P+x*L,r[o+10]=f*g+l*A+m*S+x*D,r[o+11]=f*_+l*b+m*C+x*H,r[o+12]=d*R+w*F+v*I+z*V,r[o+13]=d*T+w*M+v*P+z*L,r[o+14]=d*g+w*A+v*S+z*D,r[o+15]=d*_+w*b+v*C+z*H,this},t.prototype.equals=function(t){var r=t;if(!r)return!1;if((this._isIdentity||r._isIdentity)&&!this._isIdentityDirty&&!r._isIdentityDirty)return this._isIdentity&&r._isIdentity;var o=this.m,n=r.m;return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]&&o[3]===n[3]&&o[4]===n[4]&&o[5]===n[5]&&o[6]===n[6]&&o[7]===n[7]&&o[8]===n[8]&&o[9]===n[9]&&o[10]===n[10]&&o[11]===n[11]&&o[12]===n[12]&&o[13]===n[13]&&o[14]===n[14]&&o[15]===n[15]},t.prototype.clone=function(){var r=new t;return r.copyFrom(this),r},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var t=this._m[0]||0,r=1;r<16;r++)t=397*t^(this._m[r]||0);return t},t.prototype.decompose=function(r,o,n){if(this._isIdentity)return n&&n.setAll(0),r&&r.setAll(1),o&&o.copyFromFloats(0,0,0,1),!0;var i=this._m;if(n&&n.copyFromFloats(i[12],i[13],i[14]),(r=r||b.Vector3[0]).x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),r.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),r.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),this.determinant()<=0&&(r.y*=-1),0===r.x||0===r.y||0===r.z)return o&&o.copyFromFloats(0,0,0,1),!1;if(o){var e=1/r.x,s=1/r.y,a=1/r.z;t.FromValuesToRef(i[0]*e,i[1]*e,i[2]*e,0,i[4]*s,i[5]*s,i[6]*s,0,i[8]*a,i[9]*a,i[10]*a,0,0,0,0,1,b.Matrix[0]),c.FromRotationMatrixToRef(b.Matrix[0],o)}return!0},t.prototype.getRow=function(t){if(t<0||t>3)return null;var r=4*t;return new u(this._m[r+0],this._m[r+1],this._m[r+2],this._m[r+3])},t.prototype.setRow=function(t,r){return this.setRowFromFloats(t,r.x,r.y,r.z,r.w)},t.prototype.transpose=function(){return t.Transpose(this)},t.prototype.transposeToRef=function(r){return t.TransposeToRef(this,r),this},t.prototype.setRowFromFloats=function(t,r,o,n,i){if(t<0||t>3)return this;var e=4*t;return this._m[e+0]=r,this._m[e+1]=o,this._m[e+2]=n,this._m[e+3]=i,this._markAsUpdated(),this},t.prototype.scale=function(r){var o=new t;return this.scaleToRef(r,o),o},t.prototype.scaleToRef=function(t,r){for(var o=0;o<16;o++)r._m[o]=this._m[o]*t;return r._markAsUpdated(),this},t.prototype.scaleAndAddToRef=function(t,r){for(var o=0;o<16;o++)r._m[o]+=this._m[o]*t;return r._markAsUpdated(),this},t.prototype.toNormalMatrix=function(r){var o=b.Matrix[0];this.invertToRef(o),o.transposeToRef(r);var n=r._m;t.FromValuesToRef(n[0],n[1],n[2],0,n[4],n[5],n[6],0,n[8],n[9],n[10],0,0,0,0,1,r)},t.prototype.getRotationMatrix=function(){var r=new t;return this.getRotationMatrixToRef(r),r},t.prototype.getRotationMatrixToRef=function(r){var o=b.Vector3[0];if(!this.decompose(o))return t.IdentityToRef(r),this;var n=this._m,i=1/o.x,e=1/o.y,s=1/o.z;return t.FromValuesToRef(n[0]*i,n[1]*i,n[2]*i,0,n[4]*e,n[5]*e,n[6]*e,0,n[8]*s,n[9]*s,n[10]*s,0,0,0,0,1,r),this},t.prototype.toggleModelMatrixHandInPlace=function(){var t=this._m;t[2]*=-1,t[6]*=-1,t[8]*=-1,t[9]*=-1,t[14]*=-1,this._markAsUpdated()},t.prototype.toggleProjectionMatrixHandInPlace=function(){var t=this._m;t[8]*=-1,t[9]*=-1,t[10]*=-1,t[11]*=-1,this._markAsUpdated()},t.FromArray=function(r,o){void 0===o&&(o=0);var n=new t;return t.FromArrayToRef(r,o,n),n},t.FromArrayToRef=function(t,r,o){for(var n=0;n<16;n++)o._m[n]=t[n+r];o._markAsUpdated()},t.FromFloat32ArrayToRefScaled=function(t,r,o,n){for(var i=0;i<16;i++)n._m[i]=t[i+r]*o;n._markAsUpdated()},Object.defineProperty(t,"IdentityReadOnly",{get:function(){return t._identityReadOnly},enumerable:!0,configurable:!0}),t.FromValuesToRef=function(t,r,o,n,i,e,s,a,h,u,y,c,p,f,l,m,x){var d=x._m;d[0]=t,d[1]=r,d[2]=o,d[3]=n,d[4]=i,d[5]=e,d[6]=s,d[7]=a,d[8]=h,d[9]=u,d[10]=y,d[11]=c,d[12]=p,d[13]=f,d[14]=l,d[15]=m,x._markAsUpdated()},t.FromValues=function(r,o,n,i,e,s,a,h,u,y,c,p,f,l,m,x){var d=new t,w=d._m;return w[0]=r,w[1]=o,w[2]=n,w[3]=i,w[4]=e,w[5]=s,w[6]=a,w[7]=h,w[8]=u,w[9]=y,w[10]=c,w[11]=p,w[12]=f,w[13]=l,w[14]=m,w[15]=x,d._markAsUpdated(),d},t.Compose=function(r,o,n){var i=new t;return t.ComposeToRef(r,o,n,i),i},t.ComposeToRef=function(r,o,n,i){t.ScalingToRef(r.x,r.y,r.z,b.Matrix[1]),o.toRotationMatrix(b.Matrix[0]),b.Matrix[1].multiplyToRef(b.Matrix[0],i),i.setTranslation(n)},t.Identity=function(){var r=t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return r._updateIdentityStatus(!0),r},t.IdentityToRef=function(r){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,r),r._updateIdentityStatus(!0)},t.Zero=function(){var r=t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return r._updateIdentityStatus(!1),r},t.RotationX=function(r){var o=new t;return t.RotationXToRef(r,o),o},t.Invert=function(r){var o=new t;return r.invertToRef(o),o},t.RotationXToRef=function(r,o){var n=Math.sin(r),i=Math.cos(r);t.FromValuesToRef(1,0,0,0,0,i,n,0,0,-n,i,0,0,0,0,1,o),o._updateIdentityStatus(1===i&&0===n)},t.RotationY=function(r){var o=new t;return t.RotationYToRef(r,o),o},t.RotationYToRef=function(r,o){var n=Math.sin(r),i=Math.cos(r);t.FromValuesToRef(i,0,-n,0,0,1,0,0,n,0,i,0,0,0,0,1,o),o._updateIdentityStatus(1===i&&0===n)},t.RotationZ=function(r){var o=new t;return t.RotationZToRef(r,o),o},t.RotationZToRef=function(r,o){var n=Math.sin(r),i=Math.cos(r);t.FromValuesToRef(i,n,0,0,-n,i,0,0,0,0,1,0,0,0,0,1,o),o._updateIdentityStatus(1===i&&0===n)},t.RotationAxis=function(r,o){var n=new t;return t.RotationAxisToRef(r,o,n),n},t.RotationAxisToRef=function(t,r,o){var n=Math.sin(-r),i=Math.cos(-r),e=1-i;t.normalize();var s=o._m;s[0]=t.x*t.x*e+i,s[1]=t.x*t.y*e-t.z*n,s[2]=t.x*t.z*e+t.y*n,s[3]=0,s[4]=t.y*t.x*e+t.z*n,s[5]=t.y*t.y*e+i,s[6]=t.y*t.z*e-t.x*n,s[7]=0,s[8]=t.z*t.x*e-t.y*n,s[9]=t.z*t.y*e+t.x*n,s[10]=t.z*t.z*e+i,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,o._markAsUpdated()},t.RotationYawPitchRoll=function(r,o,n){var i=new t;return t.RotationYawPitchRollToRef(r,o,n,i),i},t.RotationYawPitchRollToRef=function(t,r,o,n){c.RotationYawPitchRollToRef(t,r,o,b.Quaternion[0]),b.Quaternion[0].toRotationMatrix(n)},t.Scaling=function(r,o,n){var i=new t;return t.ScalingToRef(r,o,n,i),i},t.ScalingToRef=function(r,o,n,i){t.FromValuesToRef(r,0,0,0,0,o,0,0,0,0,n,0,0,0,0,1,i),i._updateIdentityStatus(1===r&&1===o&&1===n)},t.Translation=function(r,o,n){var i=new t;return t.TranslationToRef(r,o,n,i),i},t.TranslationToRef=function(r,o,n,i){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,r,o,n,1,i),i._updateIdentityStatus(0===r&&0===o&&0===n)},t.Lerp=function(r,o,n){var i=new t;return t.LerpToRef(r,o,n,i),i},t.LerpToRef=function(t,r,o,n){for(var i=n._m,e=t.m,s=r.m,a=0;a<16;a++)i[a]=e[a]*(1-o)+s[a]*o;n._markAsUpdated()},t.DecomposeLerp=function(r,o,n){var i=new t;return t.DecomposeLerpToRef(r,o,n,i),i},t.DecomposeLerpToRef=function(r,o,n,i){var e=b.Vector3[0],s=b.Quaternion[0],a=b.Vector3[1];r.decompose(e,s,a);var u=b.Vector3[2],y=b.Quaternion[1],p=b.Vector3[3];o.decompose(u,y,p);var f=b.Vector3[4];h.LerpToRef(e,u,n,f);var l=b.Quaternion[2];c.SlerpToRef(s,y,n,l);var m=b.Vector3[5];h.LerpToRef(a,p,n,m),t.ComposeToRef(f,l,m,i)},t.LookAtLH=function(r,o,n){var i=new t;return t.LookAtLHToRef(r,o,n,i),i},t.LookAtLHToRef=function(r,o,n,i){var e=b.Vector3[0],s=b.Vector3[1],a=b.Vector3[2];o.subtractToRef(r,a),a.normalize(),h.CrossToRef(n,a,e);var u=e.lengthSquared();0===u?e.x=1:e.normalizeFromLength(Math.sqrt(u)),h.CrossToRef(a,e,s),s.normalize();var y=-h.Dot(e,r),c=-h.Dot(s,r),p=-h.Dot(a,r);t.FromValuesToRef(e.x,s.x,a.x,0,e.y,s.y,a.y,0,e.z,s.z,a.z,0,y,c,p,1,i)},t.LookAtRH=function(r,o,n){var i=new t;return t.LookAtRHToRef(r,o,n,i),i},t.LookAtRHToRef=function(r,o,n,i){var e=b.Vector3[0],s=b.Vector3[1],a=b.Vector3[2];r.subtractToRef(o,a),a.normalize(),h.CrossToRef(n,a,e);var u=e.lengthSquared();0===u?e.x=1:e.normalizeFromLength(Math.sqrt(u)),h.CrossToRef(a,e,s),s.normalize();var y=-h.Dot(e,r),c=-h.Dot(s,r),p=-h.Dot(a,r);t.FromValuesToRef(e.x,s.x,a.x,0,e.y,s.y,a.y,0,e.z,s.z,a.z,0,y,c,p,1,i)},t.OrthoLH=function(r,o,n,i){var e=new t;return t.OrthoLHToRef(r,o,n,i,e),e},t.OrthoLHToRef=function(r,o,n,i,e){var s=2/r,a=2/o,h=2/(i-n),u=-(i+n)/(i-n);t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,0,0,0,u,1,e),e._updateIdentityStatus(1===s&&1===a&&1===h&&0===u)},t.OrthoOffCenterLH=function(r,o,n,i,e,s){var a=new t;return t.OrthoOffCenterLHToRef(r,o,n,i,e,s,a),a},t.OrthoOffCenterLHToRef=function(r,o,n,i,e,s,a){var h=2/(o-r),u=2/(i-n),y=2/(s-e),c=-(s+e)/(s-e),p=(r+o)/(r-o),f=(i+n)/(n-i);t.FromValuesToRef(h,0,0,0,0,u,0,0,0,0,y,0,p,f,c,1,a),a._markAsUpdated()},t.OrthoOffCenterRH=function(r,o,n,i,e,s){var a=new t;return t.OrthoOffCenterRHToRef(r,o,n,i,e,s,a),a},t.OrthoOffCenterRHToRef=function(r,o,n,i,e,s,a){t.OrthoOffCenterLHToRef(r,o,n,i,e,s,a),a._m[10]*=-1},t.PerspectiveLH=function(r,o,n,i){var e=new t,s=2*n/r,a=2*n/o,h=(i+n)/(i-n),u=-2*i*n/(i-n);return t.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,1,0,0,u,0,e),e._updateIdentityStatus(!1),e},t.PerspectiveFovLH=function(r,o,n,i){var e=new t;return t.PerspectiveFovLHToRef(r,o,n,i,e),e},t.PerspectiveFovLHToRef=function(r,o,n,i,e,s){void 0===s&&(s=!0);var a=n,h=i,u=1/Math.tan(.5*r),y=s?u/o:u,c=s?u:u*o,p=(h+a)/(h-a),f=-2*h*a/(h-a);t.FromValuesToRef(y,0,0,0,0,c,0,0,0,0,p,1,0,0,f,0,e),e._updateIdentityStatus(!1)},t.PerspectiveFovRH=function(r,o,n,i){var e=new t;return t.PerspectiveFovRHToRef(r,o,n,i,e),e},t.PerspectiveFovRHToRef=function(r,o,n,i,e,s){void 0===s&&(s=!0);var a=n,h=i,u=1/Math.tan(.5*r),y=s?u/o:u,c=s?u:u*o,p=-(h+a)/(h-a),f=-2*h*a/(h-a);t.FromValuesToRef(y,0,0,0,0,c,0,0,0,0,p,-1,0,0,f,0,e),e._updateIdentityStatus(!1)},t.PerspectiveFovWebVRToRef=function(t,r,o,n,i){void 0===i&&(i=!1);var e=i?-1:1,s=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),h=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),y=2/(h+u),c=2/(s+a),p=n._m;p[0]=y,p[1]=p[2]=p[3]=p[4]=0,p[5]=c,p[6]=p[7]=0,p[8]=(h-u)*y*.5,p[9]=-(s-a)*c*.5,p[10]=-o/(r-o),p[11]=1*e,p[12]=p[13]=p[15]=0,p[14]=-2*o*r/(o-r),n._markAsUpdated()},t.GetFinalMatrix=function(r,o,n,i,e,s){var a=r.width,h=r.height,u=r.x,y=r.y,c=t.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-e,0,u+a/2,h/2+y,e,1),p=b.Matrix[0];return o.multiplyToRef(n,p),p.multiplyToRef(i,p),p.multiply(c)},t.GetAsMatrix2x2=function(t){var r=t.m;return new Float32Array([r[0],r[1],r[4],r[5]])},t.GetAsMatrix3x3=function(t){var r=t.m;return new Float32Array([r[0],r[1],r[2],r[4],r[5],r[6],r[8],r[9],r[10]])},t.Transpose=function(r){var o=new t;return t.TransposeToRef(r,o),o},t.TransposeToRef=function(t,r){var o=r._m,n=t.m;o[0]=n[0],o[1]=n[4],o[2]=n[8],o[3]=n[12],o[4]=n[1],o[5]=n[5],o[6]=n[9],o[7]=n[13],o[8]=n[2],o[9]=n[6],o[10]=n[10],o[11]=n[14],o[12]=n[3],o[13]=n[7],o[14]=n[11],o[15]=n[15],r._updateIdentityStatus(t._isIdentity,t._isIdentityDirty)},t.Reflection=function(r){var o=new t;return t.ReflectionToRef(r,o),o},t.ReflectionToRef=function(r,o){r.normalize();var n=r.normal.x,i=r.normal.y,e=r.normal.z,s=-2*n,a=-2*i,h=-2*e;t.FromValuesToRef(s*n+1,a*n,h*n,0,s*i,a*i+1,h*i,0,s*e,a*e,h*e+1,0,s*r.d,a*r.d,h*r.d,1,o)},t.FromXYZAxesToRef=function(r,o,n,i){t.FromValuesToRef(r.x,r.y,r.z,0,o.x,o.y,o.z,0,n.x,n.y,n.z,0,0,0,0,1,i)},t.FromQuaternionToRef=function(t,r){var o=t.x*t.x,n=t.y*t.y,i=t.z*t.z,e=t.x*t.y,s=t.z*t.w,a=t.z*t.x,h=t.y*t.w,u=t.y*t.z,y=t.x*t.w;r._m[0]=1-2*(n+i),r._m[1]=2*(e+s),r._m[2]=2*(a-h),r._m[3]=0,r._m[4]=2*(e-s),r._m[5]=1-2*(i+o),r._m[6]=2*(u+y),r._m[7]=0,r._m[8]=2*(a+h),r._m[9]=2*(u-y),r._m[10]=1-2*(n+o),r._m[11]=0,r._m[12]=0,r._m[13]=0,r._m[14]=0,r._m[15]=1,r._markAsUpdated()},t._updateFlagSeed=0,t._identityReadOnly=t.Identity(),t}();exports.Matrix=p;var f=function(){function t(t,r,o,n){this.normal=new h(t,r,o),this.d=n}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=397*t^(this.d||0)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),r=0;return 0!==t&&(r=1/t),this.normal.x*=r,this.normal.y*=r,this.normal.z*=r,this.d*=r,this},t.prototype.transform=function(r){var o=b.Matrix[0];p.TransposeToRef(r,o);var n=o.m,i=this.normal.x,e=this.normal.y,s=this.normal.z,a=this.d;return new t(i*n[0]+e*n[1]+s*n[2]+a*n[3],i*n[4]+e*n[5]+s*n[6]+a*n[7],i*n[8]+e*n[9]+s*n[10]+a*n[11],i*n[12]+e*n[13]+s*n[14]+a*n[15])},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,r,o){var n,i=r.x-t.x,e=r.y-t.y,s=r.z-t.z,a=o.x-t.x,h=o.y-t.y,u=o.z-t.z,y=e*u-s*h,c=s*a-i*u,p=i*h-e*a,f=Math.sqrt(y*y+c*c+p*p);return n=0!==f?1/f:0,this.normal.x=y*n,this.normal.y=c*n,this.normal.z=p*n,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,r){return h.Dot(this.normal,t)<=r},t.prototype.signedDistanceTo=function(t){return h.Dot(t,this.normal)+this.d},t.FromArray=function(r){return new t(r[0],r[1],r[2],r[3])},t.FromPoints=function(r,o,n){var i=new t(0,0,0,0);return i.copyFromPoints(r,o,n),i},t.FromPositionAndNormal=function(r,o){var n=new t(0,0,0,0);return o.normalize(),n.normal=o,n.d=-(o.x*r.x+o.y*r.y+o.z*r.z),n},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,r,o){var n=-(r.x*t.x+r.y*t.y+r.z*t.z);return h.Dot(o,r)+n},t}();exports.Plane=f;var l=function(){function t(t,r,o,n){this.x=t,this.y=r,this.width=o,this.height=n}return t.prototype.toGlobal=function(r,o){return new t(this.x*r,this.y*o,this.width*r,this.height*o)},t.prototype.toGlobalToRef=function(t,r,o){return o.x=this.x*t,o.y=this.y*r,o.width=this.width*t,o.height=this.height*r,this},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t}();exports.Viewport=l;var m,x=function(){function t(){}return t.GetPlanes=function(r){for(var o=[],n=0;n<6;n++)o.push(new f(0,0,0,0));return t.GetPlanesToRef(r,o),o},t.GetNearPlaneToRef=function(t,r){var o=t.m;r.normal.x=o[3]+o[2],r.normal.y=o[7]+o[6],r.normal.z=o[11]+o[10],r.d=o[15]+o[14],r.normalize()},t.GetFarPlaneToRef=function(t,r){var o=t.m;r.normal.x=o[3]-o[2],r.normal.y=o[7]-o[6],r.normal.z=o[11]-o[10],r.d=o[15]-o[14],r.normalize()},t.GetLeftPlaneToRef=function(t,r){var o=t.m;r.normal.x=o[3]+o[0],r.normal.y=o[7]+o[4],r.normal.z=o[11]+o[8],r.d=o[15]+o[12],r.normalize()},t.GetRightPlaneToRef=function(t,r){var o=t.m;r.normal.x=o[3]-o[0],r.normal.y=o[7]-o[4],r.normal.z=o[11]-o[8],r.d=o[15]-o[12],r.normalize()},t.GetTopPlaneToRef=function(t,r){var o=t.m;r.normal.x=o[3]-o[1],r.normal.y=o[7]-o[5],r.normal.z=o[11]-o[9],r.d=o[15]-o[13],r.normalize()},t.GetBottomPlaneToRef=function(t,r){var o=t.m;r.normal.x=o[3]+o[1],r.normal.y=o[7]+o[5],r.normal.z=o[11]+o[9],r.d=o[15]+o[13],r.normalize()},t.GetPlanesToRef=function(r,o){t.GetNearPlaneToRef(r,o[0]),t.GetFarPlaneToRef(r,o[1]),t.GetLeftPlaneToRef(r,o[2]),t.GetRightPlaneToRef(r,o[3]),t.GetTopPlaneToRef(r,o[4]),t.GetBottomPlaneToRef(r,o[5])},t}();exports.Frustum=x,exports.Space=m,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD",t[t.BONE=2]="BONE"}(m||(exports.Space=m={}));var d=function(){function t(){}return t.X=new h(1,0,0),t.Y=new h(0,1,0),t.Z=new h(0,0,1),t}();exports.Axis=d;var w,v=function(){function t(){}return t.Interpolate=function(t,r,o,n,i){for(var e=1-3*n+3*r,s=3*n-6*r,a=3*r,h=t,u=0;u<5;u++){var y=h*h;h-=(e*(y*h)+s*y+a*h-t)*(1/(3*e*y+2*s*h+a)),h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*o+3*(1-h)*Math.pow(h,2)*i+Math.pow(h,3)},t}();exports.BezierCurve=v,exports.Orientation=w,function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(w||(exports.Orientation=w={}));var z=function(){function t(t){this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.prototype.degrees=function(){return 180*this._radians/Math.PI},t.prototype.radians=function(){return this._radians},t.BetweenTwoPoints=function(r,o){var n=o.subtract(r);return new t(Math.atan2(n.y,n.x))},t.FromRadians=function(r){return new t(r)},t.FromDegrees=function(r){return new t(r*Math.PI/180)},t}();exports.Angle=z;var R=function(){return function(t,r,o){this.startPoint=t,this.midPoint=r,this.endPoint=o;var n=Math.pow(r.x,2)+Math.pow(r.y,2),i=(Math.pow(t.x,2)+Math.pow(t.y,2)-n)/2,e=(n-Math.pow(o.x,2)-Math.pow(o.y,2))/2,s=(t.x-r.x)*(r.y-o.y)-(r.x-o.x)*(t.y-r.y);this.centerPoint=new a((i*(r.y-o.y)-e*(t.y-r.y))/s,((t.x-r.x)*e-(r.x-o.x)*i)/s),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=z.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),u=z.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),y=z.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-h>180&&(u-=360),u-h<-180&&(u+=360),y-u>180&&(y-=360),y-u<-180&&(y+=360),this.orientation=u-h<0?w.CW:w.CCW,this.angle=z.FromDegrees(this.orientation===w.CW?h-y:y-h)}}();exports.Arc2=R;var T=function(){function t(t,r){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new a(t,r))}return t.prototype.addLineTo=function(t,r){if(this.closed)return this;var o=new a(t,r),n=this._points[this._points.length-1];return this._points.push(o),this._length+=o.subtract(n).length(),this},t.prototype.addArcTo=function(t,r,o,n,i){if(void 0===i&&(i=36),this.closed)return this;var e=this._points[this._points.length-1],s=new a(t,r),h=new a(o,n),u=new R(e,s,h),y=u.angle.radians()/i;u.orientation===w.CW&&(y*=-1);for(var c=u.startAngle.radians()+y,p=0;p<i;p++){var f=Math.cos(c)*u.radius+u.centerPoint.x,l=Math.sin(c)*u.radius+u.centerPoint.y;this.addLineTo(f,l),c+=y}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var t=this._length;if(!this.closed){var r=this._points[this._points.length-1];t+=this._points[0].subtract(r).length()}return t},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(t<0||t>1)return a.Zero();for(var r=t*this.length(),o=0,n=0;n<this._points.length;n++){var i=(n+1)%this._points.length,e=this._points[n],s=this._points[i].subtract(e),h=s.length()+o;if(r>=o&&r<=h){var u=s.normalize(),y=r-o;return new a(e.x+u.x*y,e.y+u.y*y)}o=h}return a.Zero()},t.StartingAt=function(r,o){return new t(r,o)},t}();exports.Path2=T;var g=function(){function t(t,r,o){void 0===r&&(r=null),this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var n=0;n<t.length;n++)this._curve[n]=t[n].clone();this._raw=o||!1,this._compute(r)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(t,r){void 0===r&&(r=null);for(var o=0;o<t.length;o++)this._curve[o].x=t[o].x,this._curve[o].y=t[o].y,this._curve[o].z=t[o].z;return this._compute(r),this},t.prototype._compute=function(t){var r=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[r-1]=this._curve[r-1].subtract(this._curve[r-2]),this._raw||this._tangents[r-1].normalize();var o,n,i,e,s=this._tangents[0],a=this._normalVector(s,t);this._normals[0]=a,this._raw||this._normals[0].normalize(),this._binormals[0]=h.Cross(s,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var u=1;u<r;u++)o=this._getLastNonNullVector(u),u<r-1&&(n=this._getFirstNonNullVector(u),this._tangents[u]=o.add(n),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+o.length(),i=this._tangents[u],e=this._binormals[u-1],this._normals[u]=h.Cross(e,i),this._raw||this._normals[u].normalize(),this._binormals[u]=h.Cross(i,this._normals[u]),this._raw||this._binormals[u].normalize()},t.prototype._getFirstNonNullVector=function(t){for(var r=1,o=this._curve[t+r].subtract(this._curve[t]);0===o.length()&&t+r+1<this._curve.length;)r++,o=this._curve[t+r].subtract(this._curve[t]);return o},t.prototype._getLastNonNullVector=function(t){for(var r=1,o=this._curve[t].subtract(this._curve[t-r]);0===o.length()&&t>r+1;)r++,o=this._curve[t].subtract(this._curve[t-r]);return o},t.prototype._normalVector=function(t,o){var n,e,s=t.length();(0===s&&(s=1),null==o)?(e=r.Scalar.WithinEpsilon(Math.abs(t.y)/s,1,i)?r.Scalar.WithinEpsilon(Math.abs(t.x)/s,1,i)?r.Scalar.WithinEpsilon(Math.abs(t.z)/s,1,i)?h.Zero():new h(0,0,1):new h(1,0,0):new h(0,-1,0),n=h.Cross(t,e)):(n=h.Cross(t,o),h.CrossToRef(n,t,n));return n.normalize(),n},t}();exports.Path3D=g;var _=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(r,o,n,i){i=i>2?i:3;for(var e=new Array,s=function(t,r,o,n){return(1-t)*(1-t)*r+2*t*(1-t)*o+t*t*n},a=0;a<=i;a++)e.push(new h(s(a/i,r.x,o.x,n.x),s(a/i,r.y,o.y,n.y),s(a/i,r.z,o.z,n.z)));return new t(e)},t.CreateCubicBezier=function(r,o,n,i,e){e=e>3?e:4;for(var s=new Array,a=function(t,r,o,n,i){return(1-t)*(1-t)*(1-t)*r+3*t*(1-t)*(1-t)*o+3*t*t*(1-t)*n+t*t*t*i},u=0;u<=e;u++)s.push(new h(a(u/e,r.x,o.x,n.x,i.x),a(u/e,r.y,o.y,n.y,i.y),a(u/e,r.z,o.z,n.z,i.z)));return new t(s)},t.CreateHermiteSpline=function(r,o,n,i,e){for(var s=new Array,a=1/e,u=0;u<=e;u++)s.push(h.Hermite(r,o,n,i,u*a));return new t(s)},t.CreateCatmullRomSpline=function(r,o,n){var i=new Array,e=1/o,s=0;if(n){for(var a=r.length,u=0;u<a;u++){s=0;for(var y=0;y<o;y++)i.push(h.CatmullRom(r[u%a],r[(u+1)%a],r[(u+2)%a],r[(u+3)%a],s)),s+=e}i.push(i[0])}else{var c=new Array;c.push(r[0].clone()),Array.prototype.push.apply(c,r),c.push(r[r.length-1].clone());for(u=0;u<c.length-3;u++){s=0;for(y=0;y<o;y++)i.push(h.CatmullRom(c[u],c[u+1],c[u+2],c[u+3],s)),s+=e}u--,i.push(h.CatmullRom(c[u],c[u+1],c[u+2],c[u+3],s))}return new t(i)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype.continue=function(r){for(var o=this._points[this._points.length-1],n=this._points.slice(),i=r.getPoints(),e=1;e<i.length;e++)n.push(i[e].subtract(i[0]).add(o));return new t(n)},t.prototype._computeLength=function(t){for(var r=0,o=1;o<t.length;o++)r+=t[o].subtract(t[o-1]).length();return r},t}();exports.Curve3=_;var F=function(){function t(t,r){void 0===t&&(t=h.Zero()),void 0===r&&(r=h.Up()),this.position=t,this.normal=r}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();exports.PositionNormalVertex=F;var M=function(){function t(t,r,o){void 0===t&&(t=h.Zero()),void 0===r&&(r=h.Up()),void 0===o&&(o=a.Zero()),this.position=t,this.normal=r,this.uv=o}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();exports.PositionNormalTextureVertex=M;var A=function(){function r(){}return r.Color3=t.ArrayTools.BuildArray(3,e.Black),r.Color4=t.ArrayTools.BuildArray(3,function(){return new s(0,0,0,0)}),r.Vector2=t.ArrayTools.BuildArray(3,a.Zero),r.Vector3=t.ArrayTools.BuildArray(13,h.Zero),r.Vector4=t.ArrayTools.BuildArray(3,u.Zero),r.Quaternion=t.ArrayTools.BuildArray(2,c.Zero),r.Matrix=t.ArrayTools.BuildArray(8,p.Identity),r}();exports.Tmp=A;var b=function(){function r(){}return r.Vector3=t.ArrayTools.BuildArray(6,h.Zero),r.Matrix=t.ArrayTools.BuildArray(2,p.Identity),r.Quaternion=t.ArrayTools.BuildArray(3,c.Zero),r}();
},{"../Misc/arrayTools":"eIrG","./math.scalar":"7Iig"}],"RWWY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FilesInputStore=void 0;var e=function(){function e(){}return e.FilesToLoad={},e}();exports.FilesInputStore=e;
},{}],"vn8z":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Constants=void 0;var E=function(){function E(){}return E.ALPHA_DISABLE=0,E.ALPHA_ADD=1,E.ALPHA_COMBINE=2,E.ALPHA_SUBTRACT=3,E.ALPHA_MULTIPLY=4,E.ALPHA_MAXIMIZED=5,E.ALPHA_ONEONE=6,E.ALPHA_PREMULTIPLIED=7,E.ALPHA_PREMULTIPLIED_PORTERDUFF=8,E.ALPHA_INTERPOLATE=9,E.ALPHA_SCREENMODE=10,E.DELAYLOADSTATE_NONE=0,E.DELAYLOADSTATE_LOADED=1,E.DELAYLOADSTATE_LOADING=2,E.DELAYLOADSTATE_NOTLOADED=4,E.NEVER=512,E.ALWAYS=519,E.LESS=513,E.EQUAL=514,E.LEQUAL=515,E.GREATER=516,E.GEQUAL=518,E.NOTEQUAL=517,E.KEEP=7680,E.REPLACE=7681,E.INCR=7682,E.DECR=7683,E.INVERT=5386,E.INCR_WRAP=34055,E.DECR_WRAP=34056,E.TEXTURE_CLAMP_ADDRESSMODE=0,E.TEXTURE_WRAP_ADDRESSMODE=1,E.TEXTURE_MIRROR_ADDRESSMODE=2,E.TEXTUREFORMAT_ALPHA=0,E.TEXTUREFORMAT_LUMINANCE=1,E.TEXTUREFORMAT_LUMINANCE_ALPHA=2,E.TEXTUREFORMAT_RGB=4,E.TEXTUREFORMAT_RGBA=5,E.TEXTUREFORMAT_RED=6,E.TEXTUREFORMAT_R=6,E.TEXTUREFORMAT_RG=7,E.TEXTUREFORMAT_RED_INTEGER=8,E.TEXTUREFORMAT_R_INTEGER=8,E.TEXTUREFORMAT_RG_INTEGER=9,E.TEXTUREFORMAT_RGB_INTEGER=10,E.TEXTUREFORMAT_RGBA_INTEGER=11,E.TEXTURETYPE_UNSIGNED_BYTE=0,E.TEXTURETYPE_UNSIGNED_INT=0,E.TEXTURETYPE_FLOAT=1,E.TEXTURETYPE_HALF_FLOAT=2,E.TEXTURETYPE_BYTE=3,E.TEXTURETYPE_SHORT=4,E.TEXTURETYPE_UNSIGNED_SHORT=5,E.TEXTURETYPE_INT=6,E.TEXTURETYPE_UNSIGNED_INTEGER=7,E.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,E.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,E.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,E.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,E.TEXTURETYPE_UNSIGNED_INT_24_8=12,E.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,E.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,E.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,E.TEXTURE_NEAREST_SAMPLINGMODE=1,E.TEXTURE_BILINEAR_SAMPLINGMODE=2,E.TEXTURE_TRILINEAR_SAMPLINGMODE=3,E.TEXTURE_NEAREST_NEAREST_MIPLINEAR=1,E.TEXTURE_LINEAR_LINEAR_MIPNEAREST=2,E.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,E.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,E.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,E.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,E.TEXTURE_NEAREST_LINEAR=7,E.TEXTURE_NEAREST_NEAREST=8,E.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,E.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,E.TEXTURE_LINEAR_LINEAR=11,E.TEXTURE_LINEAR_NEAREST=12,E.TEXTURE_EXPLICIT_MODE=0,E.TEXTURE_SPHERICAL_MODE=1,E.TEXTURE_PLANAR_MODE=2,E.TEXTURE_CUBIC_MODE=3,E.TEXTURE_PROJECTION_MODE=4,E.TEXTURE_SKYBOX_MODE=5,E.TEXTURE_INVCUBIC_MODE=6,E.TEXTURE_EQUIRECTANGULAR_MODE=7,E.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,E.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,E.SCALEMODE_FLOOR=1,E.SCALEMODE_NEAREST=2,E.SCALEMODE_CEILING=3,E.MATERIAL_TextureDirtyFlag=1,E.MATERIAL_LightDirtyFlag=2,E.MATERIAL_FresnelDirtyFlag=4,E.MATERIAL_AttributesDirtyFlag=8,E.MATERIAL_MiscDirtyFlag=16,E.MATERIAL_AllDirtyFlag=31,E.MATERIAL_TriangleFillMode=0,E.MATERIAL_WireFrameFillMode=1,E.MATERIAL_PointFillMode=2,E.MATERIAL_PointListDrawMode=3,E.MATERIAL_LineListDrawMode=4,E.MATERIAL_LineLoopDrawMode=5,E.MATERIAL_LineStripDrawMode=6,E.MATERIAL_TriangleStripDrawMode=7,E.MATERIAL_TriangleFanDrawMode=8,E.MATERIAL_ClockWiseSideOrientation=0,E.MATERIAL_CounterClockWiseSideOrientation=1,E.ACTION_NothingTrigger=0,E.ACTION_OnPickTrigger=1,E.ACTION_OnLeftPickTrigger=2,E.ACTION_OnRightPickTrigger=3,E.ACTION_OnCenterPickTrigger=4,E.ACTION_OnPickDownTrigger=5,E.ACTION_OnDoublePickTrigger=6,E.ACTION_OnPickUpTrigger=7,E.ACTION_OnPickOutTrigger=16,E.ACTION_OnLongPressTrigger=8,E.ACTION_OnPointerOverTrigger=9,E.ACTION_OnPointerOutTrigger=10,E.ACTION_OnEveryFrameTrigger=11,E.ACTION_OnIntersectionEnterTrigger=12,E.ACTION_OnIntersectionExitTrigger=13,E.ACTION_OnKeyDownTrigger=14,E.ACTION_OnKeyUpTrigger=15,E.PARTICLES_BILLBOARDMODE_Y=2,E.PARTICLES_BILLBOARDMODE_ALL=7,E.PARTICLES_BILLBOARDMODE_STRETCHED=8,E.PARTICLES_BaseAssetsUrl="https://assets.babylonjs.com/particles",E.MESHES_CULLINGSTRATEGY_STANDARD=0,E.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,E.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,E.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,E.SCENELOADER_NO_LOGGING=0,E.SCENELOADER_MINIMAL_LOGGING=1,E.SCENELOADER_SUMMARY_LOGGING=2,E.SCENELOADER_DETAILED_LOGGING=3,E}();exports.Constants=E;
},{}],"Fvml":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;var e=function(){function e(){}return e._AddLogEntry=function(r){e._LogCache=r+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(r)},e._FormatMessage=function(e){var r=function(e){return e<10?"0"+e:""+e},o=new Date;return"["+r(o.getHours())+":"+r(o.getMinutes())+":"+r(o.getSeconds())+"]: "+e},e._LogDisabled=function(e){},e._LogEnabled=function(r){var o=e._FormatMessage(r);console.log("BJS - "+o);var n="<div style='color:white'>"+o+"</div><br>";e._AddLogEntry(n)},e._WarnDisabled=function(e){},e._WarnEnabled=function(r){var o=e._FormatMessage(r);console.warn("BJS - "+o);var n="<div style='color:orange'>"+o+"</div><br>";e._AddLogEntry(n)},e._ErrorDisabled=function(e){},e._ErrorEnabled=function(r){e.errorsCount++;var o=e._FormatMessage(r);console.error("BJS - "+o);var n="<div style='color:red'>"+o+"</div><br>";e._AddLogEntry(n)},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(r){(r&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(r&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(r&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!0,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}();exports.Logger=e;
},{}],"WgxS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._TypeStore=void 0;var e=function(){function e(){}return e.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},e.RegisteredTypes={},e}();exports._TypeStore=e;
},{}],"RVA4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DeepCopier=void 0;var e=function(e,n){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(n):e.clone?e.clone():null:null},n=function(){function n(){}return n.DeepCopy=function(n,t,o,i){for(var r in n)if(("_"!==r[0]||i&&-1!==i.indexOf(r))&&(!o||-1===o.indexOf(r))){var s=n[r],l=typeof s;if("function"!==l)try{if("object"===l)if(s instanceof Array){if(t[r]=[],s.length>0)if("object"==typeof s[0])for(var f=0;f<s.length;f++){var a=e(s[f],t);-1===t[r].indexOf(a)&&t[r].push(a)}else t[r]=s.slice(0)}else t[r]=e(s,t);else t[r]=s}catch(c){}}},n}();exports.DeepCopier=n;
},{}],"RkuS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.className=p,exports.AsyncLoop=exports.PerfCounter=exports.Tools=exports.RetryStrategy=exports.LoadFileError=exports.FactorGradient=exports.Color3Gradient=exports.ColorGradient=void 0;var e=f(require("tslib")),o=require("../Maths/math"),r=require("../Maths/math.scalar"),t=require("./observable"),n=require("./filesInputStore"),i=require("../Engines/constants"),a=require("./domManagement"),s=require("./logger"),u=require("./typeStore"),c=require("./deepCopier"),l=require("./precisionDate");function f(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var t=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};t.get||t.set?Object.defineProperty(o,r,t):o[r]=e[r]}return o.default=e,o}var v=function(){function e(){}return e.prototype.getColorToRef=function(e){this.color2?o.Color4.LerpToRef(this.color1,this.color2,Math.random(),e):e.copyFrom(this.color1)},e}();exports.ColorGradient=v;var g=function(){return function(){}}();exports.Color3Gradient=g;var m=function(){function e(){}return e.prototype.getFactor=function(){return void 0===this.factor2?this.factor1:r.Scalar.Lerp(this.factor1,this.factor2,Math.random())},e}();exports.FactorGradient=m;var K=function(o){function r(e,t){var n=o.call(this,e)||this;return n.request=t,n.name="LoadFileError",r._setPrototypeOf(n,r.prototype),n}return e.__extends(r,o),r._setPrototypeOf=Object.setPrototypeOf||function(e,o){return e.__proto__=o,e},r}(Error);exports.LoadFileError=K;var d,A=function(){function e(){}return e.ExponentialBackoff=function(e,o){return void 0===e&&(e=3),void 0===o&&(o=500),function(r,t,n){return 0!==t.status||n>=e||-1!==r.indexOf("file:")?-1:Math.pow(2,n)*o}},e}();exports.RetryStrategy=A;var P=function(){function e(){}return e.FetchToRef=function(e,o,r,t,n,i){var a=4*((Math.abs(e)*r%r|0)+(Math.abs(o)*t%t|0)*r);i.r=n[a]/255,i.g=n[a+1]/255,i.b=n[a+2]/255,i.a=n[a+3]/255},e.Mix=function(e,o,r){return e*(1-r)+o*r},e.Instantiate=function(o){if(e.RegisteredExternalClasses&&e.RegisteredExternalClasses[o])return e.RegisteredExternalClasses[o];var r=u._TypeStore.GetClass(o);if(r)return r;s.Logger.Warn(o+" not found, you may have missed an import.");for(var t=o.split("."),n=window||this,i=0,a=t.length;i<a;i++)n=n[t[i]];return"function"!=typeof n?null:n},e.Slice=function(e,o,r){return e.slice?e.slice(o,r):Array.prototype.slice.call(e,o,r)},e.SetImmediate=function(e){a.DomManagement.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},e.IsExponentOfTwo=function(e){var o=1;do{o*=2}while(o<e);return o===e},e.FloatRound=function(o){return Math.fround?Math.fround(o):e._tmpFloatArray[0]=o},e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(o){var r=e.CeilingPOT(o),t=e.FloorPOT(o);return r-o>o-t?t:r},e.GetExponentOfTwo=function(o,r,t){var n;switch(void 0===t&&(t=i.Constants.SCALEMODE_NEAREST),t){case i.Constants.SCALEMODE_FLOOR:n=e.FloorPOT(o);break;case i.Constants.SCALEMODE_NEAREST:n=e.NearestPOT(o);break;case i.Constants.SCALEMODE_CEILING:default:n=e.CeilingPOT(o)}return Math.min(n,r)},e.GetFilename=function(e){var o=e.lastIndexOf("/");return o<0?e:e.substring(o+1)},e.GetFolderPath=function(e,o){void 0===o&&(o=!1);var r=e.lastIndexOf("/");return r<0?o?e:"":e.substring(0,r+1)},e.ToDegrees=function(e){return 180*e/Math.PI},e.ToRadians=function(e){return e*Math.PI/180},e.EncodeArrayBufferTobase64=function(e){for(var o,r,t,n,i,a,s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",l=0,f=new Uint8Array(e);l<f.length;)n=(o=f[l++])>>2,i=(3&o)<<4|(r=l<f.length?f[l++]:Number.NaN)>>4,a=(15&r)<<2|(t=l<f.length?f[l++]:Number.NaN)>>6,s=63&t,isNaN(r)?a=s=64:isNaN(t)&&(s=64),c+=u.charAt(n)+u.charAt(i)+u.charAt(a)+u.charAt(s);return"data:image/png;base64,"+c},e.ExtractMinAndMaxIndexed=function(e,r,t,n,i){void 0===i&&(i=null);for(var a=new o.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new o.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),u=t;u<t+n;u++){var c=3*r[u],l=e[c],f=e[c+1],v=e[c+2];a.minimizeInPlaceFromFloats(l,f,v),s.maximizeInPlaceFromFloats(l,f,v)}return i&&(a.x-=a.x*i.x+i.y,a.y-=a.y*i.x+i.y,a.z-=a.z*i.x+i.y,s.x+=s.x*i.x+i.y,s.y+=s.y*i.x+i.y,s.z+=s.z*i.x+i.y),{minimum:a,maximum:s}},e.ExtractMinAndMax=function(e,r,t,n,i){void 0===n&&(n=null);var a=new o.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new o.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);i||(i=3);for(var u=r,c=r*i;u<r+t;u++,c+=i){var l=e[c],f=e[c+1],v=e[c+2];a.minimizeInPlaceFromFloats(l,f,v),s.maximizeInPlaceFromFloats(l,f,v)}return n&&(a.x-=a.x*n.x+n.y,a.y-=a.y*n.x+n.y,a.z-=a.z*n.x+n.y,s.x+=s.x*n.x+n.y,s.y+=s.y*n.x+n.y,s.z+=s.z*n.x+n.y),{minimum:a,maximum:s}},e.MakeArray=function(e,o){return!0===o||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},e.GetPointerPrefix=function(){var e="pointer";return!a.DomManagement.IsWindowObjectExist()||window.PointerEvent||navigator.pointerEnabled||(e="mouse"),e},e.QueueNewFrame=function(e,o){return a.DomManagement.IsWindowObjectExist()?(o||(o=window),o.requestAnimationFrame?o.requestAnimationFrame(e):o.msRequestAnimationFrame?o.msRequestAnimationFrame(e):o.webkitRequestAnimationFrame?o.webkitRequestAnimationFrame(e):o.mozRequestAnimationFrame?o.mozRequestAnimationFrame(e):o.oRequestAnimationFrame?o.oRequestAnimationFrame(e):window.setTimeout(e,16)):setTimeout(e,16)},e.RequestFullscreen=function(e){var o=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;o&&o.call(e)},e.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},e.SetCorsBehavior=function(o,r){if((!o||0!==o.indexOf("data:"))&&e.CorsBehavior)if("string"==typeof e.CorsBehavior||e.CorsBehavior instanceof String)r.crossOrigin=e.CorsBehavior;else{var t=e.CorsBehavior(o);t&&(r.crossOrigin=t)}},e.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},e.LoadImage=function(o,r,t,i){var a,u=!1;o instanceof ArrayBuffer?(a=URL.createObjectURL(new Blob([o])),u=!0):o instanceof Blob?(a=URL.createObjectURL(o),u=!0):(a=e.CleanUrl(o),a=e.PreprocessUrl(o));var c=new Image;e.SetCorsBehavior(a,c);var l=function(){u&&c.src&&URL.revokeObjectURL(c.src),c.removeEventListener("load",l),c.removeEventListener("error",f),r(c)},f=function(e){u&&c.src&&URL.revokeObjectURL(c.src),c.removeEventListener("load",l),c.removeEventListener("error",f),s.Logger.Error("Error while trying to load image: "+o),t&&t("Error while trying to load image: "+o,e)};c.addEventListener("load",l),c.addEventListener("error",f);var v=function(){c.src=a};if("data:"!==a.substr(0,5)&&i&&i.enableTexturesOffline)i.open(function(){i&&i.loadImage(a,c)},v);else{if(-1!==a.indexOf("file:")){var g=decodeURIComponent(a.substring(5).toLowerCase());if(n.FilesInputStore.FilesToLoad[g]){try{var m;try{m=URL.createObjectURL(n.FilesInputStore.FilesToLoad[g])}catch(K){m=URL.createObjectURL(n.FilesInputStore.FilesToLoad[g])}c.src=m,u=!0}catch(d){c.src=""}return c}}v()}return c},e.LoadFile=function(o,r,i,s,u,c){if(o=e.CleanUrl(o),-1!==(o=e.PreprocessUrl(o)).indexOf("file:")){var l=decodeURIComponent(o.substring(5).toLowerCase());if(n.FilesInputStore.FilesToLoad[l])return e.ReadFile(n.FilesInputStore.FilesToLoad[l],r,i,u)}var f=e.BaseUrl+o,v=!1,g={onCompleteObservable:new t.Observable,abort:function(){return v=!0}},m=function(){var o=new XMLHttpRequest,t=null;g.abort=function(){v=!0,o.readyState!==(XMLHttpRequest.DONE||4)&&o.abort(),null!==t&&(clearTimeout(t),t=null)};var n=function(s){o.open("GET",f,!0),u&&(o.responseType="arraybuffer"),i&&o.addEventListener("progress",i);var l=function(){o.removeEventListener("loadend",l),g.onCompleteObservable.notifyObservers(g),g.onCompleteObservable.clear()};o.addEventListener("loadend",l);var m=function(){if(!v&&o.readyState===(XMLHttpRequest.DONE||4)){if(o.removeEventListener("readystatechange",m),o.status>=200&&o.status<300||0===o.status&&(!a.DomManagement.IsWindowObjectExist()||e.IsFileURL()))return void r(u?o.response:o.responseText,o.responseURL);var i=e.DefaultRetryStrategy;if(i){var g=i(f,o,s);if(-1!==g)return o.removeEventListener("loadend",l),o=new XMLHttpRequest,void(t=setTimeout(function(){return n(s+1)},g))}var d=new K("Error status: "+o.status+" "+o.statusText+" - Unable to load "+f,o);if(!c)throw d;c(o,d)}};o.addEventListener("readystatechange",m),e.UseCustomRequestHeaders&&e.InjectCustomRequestHeaders(o),o.send()};n(0)};if(s&&s.enableSceneOffline){var d=function(e){e&&e.status>400?c&&c(e):v||m()};s.open(function(){v||s&&s.loadFile(o,function(e){v||r(e),g.onCompleteObservable.notifyObservers(g)},i?function(e){v||i(e)}:void 0,d,u)},d)}else m();return g},e.LoadScript=function(e,o,r){if(a.DomManagement.IsWindowObjectExist()){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=function(){o&&o()},n.onerror=function(o){r&&r("Unable to load script '"+e+"'",o)},t.appendChild(n)}},e.ReadFileAsDataURL=function(e,o,r){var n=new FileReader,i={onCompleteObservable:new t.Observable,abort:function(){return n.abort()}};return n.onloadend=function(e){i.onCompleteObservable.notifyObservers(i)},n.onload=function(e){o(e.target.result)},n.onprogress=r,n.readAsDataURL(e),i},e.ReadFile=function(e,o,r,n){var i=new FileReader,a={onCompleteObservable:new t.Observable,abort:function(){return i.abort()}};return i.onloadend=function(e){return a.onCompleteObservable.notifyObservers(a)},i.onerror=function(r){s.Logger.Log("Error while reading file: "+e.name),o(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},i.onload=function(e){o(e.target.result)},r&&(i.onprogress=r),n?i.readAsArrayBuffer(e):i.readAsText(e),a},e.FileAsURL=function(e){var o=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(o)},e.Format=function(e,o){return void 0===o&&(o=2),e.toFixed(o)},e.CheckExtends=function(e,o,r){o.minimizeInPlace(e),r.maximizeInPlace(e)},e.DeepCopy=function(e,o,r,t){c.DeepCopier.DeepCopy(e,o,r,t)},e.IsEmpty=function(e){for(var o in e)if(e.hasOwnProperty(o))return!1;return!0},e.RegisterTopRootEvents=function(e){for(var o=0;o<e.length;o++){var r=e[o];window.addEventListener(r.name,r.handler,!1);try{window.parent&&window.parent.addEventListener(r.name,r.handler,!1)}catch(t){}}},e.UnregisterTopRootEvents=function(e){for(var o=0;o<e.length;o++){var r=e[o];window.removeEventListener(r.name,r.handler);try{window.parent&&window.parent.removeEventListener(r.name,r.handler)}catch(t){}}},e.DumpFramebuffer=function(o,r,t,n,i,a){void 0===i&&(i="image/png");for(var s=4*o,u=r/2,c=t.readPixels(0,0,o,r),l=0;l<u;l++)for(var f=0;f<s;f++){var v=f+l*s,g=f+(r-l-1)*s,m=c[v];c[v]=c[g],c[g]=m}d||(d=document.createElement("canvas")),d.width=o,d.height=r;var K=d.getContext("2d");if(K){var A=K.createImageData(o,r);A.data.set(c),K.putImageData(A,0,0),e.EncodeScreenshotCanvasData(n,i,a)}},e.ToBlob=function(e,o,r){void 0===r&&(r="image/png"),e.toBlob||(e.toBlob=function(e,o,r){var t=this;setTimeout(function(){for(var n=atob(t.toDataURL(o,r).split(",")[1]),i=n.length,a=new Uint8Array(i),s=0;s<i;s++)a[s]=n.charCodeAt(s);e(new Blob([a]))})}),e.toBlob(function(e){o(e)},r)},e.EncodeScreenshotCanvasData=function(o,r,t){(void 0===r&&(r="image/png"),o)?o(d.toDataURL(r)):this.ToBlob(d,function(o){if("download"in document.createElement("a")){if(!t){var r=new Date,n=(r.getFullYear()+"-"+(r.getMonth()+1)).slice(2)+"-"+r.getDate()+"_"+r.getHours()+"-"+("0"+r.getMinutes()).slice(-2);t="screenshot_"+n+".png"}e.Download(o,t)}else{var i=URL.createObjectURL(o),a=window.open("");if(!a)return;var s=a.document.createElement("img");s.onload=function(){URL.revokeObjectURL(i)},s.src=i,a.document.body.appendChild(s)}},r)},e.Download=function(e,o){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,o);else{var r=window.URL.createObjectURL(e),t=document.createElement("a");document.body.appendChild(t),t.style.display="none",t.href=r,t.download=o,t.addEventListener("click",function(){t.parentElement&&t.parentElement.removeChild(t)}),t.click(),window.URL.revokeObjectURL(r)}},e.CreateScreenshot=function(e,o,r,t,n){throw void 0===n&&(n="image/png"),"Import ScreenshotTools before creating screenshot."},e.CreateScreenshotUsingRenderTarget=function(e,o,r,t,n,i,a,s){throw void 0===n&&(n="image/png"),void 0===i&&(i=1),void 0===a&&(a=!1),"Import ScreenshotTools before creating screenshot."},e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=16*Math.random()|0;return("x"===e?o:3&o|8).toString(16)})},e.IsBase64=function(e){return!(e.length<5)&&"data:"===e.substr(0,5)},e.DecodeBase64=function(e){for(var o=atob(e.split(",")[1]),r=o.length,t=new Uint8Array(new ArrayBuffer(r)),n=0;n<r;n++)t[n]=o.charCodeAt(n);return t.buffer},Object.defineProperty(e,"errorsCount",{get:function(){return s.Logger.errorsCount},enumerable:!0,configurable:!0}),e.Log=function(e){s.Logger.Log(e)},e.Warn=function(e){s.Logger.Warn(e)},e.Error=function(e){s.Logger.Error(e)},Object.defineProperty(e,"LogCache",{get:function(){return s.Logger.LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){s.Logger.ClearLogCache()},Object.defineProperty(e,"LogLevels",{set:function(e){s.Logger.LogLevels=e},enumerable:!0,configurable:!0}),e.IsFileURL=function(){return"file:"===location.protocol},Object.defineProperty(e,"PerformanceLogLevel",{set:function(o){return(o&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(o&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),e._StartPerformanceCounterDisabled=function(e,o){},e._EndPerformanceCounterDisabled=function(e,o){},e._StartUserMark=function(o,r){if(void 0===r&&(r=!0),!e._performance){if(!a.DomManagement.IsWindowObjectExist())return;e._performance=window.performance}r&&e._performance.mark&&e._performance.mark(o+"-Begin")},e._EndUserMark=function(o,r){void 0===r&&(r=!0),r&&e._performance.mark&&(e._performance.mark(o+"-End"),e._performance.measure(o,o+"-Begin",o+"-End"))},e._StartPerformanceConsole=function(o,r){void 0===r&&(r=!0),r&&(e._StartUserMark(o,r),console.time&&console.time(o))},e._EndPerformanceConsole=function(o,r){void 0===r&&(r=!0),r&&(e._EndUserMark(o,r),console.time&&console.timeEnd(o))},e.InjectCustomRequestHeaders=function(o){for(var r in e.CustomRequestHeaders){var t=e.CustomRequestHeaders[r];t&&o.setRequestHeader(r,t)}},Object.defineProperty(e,"Now",{get:function(){return l.PrecisionDate.Now},enumerable:!0,configurable:!0}),e.GetClassName=function(e,o){void 0===o&&(o=!1);var r=null;if(!o&&e.getClassName)r=e.getClassName();else{if(e instanceof Object)r=(o?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__;r||(r=typeof e)}return r},e.First=function(e,o){for(var r=0,t=e;r<t.length;r++){var n=t[r];if(o(n))return n}return null},e.getFullClassName=function(e,o){void 0===o&&(o=!1);var r=null,t=null;if(!o&&e.getClassName)r=e.getClassName();else{if(e instanceof Object){var n=o?e:Object.getPrototypeOf(e);r=n.constructor.__bjsclassName__,t=n.constructor.__bjsmoduleName__}r||(r=typeof e)}return r?(null!=t?t+".":"")+r:null},e.DelayAsync=function(e){return new Promise(function(o){setTimeout(function(){o()},e)})},e.GetCurrentGradient=function(e,o,r){for(var t=0;t<o.length-1;t++){var n=o[t],i=o[t+1];if(e>=n.gradient&&e<=i.gradient)return void r(n,i,(e-n.gradient)/(i.gradient-n.gradient))}var a=o.length-1;r(o[a],o[a],1)},e.BaseUrl="",e.UseCustomRequestHeaders=!1,e.CustomRequestHeaders={},e.DefaultRetryStrategy=A.ExponentialBackoff(),e.CorsBehavior="anonymous",e.UseFallbackTexture=!0,e.RegisteredExternalClasses={},e.fallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",e._tmpFloatArray=new Float32Array(1),e.GetDOMTextContent=a.DomManagement.GetDOMTextContent,e.PreprocessUrl=function(e){return e},e.NoneLogLevel=s.Logger.NoneLogLevel,e.MessageLogLevel=s.Logger.MessageLogLevel,e.WarningLogLevel=s.Logger.WarningLogLevel,e.ErrorLogLevel=s.Logger.ErrorLogLevel,e.AllLogLevel=s.Logger.AllLogLevel,e.IsWindowObjectExist=a.DomManagement.IsWindowObjectExist,e.PerformanceNoneLogLevel=0,e.PerformanceUserMarkLogLevel=1,e.PerformanceConsoleLogLevel=2,e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,e.EndPerformanceCounter=e._EndPerformanceCounterDisabled,e}();exports.Tools=P;var h=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(o,r){e.Enabled&&(this._current+=o,r&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=l.PrecisionDate.Now)},e.prototype.endMonitoring=function(o){if(void 0===o&&(o=!0),e.Enabled){o&&this.fetchNewFrame();var r=l.PrecisionDate.Now;this._current=r-this._startMonitoringTime,o&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=l.PrecisionDate.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}();function p(e,o){return function(r){r.__bjsclassName__=e,r.__bjsmoduleName__=null!=o?o:null}}exports.PerfCounter=h;var F=function(){function e(e,o,r,t){void 0===t&&(t=0),this.iterations=e,this.index=t-1,this._done=!1,this._fn=o,this._successCallback=r}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(o,r,t,n){void 0===n&&(n=0);var i=new e(o,r,t,n);return i.executeNext(),i},e.SyncAsyncForLoop=function(o,r,t,n,i,a){return void 0===a&&(a=0),e.Run(Math.ceil(o/r),function(e){i&&i()?e.breakLoop():setTimeout(function(){for(var n=0;n<r;++n){var a=e.index*r+n;if(a>=o)break;if(t(a),i&&i()){e.breakLoop();break}}e.executeNext()},a)},n)},e}();exports.AsyncLoop=F;
},{"tslib":"vCxL","../Maths/math":"Iizi","../Maths/math.scalar":"7Iig","./observable":"gtkL","./filesInputStore":"RWWY","../Engines/constants":"vn8z","./domManagement":"+D0i","./logger":"Fvml","./typeStore":"WgxS","./deepCopier":"RVA4","./precisionDate":"V1yO"}],"Dc2l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PromisePolyfill=void 0;var e,t=require("./tools");!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(e||(e={}));var n=function(){return function(){this.count=0,this.target=0,this.results=[]}}(),r=function(){function r(t){var n=this;if(this._state=e.Pending,this._children=new Array,this._rejectWasConsumed=!1,t)try{t(function(e){n._resolve(e)},function(e){n._reject(e)})}catch(r){this._reject(r)}}return Object.defineProperty(r.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&void 0===this._parent._result&&(this._parent._result=e)},enumerable:!0,configurable:!0}),r.prototype.catch=function(e){return this.then(void 0,e)},r.prototype.then=function(n,i){var l=this,s=new r;return s._onFulfilled=n,s._onRejected=i,this._children.push(s),s._parent=this,this._state!==e.Pending&&t.Tools.SetImmediate(function(){if(l._state===e.Fulfilled||l._rejectWasConsumed){var t=s._resolve(l._result);if(null!=t)if(void 0!==t._state){var n=t;s._children.push(n),n._parent=s,s=n}else s._result=t}else s._reject(l._reason)}),s},r.prototype._moveChildren=function(t){var n,r=this;if((n=this._children).push.apply(n,t.splice(0,t.length)),this._children.forEach(function(e){e._parent=r}),this._state===e.Fulfilled)for(var i=0,l=this._children;i<l.length;i++){l[i]._resolve(this._result)}else if(this._state===e.Rejected)for(var s=0,o=this._children;s<o.length;s++){o[s]._reject(this._reason)}},r.prototype._resolve=function(t){try{this._state=e.Fulfilled;var n=null;if(this._onFulfilled&&(n=this._onFulfilled(t)),null!=n)if(void 0!==n._state){var r=n;r._parent=this,r._moveChildren(this._children),t=r._result}else t=n;this._result=t;for(var i=0,l=this._children;i<l.length;i++){l[i]._resolve(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(s){this._reject(s,!0)}},r.prototype._reject=function(t,n){if(void 0===n&&(n=!1),this._state=e.Rejected,this._reason=t,this._onRejected&&!n)try{this._onRejected(t),this._rejectWasConsumed=!0}catch(s){t=s}for(var r=0,i=this._children;r<i.length;r++){var l=i[r];this._rejectWasConsumed?l._resolve(null):l._reject(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},r.resolve=function(e){var t=new r;return t._resolve(e),t},r._RegisterForFulfillment=function(t,n,r){t.then(function(e){return n.results[r]=e,n.count++,n.count===n.target&&n.rootPromise._resolve(n.results),null},function(t){n.rootPromise._state!==e.Rejected&&n.rootPromise._reject(t)})},r.all=function(e){var t=new r,i=new n;if(i.target=e.length,i.rootPromise=t,e.length)for(var l=0;l<e.length;l++)r._RegisterForFulfillment(e[l],i,l);else t._resolve([]);return t},r.race=function(e){var t=new r;if(e.length)for(var n=0,i=e;n<i.length;n++){i[n].then(function(e){return t&&(t._resolve(e),t=null),null},function(e){t&&(t._reject(e),t=null)})}return t},r}(),i=function(){function e(){}return e.Apply=function(e){(void 0===e&&(e=!1),e||"undefined"==typeof Promise)&&(window.Promise=r)},e}();exports.PromisePolyfill=i;
},{"./tools":"RkuS"}],"Ru7D":[function(require,module,exports) {
var define;
var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Effect=exports.EffectCreationOptions=exports.EffectFallbacks=void 0;var t=require("../Misc/observable"),r=require("../Engines/constants"),i=require("../Misc/domManagement"),n=require("../Misc/logger"),s=function(){function e(){this._defines={},this._currentRank=32,this._maxRank=-1}return e.prototype.unBindMesh=function(){this._mesh=null},e.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},e.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(e.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),e.prototype.reduce=function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0&&this._mesh.material){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var r=this._mesh.getScene(),i=0;i<r.meshes.length;i++){var n=r.meshes[i];if(n.material&&(n.computeBonesUsingShaders&&0!==n.numBoneInfluencers))if(n.material.getEffect()===t)n.computeBonesUsingShaders=!1;else if(n.subMeshes)for(var s=0,o=n.subMeshes;s<o.length;s++){if(o[s].effect===t){n.computeBonesUsingShaders=!1;break}}}}else{var a=this._defines[this._currentRank];if(a)for(i=0;i<a.length;i++)e=e.replace("#define "+a[i],"");this._currentRank++}return e},e}();exports.EffectFallbacks=s;var o=function(){return function(){}}();exports.EffectCreationOptions=o;var a=function(){function e(r,i,n,s,o,a,h,u,c,l){void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=null),void 0===u&&(u=null),void 0===c&&(c=null);var f,p,_=this;if(this.uniqueId=0,this.onCompileObservable=new t.Observable,this.onErrorObservable=new t.Observable,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._isReady=!1,this._compilationError="",this.name=r,i.attributes){var m=i;if(this._engine=n,this._attributesNames=m.attributes,this._uniformsNames=m.uniformsNames.concat(m.samplers),this._samplers=m.samplers.slice(),this.defines=m.defines,this.onError=m.onError,this.onCompiled=m.onCompiled,this._fallbacks=m.fallbacks,this._indexParameters=m.indexParameters,this._transformFeedbackVaryings=m.transformFeedbackVaryings,m.uniformBuffersNames)for(var g=0;g<m.uniformBuffersNames.length;g++)this._uniformBuffersNames[m.uniformBuffersNames[g]]=g}else this._engine=o,this.defines=a,this._uniformsNames=n.concat(s),this._samplers=s?s.slice():[],this._attributesNames=i,this.onError=c,this.onCompiled=u,this._indexParameters=l,this._fallbacks=h;this.uniqueId=e._uniqueIdSeed++,r.vertexElement?(f=document.getElementById(r.vertexElement))||(f=r.vertexElement):f=r.vertex||r,r.fragmentElement?(p=document.getElementById(r.fragmentElement))||(p=r.fragmentElement):p=r.fragment||r,this._loadVertexShader(f,function(e){_._processIncludes(e,function(e){_._processShaderConversion(e,!1,function(e){_._loadFragmentShader(p,function(t){_._processIncludes(t,function(t){_._processShaderConversion(t,!0,function(t){if(r){var i=r.vertexElement||r.vertex||r,n=r.fragmentElement||r.fragment||r;_._vertexSourceCode="#define SHADER_NAME vertex:"+i+"\n"+e,_._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t}else _._vertexSourceCode=e,_._fragmentSourceCode=t;_._prepareEffect()})})})})})})}return Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new t.Observable),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return!this._isReady&&this._program&&this._program.isParallelCompiled?this._engine._isProgramCompiled(this._program):this._isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getProgram=function(){return this._program},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[t]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[this._uniformsNames.indexOf(e)]},e.prototype.getSamplers=function(){return this._samplers},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add(function(t){e(t)}),this._program&&!this._program.isParallelCompiled||setTimeout(function(){t._checkIsReady()},16))},e.prototype._checkIsReady=function(){var e=this;this.isReady()||setTimeout(function(){e._checkIsReady()},16)},e.prototype._loadVertexShader=function(t,r){var n;if(i.DomManagement.IsWindowObjectExist()&&t instanceof HTMLElement)return void r(i.DomManagement.GetDOMTextContent(t));"base64:"!==t.substr(0,7)?e.ShadersStore[t+"VertexShader"]?r(e.ShadersStore[t+"VertexShader"]):(n="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(n+".vertex.fx",r)):r(window.atob(t.substr(7)))},e.prototype._loadFragmentShader=function(t,r){var n;if(i.DomManagement.IsWindowObjectExist()&&t instanceof HTMLElement)return void r(i.DomManagement.GetDOMTextContent(t));"base64:"!==t.substr(0,7)?e.ShadersStore[t+"PixelShader"]?r(e.ShadersStore[t+"PixelShader"]):e.ShadersStore[t+"FragmentShader"]?r(e.ShadersStore[t+"FragmentShader"]):(n="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(n+".fragment.fx",r)):r(window.atob(t.substr(7)))},e.prototype._dumpShadersSource=function(e,t,r){var i=(this._engine.webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"")+(r?r+"\n":"");t=i+t;var s=2,o=/\n/gm,a="\n1\t"+(e=i+e).replace(o,function(){return"\n"+s+++"\t"});s=2;var h="\n1\t"+t.replace(o,function(){return"\n"+s+++"\t"});this.name.vertexElement?(n.Logger.Error("Vertex shader: "+this.name.vertexElement+a),n.Logger.Error("Fragment shader: "+this.name.fragmentElement+h)):this.name.vertex?(n.Logger.Error("Vertex shader: "+this.name.vertex+a),n.Logger.Error("Fragment shader: "+this.name.fragment+h)):(n.Logger.Error("Vertex shader: "+this.name+a),n.Logger.Error("Fragment shader: "+this.name+h))},e.prototype._processShaderConversion=function(e,t,r){var i=this._processPrecision(e);if(1!=this._engine.webGLVersion)if(-1===i.indexOf("#version 3")){var n=-1!==i.search(/#extension.+GL_EXT_draw_buffers.+require/),s=i.replace(/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"");s=(s=(s=(s=s.replace(/varying(?![\n\r])\s/g,t?"in ":"out ")).replace(/attribute[ \t]/g,"in ")).replace(/[ \t]attribute/g," in")).replace(/texture2D\s*\(/g,"texture("),t&&(s=(s=(s=(s=(s=(s=(s=s.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(n?"":"out vec4 glFragColor;\n")+"void main(")),r(s)}else r(i.replace("#version 300 es",""));else r(i)},e.prototype._processIncludes=function(t,r){for(var i=this,n=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,s=n.exec(t),o=new String(t);null!=s;){var a=s[1];if(-1!==a.indexOf("__decl__")&&(a=a.replace(/__decl__/,""),this._engine.supportsUniformBuffers&&(a=(a=a.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),a+="Declaration"),!e.IncludesShadersStore[a]){var h=e.ShadersRepository+"ShadersInclude/"+a+".fx";return void this._engine._loadFile(h,function(t){e.IncludesShadersStore[a]=t,i._processIncludes(o,r)})}var u=e.IncludesShadersStore[a];if(s[2])for(var c=s[3].split(","),l=0;l<c.length;l+=2){var f=new RegExp(c[l],"g"),p=c[l+1];u=u.replace(f,p)}if(s[4]){var _=s[5];if(-1!==_.indexOf("..")){var m=_.split(".."),g=parseInt(m[0]),d=parseInt(m[1]),v=u.slice(0);u="",isNaN(d)&&(d=this._indexParameters[m[1]]);for(var y=g;y<d;y++)this._engine.supportsUniformBuffers||(v=v.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),u+=v.replace(/\{X\}/g,y.toString())+"\n"}else this._engine.supportsUniformBuffers||(u=u.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),u=u.replace(/\{X\}/g,_)}o=o.replace(s[0],u),s=n.exec(t)}r(o)},e.prototype._processPrecision=function(e){return-1===e.indexOf("precision highp float")?e=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+e:"precision mediump float;\n"+e:this._engine.getCaps().highPrecisionShaderSupported||(e=e.replace("precision highp float","precision mediump float")),e},e.prototype._rebuildProgram=function(e,t,i,n){var s=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){n&&n(t)},this.onCompiled=function(){for(var e=s.getEngine().scenes,t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(r.Constants.MATERIAL_TextureDirtyFlag);i&&i(s._program)},this._fallbacks=null,this._prepareEffect()},e.prototype.getSpecificUniformLocations=function(e){return this._engine.getUniforms(this._program,e)},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines,i=this._fallbacks;this._valueCache={};var s=this._program;try{var o=this._engine;this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._program=o.createRawShaderProgram(this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,void 0,this._transformFeedbackVaryings):this._program=o.createShaderProgram(this._vertexSourceCode,this._fragmentSourceCode,r,void 0,this._transformFeedbackVaryings),this._program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this),o._executeWhenProgramIsCompiled(this._program,function(){if(o.supportsUniformBuffers)for(var r in e._uniformBuffersNames)e.bindUniformBlock(r,e._uniformBuffersNames[r]);var i;for(e._uniforms=o.getUniforms(e._program,e._uniformsNames),e._attributes=o.getAttributes(e._program,t),i=0;i<e._samplers.length;i++){null==e.getUniform(e._samplers[i])&&(e._samplers.splice(i,1),i--)}o.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),s&&e.getEngine()._deleteProgram(s)}),this._program.isParallelCompiled&&this._checkIsReady()}catch(a){this._compilationError=a.message,n.Logger.Error("Unable to compile effect:"),n.Logger.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),n.Logger.Error("Attributes: "+t.map(function(e){return" "+e})),n.Logger.Error("Error: "+this._compilationError),s&&(this._program=s,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),i&&i.isMoreFallbacks?(n.Logger.Error("Trying next fallback."),this.defines=i.reduce(this.defines,this),this._prepareEffect()):(this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())}},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers.indexOf(e),t)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers.indexOf(e),this.getUniform(e),t)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers.indexOf(e),this.getUniform(e),t)},e.prototype.setTextureArray=function(e,t){if(-1===this._samplers.indexOf(e+"Ex"))for(var r=this._samplers.indexOf(e),i=1;i<t.length;i++)this._samplers.splice(r+i,0,e+"Ex");this._engine.setTextureArray(this._samplers.indexOf(e),this.getUniform(e),t)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers.indexOf(e),t)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers.indexOf(e),t)},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._cacheFloat2=function(e,t,r){var i=this._valueCache[e];if(!i)return i=[t,r],this._valueCache[e]=i,!0;var n=!1;return i[0]!==t&&(i[0]=t,n=!0),i[1]!==r&&(i[1]=r,n=!0),n},e.prototype._cacheFloat3=function(e,t,r,i){var n=this._valueCache[e];if(!n)return n=[t,r,i],this._valueCache[e]=n,!0;var s=!1;return n[0]!==t&&(n[0]=t,s=!0),n[1]!==r&&(n[1]=r,s=!0),n[2]!==i&&(n[2]=i,s=!0),s},e.prototype._cacheFloat4=function(e,t,r,i,n){var s=this._valueCache[e];if(!s)return s=[t,r,i,n],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==r&&(s[1]=r,o=!0),s[2]!==i&&(s[2]=i,o=!0),s[3]!==n&&(s[3]=n,o=!0),o},e.prototype.bindUniformBuffer=function(t,r){var i=this._uniformBuffersNames[r];void 0!==i&&e._baseCache[i]!==t&&(e._baseCache[i]=t,this._engine.bindUniformBufferBase(t,i))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._program,e,t)},e.prototype.setInt=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setInt(this.getUniform(e),t),this)},e.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this.getUniform(e),t),this},e.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this.getUniform(e),t),this},e.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this.getUniform(e),t),this},e.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this.getUniform(e),t),this},e.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray(this.getUniform(e),t),this},e.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray2(this.getUniform(e),t),this},e.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray3(this.getUniform(e),t),this},e.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray4(this.getUniform(e),t),this},e.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this.getUniform(e),t),this},e.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this.getUniform(e),t),this},e.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this.getUniform(e),t),this},e.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this.getUniform(e),t),this},e.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this.getUniform(e),t),this):this},e.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrix(this.getUniform(e),t),this},e.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this.getUniform(e),t),this},e.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this.getUniform(e),t),this},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setFloat(this.getUniform(e),t),this)},e.prototype.setBool=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setBool(this.getUniform(e),t?1:0),this)},e.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this.getUniform(e),t.x,t.y),this},e.prototype.setFloat2=function(e,t,r){return this._cacheFloat2(e,t,r)&&this._engine.setFloat2(this.getUniform(e),t,r),this},e.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this.getUniform(e),t.x,t.y,t.z),this},e.prototype.setFloat3=function(e,t,r,i){return this._cacheFloat3(e,t,r,i)&&this._engine.setFloat3(this.getUniform(e),t,r,i),this},e.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this.getUniform(e),t.x,t.y,t.z,t.w),this},e.prototype.setFloat4=function(e,t,r,i,n){return this._cacheFloat4(e,t,r,i,n)&&this._engine.setFloat4(this.getUniform(e),t,r,i,n),this},e.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setColor3(this.getUniform(e),t),this},e.prototype.setColor4=function(e,t,r){return this._cacheFloat4(e,t.r,t.g,t.b,r)&&this._engine.setColor4(this.getUniform(e),t,r),this},e.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setDirectColor4(this.getUniform(e),t),this},e.RegisterShader=function(t,r,i){r&&(e.ShadersStore[t+"PixelShader"]=r),i&&(e.ShadersStore[t+"VertexShader"]=i)},e.ResetCache=function(){e._baseCache={}},e.ShadersRepository="src/Shaders/",e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore={},e.IncludesShadersStore={},e}();exports.Effect=a;
},{"../Misc/observable":"gtkL","../Engines/constants":"vn8z","../Misc/domManagement":"+D0i","../Misc/logger":"Fvml"}],"Bmza":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AndOrNotEvaluator=void 0;var e=function(){function e(){}return e.Eval=function(t,r){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,r)}):e._HandleParenthesisContent(t,r))||"false"!==t&&e.Eval(t,r)},e._HandleParenthesisContent=function(t,r){var n;r=r||function(e){return"true"===e};var a=t.split("||");for(var i in a)if(a.hasOwnProperty(i)){var u=e._SimplifyNegation(a[i].trim()),l=u.split("&&");if(l.length>1)for(var s=0;s<l.length;++s){var o=e._SimplifyNegation(l[s].trim());if(!(n="true"!==o&&"false"!==o?"!"===o[0]?!r(o.substring(1)):r(o):"true"===o)){u="false";break}}if(n||"true"===u){n=!0;break}n="true"!==u&&"false"!==u?"!"===u[0]?!r(u.substring(1)):r(u):"true"===u}return n?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,function(e){return(e=e.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?e="false":"!false"===e&&(e="true"),e},e}();exports.AndOrNotEvaluator=e;
},{}],"Ae8d":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tags=void 0;var t=require("./tools"),e=require("./andOrNotEvaluator"),a=function(){function a(){}return a.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return a.HasTags(t)},t.addTags=function(e){return a.AddTagsTo(t,e)},t.removeTags=function(e){return a.RemoveTagsFrom(t,e)},t.matchesTagsQuery=function(e){return a.MatchesQuery(t,e)}},a.DisableFor=function(t){delete t._tags,delete t.hasTags,delete t.addTags,delete t.removeTags,delete t.matchesTagsQuery},a.HasTags=function(e){return!!e._tags&&!t.Tools.IsEmpty(e._tags)},a.GetTags=function(t,e){if(void 0===e&&(e=!0),!t._tags)return null;if(e){var a=[];for(var r in t._tags)t._tags.hasOwnProperty(r)&&!0===t._tags[r]&&a.push(r);return a.join(" ")}return t._tags},a.AddTagsTo=function(t,e){e&&("string"==typeof e&&e.split(" ").forEach(function(e,r,s){a._AddTagTo(t,e)}))},a._AddTagTo=function(t,e){""!==(e=e.trim())&&"true"!==e&&"false"!==e&&(e.match(/[\s]/)||e.match(/^([!]|([|]|[&]){2})/)||(a.EnableFor(t),t._tags[e]=!0))},a.RemoveTagsFrom=function(t,e){if(a.HasTags(t)){var r=e.split(" ");for(var s in r)a._RemoveTagFrom(t,r[s])}},a._RemoveTagFrom=function(t,e){delete t._tags[e]},a.MatchesQuery=function(t,r){return void 0===r||(""===r?a.HasTags(t):e.AndOrNotEvaluator.Eval(r,function(e){return a.HasTags(t)&&t._tags[e]}))},a}();exports.Tags=a;
},{"./tools":"RkuS","./andOrNotEvaluator":"Bmza"}],"knvU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.expandToProperty=u,exports.serialize=l,exports.serializeAsTexture=f,exports.serializeAsColor3=b,exports.serializeAsFresnelParameters=g,exports.serializeAsVector2=p,exports.serializeAsVector3=d,exports.serializeAsMeshReference=m,exports.serializeAsColorCurves=v,exports.serializeAsColor4=k,exports.serializeAsImageProcessingConfiguration=z,exports.serializeAsQuaternion=A,exports.serializeAsCameraReference=C,exports.SerializationHelper=void 0;var e=require("../Misc/tags"),r=require("../Maths/math"),a={},s={},n=function(r,a,s){var n=r();e.Tags&&e.Tags.AddTagsTo(n,a.tags);var i=t(n);for(var o in i){var c=i[o],u=a[o],l=c.type;if(null!=u)switch(l){case 0:case 6:case 11:n[o]=u;break;case 1:n[o]=s||u.isRenderTarget?u:u.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:n[o]=s?u:u.clone()}}return n};function i(e){var r=e.getClassName();return a[r]||(a[r]={}),a[r]}function t(e){var r=e.getClassName();if(s[r])return s[r];s[r]={};for(var n=s[r],i=e,t=r;t;){var o=a[t];for(var c in o)n[c]=o[c];var u=void 0,l=!1;do{if(!(u=Object.getPrototypeOf(i)).getClassName){l=!0;break}if(u.getClassName()!==t)break;i=u}while(u);if(l)break;t=u.getClassName(),i=u}return n}function o(e,r){return function(a,s){var n=i(a);n[s]||(n[s]={type:e,sourceName:r})}}function c(e,r){return void 0===r&&(r=null),function(a,s){var n=r||"_"+s;Object.defineProperty(a,s,{get:function(){return this[n]},set:function(r){this[n]!==r&&(this[n]=r,a[e].apply(this))},enumerable:!0,configurable:!0})}}function u(e,r){return void 0===r&&(r=null),c(e,r)}function l(e){return o(0,e)}function f(e){return o(1,e)}function b(e){return o(2,e)}function g(e){return o(3,e)}function p(e){return o(4,e)}function d(e){return o(5,e)}function m(e){return o(6,e)}function v(e){return o(7,e)}function k(e){return o(8,e)}function z(e){return o(9,e)}function A(e){return o(10,e)}function C(e){return o(11,e)}var x=function(){function a(){}return a.AppendSerializedAnimations=function(e,r){if(e.animations){r.animations=[];for(var a=0;a<e.animations.length;a++){var s=e.animations[a];r.animations.push(s.serialize())}}},a.Serialize=function(r,a){a||(a={}),e.Tags&&(a.tags=e.Tags.GetTags(r));var s=t(r);for(var n in s){var i=s[n],o=i.sourceName||n,c=i.type,u=r[n];if(null!=u)switch(c){case 0:a[o]=u;break;case 1:a[o]=u.serialize();break;case 2:a[o]=u.asArray();break;case 3:a[o]=u.serialize();break;case 4:case 5:a[o]=u.asArray();break;case 6:a[o]=u.id;break;case 7:a[o]=u.serialize();break;case 8:a[o]=u.asArray();break;case 9:a[o]=u.serialize();break;case 10:a[o]=u.asArray();break;case 11:a[o]=u.id}}return a},a.Parse=function(s,n,i,o){void 0===o&&(o=null);var c=s();o||(o=""),e.Tags&&e.Tags.AddTagsTo(c,n.tags);var u=t(c);for(var l in u){var f=u[l],b=n[f.sourceName||l],g=f.type;if(null!=b){var p=c;switch(g){case 0:p[l]=b;break;case 1:i&&(p[l]=a._TextureParser(b,i,o));break;case 2:p[l]=r.Color3.FromArray(b);break;case 3:p[l]=a._FresnelParametersParser(b);break;case 4:p[l]=r.Vector2.FromArray(b);break;case 5:p[l]=r.Vector3.FromArray(b);break;case 6:i&&(p[l]=i.getLastMeshByID(b));break;case 7:p[l]=a._ColorCurvesParser(b);break;case 8:p[l]=r.Color4.FromArray(b);break;case 9:p[l]=a._ImageProcessingConfigurationParser(b);break;case 10:p[l]=r.Quaternion.FromArray(b);break;case 11:i&&(p[l]=i.getCameraByID(b))}}}return c},a.Clone=function(e,r){return n(e,r,!1)},a.Instanciate=function(e,r){return n(e,r,!0)},a._ImageProcessingConfigurationParser=function(e){throw"ImageProcessingConfiguration needs to be imported before being deserialized."},a._FresnelParametersParser=function(e){throw"FresnelParameters needs to be imported before being deserialized."},a._ColorCurvesParser=function(e){throw"ColorCurves needs to be imported before being deserialized."},a._TextureParser=function(e,r,a){throw"Texture needs to be imported before being deserialized."},a}();exports.SerializationHelper=x;
},{"../Misc/tags":"Ae8d","../Maths/math":"Iizi"}],"n+VE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EngineStore=void 0;var e=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){var e=this.LastCreatedEngine;return e?0===e.scenes.length?null:e.scenes[e.scenes.length-1]:null},enumerable:!0,configurable:!0}),e.Instances=new Array,e}();exports.EngineStore=e;
},{}],"YHhW":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VertexBuffer=exports.Buffer=void 0;var t=function(){function t(t,e,i,r,n,s,a){void 0===r&&(r=0),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=i,this._instanced=s,this._data=e,this.byteStride=a?r:r*Float32Array.BYTES_PER_ELEMENT,n||this.create()}return t.prototype.createVertexBuffer=function(t,i,r,n,s,a){void 0===a&&(a=!1);var o=a?i:i*Float32Array.BYTES_PER_ELEMENT,f=n?a?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new e(this._engine,this,t,this._updatable,!0,f,void 0===s?this._instanced:s,o,r,void 0,void 0,!0)},t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},t.prototype.create=function(t){void 0===t&&(t=null),!t&&this._buffer||(t=t||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t))},t.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},t.prototype.update=function(t){this.create(t)},t.prototype.updateDirectly=function(t,e,i,r){void 0===r&&(r=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,r?e:e*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},t}();exports.Buffer=t;var e=function(){function e(i,r,n,s,a,o,f,u,c,h,d,p){if(void 0===d&&(d=!1),void 0===p&&(p=!1),r instanceof t?(this._buffer=r,this._ownsBuffer=!1):(this._buffer=new t(i,r,s,o,a,f,p),this._ownsBuffer=!0),this._kind=n,null==h){var _=this.getData();this.type=e.FLOAT,_ instanceof Int8Array?this.type=e.BYTE:_ instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:_ instanceof Int16Array?this.type=e.SHORT:_ instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:_ instanceof Int32Array?this.type=e.INT:_ instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=h;var y=e.GetTypeByteLength(this.type);p?(this._size=c||(o?o/y:e.DeduceStride(n)),this.byteStride=o||this._buffer.byteStride||this._size*y,this.byteOffset=u||0):(this._size=c||o||e.DeduceStride(n),this.byteStride=o?o*y:this._buffer.byteStride||this._size*y,this.byteOffset=(u||0)*y),this.normalized=d,this._instanced=void 0!==f&&f,this._instanceDivisor=f?1:0}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(t){this._instanceDivisor=t,this._instanced=0!=t},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(){return this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(t){this._buffer.create(t)},e.prototype.update=function(t){this._buffer.update(t)},e.prototype.updateDirectly=function(t,e,i){void 0===i&&(i=!1),this._buffer.updateDirectly(t,e,void 0,i)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,i){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,i)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},e.ForEach=function(t,i,r,n,s,a,o,f){if(t instanceof Array)for(var u=i/4,c=r/4,h=0;h<a;h+=n){for(var d=0;d<n;d++)f(t[u+d],h+d);u+=c}else{var p=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),_=e.GetTypeByteLength(s);for(h=0;h<a;h+=n){var y=i;for(d=0;d<n;d++){f(e._GetFloatValue(p,s,y,o),h+d),y+=_}i+=r}}},e._GetFloatValue=function(t,i,r,n){switch(i){case e.BYTE:var s=t.getInt8(r);return n&&(s=Math.max(s/127,-1)),s;case e.UNSIGNED_BYTE:s=t.getUint8(r);return n&&(s/=255),s;case e.SHORT:s=t.getInt16(r,!0);return n&&(s=Math.max(s/16383,-1)),s;case e.UNSIGNED_SHORT:s=t.getUint16(r,!0);return n&&(s/=65535),s;case e.FLOAT:return t.getFloat32(r,!0);default:throw new Error("Invalid component type "+i)}},e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}();exports.VertexBuffer=e;
},{}],"RtU8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IntersectionInfo=void 0;var t=function(){return function(t,e,s){this.bu=t,this.bv=e,this.distance=s,this.faceId=0,this.subMeshId=0}}();exports.IntersectionInfo=t;
},{}],"fYWR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoundingBox=void 0;var r=require("../Misc/arrayTools"),t=require("../Maths/math"),o=function(){function o(o,e,i){this.vectors=r.ArrayTools.BuildArray(8,t.Vector3.Zero),this.center=t.Vector3.Zero(),this.centerWorld=t.Vector3.Zero(),this.extendSize=t.Vector3.Zero(),this.extendSizeWorld=t.Vector3.Zero(),this.directions=r.ArrayTools.BuildArray(3,t.Vector3.Zero),this.vectorsWorld=r.ArrayTools.BuildArray(8,t.Vector3.Zero),this.minimumWorld=t.Vector3.Zero(),this.maximumWorld=t.Vector3.Zero(),this.minimum=t.Vector3.Zero(),this.maximum=t.Vector3.Zero(),this.reConstruct(o,e,i)}return o.prototype.reConstruct=function(r,o,e){var i=r.x,s=r.y,n=r.z,m=o.x,c=o.y,a=o.z,u=this.vectors;this.minimum.copyFromFloats(i,s,n),this.maximum.copyFromFloats(m,c,a),u[0].copyFromFloats(i,s,n),u[1].copyFromFloats(m,c,a),u[2].copyFromFloats(m,s,n),u[3].copyFromFloats(i,c,n),u[4].copyFromFloats(i,s,a),u[5].copyFromFloats(m,c,n),u[6].copyFromFloats(i,c,a),u[7].copyFromFloats(m,s,a),o.addToRef(r,this.center).scaleInPlace(.5),o.subtractToRef(r,this.extendSize).scaleInPlace(.5),this._update(e||t.Matrix.IdentityReadOnly)},o.prototype.scale=function(r){var t=o.TmpVector3,e=this.maximum.subtractToRef(this.minimum,t[0]),i=e.length();e.normalizeFromLength(i);var s=i*r,n=e.scaleInPlace(.5*s),m=this.center.subtractToRef(n,t[1]),c=this.center.addToRef(n,t[2]);return this.reConstruct(m,c,this._worldMatrix),this},o.prototype.getWorldMatrix=function(){return this._worldMatrix},o.prototype._update=function(r){var o=this.minimumWorld,e=this.maximumWorld,i=this.directions,s=this.vectorsWorld,n=this.vectors;if(r.isIdentity()){o.copyFrom(this.minimum),e.copyFrom(this.maximum);for(m=0;m<8;++m)s[m].copyFrom(n[m]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{o.setAll(Number.MAX_VALUE),e.setAll(-Number.MAX_VALUE);for(var m=0;m<8;++m){var c=s[m];t.Vector3.TransformCoordinatesToRef(n[m],r,c),o.minimizeInPlace(c),e.maximizeInPlace(c)}e.subtractToRef(o,this.extendSizeWorld).scaleInPlace(.5),e.addToRef(o,this.centerWorld).scaleInPlace(.5)}t.Vector3.FromArrayToRef(r.m,0,i[0]),t.Vector3.FromArrayToRef(r.m,4,i[1]),t.Vector3.FromArrayToRef(r.m,8,i[2]),this._worldMatrix=r},o.prototype.isInFrustum=function(r){return o.IsInFrustum(this.vectorsWorld,r)},o.prototype.isCompletelyInFrustum=function(r){return o.IsCompletelyInFrustum(this.vectorsWorld,r)},o.prototype.intersectsPoint=function(r){var o=this.minimumWorld,e=this.maximumWorld,i=o.x,s=o.y,n=o.z,m=e.x,c=e.y,a=e.z,u=r.x,l=r.y,d=r.z,h=-t.Epsilon;return!(m-u<h||h>u-i)&&(!(c-l<h||h>l-s)&&!(a-d<h||h>d-n))},o.prototype.intersectsSphere=function(r){return o.IntersectsSphere(this.minimumWorld,this.maximumWorld,r.centerWorld,r.radiusWorld)},o.prototype.intersectsMinMax=function(r,t){var o=this.minimumWorld,e=this.maximumWorld,i=o.x,s=o.y,n=o.z,m=e.x,c=e.y,a=e.z,u=r.x,l=r.y,d=r.z,h=t.x,y=t.y,p=t.z;return!(m<u||i>h)&&(!(c<l||s>y)&&!(a<d||n>p))},o.Intersects=function(r,t){return r.intersectsMinMax(t.minimumWorld,t.maximumWorld)},o.IntersectsSphere=function(r,e,i,s){var n=o.TmpVector3[0];return t.Vector3.ClampToRef(i,r,e,n),t.Vector3.DistanceSquared(i,n)<=s*s},o.IsCompletelyInFrustum=function(r,t){for(var o=0;o<6;++o)for(var e=t[o],i=0;i<8;++i)if(e.dotCoordinate(r[i])<0)return!1;return!0},o.IsInFrustum=function(r,t){for(var o=0;o<6;++o){for(var e=!0,i=t[o],s=0;s<8;++s)if(i.dotCoordinate(r[s])>=0){e=!1;break}if(e)return!1}return!0},o.TmpVector3=r.ArrayTools.BuildArray(3,t.Vector3.Zero),o}();exports.BoundingBox=o;
},{"../Misc/arrayTools":"eIrG","../Maths/math":"Iizi"}],"LqMr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoundingSphere=void 0;var r=require("../Misc/arrayTools"),t=require("../Maths/math"),e=function(){function e(r,e,o){this.center=t.Vector3.Zero(),this.centerWorld=t.Vector3.Zero(),this.minimum=t.Vector3.Zero(),this.maximum=t.Vector3.Zero(),this.reConstruct(r,e,o)}return e.prototype.reConstruct=function(r,e,o){this.minimum.copyFrom(r),this.maximum.copyFrom(e);var i=t.Vector3.Distance(r,e);e.addToRef(r,this.center).scaleInPlace(.5),this.radius=.5*i,this._update(o||t.Matrix.IdentityReadOnly)},e.prototype.scale=function(r){var t=this.radius*r,o=e.TmpVector3,i=o[0].setAll(t),s=this.center.subtractToRef(i,o[1]),n=this.center.addToRef(i,o[2]);return this.reConstruct(s,n,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(r){if(r.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{t.Vector3.TransformCoordinatesToRef(this.center,r,this.centerWorld);var o=e.TmpVector3[0];t.Vector3.TransformNormalFromFloatsToRef(1,1,1,r,o),this.radiusWorld=Math.max(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z))*this.radius}},e.prototype.isInFrustum=function(r){for(var t=this.centerWorld,e=this.radiusWorld,o=0;o<6;o++)if(r[o].dotCoordinate(t)<=-e)return!1;return!0},e.prototype.isCenterInFrustum=function(r){for(var t=this.centerWorld,e=0;e<6;e++)if(r[e].dotCoordinate(t)<0)return!1;return!0},e.prototype.intersectsPoint=function(r){var e=t.Vector3.DistanceSquared(this.centerWorld,r);return!(this.radiusWorld*this.radiusWorld<e)},e.Intersects=function(r,e){var o=t.Vector3.DistanceSquared(r.centerWorld,e.centerWorld),i=r.radiusWorld+e.radiusWorld;return!(i*i<o)},e.TmpVector3=r.ArrayTools.BuildArray(3,t.Vector3.Zero),e}();exports.BoundingSphere=e;
},{"../Misc/arrayTools":"eIrG","../Maths/math":"Iizi"}],"1eEz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BoundingInfo=void 0;var n=require("../Misc/arrayTools"),t=require("../Maths/math"),o=require("../Engines/constants"),e=require("./boundingBox"),i=require("./boundingSphere"),r={min:0,max:0},s={min:0,max:0},u=function(n,o,e){var i=t.Vector3.Dot(o.centerWorld,n),r=Math.abs(t.Vector3.Dot(o.directions[0],n))*o.extendSize.x+Math.abs(t.Vector3.Dot(o.directions[1],n))*o.extendSize.y+Math.abs(t.Vector3.Dot(o.directions[2],n))*o.extendSize.z;e.min=i-r,e.max=i+r},c=function(n,t,o){return u(n,t,r),u(n,o,s),!(r.min>s.max||s.min>r.max)},d=function(){function r(n,t,o){this._isLocked=!1,this.boundingBox=new e.BoundingBox(n,t,o),this.boundingSphere=new i.BoundingSphere(n,t,o)}return r.prototype.reConstruct=function(n,t,o){this.boundingBox.reConstruct(n,t,o),this.boundingSphere.reConstruct(n,t,o)},Object.defineProperty(r.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLocked",{get:function(){return this._isLocked},set:function(n){this._isLocked=n},enumerable:!0,configurable:!0}),r.prototype.update=function(n){this._isLocked||(this.boundingBox._update(n),this.boundingSphere._update(n))},r.prototype.centerOn=function(n,t){var o=r.TmpVector3[0].copyFrom(n).subtractInPlace(t),e=r.TmpVector3[1].copyFrom(n).addInPlace(t);return this.boundingBox.reConstruct(o,e,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(o,e,this.boundingBox.getWorldMatrix()),this},r.prototype.scale=function(n){return this.boundingBox.scale(n),this.boundingSphere.scale(n),this},r.prototype.isInFrustum=function(n,t){return void 0===t&&(t=o.Constants.MESHES_CULLINGSTRATEGY_STANDARD),!(t!==o.Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&t!==o.Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(n))||!!this.boundingSphere.isInFrustum(n)&&(!(t!==o.Constants.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&t!==o.Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(n))},Object.defineProperty(r.prototype,"diagonalLength",{get:function(){var n=this.boundingBox;return n.maximumWorld.subtractToRef(n.minimumWorld,r.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),r.prototype.isCompletelyInFrustum=function(n){return this.boundingBox.isCompletelyInFrustum(n)},r.prototype._checkCollision=function(n){return n._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},r.prototype.intersectsPoint=function(n){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(n)&&!!this.boundingBox.intersectsPoint(n))},r.prototype.intersects=function(n,o){if(!i.BoundingSphere.Intersects(this.boundingSphere,n.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,n.boundingBox))return!1;if(!o)return!0;var r=this.boundingBox,s=n.boundingBox;return!!c(r.directions[0],r,s)&&(!!c(r.directions[1],r,s)&&(!!c(r.directions[2],r,s)&&(!!c(s.directions[0],r,s)&&(!!c(s.directions[1],r,s)&&(!!c(s.directions[2],r,s)&&(!!c(t.Vector3.Cross(r.directions[0],s.directions[0]),r,s)&&(!!c(t.Vector3.Cross(r.directions[0],s.directions[1]),r,s)&&(!!c(t.Vector3.Cross(r.directions[0],s.directions[2]),r,s)&&(!!c(t.Vector3.Cross(r.directions[1],s.directions[0]),r,s)&&(!!c(t.Vector3.Cross(r.directions[1],s.directions[1]),r,s)&&(!!c(t.Vector3.Cross(r.directions[1],s.directions[2]),r,s)&&(!!c(t.Vector3.Cross(r.directions[2],s.directions[0]),r,s)&&(!!c(t.Vector3.Cross(r.directions[2],s.directions[1]),r,s)&&!!c(t.Vector3.Cross(r.directions[2],s.directions[2]),r,s))))))))))))))},r.TmpVector3=n.ArrayTools.BuildArray(2,t.Vector3.Zero),r}();exports.BoundingInfo=d;
},{"../Misc/arrayTools":"eIrG","../Maths/math":"Iizi","../Engines/constants":"vn8z","./boundingBox":"fYWR","./boundingSphere":"LqMr"}],"MMoF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubMesh=exports.BaseSubMesh=void 0;var e=o(require("tslib")),t=require("../Misc/tools"),n=require("./buffer"),i=require("../Collisions/intersectionInfo"),r=require("../Culling/boundingInfo"),s=require("../Engines/constants");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};i.get||i.set?Object.defineProperty(t,n,i):t[n]=e[n]}return t.default=e,t}var u=function(){function e(){}return Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},e}();exports.BaseSubMesh=u;var a=function(o){function u(e,t,n,i,r,s,u,a){void 0===a&&(a=!0);var h=o.call(this)||this;return h.materialIndex=e,h.verticesStart=t,h.verticesCount=n,h.indexStart=i,h.indexCount=r,h._renderId=0,h._mesh=s,h._renderingMesh=u||s,s.subMeshes.push(h),h._trianglePlanes=[],h._id=s.subMeshes.length-1,a&&(h.refreshBoundingInfo(),s.computeWorldMatrix(!0)),h}return e.__extends(u,o),u.AddToMesh=function(e,t,n,i,r,s,o,a){return void 0===a&&(a=!0),new u(e,t,n,i,r,s,o,a)},Object.defineProperty(u.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),u.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},u.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},u.prototype.getMesh=function(){return this._mesh},u.prototype.getRenderingMesh=function(){return this._renderingMesh},u.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},u.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;var e=this._renderingMesh.getVerticesData(n.VertexBuffer.PositionKind);if(!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var i,s=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===s.length){var o=this._renderingMesh.getBoundingInfo();i={minimum:o.minimum.clone(),maximum:o.maximum.clone()}}else i=t.Tools.ExtractMinAndMaxIndexed(e,s,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new r.BoundingInfo(i.minimum,i.maximum),this},u.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},u.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t.update(e),this},u.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},u.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},u.prototype.render=function(e){return this._renderingMesh.render(this,e),this},u.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var n=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)n.push(e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]);this._linesIndexBuffer=t.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer},u.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},u.prototype.intersects=function(e,t,n,i){var r=this.getMaterial();if(!r)return null;switch(r.fillMode){case s.Constants.MATERIAL_PointListDrawMode:case s.Constants.MATERIAL_LineListDrawMode:case s.Constants.MATERIAL_LineLoopDrawMode:case s.Constants.MATERIAL_LineStripDrawMode:case s.Constants.MATERIAL_TriangleFanDrawMode:case s.Constants.MATERIAL_TriangleStripDrawMode:return null}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?this._intersectLines(e,t,n,this._mesh.intersectionThreshold,i):this._intersectTriangles(e,t,n,i)},u.prototype._intersectLines=function(e,t,n,r,s){for(var o=null,u=this.indexStart;u<this.indexStart+this.indexCount;u+=2){var a=t[n[u]],h=t[n[u+1]],f=e.intersectionSegment(a,h,r);if(!(f<0)&&((s||!o||f<o.distance)&&((o=new i.IntersectionInfo(null,null,f)).faceId=u/2,s)))break}return o},u.prototype._intersectTriangles=function(e,t,n,i){for(var r=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=3){var o=t[n[s]],u=t[n[s+1]],a=t[n[s+2]],h=e.intersectsTriangle(o,u,a);if(h){if(h.distance<0)continue;if((i||!r||h.distance<r.distance)&&((r=h).faceId=s/3,i))break}}return r},u.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},u.prototype.clone=function(e,t){var n=new u(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){var i=this.getBoundingInfo();if(!i)return n;n._boundingInfo=new r.BoundingInfo(i.minimum,i.maximum)}return n},u.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},u.prototype.getClassName=function(){return"SubMesh"},u.CreateFromIndices=function(e,t,n,i,r){for(var s=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=(r||i).getIndices(),h=t;h<t+n;h++){var f=a[h];f<s&&(s=f),f>o&&(o=f)}return new u(e,s,o-s+1,t,n,i,r)},u}(u);exports.SubMesh=a;
},{"tslib":"vCxL","../Misc/tools":"RkuS","./buffer":"YHhW","../Collisions/intersectionInfo":"RtU8","../Culling/boundingInfo":"1eEz","../Engines/constants":"vn8z"}],"oGUW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UniformBuffer=void 0;var t=require("../Misc/logger"),e=function(){function e(t,e,o){this._engine=t,this._noUBO=!t.supportsUniformBuffers,this._dynamic=o,this._data=e||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(t){var e;if(e=t<=2?t:4,this._uniformLocationPointer%e!=0){var o=this._uniformLocationPointer;this._uniformLocationPointer+=e-this._uniformLocationPointer%e;for(var r=this._uniformLocationPointer-o,i=0;i<r;i++)this._data.push(0)}},e.prototype.addUniform=function(t,e){if(!this._noUBO&&void 0===this._uniformLocations[t]){var o;if(e instanceof Array)e=(o=e).length;else{e=e,o=[];for(var r=0;r<e;r++)o.push(0)}this._fillAlignment(e),this._uniformSizes[t]=e,this._uniformLocations[t]=this._uniformLocationPointer,this._uniformLocationPointer+=e;for(r=0;r<e;r++)this._data.push(o[r]);this._needSync=!0}},e.prototype.addMatrix=function(t,e){this.addUniform(t,Array.prototype.slice.call(e.toArray()))},e.prototype.addFloat2=function(t,e,o){var r=[e,o];this.addUniform(t,r)},e.prototype.addFloat3=function(t,e,o,r){var i=[e,o,r];this.addUniform(t,i)},e.prototype.addColor3=function(t,e){var o=new Array;e.toArray(o),this.addUniform(t,o)},e.prototype.addColor4=function(t,e,o){var r=new Array;e.toArray(r),r.push(o),this.addUniform(t,r)},e.prototype.addVector3=function(t,e){var o=new Array;e.toArray(o),this.addUniform(t,o)},e.prototype.addMatrix3x3=function(t){this.addUniform(t,12)},e.prototype.addMatrix2x2=function(t){this.addUniform(t,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){this._noUBO||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},e.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},e.prototype.updateUniform=function(e,o,r){var i=this._uniformLocations[e];if(void 0===i){if(this._buffer)return void t.Logger.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,r),i=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(n=0;n<r;n++)this._bufferData[i+n]=o[n];else{for(var f=!1,n=0;n<r;n++)this._bufferData[i+n]!==o[n]&&(f=!0,this._bufferData[i+n]=o[n]);this._needSync=this._needSync||f}},e.prototype._updateMatrix3x3ForUniform=function(t,o){for(var r=0;r<3;r++)e._tempBuffer[4*r]=o[3*r],e._tempBuffer[4*r+1]=o[3*r+1],e._tempBuffer[4*r+2]=o[3*r+2],e._tempBuffer[4*r+3]=0;this.updateUniform(t,e._tempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(t,e){this._currentEffect.setMatrix3x3(t,e)},e.prototype._updateMatrix2x2ForEffect=function(t,e){this._currentEffect.setMatrix2x2(t,e)},e.prototype._updateMatrix2x2ForUniform=function(t,o){for(var r=0;r<2;r++)e._tempBuffer[4*r]=o[2*r],e._tempBuffer[4*r+1]=o[2*r+1],e._tempBuffer[4*r+2]=0,e._tempBuffer[4*r+3]=0;this.updateUniform(t,e._tempBuffer,8)},e.prototype._updateFloatForEffect=function(t,e){this._currentEffect.setFloat(t,e)},e.prototype._updateFloatForUniform=function(t,o){e._tempBuffer[0]=o,this.updateUniform(t,e._tempBuffer,1)},e.prototype._updateFloat2ForEffect=function(t,e,o,r){void 0===r&&(r=""),this._currentEffect.setFloat2(t+r,e,o)},e.prototype._updateFloat2ForUniform=function(t,o,r){e._tempBuffer[0]=o,e._tempBuffer[1]=r,this.updateUniform(t,e._tempBuffer,2)},e.prototype._updateFloat3ForEffect=function(t,e,o,r,i){void 0===i&&(i=""),this._currentEffect.setFloat3(t+i,e,o,r)},e.prototype._updateFloat3ForUniform=function(t,o,r,i){e._tempBuffer[0]=o,e._tempBuffer[1]=r,e._tempBuffer[2]=i,this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateFloat4ForEffect=function(t,e,o,r,i,f){void 0===f&&(f=""),this._currentEffect.setFloat4(t+f,e,o,r,i)},e.prototype._updateFloat4ForUniform=function(t,o,r,i,f){e._tempBuffer[0]=o,e._tempBuffer[1]=r,e._tempBuffer[2]=i,e._tempBuffer[3]=f,this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateMatrixForEffect=function(t,e){this._currentEffect.setMatrix(t,e)},e.prototype._updateMatrixForUniform=function(t,e){this.updateUniform(t,e.toArray(),16)},e.prototype._updateVector3ForEffect=function(t,e){this._currentEffect.setVector3(t,e)},e.prototype._updateVector3ForUniform=function(t,o){o.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateVector4ForEffect=function(t,e){this._currentEffect.setVector4(t,e)},e.prototype._updateVector4ForUniform=function(t,o){o.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateColor3ForEffect=function(t,e,o){void 0===o&&(o=""),this._currentEffect.setColor3(t+o,e)},e.prototype._updateColor3ForUniform=function(t,o){o.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateColor4ForEffect=function(t,e,o,r){void 0===r&&(r=""),this._currentEffect.setColor4(t+r,e,o)},e.prototype._updateColor4ForUniform=function(t,o,r){o.toArray(e._tempBuffer),e._tempBuffer[3]=r,this.updateUniform(t,e._tempBuffer,4)},e.prototype.setTexture=function(t,e){this._currentEffect.setTexture(t,e)},e.prototype.updateUniformDirectly=function(t,e){this.updateUniform(t,e,e.length),this.update()},e.prototype.bindToEffect=function(t,e){this._currentEffect=t,!this._noUBO&&this._buffer&&t.bindUniformBuffer(this._buffer,e)},e.prototype.dispose=function(){if(!this._noUBO){var t=this._engine._uniformBuffers,e=t.indexOf(this);-1!==e&&(t[e]=t[t.length-1],t.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._MAX_UNIFORM_SIZE=256,e._tempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e}();exports.UniformBuffer=e;
},{"../Misc/logger":"Fvml"}],"v46b":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Material=void 0;var e=h(require("tslib")),t=require("../Misc/decorators"),i=require("../Misc/tools"),r=require("../Misc/observable"),n=require("../Maths/math"),s=require("../Engines/engineStore"),a=require("../Meshes/subMesh"),o=require("./uniformBuffer"),l=require("../Engines/constants"),c=require("../Misc/logger");function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};r.get||r.set?Object.defineProperty(t,i,r):t[i]=e[i]}return t.default=e,t}var u=function(){function h(e,t,n){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.onDisposeObservable=new r.Observable,this._alphaMode=l.Constants.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._wasPreviouslyReady=!1,this._fillMode=h.TriangleFillMode,this._indexInSceneMaterialArray=-1,this.name=e,this.id=e||i.Tools.RandomId(),this._scene=t||s.EngineStore.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=h.ClockWiseSideOrientation:this.sideOrientation=h.CounterClockWiseSideOrientation,this._uniformBuffer=new o.UniformBuffer(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,n||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(h.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alpha=e,this.markAsDirty(h.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(h.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new r.Observable),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new r.Observable),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(h.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(h.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"wireframe",{get:function(){switch(this._fillMode){case h.WireFrameFillMode:case h.LineListDrawMode:case h.LineLoopDrawMode:case h.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(e){this.fillMode=e?h.WireFrameFillMode:h.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case h.PointFillMode:case h.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(e){this.fillMode=e?h.PointFillMode:h.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(h.MiscDirtyFlag))},enumerable:!0,configurable:!0}),h.prototype.toString=function(e){return"Name: "+this.name},h.prototype.getClassName=function(){return"Material"},Object.defineProperty(h.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),h.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},h.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},h.prototype.isReady=function(e,t){return!0},h.prototype.isReadyForSubMesh=function(e,t,i){return!1},h.prototype.getEffect=function(){return this._effect},h.prototype.getScene=function(){return this._scene},h.prototype.needAlphaBlending=function(){return this.alpha<1},h.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},h.prototype.needAlphaTesting=function(){return!1},h.prototype.getAlphaTestTexture=function(){return null},h.prototype.markDirty=function(){this._wasPreviouslyReady=!1},h.prototype._preBind=function(e,t){void 0===t&&(t=null);var i=this._scene.getEngine(),r=(null==t?this.sideOrientation:t)===h.ClockWiseSideOrientation;return i.enableEffect(e||this._effect),i.setState(this.backFaceCulling,this.zOffset,!1,r),r},h.prototype.bind=function(e,t){},h.prototype.bindForSubMesh=function(e,t,i){},h.prototype.bindOnlyWorldMatrix=function(e){},h.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},h.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},h.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},h.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},h.prototype._afterBind=function(e){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}},h.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.disableDepthWrite)&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},h.prototype.getActiveTextures=function(){return[]},h.prototype.hasTexture=function(e){return!1},h.prototype.clone=function(e){return null},h.prototype.getBindedMeshes=function(){var e=this;if(this.meshMap){var t=new Array;for(var i in this.meshMap){var r=this.meshMap[i];r&&t.push(r)}return t}return this._scene.meshes.filter(function(t){return t.material===e})},h.prototype.forceCompilation=function(t,i,r){var s=this,o=e.__assign({clipPlane:!1},r),l=new a.BaseSubMesh,c=this.getScene(),h=function(){if(s._scene&&s._scene.getEngine()){l._materialDefines&&(l._materialDefines._renderId=-1);var e=c.clipPlane;o.clipPlane&&(c.clipPlane=new n.Plane(0,0,0,1)),s._storeEffectOnSubMeshes?s.isReadyForSubMesh(t,l)?i&&i(s):setTimeout(h,16):s.isReady()?i&&i(s):setTimeout(h,16),o.clipPlane&&(c.clipPlane=e)}};h()},h.prototype.forceCompilationAsync=function(e,t){var i=this;return new Promise(function(r){i.forceCompilation(e,function(){r()},t)})},h.prototype.markAsDirty=function(e){this.getScene().blockMaterialDirtyMechanism||(h._DirtyCallbackArray.length=0,e&h.TextureDirtyFlag&&h._DirtyCallbackArray.push(h._TextureDirtyCallBack),e&h.LightDirtyFlag&&h._DirtyCallbackArray.push(h._LightsDirtyCallBack),e&h.FresnelDirtyFlag&&h._DirtyCallbackArray.push(h._FresnelDirtyCallBack),e&h.AttributesDirtyFlag&&h._DirtyCallbackArray.push(h._AttributeDirtyCallBack),e&h.MiscDirtyFlag&&h._DirtyCallbackArray.push(h._MiscDirtyCallBack),h._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(h._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},h.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=0,i=this.getScene().meshes;t<i.length;t++){var r=i[t];if(r.subMeshes)for(var n=0,s=r.subMeshes;n<s.length;n++){var a=s[n];a.getMaterial()===this&&(a._materialDefines&&e(a._materialDefines))}}},h.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(h._ImageProcessingDirtyCallBack)},h.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(h._TextureDirtyCallBack)},h.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(h._FresnelDirtyCallBack)},h.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(h._FresnelAndMiscDirtyCallBack)},h.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(h._LightsDirtyCallBack)},h.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(h._AttributeDirtyCallBack)},h.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(h._MiscDirtyCallBack)},h.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(h._TextureAndMiscDirtyCallBack)},h.prototype.dispose=function(e,t,i){var r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),!0!==i)if(this.meshMap)for(var n in this.meshMap){(o=this.meshMap[n])&&(o.material=null,this.releaseVertexArrayObject(o,e))}else for(var s=0,a=r.meshes;s<a.length;s++){var o;(o=a[s]).material===this&&(o.material=null,this.releaseVertexArrayObject(o,e))}this._uniformBuffer.dispose(),e&&this._effect&&(this._storeEffectOnSubMeshes||r.getEngine()._releaseEffect(this._effect),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},h.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var i=e.geometry,r=this.getScene();if(this._storeEffectOnSubMeshes)for(var n=0,s=e.subMeshes;n<s.length;n++){var a=s[n];i._releaseVertexArrayObject(a._materialEffect),t&&a._materialEffect&&r.getEngine()._releaseEffect(a._materialEffect)}else i._releaseVertexArrayObject(this._effect)}},h.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},h.Parse=function(e,t,r){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return void c.Logger.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library.")}else e.customType="BABYLON.StandardMaterial";return i.Tools.Instantiate(e.customType).Parse(e,t,r)},h.TriangleFillMode=l.Constants.MATERIAL_TriangleFillMode,h.WireFrameFillMode=l.Constants.MATERIAL_WireFrameFillMode,h.PointFillMode=l.Constants.MATERIAL_PointFillMode,h.PointListDrawMode=l.Constants.MATERIAL_PointListDrawMode,h.LineListDrawMode=l.Constants.MATERIAL_LineListDrawMode,h.LineLoopDrawMode=l.Constants.MATERIAL_LineLoopDrawMode,h.LineStripDrawMode=l.Constants.MATERIAL_LineStripDrawMode,h.TriangleStripDrawMode=l.Constants.MATERIAL_TriangleStripDrawMode,h.TriangleFanDrawMode=l.Constants.MATERIAL_TriangleFanDrawMode,h.ClockWiseSideOrientation=l.Constants.MATERIAL_ClockWiseSideOrientation,h.CounterClockWiseSideOrientation=l.Constants.MATERIAL_CounterClockWiseSideOrientation,h.TextureDirtyFlag=l.Constants.MATERIAL_TextureDirtyFlag,h.LightDirtyFlag=l.Constants.MATERIAL_LightDirtyFlag,h.FresnelDirtyFlag=l.Constants.MATERIAL_FresnelDirtyFlag,h.AttributesDirtyFlag=l.Constants.MATERIAL_AttributesDirtyFlag,h.MiscDirtyFlag=l.Constants.MATERIAL_MiscDirtyFlag,h.AllDirtyFlag=l.Constants.MATERIAL_AllDirtyFlag,h._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},h._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},h._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},h._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},h._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},h._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},h._FresnelAndMiscDirtyCallBack=function(e){h._FresnelDirtyCallBack(e),h._MiscDirtyCallBack(e)},h._TextureAndMiscDirtyCallBack=function(e){h._TextureDirtyCallBack(e),h._MiscDirtyCallBack(e)},h._DirtyCallbackArray=[],h._RunDirtyCallBacks=function(e){for(var t=0,i=h._DirtyCallbackArray;t<i.length;t++){(0,i[t])(e)}},e.__decorate([(0,t.serialize)()],h.prototype,"id",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"uniqueId",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"name",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"checkReadyOnEveryCall",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"checkReadyOnlyOnce",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"state",void 0),e.__decorate([(0,t.serialize)("alpha")],h.prototype,"_alpha",void 0),e.__decorate([(0,t.serialize)("backFaceCulling")],h.prototype,"_backFaceCulling",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"sideOrientation",void 0),e.__decorate([(0,t.serialize)("alphaMode")],h.prototype,"_alphaMode",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"_needDepthPrePass",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"disableDepthWrite",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"forceDepthWrite",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"separateCullingPass",void 0),e.__decorate([(0,t.serialize)("fogEnabled")],h.prototype,"_fogEnabled",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"pointSize",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"zOffset",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"wireframe",null),e.__decorate([(0,t.serialize)()],h.prototype,"pointsCloud",null),e.__decorate([(0,t.serialize)()],h.prototype,"fillMode",null),h}();exports.Material=u;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Misc/tools":"RkuS","../Misc/observable":"gtkL","../Maths/math":"Iizi","../Engines/engineStore":"n+VE","../Meshes/subMesh":"MMoF","./uniformBuffer":"oGUW","../Engines/constants":"vn8z","../Misc/logger":"Fvml"}],"izD9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DummyInternalTextureTracker=void 0;var e=function(){return function(){this.previous=null,this.next=null}}();exports.DummyInternalTextureTracker=e;
},{}],"vXjp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTargetCreationOptions=void 0;var e=function(){return function(){}}();exports.RenderTargetCreationOptions=e;
},{}],"KfUh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InternalTexture=void 0;var e=require("../../Misc/observable"),t=require("../../Materials/Textures/renderTargetCreationOptions"),i=require("../../Engines/constants"),s=function(){function s(t,i,r){void 0===r&&(r=!1),this.onLoadedObservable=new e.Observable,this.previous=null,this.next=null,this._invertVScale=!1,this._initialSlot=-1,this._designatedSlot=-1,this._dataSource=s.DATASOURCE_UNKNOWN,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._isRGBD=!1,this._references=1,this._engine=t,this._dataSource=i,r||(this._webGLTexture=t._createTexture())}return s.prototype.getEngine=function(){return this._engine},Object.defineProperty(s.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),s.prototype.incrementReferences=function(){this._references++},s.prototype.updateSize=function(e,t,i){void 0===i&&(i=1),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i},s.prototype._rebuild=function(){var e,r=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this._dataSource){case s.DATASOURCE_TEMP:return;case s.DATASOURCE_URL:return void(e=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){e._swapAndDie(r),r.isReady=!0},null,this._buffer,void 0,this.format));case s.DATASOURCE_RAW:return(e=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case s.DATASOURCE_RAW3D:return(e=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case s.DATASOURCE_DYNAMIC:return(e=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case s.DATASOURCE_RENDERTARGET:var n=new t.RenderTargetCreationOptions;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)e=this._engine.createRenderTargetCubeTexture(this.width,n);else{var h={width:this.width,height:this.height};e=this._engine.createRenderTargetTexture(h,n)}return e._swapAndDie(this),void(this.isReady=!0);case s.DATASOURCE_DEPTHTEXTURE:var a={bilinearFiltering:this.samplingMode!==i.Constants.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube};return(e=this._engine.createDepthStencilTexture({width:this.width,height:this.height},a))._swapAndDie(this),void(this.isReady=!0);case s.DATASOURCE_CUBE:return void(e=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){e._swapAndDie(r),r.isReady=!0},null,this.format,this._extension));case s.DATASOURCE_CUBERAW:return(e=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case s.DATASOURCE_CUBERAW_RGBD:return e=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void s._UpdateRGBDAsync(e,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){e._swapAndDie(r),r.isReady=!0});case s.DATASOURCE_CUBEPREFILTERED:return void((e=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(r),r.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},s.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow);var t=this._engine.getLoadedTexturesCache(),i=t.indexOf(this);-1!==i&&t.splice(i,1)},s.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null,this.previous=null,this.next=null))},s._UpdateRGBDAsync=function(e,t,i,s,r){throw"environmentTextureTools needs to be imported before rebuilding RGBD textures."},s.DATASOURCE_UNKNOWN=0,s.DATASOURCE_URL=1,s.DATASOURCE_TEMP=2,s.DATASOURCE_RAW=3,s.DATASOURCE_DYNAMIC=4,s.DATASOURCE_RENDERTARGET=5,s.DATASOURCE_MULTIRENDERTARGET=6,s.DATASOURCE_CUBE=7,s.DATASOURCE_CUBERAW=8,s.DATASOURCE_CUBEPREFILTERED=9,s.DATASOURCE_RAW3D=10,s.DATASOURCE_DEPTHTEXTURE=11,s.DATASOURCE_CUBERAW_RGBD=12,s}();exports.InternalTexture=s;
},{"../../Misc/observable":"gtkL","../../Materials/Textures/renderTargetCreationOptions":"vXjp","../../Engines/constants":"vn8z"}],"GDPI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._AlphaState=void 0;var t=function(){function t(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(t){this._alphaBlend!==t&&(this._alphaBlend=t,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.setAlphaBlendConstants=function(t,n,e,s){this._blendConstants[0]===t&&this._blendConstants[1]===n&&this._blendConstants[2]===e&&this._blendConstants[3]===s||(this._blendConstants[0]=t,this._blendConstants[1]=n,this._blendConstants[2]=e,this._blendConstants[3]=s,this._isBlendConstantsDirty=!0)},t.prototype.setAlphaBlendFunctionParameters=function(t,n,e,s){this._blendFunctionParameters[0]===t&&this._blendFunctionParameters[1]===n&&this._blendFunctionParameters[2]===e&&this._blendFunctionParameters[3]===s||(this._blendFunctionParameters[0]=t,this._blendFunctionParameters[1]=n,this._blendFunctionParameters[2]=e,this._blendFunctionParameters[3]=s,this._isBlendFunctionParametersDirty=!0)},t.prototype.setAlphaEquationParameters=function(t,n){this._blendEquationParameters[0]===t&&this._blendEquationParameters[1]===n||(this._blendEquationParameters[0]=t,this._blendEquationParameters[1]=n,this._isBlendEquationParametersDirty=!0)},t.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},t.prototype.apply=function(t){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?t.enable(t.BLEND):t.disable(t.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(t.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(t.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(t.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},t}();exports._AlphaState=t;
},{}],"04fs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._DepthCullingState=void 0;var t=function(){function t(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zOffset",{get:function(){return this._zOffset},set:function(t){this._zOffset!==t&&(this._zOffset=t,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cullFace",{get:function(){return this._cullFace},set:function(t){this._cullFace!==t&&(this._cullFace=t,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cull",{get:function(){return this._cull},set:function(t){this._cull!==t&&(this._cull=t,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(t){this._depthFunc!==t&&(this._depthFunc=t,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return this._depthMask},set:function(t){this._depthMask!==t&&(this._depthMask=t,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return this._depthTest},set:function(t){this._depthTest!==t&&(this._depthTest=t,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frontFace",{get:function(){return this._frontFace},set:function(t){this._frontFace!==t&&(this._frontFace=t,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},t.prototype.apply=function(t){this.isDirty&&(this._isCullDirty&&(this.cull?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(t.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(t.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(t.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(this.zOffset,0)):t.disable(t.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(t.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},t}();exports._DepthCullingState=t;
},{}],"Pixg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports._StencilState=void 0;var t=require("../Engines/constants"),i=function(){function i(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(i.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(t){this._stencilFunc!==t&&(this._stencilFunc=t,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(t){this._stencilFuncRef!==t&&(this._stencilFuncRef=t,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(t){this._stencilFuncMask!==t&&(this._stencilFuncMask=t,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(t){this._stencilOpStencilFail!==t&&(this._stencilOpStencilFail=t,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(t){this._stencilOpDepthFail!==t&&(this._stencilOpDepthFail=t,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(t){this._stencilOpStencilDepthPass!==t&&(this._stencilOpStencilDepthPass=t,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(t){this._stencilMask!==t&&(this._stencilMask=t,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(t){this._stencilTest!==t&&(this._stencilTest=t,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=i.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=i.KEEP,this._stencilOpDepthFail=i.KEEP,this._stencilOpStencilDepthPass=i.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},i.prototype.apply=function(t){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(t.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(t.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(t.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},i.ALWAYS=t.Constants.ALWAYS,i.KEEP=t.Constants.KEEP,i.REPLACE=t.Constants.REPLACE,i}();exports._StencilState=i;
},{"../Engines/constants":"vn8z"}],"VVol":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./alphaCullingState");Object.keys(e).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}})});var t=require("./depthCullingState");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})});var r=require("./stencilState");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return r[e]}})});
},{"./alphaCullingState":"GDPI","./depthCullingState":"04fs","./stencilState":"Pixg"}],"Z5lb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Engine=exports.EngineCapabilities=exports.DepthTextureCreationOptions=exports.InstancingAttributeInfo=void 0;var e=d(require("tslib")),t=require("../Misc/observable"),r=require("../Misc/performanceMonitor"),i=require("../Misc/stringDictionary"),n=require("../Misc/promise"),s=require("../Misc/tools"),a=require("../Maths/math"),_=require("../Maths/math.scalar"),o=require("../Materials/effect"),E=require("../Materials/material"),l=require("../Materials/Textures/internalTextureTracker"),u=require("../Materials/Textures/internalTexture"),h=require("../States/index"),T=require("./constants"),c=require("../Misc/domManagement"),f=require("../Misc/logger"),R=require("./engineStore"),p=require("../Materials/Textures/renderTargetCreationOptions");function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var g=function(){return function(){}}(),A=function(){return function(){}}();exports.InstancingAttributeInfo=A;var b=function(){return function(){}}();exports.DepthTextureCreationOptions=b;var U=function(){return function(){}}();exports.EngineCapabilities=U;var m=function(){function d(e,i,_,o){void 0===o&&(o=!1);var E=this;this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.scenes=new Array,this.onNewSceneAddedObservable=new t.Observable,this.postProcesses=new Array,this.validateShaderPrograms=!1,this.onResizeObservable=new t.Observable,this.onCanvasBlurObservable=new t.Observable,this.onCanvasFocusObservable=new t.Observable,this.onCanvasPointerOutObservable=new t.Observable,this.onBeforeTextureInitObservable=new t.Observable,this._vrDisplay=void 0,this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this.onBeginFrameObservable=new t.Observable,this.customAnimationFrameRequester=null,this.onEndFrameObservable=new t.Observable,this.onBeforeShaderCompilationObservable=new t.Observable,this.onAfterShaderCompilationObservable=new t.Observable,this._windowIsBackground=!1,this._webGLVersion=1,this._badOS=!1,this._badDesktopOS=!1,this.disableTextureBindingOptimization=!1,this.onVRDisplayChangedObservable=new t.Observable,this.onVRRequestPresentComplete=new t.Observable,this.onVRRequestPresentStart=new t.Observable,this._colorWrite=!0,this._drawCalls=new s.PerfCounter,this._textureCollisions=new s.PerfCounter,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new t.Observable,this.onContextRestoredObservable=new t.Observable,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new r.PerformanceMonitor,this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this._depthCullingState=new h._DepthCullingState,this._stencilState=new h._StencilState,this._alphaState=new h._AlphaState,this._alphaMode=d.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._firstBoundInternalTextureTracker=new l.DummyInternalTextureTracker,this._lastBoundInternalTextureTracker=new l.DummyInternalTextureTracker,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this._viewportCached=new a.Vector4(0,0,0,0),this._onVRFullScreenTriggered=function(){if(E._vrDisplay&&E._vrDisplay.isPresenting){E._oldSize=new a.Size(E.getRenderWidth(),E.getRenderHeight()),E._oldHardwareScaleFactor=E.getHardwareScalingLevel();var e=E._vrDisplay.getEyeParameters("left");E.setHardwareScalingLevel(1),E.setSize(2*e.renderWidth,e.renderHeight)}else E.setHardwareScalingLevel(E._oldHardwareScaleFactor),E.setSize(E._oldSize.width,E._oldSize.height)},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},n.PromisePolyfill.Apply();var u=null;if(d.Instances.push(this),e){if(_=_||{},e.getContext){if(u=e,this._renderingCanvas=u,null!=i&&(_.antialias=i),void 0===_.deterministicLockstep&&(_.deterministicLockstep=!1),void 0===_.lockstepMaxSteps&&(_.lockstepMaxSteps=4),void 0===_.preserveDrawingBuffer&&(_.preserveDrawingBuffer=!1),void 0===_.audioEngine&&(_.audioEngine=!0),void 0===_.stencil&&(_.stencil=!0),!1===_.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._deterministicLockstep=_.deterministicLockstep,this._lockstepMaxSteps=_.lockstepMaxSteps,this._doNotHandleContextLost=!!_.doNotHandleContextLost,navigator&&navigator.userAgent)for(var T=navigator.userAgent,R=0,p=d.ExceptionList;R<p.length;R++){var A=p[R],b=A.key,U=A.targets;if(T.indexOf(b)>-1){if(A.capture&&A.captureConstraint){var m=A.capture,x=A.captureConstraint,I=new RegExp(m).exec(T);if(I&&I.length>0)if(parseInt(I[I.length-1])>=x)continue}for(var S=0,D=U;S<D.length;S++){switch(D[S]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"textureBindingOptimization":this.disableTextureBindingOptimization=!0}}}}if(!_.disableWebGL2Support)try{this._gl=u.getContext("webgl2",_)||u.getContext("experimental-webgl2",_),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(P){}if(!this._gl){if(!u)throw new Error("The provided canvas is null or undefined.");try{this._gl=u.getContext("webgl",_)||u.getContext("experimental-webgl",_)}catch(P){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._onCanvasFocus=function(){E.onCanvasFocusObservable.notifyObservers(E)},this._onCanvasBlur=function(){E.onCanvasBlurObservable.notifyObservers(E)},u.addEventListener("focus",this._onCanvasFocus),u.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){E.disablePerformanceMonitorInBackground&&E._performanceMonitor.disable(),E._windowIsBackground=!0},this._onFocus=function(){E.disablePerformanceMonitorInBackground&&E._performanceMonitor.enable(),E._windowIsBackground=!1},this._onCanvasPointerOut=function(e){E.onCanvasPointerOutObservable.notifyObservers(e)},c.DomManagement.IsWindowObjectExist()&&(window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus)),u.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),E._contextWasLost=!0,f.Logger.Warn("WebGL context lost."),E.onContextLostObservable.notifyObservers(E)},this._onContextRestored=function(){setTimeout(function(){E._initGLContext(),E._rebuildEffects(),E._rebuildInternalTextures(),E._rebuildBuffers(),E.wipeCaches(!0),f.Logger.Warn("WebGL context successfully restored."),E.onContextRestoredObservable.notifyObservers(E),E._contextWasLost=!1},0)},u.addEventListener("webglcontextlost",this._onContextLost,!1),u.addEventListener("webglcontextrestored",this._onContextRestored,!1)),_.doNotHandleTouchAction||this._disableTouchAction()}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var v=this._gl.getContextAttributes();v&&(_.stencil=v.stencil)}var F=c.DomManagement.IsWindowObjectExist()&&window.devicePixelRatio||1,N=_.limitDeviceRatio||F;this._hardwareScalingLevel=o?1/Math.min(N,F):1,this.resize(),this._isStencilEnable=!!_.stencil,this._initGLContext(),u&&(this._onFullscreenChange=function(){void 0!==document.fullscreen?E.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?E.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?E.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(E.isFullscreen=document.msIsFullScreen),E.isFullscreen&&E._pointerLockRequested&&u&&(u.requestPointerLock=u.requestPointerLock||u.msRequestPointerLock||u.mozRequestPointerLock||u.webkitRequestPointerLock,u.requestPointerLock&&u.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){E.isPointerLock=document.mozPointerLockElement===u||document.webkitPointerLockElement===u||document.msPointerLockElement===u||document.pointerLockElement===u},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._onVRDisplayPointerRestricted=function(){u&&u.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){document.exitPointerLock()},c.DomManagement.IsWindowObjectExist()&&(window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1))),!d.audioEngine&&_.audioEngine&&d.AudioEngineFactory&&(d.audioEngine=d.AudioEngineFactory(this.getRenderingCanvas()));for(var M=0;M<this._caps.maxVertexAttribs;M++)this._currentBufferPointers[M]=new g;this._linkTrackers(this._firstBoundInternalTextureTracker,this._lastBoundInternalTextureTracker),_.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),console.log("Babylon.js v"+d.Version+" - "+this.description),this.enableOfflineSupport=void 0!==d.OfflineProviderFactory}}return Object.defineProperty(d,"Instances",{get:function(){return R.EngineStore.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(d,"LastCreatedEngine",{get:function(){return R.EngineStore.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(d,"LastCreatedScene",{get:function(){return R.EngineStore.LastCreatedScene},enumerable:!0,configurable:!0}),d.MarkAllMaterialsAsDirty=function(e,t){for(var r=0;r<d.Instances.length;r++)for(var i=d.Instances[r],n=0;n<i.scenes.length;n++)i.scenes[n].markAllMaterialsAsDirty(e,t)},Object.defineProperty(d,"Version",{get:function(){return"4.0.0-alpha.17"},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ShadersRepository",{get:function(){return o.Effect.ShadersRepository},set:function(e){o.Effect.ShadersRepository=e},enumerable:!0,configurable:!0}),d.DefaultLoadingScreenFactory=function(e){throw"Import LoadingScreen or set DefaultLoadingScreenFactory on engine before using the loading screen"},Object.defineProperty(d.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,d.TEXTUREFORMAT_RGBA,!1,!1,d.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,d.TEXTUREFORMAT_RGBA,!1,!1,d.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,d.TEXTUREFORMAT_RGBA,d.TEXTURETYPE_UNSIGNED_INT,!1,!1,d.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),d.prototype._disableTouchAction=function(){this._renderingCanvas&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},d.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++){t[e]._rebuild()}},d.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){this._compiledEffects[e]._prepareEffect()}o.Effect.ResetCache()},d.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0},d.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var r=t[e];r.resetCachedMaterial(),r._rebuildGeometries(),r._rebuildTextures()}for(var i=0,n=this._uniformBuffers;i<n.length;i++){n[i]._rebuild()}},d.prototype._initGLContext=function(){this._caps=new U,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxCombinedTexturesImageUnits=this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!1,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._caps.parallelShaderCompile=this._gl.getExtension("KHR_parallel_shader_compile"),this._caps.parallelShaderCompile){var i=this._gl.getParameter(this._caps.parallelShaderCompile.MAX_SHADER_COMPILER_THREADS_KHR);this._caps.parallelShaderCompile.maxShaderCompilerThreadsKHR(i)}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var n=this._gl.getExtension("WEBGL_depth_texture");null!=n&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=n.UNSIGNED_INT_24_8_WEBGL)}if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var s=this._gl.getExtension("OES_vertex_array_object");null!=s?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=s.createVertexArrayOES.bind(s),this._gl.bindVertexArray=s.bindVertexArrayOES.bind(s),this._gl.deleteVertexArray=s.deleteVertexArrayOES.bind(s)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var a=this._gl.getExtension("ANGLE_instanced_arrays");null!=a?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a),this._gl.drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._gl.vertexAttribDivisor=a.vertexAttribDivisorANGLE.bind(a)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var _=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),o=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);_&&o&&(this._caps.highPrecisionShaderSupported=0!==_.precision&&0!==o.precision)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var E=0;E<this._maxSimultaneousTextures;E++)this._nextFreeTextureSlots.push(E)},Object.defineProperty(d.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),d.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},d.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)if(this._boundTexturesCache.hasOwnProperty(e)){var t=this._boundTexturesCache[e];t&&this._removeDesignatedSlot(t),this._boundTexturesCache[e]=null}if(!this.disableTextureBindingOptimization){this._nextFreeTextureSlots=[];for(var r=0;r<this._maxSimultaneousTextures;r++)this._nextFreeTextureSlots.push(r)}this._currentTextureChannel=-1},d.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},d.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},d.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},d.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var r=e.viewport;return this.getRenderWidth(t)*r.width/(this.getRenderHeight(t)*r.height)},d.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},d.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},d.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},d.prototype.getRenderingCanvas=function(){return this._renderingCanvas},d.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},d.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},d.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},d.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},d.prototype.getCaps=function(){return this._caps},d.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},d.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},d.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},d.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},d.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},d.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},d.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},d.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},d.prototype.getStencilMask=function(){return this._stencilState.stencilMask},d.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},d.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},d.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},d.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},d.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},d.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},d.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},d.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},d.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},d.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},d.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},d.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},d.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},d.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},d.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},d.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},d.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=s.Tools.QueueNewFrame(this.customAnimationFrameRequester.renderFunction||this._bindedRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._vrDisplay&&this._vrDisplay.isPresenting?this._frameHandler=s.Tools.QueueNewFrame(this._bindedRenderFunction,this._vrDisplay):this._frameHandler=s.Tools.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},d.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=s.Tools.QueueNewFrame(this._bindedRenderFunction)))},d.prototype.switchFullscreen=function(e){this.isFullscreen?s.Tools.ExitFullscreen():(this._pointerLockRequested=e,this._renderingCanvas&&s.Tools.RequestFullscreen(this._renderingCanvas))},d.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),r&&(this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},d.prototype.scissorClear=function(e,t,r,i,n){this.enableScissor(e,t,r,i),this.clear(n,!0,!0,!0),this.disableScissor()},d.prototype.enableScissor=function(e,t,r,i){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,r,i)},d.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},d.prototype._viewport=function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))},d.prototype.setViewport=function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),s=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(s*i,a*n,i*e.width,n*e.height)},d.prototype.setDirectViewport=function(e,t,r,i){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,r,i),n},d.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},d.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame(),this.onEndFrameObservable.notifyObservers(this)},d.prototype.resize=function(){if(!this._vrDisplay||!this._vrDisplay.isPresenting){var e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)}},d.prototype.setSize=function(e,t){if(this._renderingCanvas&&(this._renderingCanvas.width!==e||this._renderingCanvas.height!==t)){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var r=0;r<this.scenes.length;r++)for(var i=this.scenes[r],n=0;n<i.cameras.length;n++){i.cameras[n]._currentRenderId=0}this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},d.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},d.prototype.getVRDevice=function(){return this._vrDisplay},d.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},d.prototype.initWebVRAsync=function(){var e=this,t=function(){var t={vrDisplay:e._vrDisplay,vrSupported:e._vrSupported};e.onVRDisplayChangedObservable.notifyObservers(t),e._webVRInitPromise=new Promise(function(e){e(t)})};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(r){e._vrDisplay=r.display,t()},this._onVrDisplayDisconnect=function(){e._vrDisplay.cancelAnimationFrame(e._frameHandler),e._vrDisplay=void 0,e._frameHandler=s.Tools.QueueNewFrame(e._bindedRenderFunction),t()},this._onVrDisplayPresentChange=function(){e._vrExclusivePointerMode=e._vrDisplay&&e._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},d.prototype.enableVR=function(){var e=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then(function(){e.onVRRequestPresentComplete.notifyObservers(!0),e._onVRFullScreenTriggered()}).catch(function(){e.onVRRequestPresentComplete.notifyObservers(!1)})}},d.prototype.disableVR=function(){this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(this._onVRFullScreenTriggered).catch(this._onVRFullScreenTriggered)},d.prototype._getVRDisplaysAsync=function(){var e=this;return new Promise(function(t){navigator.getVRDisplays?navigator.getVRDisplays().then(function(r){e._vrSupported=!0,e._vrDisplay=r[0],t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported})}):(e._vrDisplay=void 0,e._vrSupported=!1,t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported}))})},d.prototype.bindFramebuffer=function(e,t,r,i,n,s,a){void 0===a&&(a=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this.bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var _=this._gl;e.isCube&&(void 0===t&&(t=0),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,a),s&&(s._generateStencilBuffer?_.framebufferTexture2D(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.TEXTURE_CUBE_MAP_POSITIVE_X+t,s._webGLTexture,a):_.framebufferTexture2D(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.TEXTURE_CUBE_MAP_POSITIVE_X+t,s._webGLTexture,a))),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,a&&(r/=Math.pow(2,a))),i||(i=e.height,a&&(i/=Math.pow(2,a))),this._viewport(0,0,r,i)),this.wipeCaches()},d.prototype.bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},d.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;e._MSAAFramebuffer&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,e,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null)),r&&(e._MSAAFramebuffer&&this.bindUnboundFramebuffer(e._framebuffer),r()),this.bindUnboundFramebuffer(null)},d.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;if(e[0]._MSAAFramebuffer){i.bindFramebuffer(i.READ_FRAMEBUFFER,e[0]._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e[0]._framebuffer);var n=e[0]._attachments;n||(n=new Array(e.length),e[0]._attachments=n);for(var s=0;s<e.length;s++){for(var a=e[s],_=0;_<n.length;_++)n[_]=i.NONE;n[s]=i[this.webGLVersion>1?"COLOR_ATTACHMENT"+s:"COLOR_ATTACHMENT"+s+"_WEBGL"],i.readBuffer(n[s]),i.drawBuffers(n),i.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,i.COLOR_BUFFER_BIT,i.NEAREST)}for(s=0;s<n.length;s++)n[s]=i[this.webGLVersion>1?"COLOR_ATTACHMENT"+s:"COLOR_ATTACHMENT"+s+"_WEBGL"];i.drawBuffers(n)}for(s=0;s<e.length;s++){!(a=e[s]).generateMipMaps||t||a.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,a),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null))}r&&(e[0]._MSAAFramebuffer&&this.bindUnboundFramebuffer(e[0]._framebuffer),r()),this.bindUnboundFramebuffer(null)},d.prototype.generateMipMapsForCubemap=function(e){if(e.generateMipMaps){var t=this._gl;this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,e,!0),t.generateMipmap(t.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}},d.prototype.flushFramebuffer=function(){this._gl.flush()},d.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this.bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},d.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");return this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},d.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");return this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},d.prototype.updateUniformBuffer=function(e,t,r,i){this.bindUniformBuffer(e),void 0===r&&(r=0),void 0===i?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(r,r+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(r,r+i)),this.bindUniformBuffer(null)},d.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},d.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create vertex buffer");return this.bindArrayBuffer(t),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},d.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic vertex buffer");return this.bindArrayBuffer(t),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},d.prototype.updateDynamicIndexBuffer=function(e,t,r){var i;void 0===r&&(r=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),i=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},d.prototype.updateDynamicVertexBuffer=function(e,t,r,i){this.bindArrayBuffer(e),void 0===r&&(r=0),void 0===i?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(r,r+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,r,i):new Uint8Array(t.buffer,t.byteOffset+r,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},d.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},d.prototype.createIndexBuffer=function(e,t){var r,i=this._gl.createBuffer();if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=!1;if(e instanceof Uint16Array)r=e;else if(this._caps.uintIndices)if(e instanceof Uint32Array)r=e,n=!0;else{for(var s=0;s<e.length;s++)if(e[s]>65535){n=!0;break}r=n?new Uint32Array(e):new Uint16Array(e)}else r=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=n,i},d.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},d.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e)},d.prototype.bindUniformBufferBase=function(e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e)},d.prototype.bindUniformBlock=function(e,t,r){var i=this._gl.getUniformBlockIndex(e,t);this._gl.uniformBlockBinding(e,i,r)},d.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},d.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e),this._currentBoundBuffer[t]=e)},d.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},d.prototype._vertexAttribPointer=function(e,t,r,i,n,s,a){var _=this._currentBufferPointers[t],o=!1;_.active?(_.buffer!==e&&(_.buffer=e,o=!0),_.size!==r&&(_.size=r,o=!0),_.type!==i&&(_.type=i,o=!0),_.normalized!==n&&(_.normalized=n,o=!0),_.stride!==s&&(_.stride=s,o=!0),_.offset!==a&&(_.offset=a,o=!0)):(o=!0,_.active=!0,_.index=t,_.size=r,_.type=i,_.normalized=n,_.stride=s,_.offset=a,_.buffer=e),(o||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,i,n,s,a))},d.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},d.prototype._bindVertexBuffersAttributes=function(e,t){var r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var i=0;i<r.length;i++){var n=t.getAttributeLocation(i);if(n>=0){var s=e[r[i]];if(!s)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var a=s.getBuffer();a&&(this._vertexAttribPointer(a,n,s.getSize(),s.type,s.normalized,s.byteStride,s.byteOffset),s.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,s.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(a))))}}},d.prototype.recordVertexArrayObject=function(e,t,r){var i=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(i),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),i},d.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},d.prototype.bindBuffersDirectly=function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var s=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var a=0,_=0;_<s;_++)if(_<r.length){var o=n.getAttributeLocation(_);o>=0&&(this._gl.enableVertexAttribArray(o),this._vertexAttribArraysEnabled[o]=!0,this._vertexAttribPointer(e,o,r[_],this._gl.FLOAT,!1,i,a)),a+=4*r[_]}}this._bindIndexBufferWithCache(t)},d.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},d.prototype.bindBuffers=function(e,t,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r)),this._bindIndexBufferWithCache(t)},d.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},d.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},d.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._gl.deleteBuffer(e),!0)},d.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");return t.capacity=e,this.bindArrayBuffer(t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},d.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},d.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index){for(var i=0,n=0;n<r.length;n++){i+=4*(s=r[n]).attributeSize}for(n=0;n<r.length;n++){var s=r[n];this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attribyteType||this._gl.FLOAT,s.normalized||!1,i,s.offset),this._gl.vertexAttribDivisor(s.index,1),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e)}}else for(var a=0;a<4;a++){var _=r[a];this._vertexAttribArraysEnabled[_]||(this._gl.enableVertexAttribArray(_),this._vertexAttribArraysEnabled[_]=!0),this._vertexAttribPointer(e,_,4,this._gl.FLOAT,!1,64,16*a),this._gl.vertexAttribDivisor(_,1),this._currentInstanceLocations.push(_),this._currentInstanceBuffers.push(e)}},d.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},d.prototype.draw=function(e,t,r,i){this.drawElementsType(e?E.Material.TriangleFillMode:E.Material.WireFrameFillMode,t,r,i)},d.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(E.Material.PointFillMode,e,t,r)},d.prototype.drawUnIndexed=function(e,t,r,i){this.drawArraysType(e?E.Material.TriangleFillMode:E.Material.WireFrameFillMode,t,r,i)},d.prototype.drawElementsType=function(e,t,r,i){this.applyStates(),this._drawCalls.addCount(1,!1);var n=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,s,t*a,i):this._gl.drawElements(n,r,s,t*a)},d.prototype.drawArraysType=function(e,t,r,i){this.applyStates(),this._drawCalls.addCount(1,!1);var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)},d.prototype._drawMode=function(e){switch(e){case E.Material.TriangleFillMode:return this._gl.TRIANGLES;case E.Material.PointFillMode:return this._gl.POINTS;case E.Material.WireFrameFillMode:return this._gl.LINES;case E.Material.PointListDrawMode:return this._gl.POINTS;case E.Material.LineListDrawMode:return this._gl.LINES;case E.Material.LineLoopDrawMode:return this._gl.LINE_LOOP;case E.Material.LineStripDrawMode:return this._gl.LINE_STRIP;case E.Material.TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case E.Material.TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},d.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deleteProgram(e.getProgram()))},d.prototype._deleteProgram=function(e){e&&(e.__SPECTOR_rebuildProgram=null,e.transformFeedback&&(this.deleteTransformFeedback(e.transformFeedback),e.transformFeedback=null),this._gl.deleteProgram(e))},d.prototype.createEffect=function(e,t,r,i,n,s,a,_,E){var l=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(n||t.defines);if(this._compiledEffects[l]){var u=this._compiledEffects[l];return a&&u.isReady()&&a(u),u}var h=new o.Effect(e,t,r,i,this,n,s,a,_,E);return h._key=l,this._compiledEffects[l]=h,h},d.prototype._compileShader=function(e,t,r,i){return this._compileRawShader(i+(r?r+"\n":"")+e,t)},d.prototype._compileRawShader=function(e,t){var r=this._gl,i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i)throw new Error("Something went wrong while compile the shader.");if(r.shaderSource(i,e),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS)){var n=r.getShaderInfoLog(i);if(n)throw new Error(n)}return i},d.prototype.createRawShaderProgram=function(e,t,r,i){void 0===i&&(i=null),r=r||this._gl;var n=this._compileRawShader(e,"vertex"),s=this._compileRawShader(t,"fragment");return this._createShaderProgram(n,s,r,i)},d.prototype.createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null),i=i||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var s=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(e,"vertex",r,s),_=this._compileShader(t,"fragment",r,s),o=this._createShaderProgram(a,_,i,n);return this.onAfterShaderCompilationObservable.notifyObservers(this),o},d.prototype._createShaderProgram=function(e,t,r,i){void 0===i&&(i=null);var n=r.createProgram();if(!n)throw new Error("Unable to create program");if(r.attachShader(n,e),r.attachShader(n,t),this.webGLVersion>1&&i){var s=this.createTransformFeedback();this.bindTransformFeedback(s),this.setTranformFeedbackVaryings(n,i),n.transformFeedback=s}return r.linkProgram(n),this.webGLVersion>1&&i&&this.bindTransformFeedback(null),n.context=r,n.vertexShader=e,n.fragmentShader=t,this._caps.parallelShaderCompile?n.isParallelCompiled=!0:this._finalizeProgram(n),n},d.prototype._finalizeProgram=function(e){var t,r=e.context,i=e.vertexShader,n=e.fragmentShader;if(!r.getProgramParameter(e,r.LINK_STATUS)&&(t=r.getProgramInfoLog(e)))throw new Error(t);if(this.validateShaderPrograms&&(r.validateProgram(e),!r.getProgramParameter(e,r.VALIDATE_STATUS)&&(t=r.getProgramInfoLog(e))))throw new Error(t);r.deleteShader(i),r.deleteShader(n),e.context=void 0,e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},d.prototype._isProgramCompiled=function(e){return!e.isParallelCompiled||!!this._gl.getProgramParameter(e,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizeProgram(e),!0)},d.prototype._executeWhenProgramIsCompiled=function(e,t){e.isParallelCompiled?e.onCompiled=t:t()},d.prototype.getUniforms=function(e,t){for(var r=new Array,i=0;i<t.length;i++)r.push(this._gl.getUniformLocation(e,t[i]));return r},d.prototype.getAttributes=function(e,t){for(var r=[],i=0;i<t.length;i++)try{r.push(this._gl.getAttribLocation(e,t[i]))}catch(n){r.push(-1)}return r},d.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},d.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},d.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},d.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},d.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},d.prototype.setFloatArray=function(e,t){e&&this._gl.uniform1fv(e,t)},d.prototype.setFloatArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},d.prototype.setFloatArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},d.prototype.setFloatArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},d.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},d.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},d.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},d.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},d.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},d.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},d.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},d.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},d.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},d.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},d.prototype.setFloat2=function(e,t,r){e&&this._gl.uniform2f(e,t,r)},d.prototype.setFloat3=function(e,t,r,i){e&&this._gl.uniform3f(e,t,r,i)},d.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},d.prototype.setFloat4=function(e,t,r,i,n){e&&this._gl.uniform4f(e,t,r,i,n)},d.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},d.prototype.setColor4=function(e,t,r){e&&this._gl.uniform4f(e,t.r,t.g,t.b,r)},d.prototype.setDirectColor4=function(e,t){e&&this._gl.uniform4f(e,t.r,t.g,t.b,t.a)},d.prototype.setState=function(e,t,r,i){void 0===t&&(t=0),void 0===i&&(i=!1),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var n=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==n||r)&&(this._depthCullingState.cullFace=n),this.setZOffset(t);var s=i?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==s||r)&&(this._depthCullingState.frontFace=s)},d.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},d.prototype.getZOffset=function(){return this._depthCullingState.zOffset},d.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},d.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},d.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},d.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e),this._colorWrite=e},d.prototype.getColorWrite=function(){return this._colorWrite},d.prototype.setAlphaConstants=function(e,t,r,i){this._alphaState.setAlphaBlendConstants(e,t,r,i)},d.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case d.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case d.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case d.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case d.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case d.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case d.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case d.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case d.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case d.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case d.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case d.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||this.setDepthWrite(e===d.ALPHA_DISABLE),this._alphaMode=e}},d.prototype.getAlphaMode=function(){return this._alphaMode},d.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},d.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,e&&(this.resetTextureCache(),this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._unpackFlipYCached=null),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null))},d.prototype.setTextureFormatToUse=function(e){for(var t=0,r=this.texturesSupported.length;t<r;t++)for(var i=0,n=e.length;i<n;i++)if(this._texturesSupported[t]===e[i].toLowerCase())return this._textureFormatInUse=this._texturesSupported[t];return this._textureFormatInUse=null,null},d.prototype._getSamplingParameters=function(e,t){var r=this._gl,i=r.NEAREST,n=r.NEAREST;switch(e){case d.TEXTURE_BILINEAR_SAMPLINGMODE:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case d.TEXTURE_TRILINEAR_SAMPLINGMODE:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case d.TEXTURE_NEAREST_SAMPLINGMODE:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case d.TEXTURE_NEAREST_NEAREST_MIPNEAREST:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case d.TEXTURE_NEAREST_LINEAR_MIPNEAREST:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case d.TEXTURE_NEAREST_LINEAR_MIPLINEAR:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case d.TEXTURE_NEAREST_LINEAR:i=r.NEAREST,n=r.LINEAR;break;case d.TEXTURE_NEAREST_NEAREST:i=r.NEAREST,n=r.NEAREST;break;case d.TEXTURE_LINEAR_NEAREST_MIPNEAREST:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case d.TEXTURE_LINEAR_NEAREST_MIPLINEAR:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case d.TEXTURE_LINEAR_LINEAR:i=r.LINEAR,n=r.LINEAR;break;case d.TEXTURE_LINEAR_NEAREST:i=r.LINEAR,n=r.NEAREST}return{min:n,mag:i}},d.prototype._partialLoadImg=function(e,t,r,i,n,a){var _;void 0===a&&(a=null);_=s.Tools.LoadImage(e,function(){r[t]=_,r._internalCount++,i&&i._removePendingData(_),6===r._internalCount&&n(r)},function(e,t){i&&i._removePendingData(_),a&&a(e,t)},i?i.offlineProvider:null),i&&i._addPendingData(_)},d.prototype._cascadeLoadImgs=function(e,t,r,i){void 0===i&&(i=null);var n=[];n._internalCount=0;for(var s=0;s<6;s++)this._partialLoadImg(r[s],s,n,e,t,i)},d.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},d.prototype.createTexture=function(e,t,r,i,n,a,_,o,E,l,h,T){var c=this;void 0===n&&(n=d.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===_&&(_=null),void 0===o&&(o=null),void 0===E&&(E=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===T&&(T=[]);for(var f=String(e),R="data:"===f.substr(0,5),p="blob:"===f.substr(0,5),g=R&&-1!==f.indexOf(";base64,"),A=E||new u.InternalTexture(this,u.InternalTexture.DATASOURCE_URL),b=f.lastIndexOf("."),U=h||(b>-1?f.substring(b).toLowerCase():""),m=null,x=0,I=d._TextureLoaders;x<I.length;x++){var S=I[x];if(-1===T.indexOf(S)&&S.canLoad(U,this._textureFormatInUse,E,g,!!o)){m=S;break}}m&&(f=m.transformUrl(f,this._textureFormatInUse)),i&&i._addPendingData(A),A.url=f,A.generateMipMaps=!t,A.samplingMode=n,A.invertY=r,this._doNotHandleContextLost||(A._buffer=o);var D=null;a&&!E&&(D=A.onLoadedObservable.add(a)),E||this._internalTexturesCache.push(A);var v=function(r,a){i&&i._removePendingData(A);var E=!1;m&&(m.getFallbackTextureUrl(f,c._textureFormatInUse)&&(E=!0,T.push(m),s.Tools.Warn(m.constructor.name+" failed when trying to load "+A.url+", falling back to the next supported loader"),c.createTexture(e,t,A.invertY,i,n,null,null,o,A,void 0,void 0,T)));E||(D&&A.onLoadedObservable.remove(D),s.Tools.UseFallbackTexture&&c.createTexture(s.Tools.fallbackTexture,t,A.invertY,i,n,null,null,o,A)),_&&_(r||"Unknown error",a)};if(m){var F=function(e){m.loadData(e,A,function(e,t,r,s,a,_){_?v("TextureLoader failed to load data"):c._prepareWebGLTexture(A,i,e,t,A.invertY,!r,s,function(){return a(),!1},n)})};o?F(o):this._loadFile(f,F,void 0,i?i.offlineProvider:void 0,!0,function(e,t){v("Unable to load "+(e&&e.responseURL,t))})}else{var N=function(e){p&&!c._doNotHandleContextLost&&(A._buffer=e),c._prepareWebGLTexture(A,i,e.width,e.height,A.invertY,t,!1,function(t,r,n){var s=c._gl,a=e.width===t&&e.height===r,_=l?c._getInternalFormat(l):".jpg"===U?s.RGB:s.RGBA;if(a)return s.texImage2D(s.TEXTURE_2D,0,_,_,s.UNSIGNED_BYTE,e),!1;var o=c._caps.maxTextureSize;if(e.width>o||e.height>o||null===d._RescalePostProcessFactory)return c._prepareWorkingCanvas(),!(!c._workingCanvas||!c._workingContext)&&(c._workingCanvas.width=t,c._workingCanvas.height=r,c._workingContext.drawImage(e,0,0,e.width,e.height,0,0,t,r),s.texImage2D(s.TEXTURE_2D,0,_,_,s.UNSIGNED_BYTE,c._workingCanvas),A.width=t,A.height=r,!1);var E=new u.InternalTexture(c,u.InternalTexture.DATASOURCE_TEMP);return c._bindTextureDirectly(s.TEXTURE_2D,E,!0),s.texImage2D(s.TEXTURE_2D,0,_,_,s.UNSIGNED_BYTE,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),c._rescaleTexture(E,A,i,_,function(){c._releaseTexture(E),c._bindTextureDirectly(s.TEXTURE_2D,A,!0),n()}),!0},n)};!R||g?o instanceof HTMLImageElement?N(o):s.Tools.LoadImage(f,N,v,i?i.offlineProvider:null):"string"==typeof o||o instanceof ArrayBuffer||o instanceof Blob?s.Tools.LoadImage(o,N,v,i?i.offlineProvider:null):N(o)}return A},d.prototype._rescaleTexture=function(e,t,r,i,n){var s=this,a=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:d.TEXTURETYPE_UNSIGNED_INT,samplingMode:d.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&d._RescalePostProcessFactory&&(this._rescalePostProcess=d._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){s._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var _=r;_||(_=s.scenes[s.scenes.length-1]),_.postProcessManager.directRender([s._rescalePostProcess],a,!0),s._bindTextureDirectly(s._gl.TEXTURE_2D,t,!0),s._gl.copyTexImage2D(s._gl.TEXTURE_2D,0,i,0,0,t.width,t.height,0),s.unBindFramebuffer(a),s._releaseTexture(a),n&&n()})},d.prototype.updateRawTexture=function(e,t,r,i,n,s){if(void 0===n&&(n=null),void 0===s&&(s=d.TEXTURETYPE_UNSIGNED_INT),e){var a=this._getRGBABufferInternalSizedFormat(s,r),_=this._getInternalFormat(r),o=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===i||!!i),this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.type=s,e.invertY=i,e._compression=n),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[n],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,e.width,e.height,0,_,o,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},d.prototype.createRawTexture=function(e,t,r,i,n,s,a,_,o){void 0===_&&(_=null),void 0===o&&(o=d.TEXTURETYPE_UNSIGNED_INT);var E=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_RAW);E.baseWidth=t,E.baseHeight=r,E.width=t,E.height=r,E.format=i,E.generateMipMaps=n,E.samplingMode=a,E.invertY=s,E._compression=_,E.type=o,this._doNotHandleContextLost||(E._bufferView=e),this.updateRawTexture(E,e,i,s,_,o),this._bindTextureDirectly(this._gl.TEXTURE_2D,E,!0);var l=this._getSamplingParameters(a,n);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,l.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,l.min),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(E),E},d.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},d.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},d.prototype.createDynamicTexture=function(e,t,r,i){var n=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_DYNAMIC);return n.baseWidth=e,n.baseHeight=t,r&&(e=this.needPOTTextures?s.Tools.GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?s.Tools.GetExponentOfTwo(t,this._caps.maxTextureSize):t),n.width=e,n.height=t,n.isReady=!1,n.generateMipMaps=r,n.samplingMode=i,this.updateTextureSamplingMode(i,n),this._internalTexturesCache.push(n),n},d.prototype.updateTextureSamplingMode=function(e,t){var r=this._getSamplingParameters(e,t.generateMipMaps);t.isCube?(this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):t.is3D?(this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,r.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,r.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t.samplingMode=e},d.prototype.updateDynamicTexture=function(e,t,r,i,n,s){if(void 0===i&&(i=!1),void 0===s&&(s=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,s),this._unpackFlipY(r),i&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var a=n?this._getInternalFormat(n):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,a,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),i&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}},d.prototype.updateVideoTexture=function(e,t,r){if(e&&!e._isDisabled){var i=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!r);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=document.createElement("canvas");var n=e._workingCanvas.getContext("2d");if(!n)throw new Error("Unable to get 2d context");e._workingContext=n,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),i||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(s){e._isDisabled=!0}}},d.prototype.updateTextureComparisonFunction=function(e,t){if(1!==this.webGLVersion){var r=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,d.LEQUAL),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,d.LEQUAL),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else f.Logger.Error("WebGL 1 does not support texture comparison.")},d.prototype._setupDepthStencilTexture=function(e,t,r,i,n){var s=t.width||t,a=t.height||t;e.baseWidth=s,e.baseHeight=a,e.width=s,e.height=a,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=r,e.samplingMode=i?d.TEXTURE_BILINEAR_SAMPLINGMODE:d.TEXTURE_NEAREST_SAMPLINGMODE,e.type=d.TEXTURETYPE_UNSIGNED_INT,e._comparisonFunction=n;var _=this._gl,o=e.isCube?_.TEXTURE_CUBE_MAP:_.TEXTURE_2D,E=this._getSamplingParameters(e.samplingMode,!1);_.texParameteri(o,_.TEXTURE_MAG_FILTER,E.mag),_.texParameteri(o,_.TEXTURE_MIN_FILTER,E.min),_.texParameteri(o,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(o,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),0===n?(_.texParameteri(o,_.TEXTURE_COMPARE_FUNC,d.LEQUAL),_.texParameteri(o,_.TEXTURE_COMPARE_MODE,_.NONE)):(_.texParameteri(o,_.TEXTURE_COMPARE_FUNC,n),_.texParameteri(o,_.TEXTURE_COMPARE_MODE,_.COMPARE_REF_TO_TEXTURE))},d.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var r=e.width||e;return this._createDepthStencilCubeTexture(r,t)}return this._createDepthStencilTexture(e,t)},d.prototype._createDepthStencilTexture=function(t,r){var i=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_DEPTHTEXTURE);if(!this._caps.depthTextureExtension)return f.Logger.Error("Depth texture is not supported by your browser or hardware."),i;var n=e.__assign({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},r),s=this._gl;return this._bindTextureDirectly(s.TEXTURE_2D,i,!0),this._setupDepthStencilTexture(i,t,n.generateStencil,n.bilinearFiltering,n.comparisonFunction),this.webGLVersion>1?n.generateStencil?s.texImage2D(s.TEXTURE_2D,0,s.DEPTH24_STENCIL8,i.width,i.height,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_COMPONENT24,i.width,i.height,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null):n.generateStencil?s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_STENCIL,i.width,i.height,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_COMPONENT,i.width,i.height,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null),this._bindTextureDirectly(s.TEXTURE_2D,null),i},d.prototype._createDepthStencilCubeTexture=function(t,r){var i=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_UNKNOWN);if(i.isCube=!0,1===this.webGLVersion)return f.Logger.Error("Depth cube texture is not supported by WebGL 1."),i;var n=e.__assign({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},r),s=this._gl;this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,i,!0),this._setupDepthStencilTexture(i,t,n.generateStencil,n.bilinearFiltering,n.comparisonFunction);for(var a=0;a<6;a++)n.generateStencil?s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,s.DEPTH24_STENCIL8,t,t,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,s.DEPTH_COMPONENT24,t,t,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null);return this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),i},d.prototype.setFrameBufferDepthStencilTexture=function(e){var t=e.getInternalTexture();if(t&&t._framebuffer&&e.depthStencilTexture){var r=this._gl,i=e.depthStencilTexture;this.bindUnboundFramebuffer(t._framebuffer),i.isCube?i._generateStencilBuffer?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_CUBE_MAP_POSITIVE_X,i._webGLTexture,0):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_CUBE_MAP_POSITIVE_X,i._webGLTexture,0):i._generateStencilBuffer?r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,i._webGLTexture,0):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,i._webGLTexture,0),this.bindUnboundFramebuffer(null)}},d.prototype.createRenderTargetTexture=function(e,t){var r=new p.RenderTargetCreationOptions;void 0!==t&&"object"==typeof t?(r.generateMipMaps=t.generateMipMaps,r.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&t.generateStencilBuffer,r.type=void 0===t.type?d.TEXTURETYPE_UNSIGNED_INT:t.type,r.samplingMode=void 0===t.samplingMode?d.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode,r.format=void 0===t.format?d.TEXTUREFORMAT_RGBA:t.format):(r.generateMipMaps=t,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=d.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=d.TEXTURE_TRILINEAR_SAMPLINGMODE,r.format=d.TEXTUREFORMAT_RGBA),(r.type!==d.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(r.type!==d.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=d.TEXTURE_NEAREST_SAMPLINGMODE);var i=this._gl,n=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(i.TEXTURE_2D,n,!0);var s=e.width||e,a=e.height||e,_=this._getSamplingParameters(r.samplingMode,!!r.generateMipMaps);r.type!==d.TEXTURETYPE_FLOAT||this._caps.textureFloat||(r.type=d.TEXTURETYPE_UNSIGNED_INT,f.Logger.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,_.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,_.min),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(r.type,r.format),s,a,0,this._getInternalFormat(r.format),this._getWebGLTextureType(r.type),null);var o=this._currentFramebuffer,E=i.createFramebuffer();return this.bindUnboundFramebuffer(E),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n._webGLTexture,0),n._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!r.generateStencilBuffer,r.generateDepthBuffer,s,a),r.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),this.bindUnboundFramebuffer(o),n._framebuffer=E,n.baseWidth=s,n.baseHeight=a,n.width=s,n.height=a,n.isReady=!0,n.samples=1,n.generateMipMaps=!!r.generateMipMaps,n.samplingMode=r.samplingMode,n.type=r.type,n.format=r.format,n._generateDepthBuffer=r.generateDepthBuffer,n._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(n),n},d.prototype.createMultipleRenderTarget=function(e,t){var r=!1,i=!0,n=!1,s=!1,a=1,_=d.TEXTURETYPE_UNSIGNED_INT,o=d.TEXTURE_TRILINEAR_SAMPLINGMODE,E=new Array,l=new Array;void 0!==t&&(r=void 0!==t.generateMipMaps&&t.generateMipMaps,i=void 0===t.generateDepthBuffer||t.generateDepthBuffer,n=void 0!==t.generateStencilBuffer&&t.generateStencilBuffer,s=void 0!==t.generateDepthTexture&&t.generateDepthTexture,a=t.textureCount||1,t.types&&(E=t.types),t.samplingModes&&(l=t.samplingModes));var h=this._gl,T=h.createFramebuffer();this.bindUnboundFramebuffer(T);for(var c=e.width||e,R=e.height||e,p=[],g=[],A=this._setupFramebufferDepthAttachments(n,i,c,R),b=0;b<a;b++){var U=l[b]||o,m=E[b]||_;(m!==d.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(m!==d.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(U=d.TEXTURE_NEAREST_SAMPLINGMODE);var x=this._getSamplingParameters(U,r);m!==d.TEXTURETYPE_FLOAT||this._caps.textureFloat||(m=d.TEXTURETYPE_UNSIGNED_INT,f.Logger.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var I=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_MULTIRENDERTARGET),S=h[this.webGLVersion>1?"COLOR_ATTACHMENT"+b:"COLOR_ATTACHMENT"+b+"_WEBGL"];p.push(I),g.push(S),h.activeTexture(h["TEXTURE"+b]),h.bindTexture(h.TEXTURE_2D,I._webGLTexture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,x.mag),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,x.min),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(m),c,R,0,h.RGBA,this._getWebGLTextureType(m),null),h.framebufferTexture2D(h.DRAW_FRAMEBUFFER,S,h.TEXTURE_2D,I._webGLTexture,0),r&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null),I._framebuffer=T,I._depthStencilBuffer=A,I.baseWidth=c,I.baseHeight=R,I.width=c,I.height=R,I.isReady=!0,I.samples=1,I.generateMipMaps=r,I.samplingMode=U,I.type=m,I._generateDepthBuffer=i,I._generateStencilBuffer=n,I._attachments=g,this._internalTexturesCache.push(I)}if(s&&this._caps.depthTextureExtension){var D=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_MULTIRENDERTARGET);h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,D._webGLTexture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,this.webGLVersion<2?h.DEPTH_COMPONENT:h.DEPTH_COMPONENT16,c,R,0,h.DEPTH_COMPONENT,h.UNSIGNED_SHORT,null),h.framebufferTexture2D(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.TEXTURE_2D,D._webGLTexture,0),D._framebuffer=T,D.baseWidth=c,D.baseHeight=R,D.width=c,D.height=R,D.isReady=!0,D.samples=1,D.generateMipMaps=r,D.samplingMode=h.NEAREST,D._generateDepthBuffer=i,D._generateStencilBuffer=n,p.push(D),this._internalTexturesCache.push(D)}return h.drawBuffers(g),h.bindRenderbuffer(h.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),this.resetTextureCache(),p},d.prototype._setupFramebufferDepthAttachments=function(e,t,r,i,n){void 0===n&&(n=1);var s=null,a=this._gl;return e?(s=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,s),n>1?a.renderbufferStorageMultisample(a.RENDERBUFFER,n,a.DEPTH24_STENCIL8,r,i):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,r,i),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,s)):t&&(s=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,s),n>1?a.renderbufferStorageMultisample(a.RENDERBUFFER,n,a.DEPTH_COMPONENT16,r,i):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,r,i),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,s)),s},d.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var r=this._gl;if(t=Math.min(t,r.getParameter(r.MAX_SAMPLES)),e._depthStencilBuffer&&(r.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(r.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(r.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),t>1){var i=r.createFramebuffer();if(!i)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=i,this.bindUnboundFramebuffer(e._MSAAFramebuffer);var n=r.createRenderbuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorageMultisample(r.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n),e._MSAARenderBuffer=n}else this.bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),r.bindRenderbuffer(r.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),t},d.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e||0==e.length)return 1;if(e[0].samples===t)return t;var r=this._gl;t=Math.min(t,r.getParameter(r.MAX_SAMPLES)),e[0]._depthStencilBuffer&&(r.deleteRenderbuffer(e[0]._depthStencilBuffer),e[0]._depthStencilBuffer=null),e[0]._MSAAFramebuffer&&(r.deleteFramebuffer(e[0]._MSAAFramebuffer),e[0]._MSAAFramebuffer=null);for(var i=0;i<e.length;i++)e[i]._MSAARenderBuffer&&(r.deleteRenderbuffer(e[i]._MSAARenderBuffer),e[i]._MSAARenderBuffer=null);if(t>1){var n=r.createFramebuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");this.bindUnboundFramebuffer(n);var s=this._setupFramebufferDepthAttachments(e[0]._generateStencilBuffer,e[0]._generateDepthBuffer,e[0].width,e[0].height,t),a=[];for(i=0;i<e.length;i++){var _=e[i],o=r[this.webGLVersion>1?"COLOR_ATTACHMENT"+i:"COLOR_ATTACHMENT"+i+"_WEBGL"],E=r.createRenderbuffer();if(!E)throw new Error("Unable to create multi sampled framebuffer");r.bindRenderbuffer(r.RENDERBUFFER,E),r.renderbufferStorageMultisample(r.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(_.type),_.width,_.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,o,r.RENDERBUFFER,E),_._MSAAFramebuffer=n,_._MSAARenderBuffer=E,_.samples=t,_._depthStencilBuffer=s,r.bindRenderbuffer(r.RENDERBUFFER,null),a.push(o)}r.drawBuffers(a)}else this.bindUnboundFramebuffer(e[0]._framebuffer);return this.bindUnboundFramebuffer(null),t},d.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,s,a){void 0===s&&(s=0),void 0===a&&(a=0);var _=this._gl,o=_.TEXTURE_2D;e.isCube&&(o=_.TEXTURE_CUBE_MAP_POSITIVE_X+s),this._gl.compressedTexImage2D(o,a,t,r,i,0,n)},d.prototype._uploadDataToTextureDirectly=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),o=this._getRGBABufferInternalSizedFormat(e.type,a);this._unpackFlipY(e.invertY);var E=n.TEXTURE_2D;e.isCube&&(E=n.TEXTURE_CUBE_MAP_POSITIVE_X+r);var l=Math.round(_.Scalar.Log2(e.width)),u=Math.round(_.Scalar.Log2(e.height)),h=Math.pow(2,Math.max(l-i,0)),T=Math.pow(2,Math.max(u-i,0));n.texImage2D(E,i,o,h,T,0,a,s,t)},d.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(s,null,!0)},d.prototype._uploadImageToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),_=this._getRGBABufferInternalSizedFormat(e.type,a),o=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._unpackFlipY(e.invertY);var E=n.TEXTURE_2D;e.isCube&&(E=n.TEXTURE_CUBE_MAP_POSITIVE_X+r),n.texImage2D(E,i,_,a,s,t),this._bindTextureDirectly(o,null,!0)},d.prototype.createRenderTargetCubeTexture=function(t,r){var i=e.__assign({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:d.TEXTURETYPE_UNSIGNED_INT,samplingMode:d.TEXTURE_TRILINEAR_SAMPLINGMODE,format:d.TEXTUREFORMAT_RGBA},r);i.generateStencilBuffer=i.generateDepthBuffer&&i.generateStencilBuffer,(i.type!==d.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(i.type!==d.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(i.samplingMode=d.TEXTURE_NEAREST_SAMPLINGMODE);var n=this._gl,s=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,s,!0);var a=this._getSamplingParameters(i.samplingMode,i.generateMipMaps);i.type!==d.TEXTURETYPE_FLOAT||this._caps.textureFloat||(i.type=d.TEXTURETYPE_UNSIGNED_INT,f.Logger.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,a.mag),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,a.min),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);for(var _=0;_<6;_++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+_,0,this._getRGBABufferInternalSizedFormat(i.type,i.format),t,t,0,this._getInternalFormat(i.format),this._getWebGLTextureType(i.type),null);var o=n.createFramebuffer();return this.bindUnboundFramebuffer(o),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(i.generateStencilBuffer,i.generateDepthBuffer,t,t),i.generateMipMaps&&n.generateMipmap(n.TEXTURE_CUBE_MAP),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),n.bindRenderbuffer(n.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),s._framebuffer=o,s.width=t,s.height=t,s.isReady=!0,s.isCube=!0,s.samples=1,s.generateMipMaps=i.generateMipMaps,s.samplingMode=i.samplingMode,s.type=i.type,s.format=i.format,s._generateDepthBuffer=i.generateDepthBuffer,s._generateStencilBuffer=i.generateStencilBuffer,this._internalTexturesCache.push(s),s},d.prototype.createCubeTexture=function(e,t,r,i,n,a,_,o,E,l,h,T,c){var R=this;void 0===n&&(n=null),void 0===a&&(a=null),void 0===o&&(o=null),void 0===E&&(E=!1),void 0===l&&(l=0),void 0===h&&(h=0),void 0===T&&(T=null),void 0===c&&(c=[]);var p=this._gl,g=T||new u.InternalTexture(this,u.InternalTexture.DATASOURCE_CUBE);g.isCube=!0,g.url=e,g.generateMipMaps=!i,g._lodGenerationScale=l,g._lodGenerationOffset=h,this._doNotHandleContextLost||(g._extension=o,g._files=r);for(var A=e.lastIndexOf("."),b=o||(A>-1?e.substring(A).toLowerCase():""),U=null,m=0,x=d._TextureLoaders;m<x.length;m++){var I=x[m];if(-1===c.indexOf(I)&&I.canLoad(b,this._textureFormatInUse,T,!1,!1)){U=I;break}}if(U){e=U.transformUrl(e,this._textureFormatInUse);var S=function(e){R._bindTextureDirectly(p.TEXTURE_CUBE_MAP,g,!0),U.loadCubeData(e,g,E,n,a)};r&&6===r.length?U.supportCascades?this._cascadeLoadFiles(t,S,r,a):a&&a("Textures type does not support cascades."):this._loadFile(e,S,void 0,void 0,!0,function(e,s){if(U){var o=U.getFallbackTextureUrl(g.url,R._textureFormatInUse);if(f.Logger.Warn(U.constructor.name+" failed when trying to load "+g.url+", falling back to the next supported loader"),o)return c.push(U),void R.createCubeTexture(o,t,r,i,n,a,_,b,E,l,h,g,c)}a&&e&&a(e.status+" "+e.statusText,s)})}else{if(!r)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(t,function(e){var t=R.needPOTTextures?s.Tools.GetExponentOfTwo(e[0].width,R._caps.maxCubemapTextureSize):e[0].width,r=t;if(R._prepareWorkingCanvas(),R._workingCanvas&&R._workingContext){R._workingCanvas.width=t,R._workingCanvas.height=r;var a=[p.TEXTURE_CUBE_MAP_POSITIVE_X,p.TEXTURE_CUBE_MAP_POSITIVE_Y,p.TEXTURE_CUBE_MAP_POSITIVE_Z,p.TEXTURE_CUBE_MAP_NEGATIVE_X,p.TEXTURE_CUBE_MAP_NEGATIVE_Y,p.TEXTURE_CUBE_MAP_NEGATIVE_Z];R._bindTextureDirectly(p.TEXTURE_CUBE_MAP,g,!0),R._unpackFlipY(!1);for(var o=_?R._getInternalFormat(_):R._gl.RGBA,E=0;E<a.length;E++)R._workingContext.drawImage(e[E],0,0,e[E].width,e[E].height,0,0,t,r),p.texImage2D(a[E],0,o,o,p.UNSIGNED_BYTE,R._workingCanvas);i||p.generateMipmap(p.TEXTURE_CUBE_MAP),R._setCubeMapTextureParams(!i),g.width=t,g.height=r,g.isReady=!0,_&&(g.format=_),g.onLoadedObservable.notifyObservers(g),g.onLoadedObservable.clear(),n&&n()}},r,a)}return this._internalTexturesCache.push(g),g},d.prototype._setCubeMapTextureParams=function(e){var t=this._gl;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)},d.prototype.updateRawCubeTexture=function(e,t,r,i,n,a,_){void 0===a&&(a=null),void 0===_&&(_=0),e._bufferViewArray=t,e.format=r,e.type=i,e.invertY=n,e._compression=a;var o=this._gl,E=this._getWebGLTextureType(i),l=this._getInternalFormat(r),u=this._getRGBABufferInternalSizedFormat(i),h=!1;l===o.RGB&&(l=o.RGBA,h=!0),this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===n||!!n),e.width%4!=0&&o.pixelStorei(o.UNPACK_ALIGNMENT,1);for(var T=0;T<6;T++){var c=t[T];a?o.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+T,_,this.getCaps().s3tc[a],e.width,e.height,0,c):(h&&(c=this._convertRGBtoRGBATextureData(c,e.width,e.height,i)),o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+T,_,u,e.width,e.height,0,l,E,c))}(!this.needPOTTextures||s.Tools.IsExponentOfTwo(e.width)&&s.Tools.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===_&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},d.prototype.createRawCubeTexture=function(e,t,r,i,n,a,_,o){void 0===o&&(o=null);var E=this._gl,l=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_CUBERAW);l.isCube=!0,l.format=r,l.type=i,this._doNotHandleContextLost||(l._bufferViewArray=e);var h=this._getWebGLTextureType(i),T=this._getInternalFormat(r);T===E.RGB&&(T=E.RGBA),h!==E.FLOAT||this._caps.textureFloatLinearFiltering?h!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?h!==E.FLOAT||this._caps.textureFloatRender?h!==E.HALF_FLOAT||this._caps.colorBufferFloat||(n=!1,f.Logger.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(n=!1,f.Logger.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(n=!1,_=d.TEXTURE_NEAREST_SAMPLINGMODE,f.Logger.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(n=!1,_=d.TEXTURE_NEAREST_SAMPLINGMODE,f.Logger.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var c=t,R=c;l.width=c,l.height=R,!this.needPOTTextures||s.Tools.IsExponentOfTwo(l.width)&&s.Tools.IsExponentOfTwo(l.height)||(n=!1),e&&this.updateRawCubeTexture(l,e,r,i,a,o),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,l,!0),e&&n&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var p=this._getSamplingParameters(_,n);return E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MAG_FILTER,p.mag),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_MIN_FILTER,p.min),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_CUBE_MAP,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),this._bindTextureDirectly(E.TEXTURE_CUBE_MAP,null),l.generateMipMaps=n,l},d.prototype.createRawCubeTextureFromUrl=function(e,t,r,i,n,s,a,_,o,E,l,u){var h=this;void 0===o&&(o=null),void 0===E&&(E=null),void 0===l&&(l=d.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===u&&(u=!1);var T=this._gl,c=this.createRawCubeTexture(null,r,i,n,!s,u,l);t._addPendingData(c),c.url=e,this._internalTexturesCache.push(c);return this._loadFile(e,function(e){!function(e){var r=c.width,s=a(e);if(s){if(_){var E=h._getWebGLTextureType(n),l=h._getInternalFormat(i),f=h._getRGBABufferInternalSizedFormat(n),R=!1;l===T.RGB&&(l=T.RGBA,R=!0),h._bindTextureDirectly(T.TEXTURE_CUBE_MAP,c,!0),h._unpackFlipY(!1);for(var p=_(s),d=0;d<p.length;d++)for(var g=r>>d,A=0;A<6;A++){var b=p[d][A];R&&(b=h._convertRGBtoRGBATextureData(b,g,g,n)),T.texImage2D(A,d,f,g,g,0,l,E,b)}h._bindTextureDirectly(T.TEXTURE_CUBE_MAP,null)}else h.updateRawCubeTexture(c,s,i,n,u);c.isReady=!0,t._removePendingData(c),o&&o()}}(e)},void 0,t.offlineProvider,!0,function(e,r){t._removePendingData(c),E&&e&&E(e.status+" "+e.statusText,r)}),c},d.prototype.updateRawTexture3D=function(e,t,r,i,n,s){void 0===n&&(n=null),void 0===s&&(s=d.TEXTURETYPE_UNSIGNED_INT);var a=this._getWebGLTextureType(s),_=this._getInternalFormat(r),o=this._getRGBABufferInternalSizedFormat(s,r);this._bindTextureDirectly(this._gl.TEXTURE_3D,e,!0),this._unpackFlipY(void 0===i||!!i),this._doNotHandleContextLost||(e._bufferView=t,e.format=r,e.invertY=i,e._compression=n),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&t?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[n],e.width,e.height,e.depth,0,t):this._gl.texImage3D(this._gl.TEXTURE_3D,0,o,e.width,e.height,e.depth,0,_,a,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),e.isReady=!0},d.prototype.createRawTexture3D=function(e,t,r,i,n,s,a,_,o,E){void 0===o&&(o=null),void 0===E&&(E=d.TEXTURETYPE_UNSIGNED_INT);var l=new u.InternalTexture(this,u.InternalTexture.DATASOURCE_RAW3D);l.baseWidth=t,l.baseHeight=r,l.baseDepth=i,l.width=t,l.height=r,l.depth=i,l.format=n,l.type=E,l.generateMipMaps=s,l.samplingMode=_,l.is3D=!0,this._doNotHandleContextLost||(l._bufferView=e),this.updateRawTexture3D(l,e,n,a,o,E),this._bindTextureDirectly(this._gl.TEXTURE_3D,l,!0);var h=this._getSamplingParameters(_,s);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,h.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,h.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(l),l},d.prototype._prepareWebGLTextureContinuation=function(e,t,r,i,n){var s=this._gl;if(s){var a=this._getSamplingParameters(n,!r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,a.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,a.min),r||i||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},d.prototype._prepareWebGLTexture=function(e,t,r,i,n,a,_,o,E){var l=this;void 0===E&&(E=d.TEXTURE_TRILINEAR_SAMPLINGMODE);var u=this.getCaps().maxTextureSize,h=Math.min(u,this.needPOTTextures?s.Tools.GetExponentOfTwo(r,u):r),T=Math.min(u,this.needPOTTextures?s.Tools.GetExponentOfTwo(i,u):i),c=this._gl;c&&(e._webGLTexture?(this._bindTextureDirectly(c.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===n||!!n),e.baseWidth=r,e.baseHeight=i,e.width=h,e.height=T,e.isReady=!0,o(h,T,function(){l._prepareWebGLTextureContinuation(e,t,a,_,E)})||this._prepareWebGLTextureContinuation(e,t,a,_,E)):t&&t._removePendingData(e))},d.prototype._convertRGBtoRGBATextureData=function(e,t,r,i){var n;n=i===d.TEXTURETYPE_FLOAT?new Float32Array(t*r*4):new Uint32Array(t*r*4);for(var s=0;s<t;s++)for(var a=0;a<r;a++){var _=3*(a*t+s),o=4*(a*t+s);n[o+0]=e[_+0],n[o+1]=e[_+1],n[o+2]=e[_+2],n[o+3]=1}return n},d.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},d.prototype._releaseTexture=function(e){var t=this._gl;this._releaseFramebufferObjects(e),t.deleteTexture(e._webGLTexture),this.unbindAllTextures();var r=this._internalTexturesCache.indexOf(e);-1!==r&&this._internalTexturesCache.splice(r,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),this.scenes.forEach(function(t){t.postProcesses.forEach(function(t){t._outputTexture==e&&(t._outputTexture=null)}),t.cameras.forEach(function(t){t._postProcesses.forEach(function(t){t&&t._outputTexture==e&&(t._outputTexture=null)})})})},d.prototype.setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},d.prototype.bindSamplers=function(e){this.setProgram(e.getProgram());for(var t=e.getSamplers(),r=0;r<t.length;r++){var i=e.getUniform(t[r]);i&&(this._boundUniforms[r]=i)}this._currentEffect=null},d.prototype._moveBoundTextureOnTop=function(e){this.disableTextureBindingOptimization||this._lastBoundInternalTextureTracker.previous===e||(this._linkTrackers(e.previous,e.next),this._linkTrackers(this._lastBoundInternalTextureTracker.previous,e),this._linkTrackers(e,this._lastBoundInternalTextureTracker))},d.prototype._getCorrectTextureChannel=function(e,t){if(!t)return-1;if(t._initialSlot=e,this.disableTextureBindingOptimization)e!==t._designatedSlot&&this._textureCollisions.addCount(1,!1);else if(e!==t._designatedSlot)return t._designatedSlot>-1?t._designatedSlot:this._nextFreeTextureSlots.length?this._nextFreeTextureSlots[0]:(this._textureCollisions.addCount(1,!1),this._removeDesignatedSlot(this._firstBoundInternalTextureTracker.next));return e},d.prototype._linkTrackers=function(e,t){e.next=t,t.previous=e},d.prototype._removeDesignatedSlot=function(e){var t=e._designatedSlot;return-1===t?-1:(e._designatedSlot=-1,this.disableTextureBindingOptimization?-1:(this._linkTrackers(e.previous,e.next),this._boundTexturesCache[t]=null,this._nextFreeTextureSlots.push(t),t))},d.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},d.prototype._bindTextureDirectly=function(e,t,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var n=!1;r&&t&&t._designatedSlot>-1&&(this._activeChannel=t._designatedSlot);var s=this._boundTexturesCache[this._activeChannel],a=t&&t._initialSlot>-1;if(s!==t||i){if(s&&this._removeDesignatedSlot(s),this._activateCurrentTexture(),this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t){if(!this.disableTextureBindingOptimization){var _=this._nextFreeTextureSlots.indexOf(this._activeChannel);_>-1&&this._nextFreeTextureSlots.splice(_,1),this._linkTrackers(this._lastBoundInternalTextureTracker.previous,t),this._linkTrackers(t,this._lastBoundInternalTextureTracker)}t._designatedSlot=this._activeChannel}}else r&&(n=!0,this._activateCurrentTexture());return a&&!r&&this._bindSamplerUniformToChannel(t._initialSlot,this._activeChannel),n},d.prototype._bindTexture=function(e,t){e<0||(t&&(e=this._getCorrectTextureChannel(e,t)),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},d.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},d.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},d.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},d.prototype.setTexture=function(e,t,r){e<0||(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},d.prototype.setDepthStencilTexture=function(e,t,r){e<0||(t&&(this._boundUniforms[e]=t),r&&r.depthStencilTexture?this._setTexture(e,r,!1,!0):this._setTexture(e,null))},d.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},d.prototype._getTextureWrapMode=function(e){switch(e){case d.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case d.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case d.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},d.prototype._setTexture=function(e,t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;if(t.video)this._activeChannel=e,t.update();else if(t.delayLoadState===d.DELAYLOADSTATE_NOTLOADED)return t.delayLoad(),!1;var n;n=i?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:this.emptyTexture,r||(e=this._getCorrectTextureChannel(e,n));var s=!0;if(this._boundTexturesCache[e]===n&&(this._moveBoundTextureOnTop(n),r||this._bindSamplerUniformToChannel(n._initialSlot,e),s=!1),this._activeChannel=e,n&&n.is3D)s&&this._bindTextureDirectly(this._gl.TEXTURE_3D,n,r),n&&n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n&&n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),n&&n._cachedWrapR!==t.wrapR&&(n._cachedWrapR=t.wrapR,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),n)),this._setAnisotropicLevel(this._gl.TEXTURE_3D,t);else if(n&&n.isCube){if(s&&this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,n,r),n._cachedCoordinatesMode!==t.coordinatesMode){n._cachedCoordinatesMode=t.coordinatesMode;var a=t.coordinatesMode!==d.TEXTURE_CUBIC_MODE&&t.coordinatesMode!==d.TEXTURE_SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,a,n),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,a)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,t)}else s&&this._bindTextureDirectly(this._gl.TEXTURE_2D,n,r),n&&n._cachedWrapU!==t.wrapU&&(n._cachedWrapU=t.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),n)),n&&n._cachedWrapV!==t.wrapV&&(n._cachedWrapV=t.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),n)),this._setAnisotropicLevel(this._gl.TEXTURE_2D,t);return!0},d.prototype.setTextureArray=function(e,t,r){if(!(e<0)&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var i=0;i<r.length;i++)this._textureUnits[i]=this._getCorrectTextureChannel(e+i,r[i].getInternalTexture());this._gl.uniform1iv(t,this._textureUnits);for(var n=0;n<r.length;n++)this._setTexture(this._textureUnits[n],r[n],!0)}},d.prototype._setAnisotropicLevel=function(e,t){var r=t.getInternalTexture();if(r){var i=this._caps.textureAnisotropicFilterExtension,n=t.anisotropicFilteringLevel;r.samplingMode!==d.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&r.samplingMode!==d.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&r.samplingMode!==d.TEXTURE_LINEAR_LINEAR&&(n=1),i&&r._cachedAnisotropicFilteringLevel!==n&&(this._setTextureParameterFloat(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n,this._caps.maxAnisotropy),r),r._cachedAnisotropicFilteringLevel=n)}},d.prototype._setTextureParameterFloat=function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)},d.prototype._setTextureParameterInteger=function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)},d.prototype.readPixels=function(e,t,r,i){var n=new Uint8Array(i*r*4);return this._gl.readPixels(e,t,r,i,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},d.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new i.StringDictionary),this._externalData.add(e,t)},d.prototype.getExternalData=function(e){return this._externalData||(this._externalData=new i.StringDictionary),this._externalData.get(e)},d.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new i.StringDictionary),this._externalData.getOrAddWithFactory(e,t)},d.prototype.removeExternalData=function(e){return this._externalData||(this._externalData=new i.StringDictionary),this._externalData.remove(e)},d.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||(this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1)}},d.prototype.releaseEffects=function(){for(var e in this._compiledEffects)this._deleteProgram(this._compiledEffects[e]._program);this._compiledEffects={}},d.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===d.Instances.length&&d.audioEngine&&d.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),c.DomManagement.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null));var e=d.Instances.indexOf(this);e>=0&&d.Instances.splice(e,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._bindedRenderFunction=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),o.Effect.ResetCache();for(var t=0,r=this._activeRequests;t<r.length;t++){r[t].abort()}},d.prototype.displayLoadingUI=function(){if(c.DomManagement.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},d.prototype.hideLoadingUI=function(){if(c.DomManagement.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(d.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=d.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),d.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},d.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},d.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},d.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},d.prototype.getError=function(){return this._gl.getError()},d.prototype.getFps=function(){return this._fps},d.prototype.getDeltaTime=function(){return this._deltaTime},d.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},d.prototype._readTexturePixels=function(e,t,r,i,n,s){void 0===i&&(i=-1),void 0===n&&(n=0),void 0===s&&(s=null);var a=this._gl;if(!this._dummyFramebuffer){var _=a.createFramebuffer();if(!_)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=_}a.bindFramebuffer(a.FRAMEBUFFER,this._dummyFramebuffer),i>-1?a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+i,e._webGLTexture,n):a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e._webGLTexture,n);var o=void 0!==e.type?this._getWebGLTextureType(e.type):a.UNSIGNED_BYTE;switch(o){case a.UNSIGNED_BYTE:s||(s=new Uint8Array(4*t*r)),o=a.UNSIGNED_BYTE;break;default:s||(s=new Float32Array(4*t*r)),o=a.FLOAT}return a.readPixels(0,0,t,r,a.RGBA,o,s),a.bindFramebuffer(a.FRAMEBUFFER,this._currentFramebuffer),s},d.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(d.TEXTURETYPE_FLOAT)},d.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(d.TEXTURETYPE_HALF_FLOAT)},d.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&s===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var a=t.RGBA,_=t.UNSIGNED_BYTE,o=new Uint8Array(4);t.readPixels(0,0,1,1,a,_,o),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},d.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case d.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case d.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case d.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE}return this._gl.UNSIGNED_BYTE}switch(e){case d.TEXTURETYPE_BYTE:return this._gl.BYTE;case d.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case d.TEXTURETYPE_SHORT:return this._gl.SHORT;case d.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case d.TEXTURETYPE_INT:return this._gl.INT;case d.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case d.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case d.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case d.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case d.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case d.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case d.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case d.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case d.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case d.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case d.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},d.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case d.TEXTUREFORMAT_ALPHA:t=this._gl.ALPHA;break;case d.TEXTUREFORMAT_LUMINANCE:t=this._gl.LUMINANCE;break;case d.TEXTUREFORMAT_LUMINANCE_ALPHA:t=this._gl.LUMINANCE_ALPHA;break;case d.TEXTUREFORMAT_RED:t=this._gl.RED;break;case d.TEXTUREFORMAT_RG:t=this._gl.RG;break;case d.TEXTUREFORMAT_RGB:t=this._gl.RGB;break;case d.TEXTUREFORMAT_RGBA:t=this._gl.RGBA}if(this._webGLVersion>1)switch(e){case d.TEXTUREFORMAT_RED_INTEGER:t=this._gl.RED_INTEGER;break;case d.TEXTUREFORMAT_RG_INTEGER:t=this._gl.RG_INTEGER;break;case d.TEXTUREFORMAT_RGB_INTEGER:t=this._gl.RGB_INTEGER;break;case d.TEXTUREFORMAT_RGBA_INTEGER:t=this._gl.RGBA_INTEGER}return t},d.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case d.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case d.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case d.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA}return this._gl.RGBA}switch(e){case d.TEXTURETYPE_BYTE:switch(t){case d.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case d.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case d.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case d.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case d.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case d.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case d.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case d.TEXTURETYPE_UNSIGNED_BYTE:switch(t){case d.TEXTUREFORMAT_RED:return this._gl.R8;case d.TEXTUREFORMAT_RG:return this._gl.RG8;case d.TEXTUREFORMAT_RGB:return this._gl.RGB8;case d.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case d.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case d.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case d.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case d.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;default:return this._gl.RGBA8}case d.TEXTURETYPE_SHORT:switch(t){case d.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case d.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case d.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case d.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case d.TEXTURETYPE_UNSIGNED_SHORT:switch(t){case d.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case d.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case d.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case d.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case d.TEXTURETYPE_INT:switch(t){case d.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case d.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case d.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case d.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case d.TEXTURETYPE_UNSIGNED_INTEGER:switch(t){case d.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case d.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case d.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case d.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case d.TEXTURETYPE_FLOAT:switch(t){case d.TEXTUREFORMAT_RED:return this._gl.R32F;case d.TEXTUREFORMAT_RG:return this._gl.RG32F;case d.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case d.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case d.TEXTURETYPE_HALF_FLOAT:switch(t){case d.TEXTUREFORMAT_RED:return this._gl.R16F;case d.TEXTUREFORMAT_RG:return this._gl.RG16F;case d.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case d.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case d.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case d.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case d.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case d.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case d.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case d.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(t){case d.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case d.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},d.prototype._getRGBAMultiSampleBufferFormat=function(e){return e===d.TEXTURETYPE_FLOAT?this._gl.RGBA32F:e===d.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},d.prototype._loadFile=function(e,t,r,i,n,a){var _=this,o=s.Tools.LoadFile(e,t,r,i,n,a);return this._activeRequests.push(o),o.onCompleteObservable.add(function(e){_._activeRequests.splice(_._activeRequests.indexOf(e),1)}),o},d.prototype._loadFileAsync=function(e,t,r){var i=this;return new Promise(function(n,s){i._loadFile(e,function(e){n(e)},void 0,t,r,function(e,t){s(t)})})},d.prototype._partialLoadFile=function(e,t,r,i,n){void 0===n&&(n=null);this._loadFile(e,function(e){r[t]=e,r._internalCount++,6===r._internalCount&&i(r)},void 0,void 0,!0,function(e,t){n&&e&&n(e.status+" "+e.statusText,t)})},d.prototype._cascadeLoadFiles=function(e,t,r,i){void 0===i&&(i=null);var n=[];n._internalCount=0;for(var s=0;s<6;s++)this._partialLoadFile(r[s],s,n,t,i)},d.isSupported=function(){try{var e=document.createElement("canvas");return null!=(e.getContext("webgl")||e.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(t){return!1}},d.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Macintosh",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]},{key:"iPhone",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]},{key:"iPad",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]}],d._TextureLoaders=[],d.ALPHA_DISABLE=T.Constants.ALPHA_DISABLE,d.ALPHA_ADD=T.Constants.ALPHA_ADD,d.ALPHA_COMBINE=T.Constants.ALPHA_COMBINE,d.ALPHA_SUBTRACT=T.Constants.ALPHA_SUBTRACT,d.ALPHA_MULTIPLY=T.Constants.ALPHA_MULTIPLY,d.ALPHA_MAXIMIZED=T.Constants.ALPHA_MAXIMIZED,d.ALPHA_ONEONE=T.Constants.ALPHA_ONEONE,d.ALPHA_PREMULTIPLIED=T.Constants.ALPHA_PREMULTIPLIED,d.ALPHA_PREMULTIPLIED_PORTERDUFF=T.Constants.ALPHA_PREMULTIPLIED_PORTERDUFF,d.ALPHA_INTERPOLATE=T.Constants.ALPHA_INTERPOLATE,d.ALPHA_SCREENMODE=T.Constants.ALPHA_SCREENMODE,d.DELAYLOADSTATE_NONE=T.Constants.DELAYLOADSTATE_NONE,d.DELAYLOADSTATE_LOADED=T.Constants.DELAYLOADSTATE_LOADED,d.DELAYLOADSTATE_LOADING=T.Constants.DELAYLOADSTATE_LOADING,d.DELAYLOADSTATE_NOTLOADED=T.Constants.DELAYLOADSTATE_NOTLOADED,d.NEVER=T.Constants.NEVER,d.ALWAYS=T.Constants.ALWAYS,d.LESS=T.Constants.LESS,d.EQUAL=T.Constants.EQUAL,d.LEQUAL=T.Constants.LEQUAL,d.GREATER=T.Constants.GREATER,d.GEQUAL=T.Constants.GEQUAL,d.NOTEQUAL=T.Constants.NOTEQUAL,d.KEEP=T.Constants.KEEP,d.REPLACE=T.Constants.REPLACE,d.INCR=T.Constants.INCR,d.DECR=T.Constants.DECR,d.INVERT=T.Constants.INVERT,d.INCR_WRAP=T.Constants.INCR_WRAP,d.DECR_WRAP=T.Constants.DECR_WRAP,d.TEXTURE_CLAMP_ADDRESSMODE=T.Constants.TEXTURE_CLAMP_ADDRESSMODE,d.TEXTURE_WRAP_ADDRESSMODE=T.Constants.TEXTURE_WRAP_ADDRESSMODE,d.TEXTURE_MIRROR_ADDRESSMODE=T.Constants.TEXTURE_MIRROR_ADDRESSMODE,d.TEXTUREFORMAT_ALPHA=T.Constants.TEXTUREFORMAT_ALPHA,d.TEXTUREFORMAT_LUMINANCE=T.Constants.TEXTUREFORMAT_LUMINANCE,d.TEXTUREFORMAT_LUMINANCE_ALPHA=T.Constants.TEXTUREFORMAT_LUMINANCE_ALPHA,d.TEXTUREFORMAT_RGB=T.Constants.TEXTUREFORMAT_RGB,d.TEXTUREFORMAT_RGBA=T.Constants.TEXTUREFORMAT_RGBA,d.TEXTUREFORMAT_RED=T.Constants.TEXTUREFORMAT_RED,d.TEXTUREFORMAT_R=T.Constants.TEXTUREFORMAT_R,d.TEXTUREFORMAT_RG=T.Constants.TEXTUREFORMAT_RG,d.TEXTUREFORMAT_RED_INTEGER=T.Constants.TEXTUREFORMAT_RED_INTEGER,d.TEXTUREFORMAT_R_INTEGER=T.Constants.TEXTUREFORMAT_R_INTEGER,d.TEXTUREFORMAT_RG_INTEGER=T.Constants.TEXTUREFORMAT_RG_INTEGER,d.TEXTUREFORMAT_RGB_INTEGER=T.Constants.TEXTUREFORMAT_RGB_INTEGER,d.TEXTUREFORMAT_RGBA_INTEGER=T.Constants.TEXTUREFORMAT_RGBA_INTEGER,d.TEXTURETYPE_UNSIGNED_BYTE=T.Constants.TEXTURETYPE_UNSIGNED_BYTE,d.TEXTURETYPE_UNSIGNED_INT=T.Constants.TEXTURETYPE_UNSIGNED_INT,d.TEXTURETYPE_FLOAT=T.Constants.TEXTURETYPE_FLOAT,d.TEXTURETYPE_HALF_FLOAT=T.Constants.TEXTURETYPE_HALF_FLOAT,d.TEXTURETYPE_BYTE=T.Constants.TEXTURETYPE_BYTE,d.TEXTURETYPE_SHORT=T.Constants.TEXTURETYPE_SHORT,d.TEXTURETYPE_UNSIGNED_SHORT=T.Constants.TEXTURETYPE_UNSIGNED_SHORT,d.TEXTURETYPE_INT=T.Constants.TEXTURETYPE_INT,d.TEXTURETYPE_UNSIGNED_INTEGER=T.Constants.TEXTURETYPE_UNSIGNED_INTEGER,d.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=T.Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,d.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=T.Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,d.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=T.Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,d.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=T.Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,d.TEXTURETYPE_UNSIGNED_INT_24_8=T.Constants.TEXTURETYPE_UNSIGNED_INT_24_8,d.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=T.Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,d.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=T.Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,d.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=T.Constants.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,d.TEXTURE_NEAREST_SAMPLINGMODE=T.Constants.TEXTURE_NEAREST_SAMPLINGMODE,d.TEXTURE_BILINEAR_SAMPLINGMODE=T.Constants.TEXTURE_BILINEAR_SAMPLINGMODE,d.TEXTURE_TRILINEAR_SAMPLINGMODE=T.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,d.TEXTURE_NEAREST_NEAREST_MIPLINEAR=T.Constants.TEXTURE_NEAREST_NEAREST_MIPLINEAR,d.TEXTURE_LINEAR_LINEAR_MIPNEAREST=T.Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST,d.TEXTURE_LINEAR_LINEAR_MIPLINEAR=T.Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR,d.TEXTURE_NEAREST_NEAREST_MIPNEAREST=T.Constants.TEXTURE_NEAREST_NEAREST_MIPNEAREST,d.TEXTURE_NEAREST_LINEAR_MIPNEAREST=T.Constants.TEXTURE_NEAREST_LINEAR_MIPNEAREST,d.TEXTURE_NEAREST_LINEAR_MIPLINEAR=T.Constants.TEXTURE_NEAREST_LINEAR_MIPLINEAR,d.TEXTURE_NEAREST_LINEAR=T.Constants.TEXTURE_NEAREST_LINEAR,d.TEXTURE_NEAREST_NEAREST=T.Constants.TEXTURE_NEAREST_NEAREST,d.TEXTURE_LINEAR_NEAREST_MIPNEAREST=T.Constants.TEXTURE_LINEAR_NEAREST_MIPNEAREST,d.TEXTURE_LINEAR_NEAREST_MIPLINEAR=T.Constants.TEXTURE_LINEAR_NEAREST_MIPLINEAR,d.TEXTURE_LINEAR_LINEAR=T.Constants.TEXTURE_LINEAR_LINEAR,d.TEXTURE_LINEAR_NEAREST=T.Constants.TEXTURE_LINEAR_NEAREST,d.TEXTURE_EXPLICIT_MODE=T.Constants.TEXTURE_EXPLICIT_MODE,d.TEXTURE_SPHERICAL_MODE=T.Constants.TEXTURE_SPHERICAL_MODE,d.TEXTURE_PLANAR_MODE=T.Constants.TEXTURE_PLANAR_MODE,d.TEXTURE_CUBIC_MODE=T.Constants.TEXTURE_CUBIC_MODE,d.TEXTURE_PROJECTION_MODE=T.Constants.TEXTURE_PROJECTION_MODE,d.TEXTURE_SKYBOX_MODE=T.Constants.TEXTURE_SKYBOX_MODE,d.TEXTURE_INVCUBIC_MODE=T.Constants.TEXTURE_INVCUBIC_MODE,d.TEXTURE_EQUIRECTANGULAR_MODE=T.Constants.TEXTURE_EQUIRECTANGULAR_MODE,d.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=T.Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,d.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=T.Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,d.SCALEMODE_FLOOR=T.Constants.SCALEMODE_FLOOR,d.SCALEMODE_NEAREST=T.Constants.SCALEMODE_NEAREST,d.SCALEMODE_CEILING=T.Constants.SCALEMODE_CEILING,d.CollisionsEpsilon=.001,d._RescalePostProcessFactory=null,d}();exports.Engine=m;
},{"tslib":"vCxL","../Misc/observable":"gtkL","../Misc/performanceMonitor":"CVTd","../Misc/stringDictionary":"xdbM","../Misc/promise":"Dc2l","../Misc/tools":"RkuS","../Maths/math":"Iizi","../Maths/math.scalar":"7Iig","../Materials/effect":"Ru7D","../Materials/material":"v46b","../Materials/Textures/internalTextureTracker":"izD9","../Materials/Textures/internalTexture":"KfUh","../States/index":"VVol","./constants":"vn8z","../Misc/domManagement":"+D0i","../Misc/logger":"Fvml","./engineStore":"n+VE","../Materials/Textures/renderTargetCreationOptions":"vXjp"}],"vK5Y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SmartArrayNoDuplicate=exports.SmartArray=void 0;var t=e(require("tslib"));function e(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};a.get||a.set?Object.defineProperty(e,r,a):e[r]=t[r]}return e.default=t,e}var r=function(){function t(e){this.length=0,this.data=new Array(e),this._id=t._GlobalId++}return t.prototype.push=function(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)},t.prototype.forEach=function(t){for(var e=0;e<this.length;e++)t(this.data[e])},t.prototype.sort=function(t){this.data.sort(t)},t.prototype.reset=function(){this.length=0},t.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},t.prototype.concat=function(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(var e=0;e<t.length;e++)this.data[this.length++]=(t.data||t)[e]}},t.prototype.indexOf=function(t){var e=this.data.indexOf(t);return e>=this.length?-1:e},t.prototype.contains=function(t){return-1!==this.indexOf(t)},t._GlobalId=0,t}();exports.SmartArray=r;var a=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}return t.__extends(r,e),r.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},r.prototype.pushNoDuplicate=function(t){return(!t.__smartArrayFlags||t.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(t),!0)},r.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},r.prototype.concatWithNoDuplicate=function(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(var e=0;e<t.length;e++){var r=(t.data||t)[e];this.pushNoDuplicate(r)}}},r}(r);exports.SmartArrayNoDuplicate=a;
},{"tslib":"vCxL"}],"+kld":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VertexData=void 0;var e=require("../Maths/math"),t=require("../Meshes/buffer"),s=function(){function s(){}return s.prototype.set=function(e,s){switch(s){case t.VertexBuffer.PositionKind:this.positions=e;break;case t.VertexBuffer.NormalKind:this.normals=e;break;case t.VertexBuffer.TangentKind:this.tangents=e;break;case t.VertexBuffer.UVKind:this.uvs=e;break;case t.VertexBuffer.UV2Kind:this.uvs2=e;break;case t.VertexBuffer.UV3Kind:this.uvs3=e;break;case t.VertexBuffer.UV4Kind:this.uvs4=e;break;case t.VertexBuffer.UV5Kind:this.uvs5=e;break;case t.VertexBuffer.UV6Kind:this.uvs6=e;break;case t.VertexBuffer.ColorKind:this.colors=e;break;case t.VertexBuffer.MatricesIndicesKind:this.matricesIndices=e;break;case t.VertexBuffer.MatricesWeightsKind:this.matricesWeights=e;break;case t.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case t.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},s.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},s.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},s.prototype.updateMesh=function(e){return this._update(e),this},s.prototype.updateGeometry=function(e){return this._update(e),this},s.prototype._applyTo=function(e,s){return void 0===s&&(s=!1),this.positions&&e.setVerticesData(t.VertexBuffer.PositionKind,this.positions,s),this.normals&&e.setVerticesData(t.VertexBuffer.NormalKind,this.normals,s),this.tangents&&e.setVerticesData(t.VertexBuffer.TangentKind,this.tangents,s),this.uvs&&e.setVerticesData(t.VertexBuffer.UVKind,this.uvs,s),this.uvs2&&e.setVerticesData(t.VertexBuffer.UV2Kind,this.uvs2,s),this.uvs3&&e.setVerticesData(t.VertexBuffer.UV3Kind,this.uvs3,s),this.uvs4&&e.setVerticesData(t.VertexBuffer.UV4Kind,this.uvs4,s),this.uvs5&&e.setVerticesData(t.VertexBuffer.UV5Kind,this.uvs5,s),this.uvs6&&e.setVerticesData(t.VertexBuffer.UV6Kind,this.uvs6,s),this.colors&&e.setVerticesData(t.VertexBuffer.ColorKind,this.colors,s),this.matricesIndices&&e.setVerticesData(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices,s),this.matricesWeights&&e.setVerticesData(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights,s),this.matricesIndicesExtra&&e.setVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,s),this.matricesWeightsExtra&&e.setVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,s),this.indices?e.setIndices(this.indices,null,s):e.setIndices([],null),this},s.prototype._update=function(e,s,r){return this.positions&&e.updateVerticesData(t.VertexBuffer.PositionKind,this.positions,s,r),this.normals&&e.updateVerticesData(t.VertexBuffer.NormalKind,this.normals,s,r),this.tangents&&e.updateVerticesData(t.VertexBuffer.TangentKind,this.tangents,s,r),this.uvs&&e.updateVerticesData(t.VertexBuffer.UVKind,this.uvs,s,r),this.uvs2&&e.updateVerticesData(t.VertexBuffer.UV2Kind,this.uvs2,s,r),this.uvs3&&e.updateVerticesData(t.VertexBuffer.UV3Kind,this.uvs3,s,r),this.uvs4&&e.updateVerticesData(t.VertexBuffer.UV4Kind,this.uvs4,s,r),this.uvs5&&e.updateVerticesData(t.VertexBuffer.UV5Kind,this.uvs5,s,r),this.uvs6&&e.updateVerticesData(t.VertexBuffer.UV6Kind,this.uvs6,s,r),this.colors&&e.updateVerticesData(t.VertexBuffer.ColorKind,this.colors,s,r),this.matricesIndices&&e.updateVerticesData(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices,s,r),this.matricesWeights&&e.updateVerticesData(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights,s,r),this.matricesIndicesExtra&&e.updateVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,s,r),this.matricesWeightsExtra&&e.updateVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,s,r),this.indices&&e.setIndices(this.indices,null),this},s.prototype.transform=function(t){var s,r=t.m[0]*t.m[5]*t.m[10]<0,i=e.Vector3.Zero();if(this.positions){var a=e.Vector3.Zero();for(s=0;s<this.positions.length;s+=3)e.Vector3.FromArrayToRef(this.positions,s,a),e.Vector3.TransformCoordinatesToRef(a,t,i),this.positions[s]=i.x,this.positions[s+1]=i.y,this.positions[s+2]=i.z}if(this.normals){var n=e.Vector3.Zero();for(s=0;s<this.normals.length;s+=3)e.Vector3.FromArrayToRef(this.normals,s,n),e.Vector3.TransformNormalToRef(n,t,i),this.normals[s]=i.x,this.normals[s+1]=i.y,this.normals[s+2]=i.z}if(this.tangents){var o=e.Vector4.Zero(),h=e.Vector4.Zero();for(s=0;s<this.tangents.length;s+=4)e.Vector4.FromArrayToRef(this.tangents,s,o),e.Vector4.TransformNormalToRef(o,t,h),this.tangents[s]=h.x,this.tangents[s+1]=h.y,this.tangents[s+2]=h.z,this.tangents[s+3]=h.w}if(r&&this.indices)for(s=0;s<this.indices.length;s+=3){var u=this.indices[s+1];this.indices[s+1]=this.indices[s+2],this.indices[s+2]=u}return this},s.prototype.merge=function(e,t){if(void 0===t&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var s=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var r=this.indices.length+e.indices.length,i=t||this.indices instanceof Uint32Array?new Uint32Array(r):new Uint16Array(r);i.set(this.indices);for(var a=this.indices.length,n=0;n<e.indices.length;n++)i[a+n]=e.indices[n]+s;this.indices=i}else for(n=0;n<e.indices.length;n++)this.indices.push(e.indices[n]+s)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},s.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var s=t.length+e.length,r=e instanceof Float32Array,i=t instanceof Float32Array;if(r){var a=new Float32Array(s);return a.set(e),a.set(t,e.length),a}if(i){var n=e.slice(0),o=0;for(s=t.length;o<s;o++)n.push(t[o]);return n}return e.concat(t)},s.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var e=function(e,s){var r=t.VertexBuffer.DeduceStride(e);if(s.length%r!=0)throw new Error("The "+e+"s array count must be a multiple of "+r);return s.length/r},s=e(t.VertexBuffer.PositionKind,this.positions),r=function(t,r){var i=e(t,r);if(i!==s)throw new Error("The "+t+"s element count ("+i+") does not match the positions count ("+s+")")};this.normals&&r(t.VertexBuffer.NormalKind,this.normals),this.tangents&&r(t.VertexBuffer.TangentKind,this.tangents),this.uvs&&r(t.VertexBuffer.UVKind,this.uvs),this.uvs2&&r(t.VertexBuffer.UV2Kind,this.uvs2),this.uvs3&&r(t.VertexBuffer.UV3Kind,this.uvs3),this.uvs4&&r(t.VertexBuffer.UV4Kind,this.uvs4),this.uvs5&&r(t.VertexBuffer.UV5Kind,this.uvs5),this.uvs6&&r(t.VertexBuffer.UV6Kind,this.uvs6),this.colors&&r(t.VertexBuffer.ColorKind,this.colors),this.matricesIndices&&r(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&r(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&r(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&r(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra)},s.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},s.ExtractFromMesh=function(e,t,r){return s._ExtractFrom(e,t,r)},s.ExtractFromGeometry=function(e,t,r){return s._ExtractFrom(e,t,r)},s._ExtractFrom=function(e,r,i){var a=new s;return e.isVerticesDataPresent(t.VertexBuffer.PositionKind)&&(a.positions=e.getVerticesData(t.VertexBuffer.PositionKind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&(a.normals=e.getVerticesData(t.VertexBuffer.NormalKind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.TangentKind)&&(a.tangents=e.getVerticesData(t.VertexBuffer.TangentKind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(a.uvs=e.getVerticesData(t.VertexBuffer.UVKind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&(a.uvs2=e.getVerticesData(t.VertexBuffer.UV2Kind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.UV3Kind)&&(a.uvs3=e.getVerticesData(t.VertexBuffer.UV3Kind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.UV4Kind)&&(a.uvs4=e.getVerticesData(t.VertexBuffer.UV4Kind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.UV5Kind)&&(a.uvs5=e.getVerticesData(t.VertexBuffer.UV5Kind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.UV6Kind)&&(a.uvs6=e.getVerticesData(t.VertexBuffer.UV6Kind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.ColorKind)&&(a.colors=e.getVerticesData(t.VertexBuffer.ColorKind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind)&&(a.matricesIndices=e.getVerticesData(t.VertexBuffer.MatricesIndicesKind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind)&&(a.matricesWeights=e.getVerticesData(t.VertexBuffer.MatricesWeightsKind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesExtraKind)&&(a.matricesIndicesExtra=e.getVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,r,i)),e.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsExtraKind)&&(a.matricesWeightsExtra=e.getVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,r,i)),a.indices=e.getIndices(r,i),a},s.CreateRibbon=function(e){var r=e.pathArray,i=e.closeArray||!1,a=e.closePath||!1,n=e.invertUV||!1,o=Math.floor(r[0].length/2),h=e.offset||o;h=h>o?o:Math.floor(h);var u,c,f,d,p=0===e.sideOrientation?0:e.sideOrientation||s.DEFAULTSIDE,v=e.uvs,m=e.colors,l=[],V=[],x=[],g=[],y=[],w=[],b=[],z=[],D=[],E=[];if(r.length<2){var B=[],K=[];for(f=0;f<r[0].length-h;f++)B.push(r[0][f]),K.push(r[0][f+h]);r=[B,K]}var I,M,U,A,P,C=0,S=a?1:0;for(u=r[0].length,c=0;c<r.length;c++){for(b[c]=0,y[c]=[0],u=u<(M=(I=r[c]).length)?u:M,d=0;d<M;)l.push(I[d].x,I[d].y,I[d].z),d>0&&(U=I[d].subtract(I[d-1]).length()+b[c],y[c].push(U),b[c]=U),d++;a&&(d--,l.push(I[0].x,I[0].y,I[0].z),U=I[d].subtract(I[0]).length()+b[c],y[c].push(U),b[c]=U),D[c]=M+S,E[c]=C,C+=M+S}var T,W,_=null,F=null;for(f=0;f<u+S;f++){for(z[f]=0,w[f]=[0],c=0;c<r.length-1;c++)A=r[c],P=r[c+1],f===u?(_=A[0],F=P[0]):(_=A[f],F=P[f]),U=F.subtract(_).length()+z[f],w[f].push(U),z[f]=U;i&&F&&_&&(A=r[c],P=r[0],f===u&&(F=P[0]),U=F.subtract(_).length()+z[f],z[f]=U)}if(v)for(c=0;c<v.length;c++)g.push(v[c].x,v[c].y);else for(c=0;c<r.length;c++)for(f=0;f<u+S;f++)T=0!=b[c]?y[c][f]/b[c]:0,W=0!=z[f]?w[f][c]/z[f]:0,n?g.push(W,T):g.push(T,W);for(var L=0,k=D[c=0]-1,O=D[c+1]-1,N=k<O?k:O,Z=E[1]-E[0],R=i?D.length:D.length-1;L<=N&&c<R;)V.push(L,L+Z,L+1),V.push(L+Z+1,L+1,L+Z),(L+=1)===N&&(++c===D.length-1?(Z=E[0]-E[c],k=D[c]-1,O=D[0]-1):(Z=E[c+1]-E[c],k=D[c]-1,O=D[c+1]-1),L=E[c],N=k<O?k+L:O+L);if(s.ComputeNormals(l,V,x),a){var H=0,q=0;for(c=0;c<r.length;c++)H=3*E[c],q=c+1<r.length?3*(E[c+1]-1):x.length-3,x[H]=.5*(x[H]+x[q]),x[H+1]=.5*(x[H+1]+x[q+1]),x[H+2]=.5*(x[H+2]+x[q+2]),x[q]=x[H],x[q+1]=x[H+1],x[q+2]=x[H+2]}s._ComputeSides(p,l,V,x,g,e.frontUVs,e.backUVs);var Y=null;if(m){Y=new Float32Array(4*m.length);for(var G=0;G<m.length;G++)Y[4*G]=m[G].r,Y[4*G+1]=m[G].g,Y[4*G+2]=m[G].b,Y[4*G+3]=m[G].a}var X=new s,j=new Float32Array(l),J=new Float32Array(x),Q=new Float32Array(g);return X.indices=V,X.positions=j,X.normals=J,X.uvs=Q,Y&&X.set(Y,t.VertexBuffer.ColorKind),a&&(X._idx=E),X},s.CreateBox=function(t){for(var r=[new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,-1,0)],i=[],a=[],n=[],o=[],h=t.width||t.size||1,u=t.height||t.size||1,c=t.depth||t.size||1,f=0===t.sideOrientation?0:t.sideOrientation||s.DEFAULTSIDE,d=t.faceUV||new Array(6),p=t.faceColors,v=[],m=0;m<6;m++)void 0===d[m]&&(d[m]=new e.Vector4(0,0,1,1)),p&&void 0===p[m]&&(p[m]=new e.Color4(1,1,1,1));for(var l=new e.Vector3(h/2,u/2,c/2),V=0;V<r.length;V++){var x=r[V],g=new e.Vector3(x.y,x.z,x.x),y=e.Vector3.Cross(x,g),w=a.length/3;i.push(w),i.push(w+1),i.push(w+2),i.push(w),i.push(w+2),i.push(w+3);var b=x.subtract(g).subtract(y).multiply(l);a.push(b.x,b.y,b.z),n.push(x.x,x.y,x.z),o.push(d[V].z,d[V].w),p&&v.push(p[V].r,p[V].g,p[V].b,p[V].a),b=x.subtract(g).add(y).multiply(l),a.push(b.x,b.y,b.z),n.push(x.x,x.y,x.z),o.push(d[V].x,d[V].w),p&&v.push(p[V].r,p[V].g,p[V].b,p[V].a),b=x.add(g).add(y).multiply(l),a.push(b.x,b.y,b.z),n.push(x.x,x.y,x.z),o.push(d[V].x,d[V].y),p&&v.push(p[V].r,p[V].g,p[V].b,p[V].a),b=x.add(g).subtract(y).multiply(l),a.push(b.x,b.y,b.z),n.push(x.x,x.y,x.z),o.push(d[V].z,d[V].y),p&&v.push(p[V].r,p[V].g,p[V].b,p[V].a)}s._ComputeSides(f,a,i,n,o,t.frontUVs,t.backUVs);var z=new s;if(z.indices=i,z.positions=a,z.normals=n,z.uvs=o,p){var D=f===s.DOUBLESIDE?v.concat(v):v;z.colors=D}return z},s.CreateSphere=function(t){for(var r=t.segments||32,i=t.diameterX||t.diameter||1,a=t.diameterY||t.diameter||1,n=t.diameterZ||t.diameter||1,o=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,h=t.slice&&t.slice<=0?1:t.slice||1,u=0===t.sideOrientation?0:t.sideOrientation||s.DEFAULTSIDE,c=new e.Vector3(i/2,a/2,n/2),f=2+r,d=2*f,p=[],v=[],m=[],l=[],V=0;V<=f;V++){for(var x=V/f,g=x*Math.PI*h,y=0;y<=d;y++){var w=y/d,b=w*Math.PI*2*o,z=e.Matrix.RotationZ(-g),D=e.Matrix.RotationY(b),E=e.Vector3.TransformCoordinates(e.Vector3.Up(),z),B=e.Vector3.TransformCoordinates(E,D),K=B.multiply(c),I=B.divide(c).normalize();v.push(K.x,K.y,K.z),m.push(I.x,I.y,I.z),l.push(w,x)}if(V>0)for(var M=v.length/3,U=M-2*(d+1);U+d+2<M;U++)p.push(U),p.push(U+1),p.push(U+d+1),p.push(U+d+1),p.push(U+1),p.push(U+d+2)}s._ComputeSides(u,v,p,m,l,t.frontUVs,t.backUVs);var A=new s;return A.indices=p,A.positions=v,A.normals=m,A.uvs=l,A},s.CreateCylinder=function(t){var r,i=t.height||2,a=0===t.diameterTop?0:t.diameterTop||t.diameter||1,n=0===t.diameterBottom?0:t.diameterBottom||t.diameter||1,o=t.tessellation||24,h=t.subdivisions||1,u=!!t.hasRings,c=!!t.enclose,f=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,d=0===t.sideOrientation?0:t.sideOrientation||s.DEFAULTSIDE,p=t.faceUV||new Array(3),v=t.faceColors,m=2+(1+(1!==f&&c?2:0))*(u?h:1);for(r=0;r<m;r++)v&&void 0===v[r]&&(v[r]=new e.Color4(1,1,1,1));for(r=0;r<m;r++)p&&void 0===p[r]&&(p[r]=new e.Vector4(0,0,1,1));var l,V,x,g,y,w,b=new Array,z=new Array,D=new Array,E=new Array,B=new Array,K=2*Math.PI*f/o,I=(n-a)/2/i,M=e.Vector3.Zero(),U=e.Vector3.Zero(),A=e.Vector3.Zero(),P=e.Vector3.Zero(),C=e.Vector3.Zero(),S=e.Axis.Y,T=1,W=1,_=0,F=0;for(g=0;g<=h;g++)for(x=((V=g/h)*(a-n)+n)/2,T=u&&0!==g&&g!==h?2:1,w=0;w<T;w++){for(u&&(W+=w),c&&(W+=2*w),y=0;y<=o;y++)l=y*K,M.x=Math.cos(-l)*x,M.y=-i/2+V*i,M.z=Math.sin(-l)*x,0===a&&g===h?(U.x=D[D.length-3*(o+1)],U.y=D[D.length-3*(o+1)+1],U.z=D[D.length-3*(o+1)+2]):(U.x=M.x,U.z=M.z,U.y=Math.sqrt(U.x*U.x+U.z*U.z)*I,U.normalize()),0===y&&(A.copyFrom(M),P.copyFrom(U)),z.push(M.x,M.y,M.z),D.push(U.x,U.y,U.z),F=u?_!==W?p[W].y:p[W].w:p[W].y+(p[W].w-p[W].y)*V,E.push(p[W].x+(p[W].z-p[W].x)*y/o,F),v&&B.push(v[W].r,v[W].g,v[W].b,v[W].a);1!==f&&c&&(z.push(M.x,M.y,M.z),z.push(0,M.y,0),z.push(0,M.y,0),z.push(A.x,A.y,A.z),e.Vector3.CrossToRef(S,U,C),C.normalize(),D.push(C.x,C.y,C.z,C.x,C.y,C.z),e.Vector3.CrossToRef(P,S,C),C.normalize(),D.push(C.x,C.y,C.z,C.x,C.y,C.z),F=u?_!==W?p[W+1].y:p[W+1].w:p[W+1].y+(p[W+1].w-p[W+1].y)*V,E.push(p[W+1].x,F),E.push(p[W+1].z,F),F=u?_!==W?p[W+2].y:p[W+2].w:p[W+2].y+(p[W+2].w-p[W+2].y)*V,E.push(p[W+2].x,F),E.push(p[W+2].z,F),v&&(B.push(v[W+1].r,v[W+1].g,v[W+1].b,v[W+1].a),B.push(v[W+1].r,v[W+1].g,v[W+1].b,v[W+1].a),B.push(v[W+2].r,v[W+2].g,v[W+2].b,v[W+2].a),B.push(v[W+2].r,v[W+2].g,v[W+2].b,v[W+2].a))),_!==W&&(_=W)}var L=1!==f&&c?o+4:o;for(g=0,W=0;W<h;W++){var k=0,O=0,N=0,Z=0;for(y=0;y<o;y++)k=g*(L+1)+y,O=(g+1)*(L+1)+y,N=g*(L+1)+(y+1),Z=(g+1)*(L+1)+(y+1),b.push(k,O,N),b.push(Z,N,O);1!==f&&c&&(b.push(k+2,O+2,N+2),b.push(Z+2,N+2,O+2),b.push(k+4,O+4,N+4),b.push(Z+4,N+4,O+4)),g=u?g+2:g+1}var R=function(t){var s=t?a/2:n/2;if(0!==s){var r,h,u,c=t?p[m-1]:p[0],d=null;v&&(d=t?v[m-1]:v[0]);var l=z.length/3,V=t?i/2:-i/2,x=new e.Vector3(0,V,0);z.push(x.x,x.y,x.z),D.push(0,t?1:-1,0),E.push(c.x+.5*(c.z-c.x),c.y+.5*(c.w-c.y)),d&&B.push(d.r,d.g,d.b,d.a);var g=new e.Vector2(.5,.5);for(u=0;u<=o;u++){r=2*Math.PI*u*f/o;var y=Math.cos(-r),w=Math.sin(-r);h=new e.Vector3(y*s,V,w*s);var K=new e.Vector2(y*g.x+.5,w*g.y+.5);z.push(h.x,h.y,h.z),D.push(0,t?1:-1,0),E.push(c.x+(c.z-c.x)*K.x,c.y+(c.w-c.y)*K.y),d&&B.push(d.r,d.g,d.b,d.a)}for(u=0;u<o;u++)t?(b.push(l),b.push(l+(u+2)),b.push(l+(u+1))):(b.push(l),b.push(l+(u+1)),b.push(l+(u+2)))}};R(!1),R(!0),s._ComputeSides(d,z,b,D,E,t.frontUVs,t.backUVs);var H=new s;return H.indices=b,H.positions=z,H.normals=D,H.uvs=E,v&&(H.colors=B),H},s.CreateTorus=function(t){for(var r=[],i=[],a=[],n=[],o=t.diameter||1,h=t.thickness||.5,u=t.tessellation||16,c=0===t.sideOrientation?0:t.sideOrientation||s.DEFAULTSIDE,f=u+1,d=0;d<=u;d++)for(var p=d/u,v=d*Math.PI*2/u-Math.PI/2,m=e.Matrix.Translation(o/2,0,0).multiply(e.Matrix.RotationY(v)),l=0;l<=u;l++){var V=1-l/u,x=l*Math.PI*2/u+Math.PI,g=Math.cos(x),y=Math.sin(x),w=new e.Vector3(g,y,0),b=w.scale(h/2),z=new e.Vector2(p,V);b=e.Vector3.TransformCoordinates(b,m),w=e.Vector3.TransformNormal(w,m),i.push(b.x,b.y,b.z),a.push(w.x,w.y,w.z),n.push(z.x,z.y);var D=(d+1)%f,E=(l+1)%f;r.push(d*f+l),r.push(d*f+E),r.push(D*f+l),r.push(d*f+E),r.push(D*f+E),r.push(D*f+l)}s._ComputeSides(c,i,r,a,n,t.frontUVs,t.backUVs);var B=new s;return B.indices=r,B.positions=i,B.normals=a,B.uvs=n,B},s.CreateLineSystem=function(e){for(var t=[],r=[],i=e.lines,a=e.colors,n=[],o=0,h=0;h<i.length;h++)for(var u=i[h],c=0;c<u.length;c++){if(r.push(u[c].x,u[c].y,u[c].z),a){var f=a[h];n.push(f[c].r,f[c].g,f[c].b,f[c].a)}c>0&&(t.push(o-1),t.push(o)),o++}var d=new s;return d.indices=t,d.positions=r,a&&(d.colors=n),d},s.CreateDashedLines=function(t){var r,i,a=t.dashSize||3,n=t.gapSize||1,o=t.dashNb||200,h=t.points,u=new Array,c=new Array,f=e.Vector3.Zero(),d=0,p=0,v=0,m=0,l=0;for(l=0;l<h.length-1;l++)h[l+1].subtractToRef(h[l],f),d+=f.length();for(i=a*(r=d/o)/(a+n),l=0;l<h.length-1;l++){h[l+1].subtractToRef(h[l],f),p=Math.floor(f.length()/r),f.normalize();for(var V=0;V<p;V++)v=r*V,u.push(h[l].x+v*f.x,h[l].y+v*f.y,h[l].z+v*f.z),u.push(h[l].x+(v+i)*f.x,h[l].y+(v+i)*f.y,h[l].z+(v+i)*f.z),c.push(m,m+1),m+=2}var x=new s;return x.positions=u,x.indices=c,x},s.CreateGround=function(t){var r,i,a=[],n=[],o=[],h=[],u=t.width||1,c=t.height||1,f=t.subdivisionsX||t.subdivisions||1,d=t.subdivisionsY||t.subdivisions||1;for(r=0;r<=d;r++)for(i=0;i<=f;i++){var p=new e.Vector3(i*u/f-u/2,0,(d-r)*c/d-c/2),v=new e.Vector3(0,1,0);n.push(p.x,p.y,p.z),o.push(v.x,v.y,v.z),h.push(i/f,1-r/d)}for(r=0;r<d;r++)for(i=0;i<f;i++)a.push(i+1+(r+1)*(f+1)),a.push(i+1+r*(f+1)),a.push(i+r*(f+1)),a.push(i+(r+1)*(f+1)),a.push(i+1+(r+1)*(f+1)),a.push(i+r*(f+1));var m=new s;return m.indices=a,m.positions=n,m.normals=o,m.uvs=h,m},s.CreateTiledGround=function(t){var r,i,a,n,o=void 0!==t.xmin&&null!==t.xmin?t.xmin:-1,h=void 0!==t.zmin&&null!==t.zmin?t.zmin:-1,u=void 0!==t.xmax&&null!==t.xmax?t.xmax:1,c=void 0!==t.zmax&&null!==t.zmax?t.zmax:1,f=t.subdivisions||{w:1,h:1},d=t.precision||{w:1,h:1},p=new Array,v=new Array,m=new Array,l=new Array;f.h=f.h<1?1:f.h,f.w=f.w<1?1:f.w,d.w=d.w<1?1:d.w,d.h=d.h<1?1:d.h;var V=(u-o)/f.w,x=(c-h)/f.h;function g(t,s,a,n){var o=v.length/3,h=d.w+1;for(r=0;r<d.h;r++)for(i=0;i<d.w;i++){var u=[o+i+r*h,o+(i+1)+r*h,o+(i+1)+(r+1)*h,o+i+(r+1)*h];p.push(u[1]),p.push(u[2]),p.push(u[3]),p.push(u[0]),p.push(u[1]),p.push(u[3])}var c=e.Vector3.Zero(),f=new e.Vector3(0,1,0);for(r=0;r<=d.h;r++)for(c.z=r*(n-s)/d.h+s,i=0;i<=d.w;i++)c.x=i*(a-t)/d.w+t,c.y=0,v.push(c.x,c.y,c.z),m.push(f.x,f.y,f.z),l.push(i/d.w,r/d.h)}for(a=0;a<f.h;a++)for(n=0;n<f.w;n++)g(o+n*V,h+a*x,o+(n+1)*V,h+(a+1)*x);var y=new s;return y.indices=p,y.positions=v,y.normals=m,y.uvs=l,y},s.CreateGroundFromHeightMap=function(t){var r,i,a=[],n=[],o=[],h=[],u=t.colorFilter||new e.Color3(.3,.59,.11),c=t.alphaFilter||0;for(r=0;r<=t.subdivisions;r++)for(i=0;i<=t.subdivisions;i++){var f=new e.Vector3(i*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-r)*t.height/t.subdivisions-t.height/2),d=4*(((f.x+t.width/2)/t.width*(t.bufferWidth-1)|0)+((1-(f.z+t.height/2)/t.height)*(t.bufferHeight-1)|0)*t.bufferWidth),p=t.buffer[d]/255,v=t.buffer[d+1]/255,m=t.buffer[d+2]/255,l=t.buffer[d+3]/255,V=p*u.r+v*u.g+m*u.b;f.y=l>=c?t.minHeight+(t.maxHeight-t.minHeight)*V:t.minHeight-e.Epsilon,n.push(f.x,f.y,f.z),o.push(0,0,0),h.push(i/t.subdivisions,1-r/t.subdivisions)}for(r=0;r<t.subdivisions;r++)for(i=0;i<t.subdivisions;i++){var x=i+1+(r+1)*(t.subdivisions+1),g=i+1+r*(t.subdivisions+1),y=i+r*(t.subdivisions+1),w=i+(r+1)*(t.subdivisions+1),b=n[3*x+1]>=t.minHeight,z=n[3*g+1]>=t.minHeight,D=n[3*y+1]>=t.minHeight;b&&z&&D&&(a.push(x),a.push(g),a.push(y)),n[3*w+1]>=t.minHeight&&b&&D&&(a.push(w),a.push(x),a.push(y))}s.ComputeNormals(n,a,o);var E=new s;return E.indices=a,E.positions=n,E.normals=o,E.uvs=h,E},s.CreatePlane=function(e){var t=[],r=[],i=[],a=[],n=e.width||e.size||1,o=e.height||e.size||1,h=0===e.sideOrientation?0:e.sideOrientation||s.DEFAULTSIDE,u=n/2,c=o/2;r.push(-u,-c,0),i.push(0,0,-1),a.push(0,0),r.push(u,-c,0),i.push(0,0,-1),a.push(1,0),r.push(u,c,0),i.push(0,0,-1),a.push(1,1),r.push(-u,c,0),i.push(0,0,-1),a.push(0,1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),s._ComputeSides(h,r,t,i,a,e.frontUVs,e.backUVs);var f=new s;return f.indices=t,f.positions=r,f.normals=i,f.uvs=a,f},s.CreateDisc=function(e){var t=new Array,r=new Array,i=new Array,a=new Array,n=e.radius||.5,o=e.tessellation||64,h=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,u=0===e.sideOrientation?0:e.sideOrientation||s.DEFAULTSIDE;t.push(0,0,0),a.push(.5,.5);for(var c=2*Math.PI*h,f=c/o,d=0;d<c;d+=f){var p=Math.cos(d),v=Math.sin(d),m=(p+1)/2,l=(1-v)/2;t.push(n*p,n*v,0),a.push(m,l)}1===h&&(t.push(t[3],t[4],t[5]),a.push(a[2],a[3]));for(var V=t.length/3,x=1;x<V-1;x++)r.push(x+1,0,x);s.ComputeNormals(t,r,i),s._ComputeSides(u,t,r,i,a,e.frontUVs,e.backUVs);var g=new s;return g.indices=r,g.positions=t,g.normals=i,g.uvs=a,g},s.CreatePolygon=function(r,i,a,n,o,h){for(var u=a||new Array(3),c=n,f=[],d=0;d<3;d++)void 0===u[d]&&(u[d]=new e.Vector4(0,0,1,1)),c&&void 0===c[d]&&(c[d]=new e.Color4(1,1,1,1));for(var p=r.getVerticesData(t.VertexBuffer.PositionKind),v=r.getVerticesData(t.VertexBuffer.NormalKind),m=r.getVerticesData(t.VertexBuffer.UVKind),l=r.getIndices(),V=0,x=0,g=0;g<v.length;g+=3)Math.abs(v[g+1])<.001&&(x=1),Math.abs(v[g+1]-1)<.001&&(x=0),Math.abs(v[g+1]+1)<.001&&(x=2),m[2*(V=g/3)]=(1-m[2*V])*u[x].x+m[2*V]*u[x].z,m[2*V+1]=(1-m[2*V+1])*u[x].y+m[2*V+1]*u[x].w,c&&f.push(c[x].r,c[x].g,c[x].b,c[x].a);s._ComputeSides(i,p,l,v,m,o,h);var y=new s;if(y.indices=l,y.positions=p,y.normals=v,y.uvs=m,c){var w=i===s.DOUBLESIDE?f.concat(f):f;y.colors=w}return y},s.CreateIcoSphere=function(t){var r,i=t.sideOrientation||s.DEFAULTSIDE,a=t.radius||1,n=void 0===t.flat||t.flat,o=t.subdivisions||4,h=t.radiusX||a,u=t.radiusY||a,c=t.radiusZ||a,f=(1+Math.sqrt(5))/2,d=[-1,f,-0,1,f,0,-1,-f,0,1,-f,0,0,-1,-f,0,1,-f,0,-1,f,0,1,f,f,0,1,f,0,-1,-f,0,1,-f,0,-1],p=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],v=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],m=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],l=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],V=new Array,x=new Array,g=new Array,y=new Array,w=0,b=new Array(3),z=new Array(3);for(r=0;r<3;r++)b[r]=e.Vector3.Zero(),z[r]=e.Vector2.Zero();for(var D=0;D<20;D++){for(r=0;r<3;r++){var E=p[3*D+r];b[r].copyFromFloats(d[3*v[E]],d[3*v[E]+1],d[3*v[E]+2]),b[r].normalize().scaleInPlace(a),z[r].copyFromFloats(m[2*E]*(138/1024)+60/1024+l[D]*(-40/1024),m[2*E+1]*(239/1024)+26/1024+l[D]*(20/1024))}for(var B=function(t,s,r,i){var a,f=e.Vector3.Lerp(b[0],b[2],s/o),d=e.Vector3.Lerp(b[1],b[2],s/o),p=o===s?b[2]:e.Vector3.Lerp(f,d,t/(o-s));if(p.normalize(),n){var v=e.Vector3.Lerp(b[0],b[2],i/o),m=e.Vector3.Lerp(b[1],b[2],i/o);a=e.Vector3.Lerp(v,m,r/(o-i))}else a=new e.Vector3(p.x,p.y,p.z);a.x/=h,a.y/=u,a.z/=c,a.normalize();var l=e.Vector2.Lerp(z[0],z[2],s/o),D=e.Vector2.Lerp(z[1],z[2],s/o),E=o===s?z[2]:e.Vector2.Lerp(l,D,t/(o-s));x.push(p.x*h,p.y*u,p.z*c),g.push(a.x,a.y,a.z),y.push(E.x,E.y),V.push(w),w++},K=0;K<o;K++)for(var I=0;I+K<o;I++)B(I,K,I+1/3,K+1/3),B(I+1,K,I+1/3,K+1/3),B(I,K+1,I+1/3,K+1/3),I+K+1<o&&(B(I+1,K,I+2/3,K+2/3),B(I+1,K+1,I+2/3,K+2/3),B(I,K+1,I+2/3,K+2/3))}s._ComputeSides(i,x,V,g,y,t.frontUVs,t.backUVs);var M=new s;return M.indices=V,M.positions=x,M.normals=g,M.uvs=y,M},s.CreatePolyhedron=function(t){var r=[];r[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},r[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},r[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},r[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},r[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},r[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},r[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},r[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},r[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},r[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},r[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},r[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},r[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},r[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},r[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var i,a,n,o,h,u,c=t.type&&(t.type<0||t.type>=r.length)?0:t.type||0,f=t.size,d=t.sizeX||f||1,p=t.sizeY||f||1,v=t.sizeZ||f||1,m=t.custom||r[c],l=m.face.length,V=t.faceUV||new Array(l),x=t.faceColors,g=void 0===t.flat||t.flat,y=0===t.sideOrientation?0:t.sideOrientation||s.DEFAULTSIDE,w=new Array,b=new Array,z=new Array,D=new Array,E=new Array,B=0,K=0,I=new Array,M=0,U=0;if(g)for(U=0;U<l;U++)x&&void 0===x[U]&&(x[U]=new e.Color4(1,1,1,1)),V&&void 0===V[U]&&(V[U]=new e.Vector4(0,0,1,1));if(g)for(U=0;U<l;U++){var A=m.face[U].length;for(n=2*Math.PI/A,o=.5*Math.tan(n/2),h=.5,M=0;M<A;M++)w.push(m.vertex[m.face[U][M]][0]*d,m.vertex[m.face[U][M]][1]*p,m.vertex[m.face[U][M]][2]*v),I.push(B),B++,i=V[U].x+(V[U].z-V[U].x)*(.5+o),a=V[U].y+(V[U].w-V[U].y)*(h-.5),D.push(i,a),u=o*Math.cos(n)-h*Math.sin(n),h=o*Math.sin(n)+h*Math.cos(n),o=u,x&&E.push(x[U].r,x[U].g,x[U].b,x[U].a);for(M=0;M<A-2;M++)b.push(I[0+K],I[M+2+K],I[M+1+K]);K+=A}else{for(M=0;M<m.vertex.length;M++)w.push(m.vertex[M][0]*d,m.vertex[M][1]*p,m.vertex[M][2]*v),D.push(0,0);for(U=0;U<l;U++)for(M=0;M<m.face[U].length-2;M++)b.push(m.face[U][0],m.face[U][M+2],m.face[U][M+1])}s.ComputeNormals(w,b,z),s._ComputeSides(y,w,b,z,D,t.frontUVs,t.backUVs);var P=new s;return P.positions=w,P.indices=b,P.normals=z,P.uvs=D,x&&g&&(P.colors=E),P},s.CreateTorusKnot=function(t){var r,i,a=new Array,n=new Array,o=new Array,h=new Array,u=t.radius||2,c=t.tube||.5,f=t.radialSegments||32,d=t.tubularSegments||32,p=t.p||2,v=t.q||3,m=0===t.sideOrientation?0:t.sideOrientation||s.DEFAULTSIDE,l=function(t){var s=Math.cos(t),r=Math.sin(t),i=v/p*t,a=Math.cos(i),n=u*(2+a)*.5*s,o=u*(2+a)*r*.5,h=u*Math.sin(i)*.5;return new e.Vector3(n,o,h)};for(r=0;r<=f;r++){var V=r%f/f*2*p*Math.PI,x=l(V),g=l(V+.01),y=g.subtract(x),w=g.add(x),b=e.Vector3.Cross(y,w);for(w=e.Vector3.Cross(b,y),b.normalize(),w.normalize(),i=0;i<d;i++){var z=i%d/d*2*Math.PI,D=-c*Math.cos(z),E=c*Math.sin(z);n.push(x.x+D*w.x+E*b.x),n.push(x.y+D*w.y+E*b.y),n.push(x.z+D*w.z+E*b.z),h.push(r/f),h.push(i/d)}}for(r=0;r<f;r++)for(i=0;i<d;i++){var B=(i+1)%d,K=r*d+i,I=(r+1)*d+i,M=(r+1)*d+B,U=r*d+B;a.push(U),a.push(I),a.push(K),a.push(U),a.push(M),a.push(I)}s.ComputeNormals(n,a,o),s._ComputeSides(m,n,a,o,h,t.frontUVs,t.backUVs);var A=new s;return A.indices=a,A.positions=n,A.normals=o,A.uvs=h,A},s.ComputeNormals=function(t,s,r,i){var a=0,n=0,o=0,h=0,u=0,c=0,f=0,d=0,p=0,v=0,m=0,l=0,V=0,x=0,g=0,y=0,w=0,b=0,z=0,D=0,E=!1,B=!1,K=!1,I=!1,M=1,U=0,A=null;if(i&&(E=!!i.facetNormals,B=!!i.facetPositions,K=!!i.facetPartitioning,M=!0===i.useRightHandedSystem?-1:1,U=i.ratio||0,I=!!i.depthSort,A=i.distanceTo,I)){void 0===A&&(A=e.Vector3.Zero());var P=i.depthSortedFacets}var C=0,S=0,T=0,W=0;if(K&&i&&i.bbSize){var _=0,F=0,L=0,k=0,O=0,N=0,Z=0,R=0,H=0,q=0,Y=0,G=0,X=0,j=0,J=0,Q=0,$=i.bbSize.x>i.bbSize.y?i.bbSize.x:i.bbSize.y;$=$>i.bbSize.z?$:i.bbSize.z,C=i.subDiv.X*U/i.bbSize.x,S=i.subDiv.Y*U/i.bbSize.y,T=i.subDiv.Z*U/i.bbSize.z,W=i.subDiv.max*i.subDiv.max,i.facetPartitioning.length=0}for(a=0;a<t.length;a++)r[a]=0;var ee=s.length/3|0;for(a=0;a<ee;a++){if(V=(l=3*s[3*a])+1,x=l+2,y=(g=3*s[3*a+1])+1,w=g+2,z=(b=3*s[3*a+2])+1,D=b+2,n=t[l]-t[g],o=t[V]-t[y],h=t[x]-t[w],u=t[b]-t[g],c=t[z]-t[y],d=M*(o*(f=t[D]-t[w])-h*c),p=M*(h*u-n*f),v=M*(n*c-o*u),d/=m=0===(m=Math.sqrt(d*d+p*p+v*v))?1:m,p/=m,v/=m,E&&i&&(i.facetNormals[a].x=d,i.facetNormals[a].y=p,i.facetNormals[a].z=v),B&&i&&(i.facetPositions[a].x=(t[l]+t[g]+t[b])/3,i.facetPositions[a].y=(t[V]+t[y]+t[z])/3,i.facetPositions[a].z=(t[x]+t[w]+t[D])/3),K&&i&&(_=Math.floor((i.facetPositions[a].x-i.bInfo.minimum.x*U)*C),F=Math.floor((i.facetPositions[a].y-i.bInfo.minimum.y*U)*S),L=Math.floor((i.facetPositions[a].z-i.bInfo.minimum.z*U)*T),k=Math.floor((t[l]-i.bInfo.minimum.x*U)*C),O=Math.floor((t[V]-i.bInfo.minimum.y*U)*S),N=Math.floor((t[x]-i.bInfo.minimum.z*U)*T),Z=Math.floor((t[g]-i.bInfo.minimum.x*U)*C),R=Math.floor((t[y]-i.bInfo.minimum.y*U)*S),H=Math.floor((t[w]-i.bInfo.minimum.z*U)*T),q=Math.floor((t[b]-i.bInfo.minimum.x*U)*C),Y=Math.floor((t[z]-i.bInfo.minimum.y*U)*S),G=Math.floor((t[D]-i.bInfo.minimum.z*U)*T),j=k+i.subDiv.max*O+W*N,J=Z+i.subDiv.max*R+W*H,Q=q+i.subDiv.max*Y+W*G,X=_+i.subDiv.max*F+W*L,i.facetPartitioning[X]=i.facetPartitioning[X]?i.facetPartitioning[X]:new Array,i.facetPartitioning[j]=i.facetPartitioning[j]?i.facetPartitioning[j]:new Array,i.facetPartitioning[J]=i.facetPartitioning[J]?i.facetPartitioning[J]:new Array,i.facetPartitioning[Q]=i.facetPartitioning[Q]?i.facetPartitioning[Q]:new Array,i.facetPartitioning[j].push(a),J!=j&&i.facetPartitioning[J].push(a),Q!=J&&Q!=j&&i.facetPartitioning[Q].push(a),X!=j&&X!=J&&X!=Q&&i.facetPartitioning[X].push(a)),I&&i&&i.facetPositions){var te=P[a];te.ind=3*a,te.sqDistance=e.Vector3.DistanceSquared(i.facetPositions[a],A)}r[l]+=d,r[V]+=p,r[x]+=v,r[g]+=d,r[y]+=p,r[w]+=v,r[b]+=d,r[z]+=p,r[D]+=v}for(a=0;a<r.length/3;a++)d=r[3*a],p=r[3*a+1],v=r[3*a+2],d/=m=0===(m=Math.sqrt(d*d+p*p+v*v))?1:m,p/=m,v/=m,r[3*a]=d,r[3*a+1]=p,r[3*a+2]=v},s._ComputeSides=function(t,r,i,a,n,o,h){var u,c,f=i.length,d=a.length;switch(t=t||s.DEFAULTSIDE){case s.FRONTSIDE:break;case s.BACKSIDE:var p;for(u=0;u<f;u+=3)p=i[u],i[u]=i[u+2],i[u+2]=p;for(c=0;c<d;c++)a[c]=-a[c];break;case s.DOUBLESIDE:for(var v=r.length,m=v/3,l=0;l<v;l++)r[v+l]=r[l];for(u=0;u<f;u+=3)i[u+f]=i[u+2]+m,i[u+1+f]=i[u+1]+m,i[u+2+f]=i[u]+m;for(c=0;c<d;c++)a[d+c]=-a[c];var V=n.length,x=0;for(x=0;x<V;x++)n[x+V]=n[x];for(o=o||new e.Vector4(0,0,1,1),h=h||new e.Vector4(0,0,1,1),x=0,u=0;u<V/2;u++)n[x]=o.x+(o.z-o.x)*n[x],n[x+1]=o.y+(o.w-o.y)*n[x+1],n[x+V]=h.x+(h.z-h.x)*n[x+V],n[x+V+1]=h.y+(h.w-h.y)*n[x+V+1],x+=2}},s.ImportVertexData=function(r,i){var a=new s,n=r.positions;n&&a.set(n,t.VertexBuffer.PositionKind);var o=r.normals;o&&a.set(o,t.VertexBuffer.NormalKind);var h=r.tangents;h&&a.set(h,t.VertexBuffer.TangentKind);var u=r.uvs;u&&a.set(u,t.VertexBuffer.UVKind);var c=r.uv2s;c&&a.set(c,t.VertexBuffer.UV2Kind);var f=r.uv3s;f&&a.set(f,t.VertexBuffer.UV3Kind);var d=r.uv4s;d&&a.set(d,t.VertexBuffer.UV4Kind);var p=r.uv5s;p&&a.set(p,t.VertexBuffer.UV5Kind);var v=r.uv6s;v&&a.set(v,t.VertexBuffer.UV6Kind);var m=r.colors;m&&a.set(e.Color4.CheckColors4(m,n.length/3),t.VertexBuffer.ColorKind);var l=r.matricesIndices;l&&a.set(l,t.VertexBuffer.MatricesIndicesKind);var V=r.matricesWeights;V&&a.set(V,t.VertexBuffer.MatricesWeightsKind);var x=r.indices;x&&(a.indices=x),i.setAllVerticesData(a,r.updatable)},s.FRONTSIDE=0,s.BACKSIDE=1,s.DOUBLESIDE=2,s.DEFAULTSIDE=0,s}();exports.VertexData=s;
},{"../Maths/math":"Iizi","../Meshes/buffer":"YHhW"}],"P+He":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Node=void 0;var e=o(require("tslib")),t=require("./Maths/math"),i=require("./Misc/decorators"),n=require("./Misc/observable"),r=require("./Engines/engineStore");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};n.get||n.set?Object.defineProperty(t,i,n):t[i]=e[i]}return t.default=e,t}var s=function(){function o(e,i,o){void 0===i&&(i=null),void 0===o&&(o=!0),this.state="",this.metadata=null,this.reservedDataStore=null,this.doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this._childRenderId=-1,this._worldMatrix=t.Matrix.Identity(),this._worldMatrixDeterminant=0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new n.Observable,this._behaviors=new Array,this.name=e,this.id=e,this._scene=i||r.EngineStore.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),o&&this.addToSceneRootNodes()}return o.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},o.Construct=function(e,t,i,n){var r=this._NodeConstructors[e];return r?r(t,i,n):null},o.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(o.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var i=this._parentNode._children.indexOf(this);-1!==i&&this._parentNode._children.splice(i,1),e||this._isDisposed||this.addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this.removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),o.prototype.addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},o.prototype.removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[this._sceneRootNodesIndex]=e[t],e[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(o.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),o.prototype.getClassName=function(){return"Node"},Object.defineProperty(o.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),o.prototype.getScene=function(){return this._scene},o.prototype.getEngine=function(){return this._scene.getEngine()},o.prototype.addBehavior=function(e,t){var i=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)?this:(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(function(){e.attach(i)}):e.attach(this),this._behaviors.push(e),this)},o.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)},Object.defineProperty(o.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),o.prototype.getBehaviorByName=function(e){for(var t=0,i=this._behaviors;t<i.length;t++){var n=i[t];if(n.name===e)return n}return null},o.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},o.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminant},Object.defineProperty(o.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),o.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},o.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},o.prototype._updateCache=function(e){},o.prototype._isSynchronized=function(){return!0},o.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentRenderId=this._parentNode._childRenderId)},o.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentRenderId===this._parentNode._childRenderId&&this._parentNode.isSynchronized()},o.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},o.prototype.isReady=function(e){return void 0===e&&(e=!1),this._isReady},o.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},o.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(e){e._syncParentEnabledState()})},o.prototype.setEnabled=function(e){this._isEnabled=e,this._syncParentEnabledState()},o.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},o.prototype._getDescendants=function(e,t,i){if(void 0===t&&(t=!1),this._children)for(var n=0;n<this._children.length;n++){var r=this._children[n];i&&!i(r)||e.push(r),t||r._getDescendants(e,!1,i)}},o.prototype.getDescendants=function(e,t){var i=new Array;return this._getDescendants(i,e,t),i},o.prototype.getChildMeshes=function(e,t){var i=[];return this._getDescendants(i,e,function(e){return(!t||t(e))&&void 0!==e.cullingStrategy}),i},o.prototype.getChildren=function(e,t){return void 0===t&&(t=!0),this.getDescendants(t,e)},o.prototype._setReady=function(e){e!==this._isReady&&(e?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},o.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var i=this.animations[t];if(i.name===e)return i}return null},o.prototype.createAnimationRange=function(e,t,i){if(!this._ranges[e]){this._ranges[e]=o._AnimationRangeFactory(e,t,i);for(var n=0,r=this.animations.length;n<r;n++)this.animations[n]&&this.animations[n].createRange(e,t,i)}},o.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,n=this.animations.length;i<n;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null},o.prototype.getAnimationRange=function(e){return this._ranges[e]},o.prototype.beginAnimation=function(e,t,i,n){var r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,i,n):null},o.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var i=this._ranges[t];if(i){var n={};n.name=t,n.from=i.from,n.to=i.to,e.push(n)}}return e},o.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=t.Matrix.Identity()),this._worldMatrix},o.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this._isDisposed=!0,!e)for(var i=0,n=this.getDescendants(!0);i<n.length;i++){n[i].dispose(e,t)}this.parent?this.parent=null:this.removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var r=0,o=this._behaviors;r<o.length;r++){o[r].detach()}this._behaviors=[]},o.ParseAnimationRanges=function(e,t,i){if(t.ranges)for(var n=0;n<t.ranges.length;n++){var r=t.ranges[n];e.createAnimationRange(r.name,r.from,r.to)}},o._AnimationRangeFactory=function(e,t,i){throw"AnimationRange needs to be imported from animation before being created."},o._NodeConstructors={},e.__decorate([(0,i.serialize)()],o.prototype,"name",void 0),e.__decorate([(0,i.serialize)()],o.prototype,"id",void 0),e.__decorate([(0,i.serialize)()],o.prototype,"uniqueId",void 0),e.__decorate([(0,i.serialize)()],o.prototype,"state",void 0),e.__decorate([(0,i.serialize)()],o.prototype,"metadata",void 0),o}();exports.Node=s;
},{"tslib":"vCxL","./Maths/math":"Iizi","./Misc/decorators":"knvU","./Misc/observable":"gtkL","./Engines/engineStore":"n+VE"}],"XiAM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TransformNode=void 0;var t=a(require("tslib")),i=require("../Misc/decorators"),o=require("../Misc/tags"),r=require("../Misc/observable"),e=require("../Maths/math"),n=require("../node");function a(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,o):{};r.get||r.set?Object.defineProperty(i,o,r):i[o]=t[o]}return i.default=t,i}var s=function(n){function a(t,i,o){void 0===i&&(i=null),void 0===o&&(o=!0);var s=n.call(this,t,i)||this;return s._forward=new e.Vector3(0,0,1),s._forwardInverted=new e.Vector3(0,0,-1),s._up=new e.Vector3(0,1,0),s._right=new e.Vector3(1,0,0),s._rightInverted=new e.Vector3(-1,0,0),s._position=e.Vector3.Zero(),s._rotation=e.Vector3.Zero(),s._scaling=e.Vector3.One(),s._isDirty=!1,s.billboardMode=a.BILLBOARDMODE_NONE,s.scalingDeterminant=1,s.infiniteDistance=!1,s.ignoreNonUniformScaling=!1,s._localMatrix=e.Matrix.Zero(),s._absolutePosition=e.Vector3.Zero(),s._pivotMatrix=e.Matrix.Identity(),s._postMultiplyPivotMatrix=!1,s._isWorldMatrixFrozen=!1,s._indexInSceneTransformNodesArray=-1,s.onAfterWorldMatrixUpdateObservable=new r.Observable,s._nonUniformScaling=!1,o&&s.getScene().addTransformNode(s),s}return t.__extends(a,n),a.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(a.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaling",{get:function(){return this._scaling},set:function(t){this._scaling=t,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(t){this._rotationQuaternion=t,t&&this.rotation.setAll(0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"forward",{get:function(){return e.Vector3.Normalize(e.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"up",{get:function(){return e.Vector3.Normalize(e.Vector3.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"right",{get:function(){return e.Vector3.Normalize(e.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),a.prototype.updatePoseMatrix=function(t){return this._poseMatrix.copyFrom(t),this},a.prototype.getPoseMatrix=function(){return this._poseMatrix},a.prototype._isSynchronized=function(){return!this._isDirty&&(this.billboardMode===this._cache.billboardMode&&this.billboardMode===a.BILLBOARDMODE_NONE&&(!this._cache.pivotMatrixUpdated&&(!this.infiniteDistance&&(!!this._cache.position.equals(this._position)&&(!(this._rotationQuaternion&&!this._cache.rotationQuaternion.equals(this._rotationQuaternion))&&(!!this._cache.rotation.equals(this._rotation)&&!!this._cache.scaling.equals(this._scaling)))))))},a.prototype._initCache=function(){n.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0),this._cache.billboardMode=-1,this._cache.infiniteDistance=!1},a.prototype.markAsDirty=function(t){return"rotation"===t&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(a.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),a.prototype.setPreTransformMatrix=function(t){return this.setPivotMatrix(t,!1)},a.prototype.setPivotMatrix=function(t,i){return void 0===i&&(i=!0),this._pivotMatrix.copyFrom(t),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=e.Matrix.Invert(this._pivotMatrix)),this},a.prototype.getPivotMatrix=function(){return this._pivotMatrix},a.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},a.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(a.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),a.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},a.prototype.setAbsolutePosition=function(t){if(!t)return this;var i,o,r;if(void 0===t.x){if(arguments.length<3)return this;i=arguments[0],o=arguments[1],r=arguments[2]}else i=t.x,o=t.y,r=t.z;if(this.parent){var n=e.Tmp.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),e.Vector3.TransformCoordinatesFromFloatsToRef(i,o,r,n,this.position)}else this.position.x=i,this.position.y=o,this.position.z=r;return this},a.prototype.setPositionWithLocalVector=function(t){return this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localMatrix),this},a.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=e.Tmp.Matrix[0];return this._localMatrix.invertToRef(t),e.Vector3.TransformNormal(this.position,t)},a.prototype.locallyTranslate=function(t){return this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localMatrix),this},a.prototype.lookAt=function(t,i,o,r,n){void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===n&&(n=e.Space.LOCAL);var s=a._lookAtVectorCache,l=n===e.Space.LOCAL?this.position:this.getAbsolutePosition();if(t.subtractToRef(l,s),this.setDirection(s,i,o,r),n===e.Space.WORLD&&this.parent)if(this.rotationQuaternion){var p=e.Tmp.Matrix[0];this.rotationQuaternion.toRotationMatrix(p);var h=e.Tmp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),p.multiplyToRef(h,p),this.rotationQuaternion.fromRotationMatrix(p)}else{var c=e.Tmp.Quaternion[0];e.Quaternion.FromEulerVectorToRef(this.rotation,c);p=e.Tmp.Matrix[0];c.toRotationMatrix(p);h=e.Tmp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),p.multiplyToRef(h,p),c.fromRotationMatrix(p),c.toEulerAnglesToRef(this.rotation)}return this},a.prototype.getDirection=function(t){var i=e.Vector3.Zero();return this.getDirectionToRef(t,i),i},a.prototype.getDirectionToRef=function(t,i){return e.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),i),this},a.prototype.setDirection=function(t,i,o,r){void 0===i&&(i=0),void 0===o&&(o=0),void 0===r&&(r=0);var n=-Math.atan2(t.z,t.x)+Math.PI/2,a=Math.sqrt(t.x*t.x+t.z*t.z),s=-Math.atan2(t.y,a);return this.rotationQuaternion?e.Quaternion.RotationYawPitchRollToRef(n+i,s+o,r,this.rotationQuaternion):(this.rotation.x=s+o,this.rotation.y=n+i,this.rotation.z=r),this},a.prototype.setPivotPoint=function(t,i){void 0===i&&(i=e.Space.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var o=this.getWorldMatrix();if(i==e.Space.WORLD){var r=e.Tmp.Matrix[0];o.invertToRef(r),t=e.Vector3.TransformCoordinates(t,r)}return this.setPivotMatrix(e.Matrix.Translation(-t.x,-t.y,-t.z),!0)},a.prototype.getPivotPoint=function(){var t=e.Vector3.Zero();return this.getPivotPointToRef(t),t},a.prototype.getPivotPointToRef=function(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this},a.prototype.getAbsolutePivotPoint=function(){var t=e.Vector3.Zero();return this.getAbsolutePivotPointToRef(t),t},a.prototype.getAbsolutePivotPointToRef=function(t){return t.x=this._pivotMatrix.m[12],t.y=this._pivotMatrix.m[13],t.z=this._pivotMatrix.m[14],this.getPivotPointToRef(t),e.Vector3.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this},a.prototype.setParent=function(t){if(!t&&!this.parent)return this;var i=e.Tmp.Quaternion[0],o=e.Tmp.Vector3[0],r=e.Tmp.Vector3[1];if(t){var n=e.Tmp.Matrix[0],a=e.Tmp.Matrix[1];this.computeWorldMatrix(!0),t.computeWorldMatrix(!0),t.getWorldMatrix().invertToRef(a),this.getWorldMatrix().multiplyToRef(a,n),n.decompose(r,i,o)}else this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(r,i,o);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(r),this.position.copyFrom(o),this.parent=t,this},Object.defineProperty(a.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),a.prototype._updateNonUniformScalingState=function(t){return this._nonUniformScaling!==t&&(this._nonUniformScaling=t,!0)},a.prototype.attachToBone=function(t,i){return this._transformToBoneReferal=i,this.parent=t,t.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},a.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},a.prototype.rotate=function(t,i,o){var r;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),o&&o!==e.Space.LOCAL){if(this.parent){var n=e.Tmp.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),t=e.Vector3.TransformNormal(t,n)}(r=e.Quaternion.RotationAxisToRef(t,i,a._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else r=e.Quaternion.RotationAxisToRef(t,i,a._rotationAxisCache),this.rotationQuaternion.multiplyToRef(r,this.rotationQuaternion);return this},a.prototype.rotateAround=function(t,i,o){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var r=e.Tmp.Vector3[0],n=e.Tmp.Vector3[1],a=e.Tmp.Vector3[2],s=e.Tmp.Quaternion[0],l=e.Tmp.Matrix[0],p=e.Tmp.Matrix[1],h=e.Tmp.Matrix[2],c=e.Tmp.Matrix[3];return t.subtractToRef(this.position,r),e.Matrix.TranslationToRef(r.x,r.y,r.z,l),e.Matrix.TranslationToRef(-r.x,-r.y,-r.z,p),e.Matrix.RotationAxisToRef(i,o,h),p.multiplyToRef(h,c),c.multiplyToRef(l,c),c.decompose(n,s,a),this.position.addInPlace(a),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},a.prototype.translate=function(t,i,o){var r=t.scale(i);if(o&&o!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{var n=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(n)}return this},a.prototype.addRotation=function(t,i,o){var r;this.rotationQuaternion?r=this.rotationQuaternion:(r=e.Tmp.Quaternion[1],e.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));var n=e.Tmp.Quaternion[0];return e.Quaternion.RotationYawPitchRollToRef(i,t,o,n),r.multiplyInPlace(n),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this},a.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&this.isSynchronized())return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;(this._updateCache(),this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._cache.infiniteDistance=this.infiniteDistance,this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,e.Tmp.Matrix[1]),this.rotationQuaternion)&&(this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0)));this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(e.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,e.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation));var i=this.getScene().activeCamera;if(this.infiniteDistance&&!this.parent&&i){var o=i.getWorldMatrix(),r=new e.Vector3(o.m[12],o.m[13],o.m[14]);e.Matrix.TranslationToRef(this.position.x+r.x,this.position.y+r.y,this.position.z+r.z,e.Tmp.Matrix[2])}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,e.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(e.Tmp.Matrix[1],e.Tmp.Matrix[4]),e.Tmp.Matrix[4].multiplyToRef(e.Tmp.Matrix[0],e.Tmp.Matrix[5]),this.billboardMode!==a.BILLBOARDMODE_NONE&&i){if((this.billboardMode&a.BILLBOARDMODE_ALL)!==a.BILLBOARDMODE_ALL){var n=e.Tmp.Vector3[3];this.parent&&this.parent.getWorldMatrix?this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),e.Tmp.Matrix[6]),e.Vector3.TransformCoordinatesToRef(this.position,e.Tmp.Matrix[6],n)):e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),n):n.copyFrom(this.position),n.subtractInPlace(i.globalPosition);var s=e.Tmp.Vector3[4].copyFromFloats(0,0,0);(this.billboardMode&a.BILLBOARDMODE_X)===a.BILLBOARDMODE_X&&(s.x=Math.atan2(-n.y,n.z)),(this.billboardMode&a.BILLBOARDMODE_Y)===a.BILLBOARDMODE_Y&&(s.y=Math.atan2(n.x,n.z)),(this.billboardMode&a.BILLBOARDMODE_Z)===a.BILLBOARDMODE_Z&&(s.z=Math.atan2(n.y,n.x)),e.Matrix.RotationYawPitchRollToRef(s.y,s.x,s.z,e.Tmp.Matrix[0])}else e.Tmp.Matrix[1].copyFrom(i.getViewMatrix()),e.Tmp.Matrix[1].setTranslationFromFloats(0,0,0),e.Tmp.Matrix[1].invertToRef(e.Tmp.Matrix[0]);e.Tmp.Matrix[1].copyFrom(e.Tmp.Matrix[5]),e.Tmp.Matrix[1].multiplyToRef(e.Tmp.Matrix[0],e.Tmp.Matrix[5])}return this._postMultiplyPivotMatrix&&e.Tmp.Matrix[5].multiplyToRef(this._pivotMatrixInverse,e.Tmp.Matrix[5]),e.Tmp.Matrix[5].multiplyToRef(e.Tmp.Matrix[2],this._localMatrix),this.parent&&this.parent.getWorldMatrix?(this.billboardMode!==a.BILLBOARDMODE_NONE?(this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),e.Tmp.Matrix[6]),e.Tmp.Matrix[5].copyFrom(e.Tmp.Matrix[6])):e.Tmp.Matrix[5].copyFrom(this.parent.getWorldMatrix()),this._localMatrix.getTranslationToRef(e.Tmp.Vector3[5]),e.Vector3.TransformCoordinatesToRef(e.Tmp.Vector3[5],e.Tmp.Matrix[5],e.Tmp.Vector3[5]),this._worldMatrix.copyFrom(this._localMatrix),this._worldMatrix.setTranslation(e.Tmp.Vector3[5])):this._transformToBoneReferal?(this._localMatrix.multiplyToRef(this.parent.getWorldMatrix(),e.Tmp.Matrix[6]),e.Tmp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localMatrix),this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this.scaling.isNonUniform?this._updateNonUniformScalingState(!0):this.parent&&this.parent._nonUniformScaling?this._updateNonUniformScalingState(this.parent._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=e.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix},a.prototype._afterComputeWorldMatrix=function(){},a.prototype.registerAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this},a.prototype.unregisterAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this},a.prototype.getPositionInCameraSpace=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},a.prototype.getDistanceToCamera=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),this.absolutePosition.subtract(t.position).length()},a.prototype.clone=function(t,o,r){var e=this,n=i.SerializationHelper.Clone(function(){return new a(t,e.getScene())},this);if(n.name=t,n.id=t,o&&(n.parent=o),!r)for(var s=this.getDescendants(!0),l=0;l<s.length;l++){var p=s[l];p.clone&&p.clone(t+"."+p.name,n)}return n},a.prototype.serialize=function(t){var r=i.SerializationHelper.Serialize(this,t);return r.type=this.getClassName(),this.parent&&(r.parentId=this.parent.id),o.Tags&&o.Tags.HasTags(this)&&(r.tags=o.Tags.GetTags(this)),r.localMatrix=this.getPivotMatrix().asArray(),r.isEnabled=this.isEnabled(),this.parent&&(r.parentId=this.parent.id),r},a.Parse=function(t,r,n){var s=i.SerializationHelper.Parse(function(){return new a(t.name,r)},t,r,n);return o.Tags&&o.Tags.AddTagsTo(s,t.tags),t.localMatrix?s.setPreTransformMatrix(e.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&s.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),s.setEnabled(t.isEnabled),t.parentId&&(s._waitingParentId=t.parentId),s},a.prototype.getChildTransformNodes=function(t,i){var o=[];return this._getDescendants(o,t,function(t){return(!i||i(t))&&t instanceof a}),o},a.prototype.dispose=function(t,i){if(void 0===i&&(i=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var o=0,r=this.getChildTransformNodes(!0);o<r.length;o++){var e=r[o];e.parent=null,e.computeWorldMatrix(!0)}n.prototype.dispose.call(this,t,i)},a.BILLBOARDMODE_NONE=0,a.BILLBOARDMODE_X=1,a.BILLBOARDMODE_Y=2,a.BILLBOARDMODE_Z=4,a.BILLBOARDMODE_ALL=7,a._lookAtVectorCache=new e.Vector3(0,0,0),a._rotationAxisCache=new e.Quaternion,t.__decorate([(0,i.serializeAsVector3)("position")],a.prototype,"_position",void 0),t.__decorate([(0,i.serializeAsVector3)("rotation")],a.prototype,"_rotation",void 0),t.__decorate([(0,i.serializeAsQuaternion)("rotationQuaternion")],a.prototype,"_rotationQuaternion",void 0),t.__decorate([(0,i.serializeAsVector3)("scaling")],a.prototype,"_scaling",void 0),t.__decorate([(0,i.serialize)()],a.prototype,"billboardMode",void 0),t.__decorate([(0,i.serialize)()],a.prototype,"scalingDeterminant",void 0),t.__decorate([(0,i.serialize)()],a.prototype,"infiniteDistance",void 0),t.__decorate([(0,i.serialize)()],a.prototype,"ignoreNonUniformScaling",void 0),a}(n.Node);exports.TransformNode=s;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Misc/tags":"Ae8d","../Misc/observable":"gtkL","../Maths/math":"Iizi","../node":"P+He"}],"7JHM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PickingInfo=void 0;var e=require("../Maths/math"),t=require("../Meshes/buffer"),r=function(){function r(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return r.prototype.getNormal=function(r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t.VertexBuffer.NormalKind))return null;var s,a=this.pickedMesh.getIndices();if(!a)return null;if(i){var c=this.pickedMesh.getVerticesData(t.VertexBuffer.NormalKind),o=e.Vector3.FromArray(c,3*a[3*this.faceId]),h=e.Vector3.FromArray(c,3*a[3*this.faceId+1]),n=e.Vector3.FromArray(c,3*a[3*this.faceId+2]);o=o.scale(this.bu),h=h.scale(this.bv),n=n.scale(1-this.bu-this.bv),s=new e.Vector3(o.x+h.x+n.x,o.y+h.y+n.y,o.z+h.z+n.z)}else{var u=this.pickedMesh.getVerticesData(t.VertexBuffer.PositionKind),d=e.Vector3.FromArray(u,3*a[3*this.faceId]),f=e.Vector3.FromArray(u,3*a[3*this.faceId+1]),l=e.Vector3.FromArray(u,3*a[3*this.faceId+2]),p=d.subtract(f),V=l.subtract(f);s=e.Vector3.Cross(p,V)}if(r){var m=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(e.Tmp.Matrix[0].copyFrom(m),(m=e.Tmp.Matrix[0]).setTranslationFromFloats(0,0,0),m.invert(),m.transposeToRef(e.Tmp.Matrix[1]),m=e.Tmp.Matrix[1]),s=e.Vector3.TransformNormal(s,m)}return s.normalize(),s},r.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t.VertexBuffer.UVKind))return null;var r=this.pickedMesh.getIndices();if(!r)return null;var i=this.pickedMesh.getVerticesData(t.VertexBuffer.UVKind);if(!i)return null;var s=e.Vector2.FromArray(i,2*r[3*this.faceId]),a=e.Vector2.FromArray(i,2*r[3*this.faceId+1]),c=e.Vector2.FromArray(i,2*r[3*this.faceId+2]);return s=s.scale(1-this.bu-this.bv),a=a.scale(this.bu),c=c.scale(this.bv),new e.Vector2(s.x+a.x+c.x,s.y+a.y+c.y)},r}();exports.PickingInfo=r;
},{"../Maths/math":"Iizi","../Meshes/buffer":"YHhW"}],"Lnna":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Collider=void 0;var t=require("../Maths/math"),e=function(t,e,o,i){return!(t.x>o.x+i)&&(!(o.x-i>e.x)&&(!(t.y>o.y+i)&&(!(o.y-i>e.y)&&(!(t.z>o.z+i)&&!(o.z-i>e.z)))))},o=function(){var t={root:0,found:!1};return function(e,o,i,s){t.root=0,t.found=!1;var r=o*o-4*e*i;if(r<0)return t;var n=Math.sqrt(r),c=(-o-n)/(2*e),h=(-o+n)/(2*e);if(c>h){var a=h;h=c,c=a}return c>0&&c<s?(t.root=c,t.found=!0,t):h>0&&h<s?(t.root=h,t.found=!0,t):t}}(),i=function(){function i(){this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero(),this._radius=t.Vector3.One(),this._retry=0,this._basePointWorld=t.Vector3.Zero(),this._velocityWorld=t.Vector3.Zero(),this._normalizedVelocity=t.Vector3.Zero(),this._collisionMask=-1}return Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),i.prototype._initialize=function(e,o,i){this._velocity=o,t.Vector3.NormalizeToRef(o,this._normalizedVelocity),this._basePoint=e,e.multiplyToRef(this._radius,this._basePointWorld),o.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return!(n<0)&&(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((n=t.Vector3.Dot(this._tempVector4,r))<0)&&(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(n=t.Vector3.Dot(this._tempVector4,r))>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this._basePointWorld,o),c=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(n>this._velocityWorldLength+c+i)&&!!e(s,r,this._basePointWorld,this._velocityWorldLength+c)},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this._normalizedVelocity,0)){var _=l.signedDistanceTo(this._basePoint),d=t.Vector3.Dot(l.normal,this._velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{var V=(1-_)/d;if((h=(-1-_)/d)>V){var u=V;V=h,h=u}if(h>1||V<0)return;h<0&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var p=!1,P=1;if(a||(this._basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(p=!0,P=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!p){var f=this._velocity.lengthSquared(),m=f;this._basePoint.subtractToRef(s,this._tempVector);var b=2*t.Vector3.Dot(this._velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,T=o(m,b,y,P);T.found&&(P=T.root,p=!0,this._collisionPoint.copyFrom(s)),this._basePoint.subtractToRef(r,this._tempVector),b=2*t.Vector3.Dot(this._velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,(T=o(m,b,y,P)).found&&(P=T.root,p=!0,this._collisionPoint.copyFrom(r)),this._basePoint.subtractToRef(n,this._tempVector),b=2*t.Vector3.Dot(this._velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,(T=o(m,b,y,P)).found&&(P=T.root,p=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this._basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this._velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(m=g*-f+v*v,b=g*(2*t.Vector3.Dot(this._velocity,this._baseToVertex))-2*v*R,y=g*(1-this._baseToVertex.lengthSquared())+R*R,(T=o(m,b,y,P)).found){var D=(v*T.root-R)/g;D>=0&&D<=1&&(P=T.root,p=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this._basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this._velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),m=g*-f+v*v,b=g*(2*t.Vector3.Dot(this._velocity,this._baseToVertex))-2*v*R,y=g*(1-this._baseToVertex.lengthSquared())+R*R,(T=o(m,b,y,P)).found&&(D=(v*T.root-R)/g)>=0&&D<=1&&(P=T.root,p=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint)),s.subtractToRef(n,this._edge),n.subtractToRef(this._basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this._velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),m=g*-f+v*v,b=g*(2*t.Vector3.Dot(this._velocity,this._baseToVertex))-2*v*R,y=g*(1-this._baseToVertex.lengthSquared())+R*R,(T=o(m,b,y,P)).found&&(D=(v*T.root-R)/g)>=0&&D<=1&&(P=T.root,p=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint))}if(p){var x=P*this._velocity.length();(!this.collisionFound||x<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;c<s;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this._nearestDistance/o.length()),this._basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();exports.Collider=i;
},{"../Maths/math":"Iizi"}],"Nnvo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractMesh=void 0;var t=f(require("tslib")),e=require("../Misc/tools"),i=require("../Misc/observable"),r=require("../Maths/math"),o=require("../Engines/engine"),n=require("../Meshes/buffer"),s=require("../Meshes/mesh.vertexData"),a=require("../Meshes/transformNode"),c=require("../Collisions/pickingInfo"),u=require("../Collisions/collider"),l=require("../Culling/boundingInfo"),h=require("../Engines/constants");function f(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};r.get||r.set?Object.defineProperty(e,i,r):e[i]=t[i]}return e.default=t,e}var d=function(){return function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=r.Vector3.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}(),p=function(f){function p(t,e){void 0===e&&(e=null);var n=f.call(this,t,e,!1)||this;return n._facetData=new d,n.cullingStrategy=p.CULLINGSTRATEGY_STANDARD,n.onCollideObservable=new i.Observable,n.onCollisionPositionChangeObservable=new i.Observable,n.onMaterialChangedObservable=new i.Observable,n.definedFacingForward=!0,n._visibility=1,n.alphaIndex=Number.MAX_VALUE,n.isVisible=!0,n.isPickable=!0,n.showSubMeshesBoundingBox=!1,n.isBlocker=!1,n.enablePointerMoveEvents=!1,n.renderingGroupId=0,n._receiveShadows=!1,n.outlineColor=r.Color3.Red(),n.outlineWidth=.02,n.overlayColor=r.Color3.Red(),n.overlayAlpha=.5,n._hasVertexAlpha=!1,n._useVertexColors=!0,n._computeBonesUsingShaders=!0,n._numBoneInfluencers=4,n._applyFog=!0,n.useOctreeForRenderingSelection=!0,n.useOctreeForPicking=!0,n.useOctreeForCollisions=!0,n._layerMask=268435455,n.alwaysSelectAsActiveMesh=!1,n.actionManager=null,n._checkCollisions=!1,n._collisionMask=-1,n._collisionGroup=-1,n.ellipsoid=new r.Vector3(.5,1,.5),n.ellipsoidOffset=new r.Vector3(0,0,0),n._oldPositionForCollisions=new r.Vector3(0,0,0),n._diffPositionForCollisions=new r.Vector3(0,0,0),n.edgesWidth=1,n.edgesColor=new r.Color4(1,0,0,1),n._renderId=0,n._intersectionsInProgress=new Array,n._unIndexed=!1,n._lightSources=new Array,n.onRebuildObservable=new i.Observable,n._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null),e.subtractToRef(n._oldPositionForCollisions,n._diffPositionForCollisions),n._diffPositionForCollisions.length()>o.Engine.CollisionsEpsilon&&n.position.addInPlace(n._diffPositionForCollisions),i&&n.onCollideObservable.notifyObservers(i),n.onCollisionPositionChangeObservable.notifyObservers(n.position)},n.getScene().addMesh(n),n._resyncLightSources(),n}return t.__extends(p,f),Object.defineProperty(p,"BILLBOARDMODE_NONE",{get:function(){return a.TransformNode.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(p,"BILLBOARDMODE_X",{get:function(){return a.TransformNode.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(p,"BILLBOARDMODE_Y",{get:function(){return a.TransformNode.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(p,"BILLBOARDMODE_Z",{get:function(){return a.TransformNode.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(p,"BILLBOARDMODE_ALL",{get:function(){return a.TransformNode.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"facetNb",{get:function(){return this._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"partitioningSubdivisions",{get:function(){return this._facetData.partitioningSubdivisions},set:function(t){this._facetData.partitioningSubdivisions=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"partitioningBBoxRatio",{get:function(){return this._facetData.partitioningBBoxRatio},set:function(t){this._facetData.partitioningBBoxRatio=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"mustDepthSortFacets",{get:function(){return this._facetData.facetDepthSort},set:function(t){this._facetData.facetDepthSort=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"facetDepthSortFrom",{get:function(){return this._facetData.facetDepthSortFrom},set:function(t){this._facetData.facetDepthSortFrom=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"isFacetDataEnabled",{get:function(){return this._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),p.prototype._updateNonUniformScalingState=function(t){return!!f.prototype._updateNonUniformScalingState.call(this,t)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(p.prototype,"onCollide",{set:function(t){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver),this._onCollideObserver=this.onCollideObservable.add(t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onCollisionPositionChange",{set:function(t){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver),this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"visibility",{get:function(){return this._visibility},set:function(t){this._visibility!==t&&(this._visibility=t,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"material",{get:function(){return this._material},set:function(t){this._material!==t&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(t){this._receiveShadows!==t&&(this._receiveShadows=t,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"hasVertexAlpha",{get:function(){return this._hasVertexAlpha},set:function(t){this._hasVertexAlpha!==t&&(this._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useVertexColors",{get:function(){return this._useVertexColors},set:function(t){this._useVertexColors!==t&&(this._useVertexColors=t,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"computeBonesUsingShaders",{get:function(){return this._computeBonesUsingShaders},set:function(t){this._computeBonesUsingShaders!==t&&(this._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"numBoneInfluencers",{get:function(){return this._numBoneInfluencers},set:function(t){this._numBoneInfluencers!==t&&(this._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"applyFog",{get:function(){return this._applyFog},set:function(t){this._applyFog!==t&&(this._applyFog=t,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"layerMask",{get:function(){return this._layerMask},set:function(t){t!==this._layerMask&&(this._layerMask=t,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(t){this._collisionMask=isNaN(t)?-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"collisionGroup",{get:function(){return this._collisionGroup},set:function(t){this._collisionGroup=isNaN(t)?-1:t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"skeleton",{get:function(){return this._skeleton},set:function(t){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._skeleton=t,this._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),p.prototype.getClassName=function(){return"AbstractMesh"},p.prototype.toString=function(t){var e="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");return e+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(e+=", skeleton: "+this._skeleton.name),t&&(e+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],e+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),e},p.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var t=0,e=this.subMeshes;t<e.length;t++){e[t]._rebuild()}},p.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var t=0,e=this.getScene().lights;t<e.length;t++){var i=e[t];i.isEnabled()&&(i.canAffectMesh(this)&&this._lightSources.push(i))}this._markSubMeshesAsLightDirty()},p.prototype._resyncLighSource=function(t){var e=t.isEnabled()&&t.canAffectMesh(this),i=this._lightSources.indexOf(t);if(-1===i){if(!e)return;this._lightSources.push(t)}else{if(e)return;this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty()},p.prototype._unBindEffect=function(){for(var t=0,e=this.subMeshes;t<e.length;t++){e[t].setEffect(null)}},p.prototype._removeLightSource=function(t){var e=this._lightSources.indexOf(t);-1!==e&&(this._lightSources.splice(e,1),this._markSubMeshesAsLightDirty())},p.prototype._markSubMeshesAsDirty=function(t){if(this.subMeshes)for(var e=0,i=this.subMeshes;e<i.length;e++){var r=i[e];r._materialDefines&&t(r._materialDefines)}},p.prototype._markSubMeshesAsLightDirty=function(){this._markSubMeshesAsDirty(function(t){return t.markAsLightDirty()})},p.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(t){return t.markAsAttributesDirty()})},p.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var t=0,e=this.subMeshes;t<e.length;t++){var i=e[t].getMaterial();i&&i.markAsDirty(h.Constants.MATERIAL_MiscDirtyFlag)}},Object.defineProperty(p.prototype,"scaling",{get:function(){return this._scaling},set:function(t){this._scaling=t,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),p.prototype.getLOD=function(t){return this},p.prototype.getTotalVertices=function(){return 0},p.prototype.getTotalIndices=function(){return 0},p.prototype.getIndices=function(){return null},p.prototype.getVerticesData=function(t){return null},p.prototype.setVerticesData=function(t,e,i,r){return this},p.prototype.updateVerticesData=function(t,e,i,r){return this},p.prototype.setIndices=function(t,e){return this},p.prototype.isVerticesDataPresent=function(t){return!1},p.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},p.prototype.normalizeToUnitCube=function(t){void 0===t&&(t=!0);var e=this.getHierarchyBoundingVectors(t),i=e.max.subtract(e.min),r=Math.max(i.x,i.y,i.z);if(0===r)return this;var o=1/r;return this.scaling.scaleInPlace(o),this},p.prototype.setBoundingInfo=function(t){return this._boundingInfo=t,this},Object.defineProperty(p.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(n.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(n.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),p.prototype._preActivate=function(){},p.prototype._preActivateForIntermediateRendering=function(t){},p.prototype._activate=function(t){this._renderId=t},p.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():f.prototype.getWorldMatrix.call(this)},p.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():f.prototype._getWorldMatrixDeterminant.call(this)},p.prototype.movePOV=function(t,e,i){return this.position.addInPlace(this.calcMovePOV(t,e,i)),this},p.prototype.calcMovePOV=function(t,e,i){var o=new r.Matrix;(this.rotationQuaternion?this.rotationQuaternion:r.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(o);var n=r.Vector3.Zero(),s=this.definedFacingForward?-1:1;return r.Vector3.TransformCoordinatesFromFloatsToRef(t*s,e,i*s,o,n),n},p.prototype.rotatePOV=function(t,e,i){return this.rotation.addInPlace(this.calcRotatePOV(t,e,i)),this},p.prototype.calcRotatePOV=function(t,e,i){var o=this.definedFacingForward?1:-1;return new r.Vector3(t*o,e,i*o)},p.prototype.getHierarchyBoundingVectors=function(t,i){var o,n;void 0===t&&(t=!0),void 0===i&&(i=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var s=this.getBoundingInfo();if(this.subMeshes?(o=s.boundingBox.minimumWorld,n=s.boundingBox.maximumWorld):(o=new r.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new r.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)),t)for(var a=0,c=this.getDescendants(!1);a<c.length;a++){var u=c[a];if(u.computeWorldMatrix(!0),(!i||i(u))&&u.getBoundingInfo&&0!==u.getTotalVertices()){var l=u.getBoundingInfo().boundingBox,h=l.minimumWorld,f=l.maximumWorld;e.Tools.CheckExtends(h,o,n),e.Tools.CheckExtends(f,o,n)}}return{min:o,max:n}},p.prototype.refreshBoundingInfo=function(t){return void 0===t&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(t),null),this)},p.prototype._refreshBoundingInfo=function(t,i){if(t){var r=e.Tools.ExtractMinAndMax(t,0,this.getTotalVertices(),i);this._boundingInfo?this._boundingInfo.reConstruct(r.minimum,r.maximum):this._boundingInfo=new l.BoundingInfo(r.minimum,r.maximum)}if(this.subMeshes)for(var o=0;o<this.subMeshes.length;o++)this.subMeshes[o].refreshBoundingInfo();this._updateBoundingInfo()},p.prototype._getPositionData=function(t){var i=this.getVerticesData(n.VertexBuffer.PositionKind);if(i&&t&&this.skeleton){i=e.Tools.Slice(i);var o=this.getVerticesData(n.VertexBuffer.MatricesIndicesKind),s=this.getVerticesData(n.VertexBuffer.MatricesWeightsKind);if(s&&o)for(var a=this.numBoneInfluencers>4,c=a?this.getVerticesData(n.VertexBuffer.MatricesIndicesExtraKind):null,u=a?this.getVerticesData(n.VertexBuffer.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this),h=r.Tmp.Vector3[0],f=r.Tmp.Matrix[0],d=r.Tmp.Matrix[1],p=0,b=0;b<i.length;b+=3,p+=4){var g,m;for(f.reset(),g=0;g<4;g++)(m=s[p+g])>0&&(r.Matrix.FromFloat32ArrayToRefScaled(l,Math.floor(16*o[p+g]),m,d),f.addToSelf(d));if(a)for(g=0;g<4;g++)(m=u[p+g])>0&&(r.Matrix.FromFloat32ArrayToRefScaled(l,Math.floor(16*c[p+g]),m,d),f.addToSelf(d));r.Vector3.TransformCoordinatesFromFloatsToRef(i[b],i[b+1],i[b+2],f,h),h.toArray(i,b)}}return i},p.prototype._updateBoundingInfo=function(){var t=this.skeleton&&this.skeleton.overrideMesh||this;return this._boundingInfo?this._boundingInfo.update(t.worldMatrixFromCache):this._boundingInfo=new l.BoundingInfo(this.absolutePosition,this.absolutePosition,t.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(t.worldMatrixFromCache),this},p.prototype._updateSubMeshesBoundingInfo=function(t){if(!this.subMeshes)return this;for(var e=this.subMeshes.length,i=0;i<e;i++){var r=this.subMeshes[i];(e>1||!r.IsGlobal)&&r.updateBoundingInfo(t)}return this},p.prototype._afterComputeWorldMatrix=function(){this._updateBoundingInfo()},p.prototype.isInFrustum=function(t){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(t,this.cullingStrategy)},p.prototype.isCompletelyInFrustum=function(t){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(t)},p.prototype.intersectsMesh=function(t,e,i){if(void 0===e&&(e=!1),!this._boundingInfo||!t._boundingInfo)return!1;if(this._boundingInfo.intersects(t._boundingInfo,e))return!0;if(i)for(var r=0,o=this.getChildMeshes();r<o.length;r++){if(o[r].intersectsMesh(t,e,!0))return!0}return!1},p.prototype.intersectsPoint=function(t){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(t)},Object.defineProperty(p.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(t){this._checkCollisions=t},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"collider",{get:function(){return this._collider},enumerable:!0,configurable:!0}),p.prototype.moveWithCollisions=function(t){return this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._oldPositionForCollisions),this._collider||(this._collider=new u.Collider),this._collider._radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,t,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},p.prototype._collideForSubMesh=function(t,e,i){if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(e)){t._lastColliderTransformMatrix=e.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var o=t.verticesStart,n=t.verticesStart+t.verticesCount,s=o;s<n;s++)t._lastColliderWorldVertices.push(r.Vector3.TransformCoordinates(this._positions[s],e))}return i._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),i.collisionFound&&(i.collidedMesh=this),this},p.prototype._processCollisionsForSubMeshes=function(t,e){for(var i=this._scene.getCollidingSubMeshCandidates(this,t),r=i.length,o=0;o<r;o++){var n=i.data[o];r>1&&!n._checkCollision(t)||this._collideForSubMesh(n,e,t)}return this},p.prototype._checkCollision=function(t){if(!this._boundingInfo||!this._boundingInfo._checkCollision(t))return this;var e=r.Tmp.Matrix[0],i=r.Tmp.Matrix[1];return r.Matrix.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,e),this.worldMatrixFromCache.multiplyToRef(e,i),this._processCollisionsForSubMeshes(t,i),this},p.prototype._generatePointsArray=function(){return!1},p.prototype.intersects=function(t,e){var i=new c.PickingInfo,o="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,n=this._boundingInfo;if(!(this.subMeshes&&n&&t.intersectsSphere(n.boundingSphere,o)&&t.intersectsBox(n.boundingBox,o)))return i;if(!this._generatePointsArray())return i;for(var s=null,a=this._scene.getIntersectingSubMeshCandidates(this,t),u=a.length,l=0;l<u;l++){var h=a.data[l];if(!(u>1)||h.canIntersects(t)){var f=h.intersects(t,this._positions,this.getIndices(),e);if(f&&(e||!s||f.distance<s.distance)&&((s=f).subMeshId=l,e))break}}if(s){var d=this.getWorldMatrix(),p=r.Tmp.Vector3[0],b=r.Tmp.Vector3[1];r.Vector3.TransformCoordinatesToRef(t.origin,d,p),t.direction.scaleToRef(s.distance,b);var g=r.Vector3.TransformNormal(b,d).addInPlace(p);return i.hit=!0,i.distance=r.Vector3.Distance(p,g),i.pickedPoint=g,i.pickedMesh=this,i.bu=s.bu||0,i.bv=s.bv||0,i.faceId=s.faceId,i.subMeshId=s.subMeshId,i}return i},p.prototype.clone=function(t,e,i){return null},p.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},p.prototype.dispose=function(t,e){var i,r=this;for(void 0===e&&(e=!1),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._skeleton=null,i=0;i<this._intersectionsInProgress.length;i++){var o=this._intersectionsInProgress[i],n=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(n,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(t){var e=t.includedOnlyMeshes.indexOf(r);-1!==e&&t.includedOnlyMeshes.splice(e,1),-1!==(e=t.excludedMeshes.indexOf(r))&&t.excludedMeshes.splice(e,1);var i=t.getShadowGenerator();if(i){var o=i.getShadowMap();o&&o.renderList&&-1!==(e=o.renderList.indexOf(r))&&o.renderList.splice(e,1)}}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var s=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),this.getScene().removeMesh(this),e&&this.material&&this.material.dispose(!1,!0),!t)for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);this._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),f.prototype.dispose.call(this,t,e)},p.prototype.addChild=function(t){return t.setParent(this),this},p.prototype.removeChild=function(t){return t.setParent(null),this},p.prototype._initFacetData=function(){var t=this._facetData;t.facetNormals||(t.facetNormals=new Array),t.facetPositions||(t.facetPositions=new Array),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(var e=0;e<t.facetNb;e++)t.facetNormals[e]=r.Vector3.Zero(),t.facetPositions[e]=r.Vector3.Zero();return t.facetDataEnabled=!0,this},p.prototype.updateFacetData=function(){var t=this._facetData;t.facetDataEnabled||this._initFacetData();var e=this.getVerticesData(n.VertexBuffer.PositionKind),i=this.getIndices(),o=this.getVerticesData(n.VertexBuffer.NormalKind),a=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,i instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(i);else{for(var c=!1,u=0;u<i.length;u++)if(i[u]>65535){c=!0;break}t.depthSortedIndices=c?new Uint32Array(i):new Uint16Array(i)}if(t.facetDepthSortFunction=function(t,e){return e.sqDistance-t.sqDistance},!t.facetDepthSortFrom){var l=this.getScene().activeCamera;t.facetDepthSortFrom=l?l.position:r.Vector3.Zero()}t.depthSortedFacets=[];for(var h=0;h<t.facetNb;h++){var f={ind:3*h,sqDistance:0};t.depthSortedFacets.push(f)}t.invertedMatrix=r.Matrix.Identity(),t.facetDepthSortOrigin=r.Vector3.Zero()}t.bbSize.x=a.maximum.x-a.minimum.x>r.Epsilon?a.maximum.x-a.minimum.x:r.Epsilon,t.bbSize.y=a.maximum.y-a.minimum.y>r.Epsilon?a.maximum.y-a.minimum.y:r.Epsilon,t.bbSize.z=a.maximum.z-a.minimum.z>r.Epsilon?a.maximum.z-a.minimum.z:r.Epsilon;var d=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(d=d>t.bbSize.z?d:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/d),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/d),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/d),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=a,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),r.Vector3.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,s.VertexData.ComputeNormals(e,i,o,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);var p=t.depthSortedIndices.length/3|0;for(h=0;h<p;h++){var b=t.depthSortedFacets[h].ind;t.depthSortedIndices[3*h]=i[b],t.depthSortedIndices[3*h+1]=i[b+1],t.depthSortedIndices[3*h+2]=i[b+2]}this.updateIndices(t.depthSortedIndices)}return this},p.prototype.getFacetLocalNormals=function(){return this._facetData.facetNormals||this.updateFacetData(),this._facetData.facetNormals},p.prototype.getFacetLocalPositions=function(){return this._facetData.facetPositions||this.updateFacetData(),this._facetData.facetPositions},p.prototype.getFacetLocalPartitioning=function(){return this._facetData.facetPartitioning||this.updateFacetData(),this._facetData.facetPartitioning},p.prototype.getFacetPosition=function(t){var e=r.Vector3.Zero();return this.getFacetPositionToRef(t,e),e},p.prototype.getFacetPositionToRef=function(t,e){var i=this.getFacetLocalPositions()[t],o=this.getWorldMatrix();return r.Vector3.TransformCoordinatesToRef(i,o,e),this},p.prototype.getFacetNormal=function(t){var e=r.Vector3.Zero();return this.getFacetNormalToRef(t,e),e},p.prototype.getFacetNormalToRef=function(t,e){var i=this.getFacetLocalNormals()[t];return r.Vector3.TransformNormalToRef(i,this.getWorldMatrix(),e),this},p.prototype.getFacetsAtLocalCoordinates=function(t,e,i){var r=this.getBoundingInfo(),o=this._facetData,n=Math.floor((t-r.minimum.x*o.partitioningBBoxRatio)*o.subDiv.X*o.partitioningBBoxRatio/o.bbSize.x),s=Math.floor((e-r.minimum.y*o.partitioningBBoxRatio)*o.subDiv.Y*o.partitioningBBoxRatio/o.bbSize.y),a=Math.floor((i-r.minimum.z*o.partitioningBBoxRatio)*o.subDiv.Z*o.partitioningBBoxRatio/o.bbSize.z);return n<0||n>o.subDiv.max||s<0||s>o.subDiv.max||a<0||a>o.subDiv.max?null:o.facetPartitioning[n+o.subDiv.max*s+o.subDiv.max*o.subDiv.max*a]},p.prototype.getClosestFacetAtCoordinates=function(t,e,i,o,n,s){void 0===n&&(n=!1),void 0===s&&(s=!0);var a=this.getWorldMatrix(),c=r.Tmp.Matrix[5];a.invertToRef(c);var u=r.Tmp.Vector3[8];r.Vector3.TransformCoordinatesFromFloatsToRef(t,e,i,c,u);var l=this.getClosestFacetAtLocalCoordinates(u.x,u.y,u.z,o,n,s);return o&&r.Vector3.TransformCoordinatesFromFloatsToRef(o.x,o.y,o.z,a,o),l},p.prototype.getClosestFacetAtLocalCoordinates=function(t,e,i,r,o,n){void 0===o&&(o=!1),void 0===n&&(n=!0);var s=null,a=0,c=0,u=0,l=0,h=0,f=0,d=0,p=0,b=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),m=this.getFacetsAtLocalCoordinates(t,e,i);if(!m)return null;for(var _,y,M,S=Number.MAX_VALUE,v=S,D=0;D<m.length;D++)y=g[_=m[D]],l=(t-(M=b[_]).x)*y.x+(e-M.y)*y.y+(i-M.z)*y.z,(!o||o&&n&&l>=0||o&&!n&&l<=0)&&(l=y.x*M.x+y.y*M.y+y.z*M.z,h=-(y.x*t+y.y*e+y.z*i-l)/(y.x*y.x+y.y*y.y+y.z*y.z),(v=(a=(f=t+y.x*h)-t)*a+(c=(d=e+y.y*h)-e)*c+(u=(p=i+y.z*h)-i)*u)<S&&(S=v,s=_,r&&(r.x=f,r.y=d,r.z=p)));return s},p.prototype.getFacetDataParameters=function(){return this._facetData.facetParameters},p.prototype.disableFacetData=function(){return this._facetData.facetDataEnabled&&(this._facetData.facetDataEnabled=!1,this._facetData.facetPositions=new Array,this._facetData.facetNormals=new Array,this._facetData.facetPartitioning=new Array,this._facetData.facetParameters=null,this._facetData.depthSortedIndices=new Uint32Array(0)),this},p.prototype.updateIndices=function(t){return this},p.prototype.createNormals=function(t){var e,i=this.getVerticesData(n.VertexBuffer.PositionKind),r=this.getIndices();return e=this.isVerticesDataPresent(n.VertexBuffer.NormalKind)?this.getVerticesData(n.VertexBuffer.NormalKind):[],s.VertexData.ComputeNormals(i,r,e,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(n.VertexBuffer.NormalKind,e,t),this},p.prototype.alignWithNormal=function(t,e){e||(e=r.Axis.Y);var i=r.Tmp.Vector3[0],o=r.Tmp.Vector3[1];return r.Vector3.CrossToRef(e,t,o),r.Vector3.CrossToRef(t,o,i),this.rotationQuaternion?r.Quaternion.RotationQuaternionFromAxisToRef(i,t,o,this.rotationQuaternion):r.Vector3.RotationFromAxisToRef(i,t,o,this.rotation),this},p.prototype._checkOcclusionQuery=function(){return!1},p.OCCLUSION_TYPE_NONE=0,p.OCCLUSION_TYPE_OPTIMISTIC=1,p.OCCLUSION_TYPE_STRICT=2,p.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,p.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,p.CULLINGSTRATEGY_STANDARD=h.Constants.MESHES_CULLINGSTRATEGY_STANDARD,p.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=h.Constants.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,p.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=h.Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,p.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=h.Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,p}(a.TransformNode);exports.AbstractMesh=p;
},{"tslib":"vCxL","../Misc/tools":"RkuS","../Misc/observable":"gtkL","../Maths/math":"Iizi","../Engines/engine":"Z5lb","../Meshes/buffer":"YHhW","../Meshes/mesh.vertexData":"+kld","../Meshes/transformNode":"XiAM","../Collisions/pickingInfo":"7JHM","../Collisions/collider":"Lnna","../Culling/boundingInfo":"1eEz","../Engines/constants":"vn8z"}],"5ppN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Ray=void 0;var t=require("../Misc/arrayTools"),r=require("../Maths/math"),e=require("../Collisions/intersectionInfo"),o=function(){function o(t,r,e){void 0===e&&(e=Number.MAX_VALUE),this.origin=t,this.direction=r,this.length=e}return o.prototype.intersectsBoxMinMax=function(t,r,e){void 0===e&&(e=0);var i,n,s,a,c=o.TmpVector3[0].copyFromFloats(t.x-e,t.y-e,t.z-e),h=o.TmpVector3[1].copyFromFloats(r.x+e,r.y+e,r.z+e),u=0,m=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<c.x||this.origin.x>h.x)return!1}else if(i=1/this.direction.x,n=(c.x-this.origin.x)*i,(s=(h.x-this.origin.x)*i)===-1/0&&(s=1/0),n>s&&(a=n,n=s,s=a),(u=Math.max(n,u))>(m=Math.min(s,m)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<c.y||this.origin.y>h.y)return!1}else if(i=1/this.direction.y,n=(c.y-this.origin.y)*i,(s=(h.y-this.origin.y)*i)===-1/0&&(s=1/0),n>s&&(a=n,n=s,s=a),(u=Math.max(n,u))>(m=Math.min(s,m)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<c.z||this.origin.z>h.z)return!1}else if(i=1/this.direction.z,n=(c.z-this.origin.z)*i,(s=(h.z-this.origin.z)*i)===-1/0&&(s=1/0),n>s&&(a=n,n=s,s=a),(u=Math.max(n,u))>(m=Math.min(s,m)))return!1;return!0},o.prototype.intersectsBox=function(t,r){return void 0===r&&(r=0),this.intersectsBoxMinMax(t.minimum,t.maximum,r)},o.prototype.intersectsSphere=function(t,r){void 0===r&&(r=0);var e=t.center.x-this.origin.x,o=t.center.y-this.origin.y,i=t.center.z-this.origin.z,n=e*e+o*o+i*i,s=t.radius+r,a=s*s;if(n<=a)return!0;var c=e*this.direction.x+o*this.direction.y+i*this.direction.z;return!(c<0)&&n-c*c<=a},o.prototype.intersectsTriangle=function(t,i,n){var s=o.TmpVector3[0],a=o.TmpVector3[1],c=o.TmpVector3[2],h=o.TmpVector3[3],u=o.TmpVector3[4];i.subtractToRef(t,s),n.subtractToRef(t,a),r.Vector3.CrossToRef(this.direction,a,c);var m=r.Vector3.Dot(s,c);if(0===m)return null;var f=1/m;this.origin.subtractToRef(t,h);var p=r.Vector3.Dot(h,c)*f;if(p<0||p>1)return null;r.Vector3.CrossToRef(h,s,u);var l=r.Vector3.Dot(this.direction,u)*f;if(l<0||p+l>1)return null;var T=r.Vector3.Dot(a,u)*f;return T>this.length?null:new e.IntersectionInfo(p,l,T)},o.prototype.intersectsPlane=function(t){var e,o=r.Vector3.Dot(t.normal,this.direction);if(Math.abs(o)<9.99999997475243e-7)return null;var i=r.Vector3.Dot(t.normal,this.origin);return(e=(-t.d-i)/o)<0?e<-9.99999997475243e-7?null:0:e},o.prototype.intersectsMesh=function(t,e){var i=r.Tmp.Matrix[0];return t.getWorldMatrix().invertToRef(i),this._tmpRay?o.TransformToRef(this,i,this._tmpRay):this._tmpRay=o.Transform(this,i),t.intersects(this._tmpRay,e)},o.prototype.intersectsMeshes=function(t,r,e){e?e.length=0:e=[];for(var o=0;o<t.length;o++){var i=this.intersectsMesh(t[o],r);i.hit&&e.push(i)}return e.sort(this._comparePickingInfo),e},o.prototype._comparePickingInfo=function(t,r){return t.distance<r.distance?-1:t.distance>r.distance?1:0},o.prototype.intersectionSegment=function(t,e,i){var n=this.origin,s=r.Tmp.Vector3[0],a=r.Tmp.Vector3[1],c=r.Tmp.Vector3[2],h=r.Tmp.Vector3[3];e.subtractToRef(t,s),this.direction.scaleToRef(o.rayl,c),n.addToRef(c,a),t.subtractToRef(n,h);var u,m,f,p,l=r.Vector3.Dot(s,s),T=r.Vector3.Dot(s,c),y=r.Vector3.Dot(c,c),d=r.Vector3.Dot(s,h),V=r.Vector3.Dot(c,h),g=l*y-T*T,v=g,x=g;g<o.smallnum?(m=0,v=1,p=V,x=y):(p=l*V-T*d,(m=T*V-y*d)<0?(m=0,p=V,x=y):m>v&&(m=v,p=V+T,x=y)),p<0?(p=0,-d<0?m=0:-d>l?m=v:(m=-d,v=l)):p>x&&(p=x,-d+T<0?m=0:-d+T>l?m=v:(m=-d+T,v=l)),u=Math.abs(m)<o.smallnum?0:m/v,f=Math.abs(p)<o.smallnum?0:p/x;var R=r.Tmp.Vector3[4];c.scaleToRef(f,R);var M=r.Tmp.Vector3[5];s.scaleToRef(u,M),M.addInPlace(h);var z=r.Tmp.Vector3[6];return M.subtractToRef(R,z),f>0&&f<=this.length&&z.lengthSquared()<i*i?M.length():-1},o.prototype.update=function(t,r,e,o,i,n,s){return this.unprojectRayToRef(t,r,e,o,i,n,s),this},o.Zero=function(){return new o(r.Vector3.Zero(),r.Vector3.Zero())},o.CreateNew=function(t,r,e,i,n,s,a){return o.Zero().update(t,r,e,i,n,s,a)},o.CreateNewFromTo=function(t,e,i){void 0===i&&(i=r.Matrix.IdentityReadOnly);var n=e.subtract(t),s=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return n.normalize(),o.Transform(new o(t,n,s),i)},o.Transform=function(t,e){var i=new o(new r.Vector3(0,0,0),new r.Vector3(0,0,0));return o.TransformToRef(t,e,i),i},o.TransformToRef=function(t,e,o){r.Vector3.TransformCoordinatesToRef(t.origin,e,o.origin),r.Vector3.TransformNormalToRef(t.direction,e,o.direction),o.length=t.length;var i=o.direction,n=i.length();if(0!==n&&1!==n){var s=1/n;i.x*=s,i.y*=s,i.z*=s,o.length*=n}},o.prototype.unprojectRayToRef=function(t,e,o,i,n,s,a){var c=r.Tmp.Matrix[0];n.multiplyToRef(s,c),c.multiplyToRef(a,c),c.invert();var h=r.Tmp.Vector3[0];h.x=t/o*2-1,h.y=-(e/i*2-1),h.z=-1;var u=r.Tmp.Vector3[1].copyFromFloats(h.x,h.y,1),m=r.Tmp.Vector3[2],f=r.Tmp.Vector3[3];r.Vector3._UnprojectFromInvertedMatrixToRef(h,c,m),r.Vector3._UnprojectFromInvertedMatrixToRef(u,c,f),this.origin.copyFrom(m),f.subtractToRef(m,this.direction),this.direction.normalize()},o.TmpVector3=t.ArrayTools.BuildArray(6,r.Vector3.Zero),o.smallnum=1e-8,o.rayl=1e9,o}();exports.Ray=o;
},{"../Misc/arrayTools":"eIrG","../Maths/math":"Iizi","../Collisions/intersectionInfo":"RtU8"}],"pegX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.postprocessVertexShader=void 0;var e=require("../Materials/effect"),r="postprocessVertexShader",o="\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}";e.Effect.ShadersStore[r]=o;var s={name:r,shader:o};exports.postprocessVertexShader=s;
},{"../Materials/effect":"Ru7D"}],"pczz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PostProcess=void 0;var e=require("../Misc/tools"),t=require("../Misc/smartArray"),s=require("../Misc/observable"),r=require("../Maths/math"),i=require("../Engines/constants");require("../Shaders/postprocess.vertex");var n=function(){function n(e,n,o,h,a,u,p,c,l,_,f,d,b,g){void 0===p&&(p=i.Constants.TEXTURE_NEAREST_SAMPLINGMODE),void 0===_&&(_=null),void 0===f&&(f=i.Constants.TEXTURETYPE_UNSIGNED_INT),void 0===d&&(d="postprocess"),void 0===g&&(g=!1),this.name=e,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=i.Constants.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=i.Constants.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new t.SmartArray(2),this._currentRenderTextureInd=0,this._scaleRatio=new r.Vector2(1,1),this._texelSize=r.Vector2.Zero(),this.onActivateObservable=new s.Observable,this.onSizeChangedObservable=new s.Observable,this.onApplyObservable=new s.Observable,this.onBeforeRenderObservable=new s.Observable,this.onAfterRenderObservable=new s.Observable,null!=u?(this._camera=u,this._scene=u.getScene(),u.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this)):c&&(this._engine=c,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=p||i.Constants.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=l||!1,this._textureType=f,this._samplers=h||[],this._samplers.push("textureSampler"),this._fragmentUrl=n,this._vertexUrl=d,this._parameters=o||[],this._parameters.push("scale"),this._indexParameters=b,g||this.updateEffect(_)}return Object.defineProperty(n.prototype,"samples",{get:function(){return this._samples},set:function(e){var t=this;this._samples=e,this._textures.forEach(function(e){e.samples!==t._samples&&t._engine.updateRenderTargetTextureSampleCount(e,t._samples)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(e){this._forcedOutputTexture=e},enumerable:!0,configurable:!0}),n.prototype.getCamera=function(){return this._camera},Object.defineProperty(n.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),n.prototype.getEngine=function(){return this._engine},n.prototype.getEffect=function(){return this._effect},n.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},n.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new t.SmartArray(2)),this._shareOutputWithPostProcess=null},n.prototype.updateEffect=function(e,t,s,r,i,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===s&&(s=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],t||this._parameters,s||this._samplers,null!==e?e:"",void 0,i,n,r||this._indexParameters)},n.prototype.isReusable=function(){return this._reusable},n.prototype.markTextureDirty=function(){this.width=-1},n.prototype.activate=function(t,s,r){var n=this;void 0===s&&(s=null);var o=(t=t||this._camera).getScene(),h=o.getEngine(),a=h.getCaps().maxTextureSize,u=(s?s.width:this._engine.getRenderWidth(!0))*this._options|0,p=(s?s.height:this._engine.getRenderHeight(!0))*this._options|0,c=t.parent;!c||c.leftCamera!=t&&c.rightCamera!=t||(u/=2);var l,_=this._options.width||u,f=this._options.height||p;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var d=h.currentViewport;d&&(_*=d.width,f*=d.height)}if((this.renderTargetSamplingMode===i.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(_=h.needPOTTextures?e.Tools.GetExponentOfTwo(_,a,this.scaleMode):_),this._options.height||(f=h.needPOTTextures?e.Tools.GetExponentOfTwo(f,a,this.scaleMode):f)),this.width!==_||this.height!==f){if(this._textures.length>0){for(var b=0;b<this._textures.length;b++)this._engine._releaseTexture(this._textures.data[b]);this._textures.reset()}this.width=_,this.height=f;var g={width:this.width,height:this.height},O={generateMipMaps:!1,generateDepthBuffer:r||0===t._postProcesses.indexOf(this),generateStencilBuffer:(r||0===t._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(g,O)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(g,O)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(e){e.samples!==n.samples&&n._engine.updateRenderTargetTextureSampleCount(e,n.samples)})}return this._shareOutputWithPostProcess?l=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(l=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):l=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(u/_,p/f),this._engine.bindFramebuffer(l,0,u,p,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(l,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(t),this.autoClear&&this.alphaMode===i.Constants.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:o.clearColor,o._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),l},Object.defineProperty(n.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),n.prototype.isReady=function(){return this._effect&&this._effect.isReady()},n.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",e),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var e},n.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var e=0;e<this._textures.length;e++)this._engine._releaseTexture(this._textures.data[e]);this._textures.dispose()}},n.prototype.dispose=function(e){if(e=e||this._camera,this._disposeTextures(),this._scene){var t=this._scene.postProcesses.indexOf(this);-1!==t&&this._scene.postProcesses.splice(t,1)}else{var s=this._engine.postProcesses.indexOf(this);-1!==s&&this._engine.postProcesses.splice(s,1)}if(e){if(e.detachPostProcess(this),0===e._postProcesses.indexOf(this)&&e._postProcesses.length>0){var r=this._camera._getFirstPostProcess();r&&r.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},n}();exports.PostProcess=n;
},{"../Misc/tools":"RkuS","../Misc/smartArray":"vK5Y","../Misc/observable":"gtkL","../Maths/math":"Iizi","../Engines/constants":"vn8z","../Shaders/postprocess.vertex":"pegX"}],"y0E2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.passPixelShader=void 0;var e=require("../Materials/effect"),r="passPixelShader",a="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}";e.Effect.ShadersStore[r]=a;var t={name:r,shader:a};exports.passPixelShader=t;
},{"../Materials/effect":"Ru7D"}],"pnsj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.passCubePixelShader=void 0;var e=require("../Materials/effect"),r="passCubePixelShader",u="\nvarying vec2 vUV;\nuniform samplerCube textureSampler;\nvoid main(void)\n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";e.Effect.ShadersStore[r]=u;var t={name:r,shader:u};exports.passCubePixelShader=t;
},{"../Materials/effect":"Ru7D"}],"E14w":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PassCubePostProcess=exports.PassPostProcess=void 0;var e=n(require("tslib")),t=require("../Engines/constants"),s=require("./postProcess"),r=require("../Engines/engine");function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,s):{};r.get||r.set?Object.defineProperty(t,s,r):t[s]=e[s]}return t.default=e,t}require("../Shaders/pass.fragment"),require("../Shaders/passCube.fragment");var i=function(s){function r(e,r,n,i,o,a,c,u){return void 0===n&&(n=null),void 0===c&&(c=t.Constants.TEXTURETYPE_UNSIGNED_INT),void 0===u&&(u=!1),s.call(this,e,"pass",null,null,r,n,i,o,a,void 0,c,void 0,null,u)||this}return e.__extends(r,s),r}(s.PostProcess);exports.PassPostProcess=i;var o=function(s){function r(e,r,n,i,o,a,c,u){void 0===n&&(n=null),void 0===c&&(c=t.Constants.TEXTURETYPE_UNSIGNED_INT),void 0===u&&(u=!1);var f=s.call(this,e,"passCube",null,null,r,n,i,o,a,"#define POSITIVEX",c,void 0,null,u)||this;return f._face=0,f}return e.__extends(r,s),Object.defineProperty(r.prototype,"face",{get:function(){return this._face},set:function(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!0,configurable:!0}),r}(s.PostProcess);exports.PassCubePostProcess=o,r.Engine._RescalePostProcessFactory=function(e){return new i("rescale",1,null,r.Engine.TEXTURE_BILINEAR_SAMPLINGMODE,e,!1,r.Engine.TEXTURETYPE_UNSIGNED_INT)};
},{"tslib":"vCxL","../Engines/constants":"vn8z","./postProcess":"pczz","../Engines/engine":"Z5lb","../Shaders/pass.fragment":"y0E2","../Shaders/passCube.fragment":"pnsj"}],"ExGj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.anaglyphPixelShader=void 0;var e=require("../Materials/effect"),r="anaglyphPixelShader",a="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}";e.Effect.ShadersStore[r]=a;var t={name:r,shader:a};exports.anaglyphPixelShader=t;
},{"../Materials/effect":"Ru7D"}],"ZLxN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnaglyphPostProcess=void 0;var e=t(require("tslib")),r=require("./postProcess");function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};s.get||s.set?Object.defineProperty(r,t,s):r[t]=e[t]}return r.default=e,r}require("../Shaders/anaglyph.fragment");var s=function(r){function t(e,t,s,o,n,a){var p=r.call(this,e,"anaglyph",null,["leftSampler"],t,s[1],o,n,a)||this;return p._passedProcess=s[0]._rigPostProcess,p.onApplyObservable.add(function(e){e.setTextureFromPostProcess("leftSampler",p._passedProcess)}),p}return e.__extends(t,r),t}(r.PostProcess);exports.AnaglyphPostProcess=s;
},{"tslib":"vCxL","./postProcess":"pczz","../Shaders/anaglyph.fragment":"ExGj"}],"XmCS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.stereoscopicInterlacePixelShader=void 0;var e=require("../Materials/effect"),r="stereoscopicInterlacePixelShader",o="const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}";e.Effect.ShadersStore[r]=o;var t={name:r,shader:o};exports.stereoscopicInterlacePixelShader=t;
},{"../Materials/effect":"Ru7D"}],"yeJK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StereoscopicInterlacePostProcess=void 0;var e=s(require("tslib")),t=require("../Maths/math"),r=require("./postProcess");function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}require("../Shaders/stereoscopicInterlace.fragment");var o=function(r){function s(e,s,o,i,c,n){var a=r.call(this,e,"stereoscopicInterlace",["stepSize"],["camASampler"],1,s[1],i,c,n,o?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return a._passedProcess=s[0]._rigPostProcess,a._stepSize=new t.Vector2(1/a.width,1/a.height),a.onSizeChangedObservable.add(function(){a._stepSize=new t.Vector2(1/a.width,1/a.height)}),a.onApplyObservable.add(function(e){e.setTextureFromPostProcess("camASampler",a._passedProcess),e.setFloat2("stepSize",a._stepSize.x,a._stepSize.y)}),a}return e.__extends(s,r),s}(r.PostProcess);exports.StereoscopicInterlacePostProcess=o;
},{"tslib":"vCxL","../Maths/math":"Iizi","./postProcess":"pczz","../Shaders/stereoscopicInterlace.fragment":"XmCS"}],"CUgp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SphericalHarmonics=exports.SphericalPolynomial=void 0;var t=require("../Maths/math"),e=function(){function e(){this.x=t.Vector3.Zero(),this.y=t.Vector3.Zero(),this.z=t.Vector3.Zero(),this.xx=t.Vector3.Zero(),this.yy=t.Vector3.Zero(),this.zz=t.Vector3.Zero(),this.xy=t.Vector3.Zero(),this.yz=t.Vector3.Zero(),this.zx=t.Vector3.Zero()}return e.prototype.addAmbient=function(e){var s=new t.Vector3(e.r,e.g,e.b);this.xx=this.xx.add(s),this.yy=this.yy.add(s),this.zz=this.zz.add(s)},e.prototype.scale=function(t){this.x=this.x.scale(t),this.y=this.y.scale(t),this.z=this.z.scale(t),this.xx=this.xx.scale(t),this.yy=this.yy.scale(t),this.zz=this.zz.scale(t),this.yz=this.yz.scale(t),this.zx=this.zx.scale(t),this.xy=this.xy.scale(t)},e.FromHarmonics=function(t){var s=new e;return s.x=t.l11.scale(1.02333),s.y=t.l1_1.scale(1.02333),s.z=t.l10.scale(1.02333),s.xx=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).add(t.lL22.scale(.429043)),s.yy=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).subtract(t.lL22.scale(.429043)),s.zz=t.l00.scale(.886277).add(t.l20.scale(.495417)),s.yz=t.l2_1.scale(.858086),s.zx=t.l21.scale(.858086),s.xy=t.l2_2.scale(.858086),s.scale(1/Math.PI),s},e.FromArray=function(s){var l=new e;return t.Vector3.FromArrayToRef(s[0],0,l.x),t.Vector3.FromArrayToRef(s[1],0,l.y),t.Vector3.FromArrayToRef(s[2],0,l.z),t.Vector3.FromArrayToRef(s[3],0,l.xx),t.Vector3.FromArrayToRef(s[4],0,l.yy),t.Vector3.FromArrayToRef(s[5],0,l.zz),t.Vector3.FromArrayToRef(s[6],0,l.yz),t.Vector3.FromArrayToRef(s[7],0,l.zx),t.Vector3.FromArrayToRef(s[8],0,l.xy),l},e}();exports.SphericalPolynomial=e;var s=function(){function e(){this.l00=t.Vector3.Zero(),this.l1_1=t.Vector3.Zero(),this.l10=t.Vector3.Zero(),this.l11=t.Vector3.Zero(),this.l2_2=t.Vector3.Zero(),this.l2_1=t.Vector3.Zero(),this.l20=t.Vector3.Zero(),this.l21=t.Vector3.Zero(),this.lL22=t.Vector3.Zero()}return e.prototype.addLight=function(e,s,l){var r=new t.Vector3(s.r,s.g,s.b).scale(l);this.l00=this.l00.add(r.scale(.282095)),this.l1_1=this.l1_1.add(r.scale(.488603*e.y)),this.l10=this.l10.add(r.scale(.488603*e.z)),this.l11=this.l11.add(r.scale(.488603*e.x)),this.l2_2=this.l2_2.add(r.scale(1.092548*e.x*e.y)),this.l2_1=this.l2_1.add(r.scale(1.092548*e.y*e.z)),this.l21=this.l21.add(r.scale(1.092548*e.x*e.z)),this.l20=this.l20.add(r.scale(.315392*(3*e.z*e.z-1))),this.lL22=this.lL22.add(r.scale(.546274*(e.x*e.x-e.y*e.y)))},e.prototype.scale=function(t){this.l00=this.l00.scale(t),this.l1_1=this.l1_1.scale(t),this.l10=this.l10.scale(t),this.l11=this.l11.scale(t),this.l2_2=this.l2_2.scale(t),this.l2_1=this.l2_1.scale(t),this.l20=this.l20.scale(t),this.l21=this.l21.scale(t),this.lL22=this.lL22.scale(t)},e.prototype.convertIncidentRadianceToIrradiance=function(){this.l00=this.l00.scale(3.141593),this.l1_1=this.l1_1.scale(2.094395),this.l10=this.l10.scale(2.094395),this.l11=this.l11.scale(2.094395),this.l2_2=this.l2_2.scale(.785398),this.l2_1=this.l2_1.scale(.785398),this.l20=this.l20.scale(.785398),this.l21=this.l21.scale(.785398),this.lL22=this.lL22.scale(.785398)},e.prototype.convertIrradianceToLambertianRadiance=function(){this.scale(1/Math.PI)},e.FromPolynomial=function(t){var s=new e;return s.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),s.l1_1=t.y.scale(.977204),s.l10=t.z.scale(.977204),s.l11=t.x.scale(.977204),s.l2_2=t.xy.scale(1.16538),s.l2_1=t.yz.scale(1.16538),s.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),s.l21=t.zx.scale(1.16538),s.lL22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),s.scale(Math.PI),s},e.FromArray=function(s){var l=new e;return t.Vector3.FromArrayToRef(s[0],0,l.l00),t.Vector3.FromArrayToRef(s[1],0,l.l1_1),t.Vector3.FromArrayToRef(s[2],0,l.l10),t.Vector3.FromArrayToRef(s[3],0,l.l11),t.Vector3.FromArrayToRef(s[4],0,l.l2_2),t.Vector3.FromArrayToRef(s[5],0,l.l2_1),t.Vector3.FromArrayToRef(s[6],0,l.l20),t.Vector3.FromArrayToRef(s[7],0,l.l21),t.Vector3.FromArrayToRef(s[8],0,l.lL22),l},e}();exports.SphericalHarmonics=s;
},{"../Maths/math":"Iizi"}],"tVwV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CubeMapToSphericalPolynomialTools=void 0;var e=require("../../Maths/math"),r=require("../../Maths/math.scalar"),a=require("../../Maths/sphericalPolynomial"),o=require("../../Engines/constants"),n=function(){return function(e,r,a,o){this.name=e,this.worldAxisForNormal=r,this.worldAxisForFileX=a,this.worldAxisForFileY=o}}(),t=function(){function t(){}return t.ConvertCubeMapTextureToSphericalPolynomial=function(e){if(!e.isCube)return null;var r,a,n=e.getSize().width,t=e.readPixels(0),i=e.readPixels(1);e.isRenderTarget?(r=e.readPixels(3),a=e.readPixels(2)):(r=e.readPixels(2),a=e.readPixels(3));var l=e.readPixels(4),s=e.readPixels(5),c=e.gammaSpace,w=o.Constants.TEXTUREFORMAT_RGBA,T=o.Constants.TEXTURETYPE_UNSIGNED_INT;e.textureType&&e.textureType!==o.Constants.TEXTURETYPE_UNSIGNED_INT&&(T=o.Constants.TEXTURETYPE_FLOAT);var p={size:n,right:t,left:i,up:r,down:a,front:l,back:s,format:w,type:T,gammaSpace:c};return this.ConvertCubeMapToSphericalPolynomial(p)},t.ConvertCubeMapToSphericalPolynomial=function(n){for(var t=new a.SphericalHarmonics,i=0,l=2/n.size,s=l,c=.5*l-1,w=0;w<6;w++)for(var T=this.FileFaces[w],p=n[T.name],d=c,u=n.format===o.Constants.TEXTUREFORMAT_RGBA?4:3,m=0;m<n.size;m++){for(var h=c,P=0;P<n.size;P++){var x=T.worldAxisForFileX.scale(h).add(T.worldAxisForFileY.scale(d)).add(T.worldAxisForNormal);x.normalize();var E=Math.pow(1+h*h+d*d,-1.5),S=p[m*n.size*u+P*u+0],C=p[m*n.size*u+P*u+1],v=p[m*n.size*u+P*u+2];n.type===o.Constants.TEXTURETYPE_UNSIGNED_INT&&(S/=255,C/=255,v/=255),n.gammaSpace&&(S=Math.pow(r.Scalar.Clamp(S),e.ToLinearSpace),C=Math.pow(r.Scalar.Clamp(C),e.ToLinearSpace),v=Math.pow(r.Scalar.Clamp(v),e.ToLinearSpace));var F=new e.Color3(S,C,v);t.addLight(x,F,E),i+=E,h+=l}d+=s}var V=6*(4*Math.PI)/6/i;return t.scale(V),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),a.SphericalPolynomial.FromHarmonics(t)},t.FileFaces=[new n("right",new e.Vector3(1,0,0),new e.Vector3(0,0,-1),new e.Vector3(0,-1,0)),new n("left",new e.Vector3(-1,0,0),new e.Vector3(0,0,1),new e.Vector3(0,-1,0)),new n("up",new e.Vector3(0,1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,1)),new n("down",new e.Vector3(0,-1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,-1)),new n("front",new e.Vector3(0,0,1),new e.Vector3(1,0,0),new e.Vector3(0,-1,0)),new n("back",new e.Vector3(0,0,-1),new e.Vector3(-1,0,0),new e.Vector3(0,-1,0))],t}();exports.CubeMapToSphericalPolynomialTools=t;
},{"../../Maths/math":"Iizi","../../Maths/math.scalar":"7Iig","../../Maths/sphericalPolynomial":"CUgp","../../Engines/constants":"vn8z"}],"K2LE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseTexture=void 0;var e=u(require("tslib")),t=require("../../Misc/decorators"),r=require("../../Misc/observable"),i=require("../../Misc/tools"),o=require("../../Misc/HighDynamicRange/cubemapToSphericalPolynomial"),n=require("../../Maths/math"),s=require("../../Engines/engineStore"),a=require("../../Engines/constants");function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var l=function(){function u(e){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=a.Constants.TEXTURE_EXPLICIT_MODE,this.wrapU=a.Constants.TEXTURE_WRAP_ADDRESSMODE,this.wrapV=a.Constants.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=a.Constants.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=u.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new r.Observable,this.delayLoadState=a.Constants.DELAYLOADSTATE_NONE,this._cachedSize=n.Size.Zero(),this._scene=e||s.EngineStore.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}return Object.defineProperty(u.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(a.Constants.MATERIAL_TextureDirtyFlag|a.Constants.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(a.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"uid",{get:function(){return this._uid||(this._uid=i.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),u.prototype.toString=function(){return this.name},u.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(u.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),u.prototype.getScene=function(){return this._scene},u.prototype.getTextureMatrix=function(){return n.Matrix.IdentityReadOnly},u.prototype.getReflectionTextureMatrix=function(){return n.Matrix.IdentityReadOnly},u.prototype.getInternalTexture=function(){return this._texture},u.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},u.prototype.isReady=function(){return this.delayLoadState===a.Constants.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},u.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},u.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new n.Size(this._texture._size,this._texture._size):new n.Size(this._texture.baseWidth,this._texture.baseHeight):n.Size.Zero()},u.prototype.updateSamplingMode=function(e){if(this._texture){var t=this.getScene();t&&t.getEngine().updateTextureSamplingMode(e,this._texture)}},u.prototype.scale=function(e){},Object.defineProperty(u.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),u.prototype._getFromCache=function(e,t,r){if(!this._scene)return null;for(var i=this._scene.getEngine().getLoadedTexturesCache(),o=0;o<i.length;o++){var n=i[o];if(n.url===e&&n.generateMipMaps===!t&&(!r||r===n.samplingMode))return n.incrementReferences(),n}return null},u.prototype._rebuild=function(){},u.prototype.delayLoad=function(){},u.prototype.clone=function(){return null},Object.defineProperty(u.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:a.Constants.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:a.Constants.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),u.prototype.readPixels=function(e,t,r){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),!this._texture)return null;var i=this.getSize(),o=i.width,n=i.height,s=this.getScene();if(!s)return null;var a=s.getEngine();return 0!=t&&(o/=Math.pow(2,t),n/=Math.pow(2,t),o=Math.round(o),n=Math.round(n)),this._texture.isCube?a._readTexturePixels(this._texture,o,n,e,t,r):a._readTexturePixels(this._texture,o,n,-1,t,r)},u.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(u.prototype,"sphericalPolynomial",{get:function(){return this._texture&&o.CubeMapToSphericalPolynomialTools&&this.isReady()?(this._texture._sphericalPolynomial||(this._texture._sphericalPolynomial=o.CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this)),this._texture._sphericalPolynomial):null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),u.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},u.prototype.serialize=function(){if(!this.name)return null;var e=t.SerializationHelper.Serialize(this);return t.SerializationHelper.AppendSerializedAnimations(this,e),e},u.WhenAllReady=function(e,t){var r=e.length;if(0!==r)for(var i,o,n=function(){if((i=e[s]).isReady())0==--r&&t();else{o=i.onLoadObservable;var n=function(){o.removeCallback(n),0==--r&&t()};o.add(n)}},s=0;s<e.length;s++)n();else t()},u.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,e.__decorate([(0,t.serialize)()],u.prototype,"uniqueId",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"name",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"metadata",void 0),e.__decorate([(0,t.serialize)("hasAlpha")],u.prototype,"_hasAlpha",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"getAlphaFromRGB",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"level",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"coordinatesIndex",void 0),e.__decorate([(0,t.serialize)("coordinatesMode")],u.prototype,"_coordinatesMode",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"wrapU",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"wrapV",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"wrapR",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"anisotropicFilteringLevel",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"isCube",null),e.__decorate([(0,t.serialize)()],u.prototype,"is3D",null),e.__decorate([(0,t.serialize)()],u.prototype,"gammaSpace",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"invertZ",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"lodLevelInAlpha",void 0),e.__decorate([(0,t.serialize)()],u.prototype,"lodGenerationOffset",null),e.__decorate([(0,t.serialize)()],u.prototype,"lodGenerationScale",null),e.__decorate([(0,t.serialize)()],u.prototype,"isRenderTarget",void 0),u}();exports.BaseTexture=l;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Misc/observable":"gtkL","../../Misc/tools":"RkuS","../../Misc/HighDynamicRange/cubemapToSphericalPolynomial":"tVwV","../../Maths/math":"Iizi","../../Engines/engineStore":"n+VE","../../Engines/constants":"vn8z"}],"KNsj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Texture=void 0;var e=o(require("tslib")),t=require("../../Misc/decorators"),r=require("../../Misc/observable"),i=require("../../Misc/tools"),a=require("../../Maths/math"),n=require("../../Materials/Textures/baseTexture"),s=require("../../Engines/constants");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var _=function(n){function o(e,t,a,_,E,d,h,c,l,u){void 0===a&&(a=!1),void 0===_&&(_=!0),void 0===E&&(E=o.TRILINEAR_SAMPLINGMODE),void 0===d&&(d=null),void 0===h&&(h=null),void 0===c&&(c=null),void 0===l&&(l=!1);var T=n.call(this,t)||this;if(T.uOffset=0,T.vOffset=0,T.uScale=1,T.vScale=1,T.uAng=0,T.vAng=0,T.wAng=0,T.uRotationCenter=.5,T.vRotationCenter=.5,T.wRotationCenter=.5,T._initialSamplingMode=o.BILINEAR_SAMPLINGMODE,T.onLoadObservable=new r.Observable,T._isBlocking=!0,T.name=e||"",T.url=e,T._noMipmap=a,T._invertY=_,T._initialSamplingMode=E,T._buffer=c,T._deleteBuffer=l,u&&(T._format=u),!(t=T.getScene()))return T;t.getEngine().onBeforeTextureInitObservable.notifyObservers(T);var R=function(){T._texture&&T._texture._invertVScale&&(T.vScale=-1),T.onLoadObservable.hasObservers()&&T.onLoadObservable.notifyObservers(T),d&&d(),!T.isBlocking&&t&&t.resetCachedMaterial()};return T.url?(T._texture=T._getFromCache(T.url,a,E),T._texture?T._texture.isReady?i.Tools.SetImmediate(function(){return R()}):T._texture.onLoadedObservable.add(R):t.useDelayedTextureLoading?(T.delayLoadState=s.Constants.DELAYLOADSTATE_NOTLOADED,T._delayedOnLoad=R,T._delayedOnError=h):(T._texture=t.getEngine().createTexture(T.url,a,_,t,E,R,h,T._buffer,void 0,T._format),l&&delete T._buffer),T):(T._delayedOnLoad=R,T._delayedOnError=h,T)}return e.__extends(o,n),Object.defineProperty(o.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),o.prototype.updateURL=function(e,t,r){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(s.Constants.MATERIAL_TextureDirtyFlag)),this.url=e,this._buffer=t,this.delayLoadState=s.Constants.DELAYLOADSTATE_NOTLOADED,r&&(this._delayedOnLoad=r),this.delayLoad()},o.prototype.delayLoad=function(){if(this.delayLoadState===s.Constants.DELAYLOADSTATE_NOTLOADED){var e=this.getScene();e&&(this.delayLoadState=s.Constants.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode),this._texture?this._delayedOnLoad&&(this._texture.isReady?i.Tools.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},o.prototype._prepareRowForTextureGeneration=function(e,t,r,i){e*=this.uScale,t*=this.vScale,e-=this.uRotationCenter*this.uScale,t-=this.vRotationCenter*this.vScale,r-=this.wRotationCenter,a.Vector3.TransformCoordinatesFromFloatsToRef(e,t,r,this._rowGenerationMatrix,i),i.x+=this.uRotationCenter*this.uScale+this.uOffset,i.y+=this.vRotationCenter*this.vScale+this.vOffset,i.z+=this.wRotationCenter},o.prototype.getTextureMatrix=function(){var e=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=a.Matrix.Zero(),this._rowGenerationMatrix=new a.Matrix,this._t0=a.Vector3.Zero(),this._t1=a.Vector3.Zero(),this._t2=a.Vector3.Zero()),a.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),a.Matrix.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var t=this.getScene();return t?(t.markAllMaterialsAsDirty(s.Constants.MATERIAL_TextureDirtyFlag,function(t){return t.hasTexture(e)}),this._cachedTextureMatrix):this._cachedTextureMatrix},o.prototype.getReflectionTextureMatrix=function(){var e=this,t=this.getScene();if(!t)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==o.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===t.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=a.Matrix.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=a.Matrix.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case o.PLANAR_MODE:a.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case o.PROJECTION_MODE:a.Matrix.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var r=t.getProjectionMatrix();this._cachedProjectionMatrixId=r.updateFlag,r.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:a.Matrix.IdentityToRef(this._cachedTextureMatrix)}return t.markAllMaterialsAsDirty(s.Constants.MATERIAL_TextureDirtyFlag,function(t){return-1!==t.getActiveTextures().indexOf(e)}),this._cachedTextureMatrix},o.prototype.clone=function(){var e=this;return t.SerializationHelper.Clone(function(){return new o(e._texture?e._texture.url:null,e.getScene(),e._noMipmap,e._invertY,e.samplingMode)},this)},o.prototype.serialize=function(){var e=n.prototype.serialize.call(this);return"string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)&&(e.base64String=this._buffer,e.name=e.name.replace("data:","")),e.invertY=this._invertY,e.samplingMode=this.samplingMode,e},o.prototype.getClassName=function(){return"Texture"},o.prototype.dispose=function(){n.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},o.Parse=function(e,r,n){if(e.customType){var s=i.Tools.Instantiate(e.customType).Parse(e,r,n);return e.samplingMode&&s.updateSamplingMode&&s._samplingMode&&s._samplingMode!==e.samplingMode&&s.updateSamplingMode(e.samplingMode),s}if(e.isCube&&!e.isRenderTarget)return o._CubeTextureParser(e,r,n);if(!e.name&&!e.isRenderTarget)return null;var _=t.SerializationHelper.Parse(function(){var t,i=!0;if(e.noMipmap&&(i=!1),e.mirrorPlane){var s=o._CreateMirror(e.name,e.renderTargetSize,r,i);return s._waitingRenderList=e.renderList,s.mirrorPlane=a.Plane.FromArray(e.mirrorPlane),s}if(e.isRenderTarget){var _=null;if(e.isCube){if(r.reflectionProbes)for(var E=0;E<r.reflectionProbes.length;E++){var d=r.reflectionProbes[E];if(d.name===e.name)return d.cubeTexture}}else(_=o._CreateRenderTargetTexture(e.name,e.renderTargetSize,r,i))._waitingRenderList=e.renderList;return _}if(e.base64String)t=o.CreateFromBase64String(e.base64String,e.name,r,!i);else{var h=n+e.name;o.UseSerializedUrlIfAny&&e.url&&(h=e.url),t=new o(h,r,!i,e.invertY)}return t},e,r);if(e.samplingMode){var E=e.samplingMode;_&&_.samplingMode!==E&&_.updateSamplingMode(E)}if(_&&e.animations)for(var d=0;d<e.animations.length;d++){var h=e.animations[d];_.animations.push(o._AnimationParser(h))}return _},o.CreateFromBase64String=function(e,t,r,i,a,n,_,E,d){return void 0===n&&(n=o.TRILINEAR_SAMPLINGMODE),void 0===_&&(_=null),void 0===E&&(E=null),void 0===d&&(d=s.Constants.TEXTUREFORMAT_RGBA),new o("data:"+t,r,i,a,n,_,E,e,!1,d)},o.LoadFromDataString=function(e,t,r,i,a,n,_,E,d,h){return void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===n&&(n=!0),void 0===_&&(_=o.TRILINEAR_SAMPLINGMODE),void 0===E&&(E=null),void 0===d&&(d=null),void 0===h&&(h=s.Constants.TEXTUREFORMAT_RGBA),"data:"!==e.substr(0,5)&&(e="data:"+e),new o(e,r,a,n,_,E,d,t,i,h)},o._AnimationParser=function(e){throw"Animation needs to be imported before being deserialized."},o._CubeTextureParser=function(e,t,r){throw"CubeTexture needs to be imported before being deserialized."},o._CreateMirror=function(e,t,r,i){throw"MirrorTexture needs to be imported before being deserialized."},o._CreateRenderTargetTexture=function(e,t,r,i){throw"RenderTargetTexture needs to be imported before being deserialized."},o.NEAREST_SAMPLINGMODE=s.Constants.TEXTURE_NEAREST_SAMPLINGMODE,o.NEAREST_NEAREST_MIPLINEAR=s.Constants.TEXTURE_NEAREST_NEAREST_MIPLINEAR,o.BILINEAR_SAMPLINGMODE=s.Constants.TEXTURE_BILINEAR_SAMPLINGMODE,o.LINEAR_LINEAR_MIPNEAREST=s.Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST,o.TRILINEAR_SAMPLINGMODE=s.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,o.LINEAR_LINEAR_MIPLINEAR=s.Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR,o.NEAREST_NEAREST_MIPNEAREST=s.Constants.TEXTURE_NEAREST_NEAREST_MIPNEAREST,o.NEAREST_LINEAR_MIPNEAREST=s.Constants.TEXTURE_NEAREST_LINEAR_MIPNEAREST,o.NEAREST_LINEAR_MIPLINEAR=s.Constants.TEXTURE_NEAREST_LINEAR_MIPLINEAR,o.NEAREST_LINEAR=s.Constants.TEXTURE_NEAREST_LINEAR,o.NEAREST_NEAREST=s.Constants.TEXTURE_NEAREST_NEAREST,o.LINEAR_NEAREST_MIPNEAREST=s.Constants.TEXTURE_LINEAR_NEAREST_MIPNEAREST,o.LINEAR_NEAREST_MIPLINEAR=s.Constants.TEXTURE_LINEAR_NEAREST_MIPLINEAR,o.LINEAR_LINEAR=s.Constants.TEXTURE_LINEAR_LINEAR,o.LINEAR_NEAREST=s.Constants.TEXTURE_LINEAR_NEAREST,o.EXPLICIT_MODE=s.Constants.TEXTURE_EXPLICIT_MODE,o.SPHERICAL_MODE=s.Constants.TEXTURE_SPHERICAL_MODE,o.PLANAR_MODE=s.Constants.TEXTURE_PLANAR_MODE,o.CUBIC_MODE=s.Constants.TEXTURE_CUBIC_MODE,o.PROJECTION_MODE=s.Constants.TEXTURE_PROJECTION_MODE,o.SKYBOX_MODE=s.Constants.TEXTURE_SKYBOX_MODE,o.INVCUBIC_MODE=s.Constants.TEXTURE_INVCUBIC_MODE,o.EQUIRECTANGULAR_MODE=s.Constants.TEXTURE_EQUIRECTANGULAR_MODE,o.FIXED_EQUIRECTANGULAR_MODE=s.Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,o.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=s.Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,o.CLAMP_ADDRESSMODE=s.Constants.TEXTURE_CLAMP_ADDRESSMODE,o.WRAP_ADDRESSMODE=s.Constants.TEXTURE_WRAP_ADDRESSMODE,o.MIRROR_ADDRESSMODE=s.Constants.TEXTURE_MIRROR_ADDRESSMODE,o.UseSerializedUrlIfAny=!1,e.__decorate([(0,t.serialize)()],o.prototype,"url",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"uOffset",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"vOffset",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"uScale",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"vScale",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"uAng",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"vAng",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"wAng",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"uRotationCenter",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"vRotationCenter",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"wRotationCenter",void 0),e.__decorate([(0,t.serialize)()],o.prototype,"isBlocking",null),o}(n.BaseTexture);exports.Texture=_,t.SerializationHelper._TextureParser=_.Parse;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Misc/observable":"gtkL","../../Misc/tools":"RkuS","../../Maths/math":"Iizi","../../Materials/Textures/baseTexture":"K2LE","../../Engines/constants":"vn8z"}],"aNJF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.vrDistortionCorrectionPixelShader=void 0;var e=require("../Materials/effect"),r="vrDistortionCorrectionPixelShader",t="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn;\nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,0.0);\nelse{\ngl_FragColor=texture2D(textureSampler,tc);\n}\n}";e.Effect.ShadersStore[r]=t;var n={name:r,shader:t};exports.vrDistortionCorrectionPixelShader=n;
},{"../Materials/effect":"Ru7D"}],"UU+7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VRDistortionCorrectionPostProcess=void 0;var e=s(require("tslib")),t=require("../Maths/math"),r=require("../Materials/Textures/texture"),o=require("./postProcess");function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};o.get||o.set?Object.defineProperty(t,r,o):t[r]=e[r]}return t.default=e,t}require("../Shaders/vrDistortionCorrection.fragment");var n=function(o){function s(e,s,n,a){var c=o.call(this,e,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,a.postProcessScaleFactor,s,r.Texture.BILINEAR_SAMPLINGMODE)||this;return c._isRightEye=n,c._distortionFactors=a.distortionK,c._postProcessScaleFactor=a.postProcessScaleFactor,c._lensCenterOffset=a.lensCenterOffset,c.adaptScaleToCurrentViewport=!0,c.onSizeChangedObservable.add(function(){c._scaleIn=new t.Vector2(2,2/c.aspectRatio),c._scaleFactor=new t.Vector2(1/c._postProcessScaleFactor*.5,1/c._postProcessScaleFactor*.5*c.aspectRatio),c._lensCenter=new t.Vector2(c._isRightEye?.5-.5*c._lensCenterOffset:.5+.5*c._lensCenterOffset,.5)}),c.onApplyObservable.add(function(e){e.setFloat2("LensCenter",c._lensCenter.x,c._lensCenter.y),e.setFloat2("Scale",c._scaleFactor.x,c._scaleFactor.y),e.setFloat2("ScaleIn",c._scaleIn.x,c._scaleIn.y),e.setFloat4("HmdWarpParam",c._distortionFactors[0],c._distortionFactors[1],c._distortionFactors[2],c._distortionFactors[3])}),c}return e.__extends(s,o),s}(o.PostProcess);exports.VRDistortionCorrectionPostProcess=n;
},{"tslib":"vCxL","../Maths/math":"Iizi","../Materials/Textures/texture":"KNsj","./postProcess":"pczz","../Shaders/vrDistortionCorrection.fragment":"aNJF"}],"8SP4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Animation=exports.AnimationKeyInterpolation=exports.PathCursor=exports.AnimationEvent=exports.AnimationRange=void 0;var e=require("../Maths/math"),t=require("../Maths/math.scalar"),n=require("../node"),r=require("../Materials/Textures/texture"),i=require("../Misc/decorators"),o=function(){function e(e,t,n){this.name=e,this.from=t,this.to=n}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}();exports.AnimationRange=o;var a=function(){function e(e,t,n){this.frame=e,this.action=t,this.onlyOnce=n,this.isDone=!1}return e.prototype._clone=function(){return new e(this.frame,this.action,this.onlyOnce)},e}();exports.AnimationEvent=a;var s,u=function(){function t(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new e.Vector3(t.x,0,t.y)},t.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},t.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},t.prototype.move=function(e){if(Math.abs(e)>1)throw"step size should be less than 1.";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},t.prototype.onchange=function(e){return this._onchange.push(e),this},t}();exports.PathCursor=u,exports.AnimationKeyInterpolation=s,function(e){e[e.STEP=1]="STEP"}(s||(exports.AnimationKeyInterpolation=s={}));var c=function(){function n(e,t,r,i,o,a){this.name=e,this.targetProperty=t,this.framePerSecond=r,this.dataType=i,this.loopMode=o,this.enableBlending=a,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=i,this.loopMode=void 0===o?n.ANIMATIONLOOPMODE_CYCLE:o}return n._PrepareAnimation=function(t,r,i,o,a,s,u,c){var A=void 0;if(!isNaN(parseFloat(a))&&isFinite(a)?A=n.ANIMATIONTYPE_FLOAT:a instanceof e.Quaternion?A=n.ANIMATIONTYPE_QUATERNION:a instanceof e.Vector3?A=n.ANIMATIONTYPE_VECTOR3:a instanceof e.Vector2?A=n.ANIMATIONTYPE_VECTOR2:a instanceof e.Color3?A=n.ANIMATIONTYPE_COLOR3:a instanceof e.Size&&(A=n.ANIMATIONTYPE_SIZE),null==A)return null;var O=new n(t,r,i,A,u),l=[{frame:0,value:a},{frame:o,value:s}];return O.setKeys(l),void 0!==c&&O.setEasingFunction(c),O},n.CreateAnimation=function(e,t,r,i){var o=new n(e+"Animation",e,r,t,n.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(i),o},n.CreateAndStartAnimation=function(e,t,r,i,o,a,s,u,c,A){var O=n._PrepareAnimation(e,r,i,o,a,s,u,c);return O?t.getScene().beginDirectAnimation(t,[O],0,o,1===O.loopMode,1,A):null},n.CreateAndStartHierarchyAnimation=function(e,t,r,i,o,a,s,u,c,A,O){var l=n._PrepareAnimation(e,i,o,a,s,u,c,A);return l?t.getScene().beginDirectHierarchyAnimation(t,r,[l],0,a,1===l.loopMode,1,O):null},n.CreateMergeAndStartAnimation=function(e,t,r,i,o,a,s,u,c,A){var O=n._PrepareAnimation(e,r,i,o,a,s,u,c);return O?(t.animations.push(O),t.getScene().beginAnimation(t,0,o,1===O.loopMode,1,A)):null},n.TransitionTo=function(e,t,n,r,i,o,a,s){if(void 0===s&&(s=null),a<=0)return n[e]=t,s&&s(),null;var u=i*(a/1e3);o.setKeys([{frame:0,value:n[e].clone?n[e].clone():n[e]},{frame:u,value:t}]),n.animations||(n.animations=[]),n.animations.push(o);var c=r.beginAnimation(n,0,u,!1);return c.onAnimationEnd=s,c},Object.defineProperty(n.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++){if(!t[e].isStopped)return!0}return!1},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(t+=", ",n=!1),t+=r;t+="}"}return t},n.prototype.addEvent=function(e){this._events.push(e)},n.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},n.prototype.getEvents=function(){return this._events},n.prototype.createRange=function(e,t,n){this._ranges[e]||(this._ranges[e]=new o(e,t,n))},n.prototype.deleteRange=function(e,t){void 0===t&&(t=!0);var n=this._ranges[e];if(n){if(t)for(var r=n.from,i=n.to,o=this._keys.length-1;o>=0;o--)this._keys[o].frame>=r&&this._keys[o].frame<=i&&this._keys.splice(o,1);this._ranges[e]=null}},n.prototype.getRange=function(e){return this._ranges[e]},n.prototype.getKeys=function(){return this._keys},n.prototype.getHighestFrame=function(){for(var e=0,t=0,n=this._keys.length;t<n;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},n.prototype.getEasingFunction=function(){return this._easingFunction},n.prototype.setEasingFunction=function(e){this._easingFunction=e},n.prototype.floatInterpolateFunction=function(e,n,r){return t.Scalar.Lerp(e,n,r)},n.prototype.floatInterpolateFunctionWithTangents=function(e,n,r,i,o){return t.Scalar.Hermite(e,n,r,i,o)},n.prototype.quaternionInterpolateFunction=function(t,n,r){return e.Quaternion.Slerp(t,n,r)},n.prototype.quaternionInterpolateFunctionWithTangents=function(t,n,r,i,o){return e.Quaternion.Hermite(t,n,r,i,o).normalize()},n.prototype.vector3InterpolateFunction=function(t,n,r){return e.Vector3.Lerp(t,n,r)},n.prototype.vector3InterpolateFunctionWithTangents=function(t,n,r,i,o){return e.Vector3.Hermite(t,n,r,i,o)},n.prototype.vector2InterpolateFunction=function(t,n,r){return e.Vector2.Lerp(t,n,r)},n.prototype.vector2InterpolateFunctionWithTangents=function(t,n,r,i,o){return e.Vector2.Hermite(t,n,r,i,o)},n.prototype.sizeInterpolateFunction=function(t,n,r){return e.Size.Lerp(t,n,r)},n.prototype.color3InterpolateFunction=function(t,n,r){return e.Color3.Lerp(t,n,r)},n.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},n.prototype._interpolate=function(e,t,r,i,o,a){if(i===n.ANIMATIONLOOPMODE_CONSTANT&&t>0)return a.clone?a.clone():a;var u=this.getKeys(),c=Math.max(0,Math.min(u.length-1,Math.floor(u.length*(e-u[0].frame)/(u[u.length-1].frame-u[0].frame))-1));if(u[c].frame>=e)for(;c-1>=0&&u[c].frame>=e;)c--;for(var A=c;A<u.length;A++){var O=u[A+1];if(O.frame>=e){var l=u[A],T=this._getKeyValue(l.value);if(l.interpolation===s.STEP)return T;var p=this._getKeyValue(O.value),I=void 0!==l.outTangent&&void 0!==O.inTangent,h=O.frame-l.frame,N=(e-l.frame)/h,f=this.getEasingFunction();switch(null!=f&&(N=f.ease(N)),this.dataType){case n.ANIMATIONTYPE_FLOAT:var _=I?this.floatInterpolateFunctionWithTangents(T,l.outTangent*h,p,O.inTangent*h,N):this.floatInterpolateFunction(T,p,N);switch(i){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return _;case n.ANIMATIONLOOPMODE_RELATIVE:return o*t+_}break;case n.ANIMATIONTYPE_QUATERNION:var g=I?this.quaternionInterpolateFunctionWithTangents(T,l.outTangent.scale(h),p,O.inTangent.scale(h),N):this.quaternionInterpolateFunction(T,p,N);switch(i){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return g;case n.ANIMATIONLOOPMODE_RELATIVE:return g.addInPlace(o.scale(t))}return g;case n.ANIMATIONTYPE_VECTOR3:var E=I?this.vector3InterpolateFunctionWithTangents(T,l.outTangent.scale(h),p,O.inTangent.scale(h),N):this.vector3InterpolateFunction(T,p,N);switch(i){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return E;case n.ANIMATIONLOOPMODE_RELATIVE:return E.add(o.scale(t))}case n.ANIMATIONTYPE_VECTOR2:var M=I?this.vector2InterpolateFunctionWithTangents(T,l.outTangent.scale(h),p,O.inTangent.scale(h),N):this.vector2InterpolateFunction(T,p,N);switch(i){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return M;case n.ANIMATIONLOOPMODE_RELATIVE:return M.add(o.scale(t))}case n.ANIMATIONTYPE_SIZE:switch(i){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(T,p,N);case n.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(T,p,N).add(o.scale(t))}case n.ANIMATIONTYPE_COLOR3:switch(i){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(T,p,N);case n.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(T,p,N).add(o.scale(t))}case n.ANIMATIONTYPE_MATRIX:switch(i){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:if(n.AllowMatricesInterpolation)return this.matrixInterpolateFunction(T,p,N,r);case n.ANIMATIONLOOPMODE_RELATIVE:return T}}break}}return this._getKeyValue(u[u.length-1].value)},n.prototype.matrixInterpolateFunction=function(t,r,i,o){return n.AllowMatrixDecomposeForInterpolation?o?(e.Matrix.DecomposeLerpToRef(t,r,i,o),o):e.Matrix.DecomposeLerp(t,r,i):o?(e.Matrix.LerpToRef(t,r,i,o),o):e.Matrix.Lerp(t,r,i)},n.prototype.clone=function(){var e=new n(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges)for(var t in e._ranges={},this._ranges){var r=this._ranges[t];r&&(e._ranges[t]=r.clone())}return e},n.prototype.setKeys=function(e){this._keys=e.slice(0)},n.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var t=this.dataType;e.keys=[];for(var r=this.getKeys(),i=0;i<r.length;i++){var o=r[i],a={};switch(a.frame=o.frame,t){case n.ANIMATIONTYPE_FLOAT:a.values=[o.value];break;case n.ANIMATIONTYPE_QUATERNION:case n.ANIMATIONTYPE_MATRIX:case n.ANIMATIONTYPE_VECTOR3:case n.ANIMATIONTYPE_COLOR3:a.values=o.value.asArray()}e.keys.push(a)}for(var s in e.ranges=[],this._ranges){var u=this._ranges[s];if(u){var c={};c.name=s,c.from=u.from,c.to=u.to,e.ranges.push(c)}}return e},Object.defineProperty(n,"ANIMATIONTYPE_FLOAT",{get:function(){return n._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_VECTOR3",{get:function(){return n._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_VECTOR2",{get:function(){return n._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_SIZE",{get:function(){return n._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_QUATERNION",{get:function(){return n._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_MATRIX",{get:function(){return n._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_COLOR3",{get:function(){return n._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return n._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return n._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return n._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),n._UniversalLerp=function(e,t,n){var r=e.constructor;return r.Lerp?r.Lerp(e,t,n):r.Slerp?r.Slerp(e,t,n):e.toFixed?e*(1-n)+n*t:t},n.Parse=function(t){var r,i,o=new n(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),a=t.dataType,s=[];for(t.enableBlending&&(o.enableBlending=t.enableBlending),t.blendingSpeed&&(o.blendingSpeed=t.blendingSpeed),i=0;i<t.keys.length;i++){var u,c,A=t.keys[i];switch(a){case n.ANIMATIONTYPE_FLOAT:r=A.values[0],A.values.length>=1&&(u=A.values[1]),A.values.length>=2&&(c=A.values[2]);break;case n.ANIMATIONTYPE_QUATERNION:if(r=e.Quaternion.FromArray(A.values),A.values.length>=8){var O=e.Quaternion.FromArray(A.values.slice(4,8));O.equals(e.Quaternion.Zero())||(u=O)}if(A.values.length>=12){var l=e.Quaternion.FromArray(A.values.slice(8,12));l.equals(e.Quaternion.Zero())||(c=l)}break;case n.ANIMATIONTYPE_MATRIX:r=e.Matrix.FromArray(A.values);break;case n.ANIMATIONTYPE_COLOR3:r=e.Color3.FromArray(A.values);break;case n.ANIMATIONTYPE_VECTOR3:default:r=e.Vector3.FromArray(A.values)}var T={};T.frame=A.frame,T.value=r,null!=u&&(T.inTangent=u),null!=c&&(T.outTangent=c),s.push(T)}if(o.setKeys(s),t.ranges)for(i=0;i<t.ranges.length;i++)r=t.ranges[i],o.createRange(r.name,r.from,r.to);return o},n.AppendSerializedAnimations=function(e,t){i.SerializationHelper.AppendSerializedAnimations(e,t)},n.AllowMatricesInterpolation=!1,n.AllowMatrixDecomposeForInterpolation=!0,n._ANIMATIONTYPE_FLOAT=0,n._ANIMATIONTYPE_VECTOR3=1,n._ANIMATIONTYPE_QUATERNION=2,n._ANIMATIONTYPE_MATRIX=3,n._ANIMATIONTYPE_COLOR3=4,n._ANIMATIONTYPE_VECTOR2=5,n._ANIMATIONTYPE_SIZE=6,n._ANIMATIONLOOPMODE_RELATIVE=0,n._ANIMATIONLOOPMODE_CYCLE=1,n._ANIMATIONLOOPMODE_CONSTANT=2,n}();exports.Animation=c,r.Texture._AnimationParser=c.Parse,n.Node._AnimationRangeFactory=function(e,t,n){return new o(e,t,n)};
},{"../Maths/math":"Iizi","../Maths/math.scalar":"7Iig","../node":"P+He","../Materials/Textures/texture":"KNsj","../Misc/decorators":"knvU"}],"DRQO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VRCameraMetrics=void 0;var e=require("../../Maths/math"),t=function(){function t(){this.compensateDistortion=!0}return Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return e.Matrix.Translation(t,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightHMatrix",{get:function(){var t=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return e.Matrix.Translation(-t,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftPreViewMatrix",{get:function(){return e.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightPreViewMatrix",{get:function(){return e.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}();exports.VRCameraMetrics=t;
},{"../../Maths/math":"Iizi"}],"ZyNI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Camera=void 0;var t=d(require("tslib")),e=require("../Misc/decorators"),r=require("../Misc/smartArray"),i=require("../Misc/tools"),s=require("../Misc/observable"),a=require("../Maths/math"),o=require("../node"),n=require("../Culling/ray"),h=require("../PostProcesses/passPostProcess"),c=require("../PostProcesses/anaglyphPostProcess"),_=require("../PostProcesses/stereoscopicInterlacePostProcess"),m=require("../PostProcesses/vrDistortionCorrectionPostProcess"),p=require("../Animations/animation"),g=require("../Cameras/VR/vrCameraMetrics"),u=require("../Misc/logger");function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};i.get||i.set?Object.defineProperty(e,r,i):e[r]=t[r]}return e.default=t,e}var l=function(d){function l(t,e,i,o){void 0===o&&(o=!0);var n=d.call(this,t,i)||this;return n.upVector=a.Vector3.Up(),n.orthoLeft=null,n.orthoRight=null,n.orthoBottom=null,n.orthoTop=null,n.fov=.8,n.minZ=1,n.maxZ=1e4,n.inertia=.9,n.mode=l.PERSPECTIVE_CAMERA,n.isIntermediate=!1,n.viewport=new a.Viewport(0,0,1,1),n.layerMask=268435455,n.fovMode=l.FOVMODE_VERTICAL_FIXED,n.cameraRigMode=l.RIG_MODE_NONE,n.customRenderTargets=new Array,n.outputRenderTarget=null,n.onViewMatrixChangedObservable=new s.Observable,n.onProjectionMatrixChangedObservable=new s.Observable,n.onAfterCheckInputsObservable=new s.Observable,n.onRestoreStateObservable=new s.Observable,n._rigCameras=new Array,n._webvrViewMatrix=a.Matrix.Identity(),n._skipRendering=!1,n._projectionMatrix=new a.Matrix,n._postProcesses=new Array,n._activeMeshes=new r.SmartArray(256),n._globalPosition=a.Vector3.Zero(),n._computedViewMatrix=a.Matrix.Identity(),n._doNotComputeProjectionMatrix=!1,n._transformMatrix=a.Matrix.Zero(),n._refreshFrustumPlanes=!0,n._isCamera=!0,n.getScene().addCamera(n),o&&!n.getScene().activeCamera&&(n.getScene().activeCamera=n),n.position=e,n}return t.__extends(l,d),l.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},l.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},l.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},l.prototype.getClassName=function(){return"Camera"},l.prototype.toString=function(t){var e="Name: "+this.name;if(e+=", type: "+this.getClassName(),this.animations)for(var r=0;r<this.animations.length;r++)e+=", animation[0]: "+this.animations[r].toString(t);return e},Object.defineProperty(l.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),l.prototype.getActiveMeshes=function(){return this._activeMeshes},l.prototype.isActiveMesh=function(t){return-1!==this._activeMeshes.indexOf(t)},l.prototype.isReady=function(t){if(void 0===t&&(t=!1),t)for(var e=0,r=this._postProcesses;e<r.length;e++){var i=r[e];if(i&&!i.isReady())return!1}return d.prototype.isReady.call(this,t)},l.prototype._initCache=function(){d.prototype._initCache.call(this),this._cache.position=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},l.prototype._updateCache=function(t){t||d.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},l.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},l.prototype._isSynchronizedViewMatrix=function(){return!!d.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},l.prototype._isSynchronizedProjectionMatrix=function(){var t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;var e=this.getEngine();return t=this.mode===l.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===e.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===e.getRenderWidth()&&this._cache.renderHeight===e.getRenderHeight()},l.prototype.attachControl=function(t,e){},l.prototype.detachControl=function(t){},l.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==l.RIG_MODE_NONE&&this._updateRigCameras()},l.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(l.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),l.prototype._getFirstPostProcess=function(){for(var t=0;t<this._postProcesses.length;t++)if(null!==this._postProcesses[t])return this._postProcesses[t];return null},l.prototype._cascadePostProcessesToRigCams=function(){var t=this._getFirstPostProcess();t&&t.markTextureDirty();for(var e=0,r=this._rigCameras.length;e<r;e++){var i=this._rigCameras[e],s=i._rigPostProcess;if(s)s instanceof h.PassPostProcess&&(i.isIntermediate=0===this._postProcesses.length),i._postProcesses=this._postProcesses.slice(0).concat(s),s.markTextureDirty();else i._postProcesses=this._postProcesses.slice(0)}},l.prototype.attachPostProcess=function(t,e){return void 0===e&&(e=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(u.Logger.Error("You're trying to reuse a post process not defined as reusable."),0):(null==e||e<0?this._postProcesses.push(t):null===this._postProcesses[e]?this._postProcesses[e]=t:this._postProcesses.splice(e,0,t),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(t))},l.prototype.detachPostProcess=function(t){var e=this._postProcesses.indexOf(t);-1!==e&&(this._postProcesses[e]=null),this._cascadePostProcessesToRigCams()},l.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},l.prototype._getViewMatrix=function(){return a.Matrix.Identity()},l.prototype.getViewMatrix=function(t){return!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this._currentRenderId,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},l.prototype.freezeProjectionMatrix=function(t){this._doNotComputeProjectionMatrix=!0,void 0!==t&&(this._projectionMatrix=t)},l.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},l.prototype.getProjectionMatrix=function(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var e=this.getEngine(),r=this.getScene();if(this.mode===l.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=e.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),r.useRightHandedSystem?a.Matrix.PerspectiveFovRHToRef(this.fov,e.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===l.FOVMODE_VERTICAL_FIXED):a.Matrix.PerspectiveFovLHToRef(this.fov,e.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===l.FOVMODE_VERTICAL_FIXED);else{var i=e.getRenderWidth()/2,s=e.getRenderHeight()/2;r.useRightHandedSystem?a.Matrix.OrthoOffCenterRHToRef(this.orthoLeft||-i,this.orthoRight||i,this.orthoBottom||-s,this.orthoTop||s,this.minZ,this.maxZ,this._projectionMatrix):a.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-i,this.orthoRight||i,this.orthoBottom||-s,this.orthoTop||s,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=e.getRenderWidth(),this._cache.renderHeight=e.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},l.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},l.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?a.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=a.Frustum.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},l.prototype.isInFrustum=function(t){return this._updateFrustumPlanes(),t.isInFrustum(this._frustumPlanes)},l.prototype.isCompletelyInFrustum=function(t){return this._updateFrustumPlanes(),t.isCompletelyInFrustum(this._frustumPlanes)},l.prototype.getForwardRay=function(t,e,r){void 0===t&&(t=100),e||(e=this.getWorldMatrix()),r||(r=this.position);var i=this._scene.useRightHandedSystem?new a.Vector3(0,0,-1):new a.Vector3(0,0,1),s=a.Vector3.TransformNormal(i,e),o=a.Vector3.Normalize(s);return new n.Ray(r,o,t)},l.prototype.dispose=function(t,e){for(void 0===e&&(e=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var r=this._rigCameras.pop();r&&r.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==l.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var i=this._postProcesses.length;--i>=0;){var s=this._postProcesses[i];s&&s.dispose(this)}for(i=this.customRenderTargets.length;--i>=0;)this.customRenderTargets[i].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),d.prototype.dispose.call(this,t,e)},Object.defineProperty(l.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),l.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},l.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},l.prototype.setCameraRigMode=function(t,e){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){var r=this._rigCameras.pop();r&&r.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=e.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=i.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==l.RIG_MODE_NONE){var s=this.createRigCamera(this.name+"_L",0),o=this.createRigCamera(this.name+"_R",1);s&&o&&(this._rigCameras.push(s),this._rigCameras.push(o))}switch(this.cameraRigMode){case l.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new h.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new c.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case l.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case l.RIG_MODE_STEREOSCOPIC_OVERUNDER:var n=this.cameraRigMode===l.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===l.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new h.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new _.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,n);break;case l.RIG_MODE_VR:var p=e.vrCameraMetrics||g.VRCameraMetrics.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=p,this._rigCameras[0].viewport=new a.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new a.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=p.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=p.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=p,this._rigCameras[1].viewport=new a.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new a.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=p.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=p.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,p.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new m.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,p),this._rigCameras[1]._rigPostProcess=new m.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,p));break;case l.RIG_MODE_WEBVR:if(e.vrDisplay){var u=e.vrDisplay.getEyeParameters("left"),d=e.vrDisplay.getEyeParameters("right");this._rigCameras[0].viewport=new a.Viewport(0,0,.5,1),this._rigCameras[0].setCameraRigParameter("left",!0),this._rigCameras[0].setCameraRigParameter("specs",e.specs),this._rigCameras[0].setCameraRigParameter("eyeParameters",u),this._rigCameras[0].setCameraRigParameter("frameData",e.frameData),this._rigCameras[0].setCameraRigParameter("parentCamera",e.parentCamera),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new a.Matrix,this._rigCameras[0].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[0].parent=this,this._rigCameras[0]._getViewMatrix=this._getWebVRViewMatrix,this._rigCameras[1].viewport=new a.Viewport(.5,0,.5,1),this._rigCameras[1].setCameraRigParameter("eyeParameters",d),this._rigCameras[1].setCameraRigParameter("specs",e.specs),this._rigCameras[1].setCameraRigParameter("frameData",e.frameData),this._rigCameras[1].setCameraRigParameter("parentCamera",e.parentCamera),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new a.Matrix,this._rigCameras[1].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[1].parent=this,this._rigCameras[1]._getViewMatrix=this._getWebVRViewMatrix,l.UseAlternateWebVRRendering&&(this._rigCameras[1]._skipRendering=!0,this._rigCameras[0]._alternateCamera=this._rigCameras[1])}}this._cascadePostProcessesToRigCams(),this.update()}},l.prototype._getVRProjectionMatrix=function(){return a.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},l.prototype._updateCameraRotationMatrix=function(){},l.prototype._updateWebVRCameraRotationMatrix=function(){},l.prototype._getWebVRProjectionMatrix=function(){return a.Matrix.Identity()},l.prototype._getWebVRViewMatrix=function(){return a.Matrix.Identity()},l.prototype.setCameraRigParameter=function(t,e){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=e,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=i.Tools.ToRadians(e/.0637))},l.prototype.createRigCamera=function(t,e){return null},l.prototype._updateRigCameras=function(){for(var t=0;t<this._rigCameras.length;t++)this._rigCameras[t].minZ=this.minZ,this._rigCameras[t].maxZ=this.maxZ,this._rigCameras[t].fov=this.fov,this._rigCameras[t].upVector.copyFrom(this.upVector);this.cameraRigMode===l.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},l.prototype._setupInputs=function(){},l.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),this.inputs&&this.inputs.serialize(t),e.SerializationHelper.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},l.prototype.clone=function(t){return e.SerializationHelper.Clone(l.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},l.prototype.getDirection=function(t){var e=a.Vector3.Zero();return this.getDirectionToRef(t,e),e},l.prototype.getDirectionToRef=function(t,e){a.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),e)},l.GetConstructorFromName=function(t,e,r,i,s){void 0===i&&(i=0),void 0===s&&(s=!0);var a=o.Node.Construct(t,e,r,{interaxial_distance:i,isStereoscopicSideBySide:s});return a||function(){return l._createDefaultParsedCamera(e,r)}},l.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},l.Parse=function(t,r){var i=t.type,s=l.GetConstructorFromName(i,t.name,r,t.interaxial_distance,t.isStereoscopicSideBySide),n=e.SerializationHelper.Parse(s,t,r);if(t.parentId&&(n._waitingParentId=t.parentId),n.inputs&&(n.inputs.parse(t),n._setupInputs()),n.setPosition&&(n.position.copyFromFloats(0,0,0),n.setPosition(a.Vector3.FromArray(t.position))),t.target&&n.setTarget&&n.setTarget(a.Vector3.FromArray(t.target)),t.cameraRigMode){var h=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};n.setCameraRigMode(t.cameraRigMode,h)}if(t.animations){for(var c=0;c<t.animations.length;c++){var _=t.animations[c];n.animations.push(p.Animation.Parse(_))}o.Node.ParseAnimationRanges(n,t,r)}return t.autoAnimate&&r.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),n},l._createDefaultParsedCamera=function(t,e){throw"UniversalCamera needs to be imported before deserialization can create a default camera."},l.PERSPECTIVE_CAMERA=0,l.ORTHOGRAPHIC_CAMERA=1,l.FOVMODE_VERTICAL_FIXED=0,l.FOVMODE_HORIZONTAL_FIXED=1,l.RIG_MODE_NONE=0,l.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,l.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,l.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,l.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,l.RIG_MODE_VR=20,l.RIG_MODE_WEBVR=21,l.RIG_MODE_CUSTOM=22,l.ForceAttachControlToAlwaysPreventDefault=!1,l.UseAlternateWebVRRendering=!1,t.__decorate([(0,e.serializeAsVector3)()],l.prototype,"position",void 0),t.__decorate([(0,e.serializeAsVector3)()],l.prototype,"upVector",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"orthoLeft",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"orthoRight",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"orthoBottom",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"orthoTop",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"fov",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"minZ",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"maxZ",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"inertia",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"mode",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"layerMask",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"fovMode",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"cameraRigMode",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"interaxialDistance",void 0),t.__decorate([(0,e.serialize)()],l.prototype,"isStereoscopicSideBySide",void 0),l}(o.Node);exports.Camera=l;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Misc/smartArray":"vK5Y","../Misc/tools":"RkuS","../Misc/observable":"gtkL","../Maths/math":"Iizi","../node":"P+He","../Culling/ray":"5ppN","../PostProcesses/passPostProcess":"E14w","../PostProcesses/anaglyphPostProcess":"ZLxN","../PostProcesses/stereoscopicInterlacePostProcess":"yeJK","../PostProcesses/vrDistortionCorrectionPostProcess":"UU+7","../Animations/animation":"8SP4","../Cameras/VR/vrCameraMetrics":"DRQO","../Misc/logger":"Fvml"}],"x731":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractScene=void 0;var r=function(){function r(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array}return r.AddParser=function(r,e){this._BabylonFileParsers[r]=e},r.GetParser=function(r){return this._BabylonFileParsers[r]?this._BabylonFileParsers[r]:null},r.AddIndividualParser=function(r,e){this._IndividualBabylonFileParsers[r]=e},r.GetIndividualParser=function(r){return this._IndividualBabylonFileParsers[r]?this._IndividualBabylonFileParsers[r]:null},r.Parse=function(r,e,s,a){for(var i in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(i)&&this._BabylonFileParsers[i](r,e,s,a)},r._BabylonFileParsers={},r._IndividualBabylonFileParsers={},r}();exports.AbstractScene=r;
},{}],"2sZs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MaterialDefines=void 0;var t=function(){function t(){this._isDirty=!0,this._areLightsDirty=!0,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),t.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},t.prototype.markAsUnprocessed=function(){this._isDirty=!0},t.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},t.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},t.prototype.markAsLightDirty=function(){this._areLightsDirty=!0,this._isDirty=!0},t.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},t.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},t.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},t.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},t.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var t=0,i=Object.keys(this);t<i.length;t++){var e=i[t];"_"!==e[0]&&this._keys.push(e)}},t.prototype.isEqual=function(t){if(this._keys.length!==t._keys.length)return!1;for(var i=0;i<this._keys.length;i++){var e=this._keys[i];if(this[e]!==t[e])return!1}return!0},t.prototype.cloneTo=function(t){this._keys.length!==t._keys.length&&(t._keys=this._keys.slice(0));for(var i=0;i<this._keys.length;i++){var e=this._keys[i];t[e]=this[e]}},t.prototype.reset=function(){for(var t=0;t<this._keys.length;t++){var i=this._keys[t];switch(typeof this[i]){case"number":this[i]=0;break;case"string":this[i]="";break;default:this[i]=!1}}},t.prototype.toString=function(){for(var t="",i=0;i<this._keys.length;i++){var e=this._keys[i],r=this[e];switch(typeof r){case"number":case"string":t+="#define "+e+" "+r+"\n";break;default:r&&(t+="#define "+e+"\n")}}return t},t}();exports.MaterialDefines=t;
},{}],"0Cqw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorCurves=void 0;var e=i(require("tslib")),t=require("../Misc/decorators"),o=require("../Maths/math");function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};i.get||i.set?Object.defineProperty(t,o,i):t[o]=e[o]}return t.default=e,t}var r=function(){function i(){this._dirty=!0,this._tempColor=new o.Color4(0,0,0,0),this._globalCurve=new o.Color4(0,0,0,0),this._highlightsCurve=new o.Color4(0,0,0,0),this._midtonesCurve=new o.Color4(0,0,0,0),this._shadowsCurve=new o.Color4(0,0,0,0),this._positiveCurve=new o.Color4(0,0,0,0),this._negativeCurve=new o.Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(i.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"ColorCurves"},i.Bind=function(e,t,o,i,r){void 0===o&&(o="vCameraColorCurvePositive"),void 0===i&&(i="vCameraColorCurveNeutral"),void 0===r&&(r="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(o,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(i,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(r,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},i.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},i.prototype.getColorGradingDataToRef=function(e,t,o,r,s){null!=e&&(e=i.clamp(e,0,360),t=i.clamp(t,-100,100),o=i.clamp(o,-100,100),r=i.clamp(r,-100,100),t=i.applyColorGradingSliderNonlinear(t),t*=.5,r=i.applyColorGradingSliderNonlinear(r),t<0&&(t*=-1,e=(e+180)%360),i.fromHSBToRef(e,t,50+.25*r,s),s.scaleToRef(2,s),s.a=1+.01*o)},i.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100},i.fromHSBToRef=function(e,t,o,r){var s=i.clamp(e,0,360),n=i.clamp(t/100,0,1),a=i.clamp(o/100,0,1);if(0===n)r.r=a,r.g=a,r.b=a;else{s/=60;var u=Math.floor(s),l=s-u,h=a*(1-n),_=a*(1-n*l),p=a*(1-n*(1-l));switch(u){case 0:r.r=a,r.g=p,r.b=h;break;case 1:r.r=_,r.g=a,r.b=h;break;case 2:r.r=h,r.g=a,r.b=p;break;case 3:r.r=h,r.g=_,r.b=a;break;case 4:r.r=p,r.g=h,r.b=a;break;default:r.r=a,r.g=h,r.b=_}}r.a=1},i.clamp=function(e,t,o){return Math.min(Math.max(e,t),o)},i.prototype.clone=function(){return t.SerializationHelper.Clone(function(){return new i},this)},i.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},i.Parse=function(e){return t.SerializationHelper.Parse(function(){return new i},e,null,null)},e.__decorate([(0,t.serialize)()],i.prototype,"_globalHue",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_globalDensity",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_globalSaturation",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_globalExposure",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_highlightsHue",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_highlightsDensity",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_highlightsSaturation",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_highlightsExposure",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_midtonesHue",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_midtonesDensity",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_midtonesSaturation",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"_midtonesExposure",void 0),i}();exports.ColorCurves=r,t.SerializationHelper._ColorCurvesParser=r.Parse;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi"}],"Ik3r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ImageProcessingConfiguration=exports.ImageProcessingConfigurationDefines=void 0;var e=a(require("tslib")),t=require("../Misc/decorators"),r=require("../Misc/observable"),i=require("../Misc/tools"),o=require("../Maths/math"),n=require("../Materials/materialDefines"),s=require("../Materials/colorCurves");function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var l=function(t){function r(){var e=t.call(this)||this;return e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.rebuild(),e}return e.__extends(r,t),r}(n.MaterialDefines);exports.ImageProcessingConfigurationDefines=l;var p=function(){function n(){this.colorCurves=new s.ColorCurves,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=n.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new o.Color4(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=n.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new r.Observable}return Object.defineProperty(n.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),n.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},n.prototype.getClassName=function(){return"ImageProcessingConfiguration"},n.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&s.ColorCurves.PrepareUniforms(e)},n.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},n.prototype.prepareDefines=function(e,t){if(void 0===t&&(t=!1),t!==this.applyByPostProcess||!this._isEnabled)return e.VIGNETTE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.IMAGEPROCESSING=!1,void(e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===n._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case n.TONEMAPPING_ACES:e.TONEMAPPING_ACES=!0;break;default:e.TONEMAPPING_ACES=!1}e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING},n.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},n.prototype.bind=function(e,t){if(void 0===t&&(t=1),this._colorCurvesEnabled&&this.colorCurves&&s.ColorCurves.Bind(this.colorCurves,e),this._vignetteEnabled){var r=1/e.getEngine().getRenderWidth(),o=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",r,o);var n=Math.tan(.5*this.vignetteCameraFov),a=n*t,l=Math.sqrt(a*n);a=i.Tools.Mix(a,l,this.vignetteStretch),n=i.Tools.Mix(n,l,this.vignetteStretch),e.setFloat4("vignetteSettings1",a,n,-a*this.vignetteCentreX,-n*this.vignetteCentreY);var p=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,p)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var c=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(c-1)/c,.5/c,c,this.colorGradingTexture.level)}},n.prototype.clone=function(){return t.SerializationHelper.Clone(function(){return new n},this)},n.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},n.Parse=function(e){return t.SerializationHelper.Parse(function(){return new n},e,null,null)},Object.defineProperty(n,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(n,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),n.TONEMAPPING_STANDARD=0,n.TONEMAPPING_ACES=1,n._VIGNETTEMODE_MULTIPLY=0,n._VIGNETTEMODE_OPAQUE=1,e.__decorate([(0,t.serializeAsColorCurves)()],n.prototype,"colorCurves",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_colorCurvesEnabled",void 0),e.__decorate([(0,t.serializeAsTexture)("colorGradingTexture")],n.prototype,"_colorGradingTexture",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_colorGradingEnabled",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_colorGradingWithGreenDepth",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_colorGradingBGR",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_exposure",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_toneMappingEnabled",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_toneMappingType",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_contrast",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"vignetteStretch",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"vignetteCentreX",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"vignetteCentreY",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"vignetteWeight",void 0),e.__decorate([(0,t.serializeAsColor4)()],n.prototype,"vignetteColor",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"vignetteCameraFov",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_vignetteBlendMode",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_vignetteEnabled",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_applyByPostProcess",void 0),e.__decorate([(0,t.serialize)()],n.prototype,"_isEnabled",void 0),n}();exports.ImageProcessingConfiguration=p,t.SerializationHelper._ImageProcessingConfigurationParser=p.Parse;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Misc/observable":"gtkL","../Misc/tools":"RkuS","../Maths/math":"Iizi","../Materials/materialDefines":"2sZs","../Materials/colorCurves":"0Cqw"}],"pkXc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RuntimeAnimation=void 0;var e=require("../Maths/math"),t=require("./animation"),i=Object.freeze(new e.Quaternion(0,0,0,0)),r=Object.freeze(e.Vector3.Zero()),a=Object.freeze(e.Vector2.Zero()),n=Object.freeze(e.Size.Zero()),o=Object.freeze(e.Color3.Black()),s=function(){function s(e,t,i,r){var a=this;this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._animation=t,this._target=e,this._scene=i,this._host=r,t._runtimeAnimations.push(this);var n=t.getEvents();n&&n.length>0&&n.forEach(function(e){a._events.push(e._clone())})}return Object.defineProperty(s.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"weight",{get:function(){return this._weight},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"target",{get:function(){return this._activeTarget},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),s.prototype.reset=function(e){if(void 0===e&&(e=!1),e)if(this._target instanceof Array)for(var t=0,i=0,r=this._target;i<r.length;i++){var a=r[i];void 0!==this._originalValue[t]&&this._setValue(a,this._originalValue[t],-1),t++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._originalValue[0],-1);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,this._originalValue=new Array;for(t=0;t<this._events.length;t++)this._events[t].isDone=!1},s.prototype.isStopped=function(){return this._stopped},s.prototype.dispose=function(){var e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)},s.prototype._interpolate=function(i,r,a,n,o){return this._currentFrame=i,this._animation.dataType!==t.Animation.ANIMATIONTYPE_MATRIX||this._workValue||(this._workValue=e.Matrix.Zero()),this._animation._interpolate(i,r,this._workValue,a,n,o)},s.prototype.setValue=function(e,t){if(void 0===t&&(t=1),this._target instanceof Array)for(var i=0,r=0,a=this._target;r<a.length;r++){var n=a[r];this._setValue(n,e,t,i),i++}else this._setValue(this._target,e,t)},s.prototype._setValue=function(i,r,a,n){var o,s;void 0===n&&(n=0);var h=this._animation.targetPropertyPath;if(h.length>1){for(var _=i[h[0]],l=1;l<h.length-1;l++)_=_[h[l]];o=h[h.length-1],s=_}else o=h[0],s=i;if(this._targetPath=o,this._activeTarget=s,this._weight=a,void 0===this._originalValue[n]){var u=void 0;(u=s.getRestPose&&"_matrix"===o?s.getRestPose():s[o])&&u.clone?this._originalValue[n]=u.clone():this._originalValue[n]=u}if((i&&i.animationPropertiesOverride?i.animationPropertiesOverride.enableBlending:this._animation.enableBlending)&&this._blendingFactor<=1){if(!this._originalBlendValue)(u=s[o]).clone?this._originalBlendValue=u.clone():this._originalBlendValue=u;this._originalBlendValue.m?t.Animation.AllowMatrixDecomposeForInterpolation?this._currentValue?e.Matrix.DecomposeLerpToRef(this._originalBlendValue,r,this._blendingFactor,this._currentValue):this._currentValue=e.Matrix.DecomposeLerp(this._originalBlendValue,r,this._blendingFactor):this._currentValue?e.Matrix.LerpToRef(this._originalBlendValue,r,this._blendingFactor,this._currentValue):this._currentValue=e.Matrix.Lerp(this._originalBlendValue,r,this._blendingFactor):this._currentValue=t.Animation._UniversalLerp(this._originalBlendValue,r,this._blendingFactor);var c=i&&i.animationPropertiesOverride?i.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=c}else this._currentValue=r;-1!==a?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[n]):s[o]=this._currentValue,i.markAsDirty&&i.markAsDirty(this._animation.targetProperty)},s.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},s.prototype.goToFrame=function(e){var t=this._animation.getKeys();e<t[0].frame?e=t[0].frame:e>t[t.length-1].frame&&(e=t[t.length-1].frame);var i=this._interpolate(e,0,this._getCorrectLoopMode());this.setValue(i,-1)},s.prototype._prepareForSpeedRatioChange=function(e){var t=this._previousDelay*(this._animation.framePerSecond*e)/1e3;this._ratioOffset=this._previousRatio-t},s.prototype.animate=function(e,s,h,_,l,u,c){void 0===u&&(u=-1);var f=this._animation.targetPropertyPath;if(!f||f.length<1)return this._stopped=!0,!1;var m=!0,g=this._animation.getKeys();if(0!==g[0].frame){var p={frame:0,value:g[0].value};g.splice(0,0,p)}else if(1===g.length){p={frame:.001,value:g[0].value};g.push(p)}(s<g[0].frame||s>g[g.length-1].frame)&&(s=g[0].frame),(h<g[0].frame||h>g[g.length-1].frame)&&(h=g[g.length-1].frame),s===h&&(s>g[0].frame?s--:h<g[g.length-1].frame&&h++);var A,d=h-s,v=e*(this._animation.framePerSecond*l)/1e3+this._ratioOffset,O=0;if(this._previousDelay=e,this._previousRatio=v,(h>s&&v>=d||s>h&&v<=d)&&!_)m=!1,O=this._animation._getKeyValue(g[g.length-1].value);else if(this._getCorrectLoopMode()!==t.Animation.ANIMATIONLOOPMODE_CYCLE){var b=h.toString()+s.toString();if(!this._offsetsCache[b]){var V=this._interpolate(s,0,t.Animation.ANIMATIONLOOPMODE_CYCLE),T=this._interpolate(h,0,t.Animation.ANIMATIONLOOPMODE_CYCLE);switch(this._animation.dataType){case t.Animation.ANIMATIONTYPE_FLOAT:this._offsetsCache[b]=T-V;break;case t.Animation.ANIMATIONTYPE_QUATERNION:this._offsetsCache[b]=T.subtract(V);break;case t.Animation.ANIMATIONTYPE_VECTOR3:this._offsetsCache[b]=T.subtract(V);case t.Animation.ANIMATIONTYPE_VECTOR2:this._offsetsCache[b]=T.subtract(V);case t.Animation.ANIMATIONTYPE_SIZE:this._offsetsCache[b]=T.subtract(V);case t.Animation.ANIMATIONTYPE_COLOR3:this._offsetsCache[b]=T.subtract(V)}this._highLimitsCache[b]=T}O=this._highLimitsCache[b],A=this._offsetsCache[b]}if(void 0===A)switch(this._animation.dataType){case t.Animation.ANIMATIONTYPE_FLOAT:A=0;break;case t.Animation.ANIMATIONTYPE_QUATERNION:A=i;break;case t.Animation.ANIMATIONTYPE_VECTOR3:A=r;break;case t.Animation.ANIMATIONTYPE_VECTOR2:A=a;break;case t.Animation.ANIMATIONTYPE_SIZE:A=n;break;case t.Animation.ANIMATIONTYPE_COLOR3:A=o}var y=v/d>>0,P=m?s+v%d:h;if(this._host&&this._host.syncRoot){var I=this._host.syncRoot;P=s+(h-s)*((I.masterFrame-I.fromFrame)/(I.toFrame-I.fromFrame))}var N=this._events;if(d>0&&this.currentFrame>P||d<0&&this.currentFrame<P){c&&c();for(var M=0;M<N.length;M++)N[M].onlyOnce||(N[M].isDone=!1)}var C=this._interpolate(P,y,this._getCorrectLoopMode(),A,O);this.setValue(C,u);for(M=0;M<N.length;M++)if(d>0&&P>=N[M].frame&&N[M].frame>=s||d<0&&P<=N[M].frame&&N[M].frame<=s){var E=N[M];E.isDone||(E.onlyOnce&&(N.splice(M,1),M--),E.isDone=!0,E.action(P))}return m||(this._stopped=!0),m},s}();exports.RuntimeAnimation=s;
},{"../Maths/math":"Iizi","./animation":"8SP4"}],"AnKL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Animatable=void 0;var t=require("./runtimeAnimation"),i=require("../Misc/observable"),e=function(){function e(t,e,n,a,o,s,r,h,l){void 0===n&&(n=0),void 0===a&&(a=100),void 0===o&&(o=!1),void 0===s&&(s=1),this.target=e,this.fromFrame=n,this.toFrame=a,this.loopAnimation=o,this.onAnimationEnd=r,this.onAnimationLoop=l,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new i.Observable,this.onAnimationLoopObservable=new i.Observable,this._scene=t,h&&this.appendAnimations(e,h),this._speedRatio=s,t._activeAnimatables.push(this)}return Object.defineProperty(e.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"masterFrame",{get:function(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(t){this._weight=-1!==t?Math.min(Math.max(t,0),1):-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(t){for(var i=0;i<this._runtimeAnimations.length;i++){this._runtimeAnimations[i]._prepareForSpeedRatioChange(t)}this._speedRatio=t},enumerable:!0,configurable:!0}),e.prototype.syncWith=function(t){if(this._syncRoot=t,t){var i=this._scene._activeAnimatables.indexOf(this);i>-1&&(this._scene._activeAnimatables.splice(i,1),this._scene._activeAnimatables.push(this))}return this},e.prototype.getAnimations=function(){return this._runtimeAnimations},e.prototype.appendAnimations=function(i,e){for(var n=0;n<e.length;n++){var a=e[n];this._runtimeAnimations.push(new t.RuntimeAnimation(i,a,this._scene,this))}},e.prototype.getAnimationByTargetProperty=function(t){for(var i=this._runtimeAnimations,e=0;e<i.length;e++)if(i[e].animation.targetProperty===t)return i[e].animation;return null},e.prototype.getRuntimeAnimationByTargetProperty=function(t){for(var i=this._runtimeAnimations,e=0;e<i.length;e++)if(i[e].animation.targetProperty===t)return i[e];return null},e.prototype.reset=function(){for(var t=this._runtimeAnimations,i=0;i<t.length;i++)t[i].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(t){for(var i=this._runtimeAnimations,e=0;e<i.length;e++)i[e].animation.enableBlending=!0,i[e].animation.blendingSpeed=t},e.prototype.disableBlending=function(){for(var t=this._runtimeAnimations,i=0;i<t.length;i++)t[i].animation.enableBlending=!1},e.prototype.goToFrame=function(t){var i=this._runtimeAnimations;if(i[0]){var e=i[0].animation.framePerSecond,n=1e3*(t-i[0].currentFrame)/(e*this.speedRatio);null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=n}for(var a=0;a<i.length;a++)i[a].goToFrame(t)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},e.prototype.stop=function(t,i){if(t||i){var e=this._scene._activeAnimatables.indexOf(this);if(e>-1){for(var n=(o=this._runtimeAnimations).length-1;n>=0;n--){var a=o[n];t&&a.animation.name!=t||(i&&!i(a.target)||(a.dispose(),o.splice(n,1)))}0==o.length&&(this._scene._activeAnimatables.splice(e,1),this._raiseOnAnimationEnd())}}else{if((n=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(n,1);var o=this._runtimeAnimations;for(n=0;n<o.length;n++)o[n].dispose();this._raiseOnAnimationEnd()}}},e.prototype.waitAsync=function(){var t=this;return new Promise(function(i,e){t.onAnimationEndObservable.add(function(){i(t)},void 0,void 0,t,!0)})},e.prototype._animate=function(t){var i=this;if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=t),!0;if(null===this._localDelayOffset?(this._localDelayOffset=t,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=t-this._pausedDelay,this._pausedDelay=null),0===this._weight)return!0;var e,n=!1,a=this._runtimeAnimations;for(e=0;e<a.length;e++){var o=a[e].animate(t-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight,function(){i.onAnimationLoopObservable.notifyObservers(i),i.onAnimationLoop&&i.onAnimationLoop()});n=n||o}if(this.animationStarted=n,!n){if(this.disposeOnEnd)for(e=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(e,1),e=0;e<a.length;e++)a[e].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return n},e}();exports.Animatable=e;
},{"./runtimeAnimation":"pkXc","../Misc/observable":"gtkL"}],"U3iz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Light=void 0;var e=o(require("tslib")),t=require("../Misc/decorators"),r=require("../Maths/math"),i=require("../node"),n=require("../Materials/uniformBuffer"),s=require("../Animations/animation");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var a=function(o){function a(e,t){var i=o.call(this,e,t)||this;return i.diffuse=new r.Color3(1,1,1),i.specular=new r.Color3(1,1,1),i.falloffType=a.FALLOFF_DEFAULT,i.intensity=1,i._range=Number.MAX_VALUE,i._inverseSquaredRange=0,i._photometricScale=1,i._intensityMode=a.INTENSITYMODE_AUTOMATIC,i._radius=1e-5,i.renderPriority=0,i._shadowEnabled=!0,i._excludeWithLayerMask=0,i._includeOnlyWithLayerMask=0,i._lightmapMode=0,i._excludedMeshesIds=new Array,i._includedOnlyMeshesIds=new Array,i._isLight=!0,i.getScene().addLight(i),i._uniformBuffer=new n.UniformBuffer(i.getScene().getEngine()),i._buildUniformLayout(),i.includedOnlyMeshes=new Array,i.excludedMeshes=new Array,i._resyncMeshes(),i}return e.__extends(a,o),Object.defineProperty(a.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"Light"},a.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var r=0;r<this.animations.length;r++)t+=", animation[0]: "+this.animations[r].toString(e);return t},a.prototype._syncParentEnabledState=function(){o.prototype._syncParentEnabledState.call(this),this._resyncMeshes()},a.prototype.setEnabled=function(e){o.prototype.setEnabled.call(this,e),this._resyncMeshes()},a.prototype.getShadowGenerator=function(){return this._shadowGenerator},a.prototype.getAbsolutePosition=function(){return r.Vector3.Zero()},a.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},a.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},a.prototype.dispose=function(e,t){void 0===t&&(t=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var r=0,i=this.getScene().meshes;r<i.length;r++){i[r]._removeLightSource(this)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),o.prototype.dispose.call(this,e,t)},a.prototype.getTypeID=function(){return 0},a.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},a.prototype.clone=function(e){var r=a.GetConstructorFromName(this.getTypeID(),e,this.getScene());return r?t.SerializationHelper.Clone(r,this):null},a.prototype.serialize=function(){var e=t.SerializationHelper.Serialize(this);return e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.id),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(function(t){e.excludedMeshesIds.push(t.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(t){e.includedOnlyMeshesIds.push(t.id)})),t.SerializationHelper.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},a.GetConstructorFromName=function(e,t,r){var n=i.Node.Construct("Light_Type_"+e,t,r);return n||null},a.Parse=function(e,r){var n=a.GetConstructorFromName(e.type,e.name,r);if(!n)return null;var o=t.SerializationHelper.Parse(n,e,r);if(e.excludedMeshesIds&&(o._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(o._waitingParentId=e.parentId),e.animations){for(var h=0;h<e.animations.length;h++){var c=e.animations[h];o.animations.push(s.Animation.Parse(c))}i.Node.ParseAnimationRanges(o,e,r)}return e.autoAnimate&&r.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),o},a.prototype._hookArrayForExcluded=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];for(var s=r.apply(e,i),o=0,a=i;o<a.length;o++){a[o]._resyncLighSource(t)}return s};var i=e.splice;e.splice=function(r,n){for(var s=i.apply(e,[r,n]),o=0,a=s;o<a.length;o++){a[o]._resyncLighSource(t)}return s};for(var n=0,s=e;n<s.length;n++){s[n]._resyncLighSource(this)}},a.prototype._hookArrayForIncludedOnly=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var s=r.apply(e,i);return t._resyncMeshes(),s};var i=e.splice;e.splice=function(r,n){var s=i.apply(e,[r,n]);return t._resyncMeshes(),s},this._resyncMeshes()},a.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){t[e]._resyncLighSource(this)}},a.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var r=t[e];-1!==r._lightSources.indexOf(this)&&r._markSubMeshesAsLightDirty()}},a.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},a.prototype._getPhotometricScale=function(){var e=0,t=this.getTypeID(),r=this.intensityMode;switch(r===a.INTENSITYMODE_AUTOMATIC&&(r=t===a.LIGHTTYPEID_DIRECTIONALLIGHT?a.INTENSITYMODE_ILLUMINANCE:a.INTENSITYMODE_LUMINOUSINTENSITY),t){case a.LIGHTTYPEID_POINTLIGHT:case a.LIGHTTYPEID_SPOTLIGHT:switch(r){case a.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case a.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case a.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case a.LIGHTTYPEID_DIRECTIONALLIGHT:switch(r){case a.INTENSITYMODE_ILLUMINANCE:e=1;break;case a.INTENSITYMODE_LUMINANCE:var i=this.radius;i=Math.max(i,.001),e=2*Math.PI*(1-Math.cos(i))}break;case a.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},a.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},a.FALLOFF_DEFAULT=0,a.FALLOFF_PHYSICAL=1,a.FALLOFF_GLTF=2,a.FALLOFF_STANDARD=3,a.LIGHTMAP_DEFAULT=0,a.LIGHTMAP_SPECULAR=1,a.LIGHTMAP_SHADOWSONLY=2,a.INTENSITYMODE_AUTOMATIC=0,a.INTENSITYMODE_LUMINOUSPOWER=1,a.INTENSITYMODE_LUMINOUSINTENSITY=2,a.INTENSITYMODE_ILLUMINANCE=3,a.INTENSITYMODE_LUMINANCE=4,a.LIGHTTYPEID_POINTLIGHT=0,a.LIGHTTYPEID_DIRECTIONALLIGHT=1,a.LIGHTTYPEID_SPOTLIGHT=2,a.LIGHTTYPEID_HEMISPHERICLIGHT=3,e.__decorate([(0,t.serializeAsColor3)()],a.prototype,"diffuse",void 0),e.__decorate([(0,t.serializeAsColor3)()],a.prototype,"specular",void 0),e.__decorate([(0,t.serialize)()],a.prototype,"falloffType",void 0),e.__decorate([(0,t.serialize)()],a.prototype,"intensity",void 0),e.__decorate([(0,t.serialize)()],a.prototype,"range",null),e.__decorate([(0,t.serialize)()],a.prototype,"intensityMode",null),e.__decorate([(0,t.serialize)()],a.prototype,"radius",null),e.__decorate([(0,t.serialize)()],a.prototype,"_renderPriority",void 0),e.__decorate([(0,t.expandToProperty)("_reorderLightsInScene")],a.prototype,"renderPriority",void 0),e.__decorate([(0,t.serialize)("shadowEnabled")],a.prototype,"_shadowEnabled",void 0),e.__decorate([(0,t.serialize)("excludeWithLayerMask")],a.prototype,"_excludeWithLayerMask",void 0),e.__decorate([(0,t.serialize)("includeOnlyWithLayerMask")],a.prototype,"_includeOnlyWithLayerMask",void 0),e.__decorate([(0,t.serialize)("lightmapMode")],a.prototype,"_lightmapMode",void 0),a}(i.Node);exports.Light=a;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi","../node":"P+He","../Materials/uniformBuffer":"oGUW","../Animations/animation":"8SP4"}],"MxsK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CollisionCoordinatorLegacy=void 0;var o=require("../Maths/math"),i=require("../Engines/engine"),e=function(){function e(){this._scaledPosition=o.Vector3.Zero(),this._scaledVelocity=o.Vector3.Zero(),this._finalPosition=o.Vector3.Zero()}return e.prototype.getNewPosition=function(o,i,e,t,s,n,l){o.divideToRef(e._radius,this._scaledPosition),i.divideToRef(e._radius,this._scaledVelocity),e.collidedMesh=null,e._retry=0,e._initialVelocity=this._scaledVelocity,e._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,e,t,this._finalPosition,s),this._finalPosition.multiplyInPlace(e._radius),n(l,this._finalPosition,e.collidedMesh)},e.prototype.init=function(o){this._scene=o},e.prototype.destroy=function(){},e.prototype.onMeshAdded=function(o){},e.prototype.onMeshUpdated=function(o){},e.prototype.onMeshRemoved=function(o){},e.prototype.onGeometryAdded=function(o){},e.prototype.onGeometryUpdated=function(o){},e.prototype.onGeometryDeleted=function(o){},e.prototype._collideWithWorld=function(o,e,t,s,n,l){void 0===l&&(l=null);var r=10*i.Engine.CollisionsEpsilon;if(t._retry>=s)n.copyFrom(o);else{var c=l?l.collisionMask:t.collisionMask;t._initialize(o,e,r);for(var d=0;d<this._scene.meshes.length;d++){var a=this._scene.meshes[d];a.isEnabled()&&a.checkCollisions&&a.subMeshes&&a!==l&&0!=(c&a.collisionGroup)&&a._checkCollision(t)}t.collisionFound?(0===e.x&&0===e.y&&0===e.z||t._getResponse(o,e),e.length()<=r?n.copyFrom(o):(t._retry++,this._collideWithWorld(o,e,t,s,n,l))):o.addToRef(e,n)}},e}();exports.CollisionCoordinatorLegacy=e;
},{"../Maths/math":"Iizi","../Engines/engine":"Z5lb"}],"6huE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PointerInfo=exports.PointerInfoPre=exports.PointerInfoBase=exports.PointerEventTypes=void 0;var e=r(require("tslib")),t=require("../Maths/math");function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}var n=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}();exports.PointerEventTypes=n;var o=function(){return function(e,t){this.type=e,this.event=t}}();exports.PointerInfoBase=o;var i=function(r){function n(e,n,o,i){var s=r.call(this,e,n)||this;return s.ray=null,s.skipOnPointerObservable=!1,s.localPosition=new t.Vector2(o,i),s}return e.__extends(n,r),n}(o);exports.PointerInfoPre=i;var s=function(t){function r(e,r,n){var o=t.call(this,e,r)||this;return o.pickInfo=n,o}return e.__extends(r,t),r}(o);exports.PointerInfo=s;
},{"tslib":"vCxL","../Maths/math":"Iizi"}],"urGo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KeyboardInfoPre=exports.KeyboardInfo=exports.KeyboardEventTypes=void 0;var e=r(require("tslib"));function r(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}var t=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}();exports.KeyboardEventTypes=t;var n=function(){return function(e,r){this.type=e,this.event=r}}();exports.KeyboardInfo=n;var o=function(r){function t(e,t){var n=r.call(this,e,t)||this;return n.type=e,n.event=t,n.skipOnPointerObservable=!1,n}return e.__extends(t,r),t}(n);exports.KeyboardInfoPre=o;
},{"tslib":"vCxL"}],"dqHz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActionEvent=void 0;var e=function(){function e(e,t,n,r,i,o){this.source=e,this.pointerX=t,this.pointerY=n,this.meshUnderPointer=r,this.sourceEvent=i,this.additionalData=o}return e.CreateNew=function(t,n,r){var i=t.getScene();return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer,n,r)},e.CreateNewFromSprite=function(t,n,r,i){return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,r,i)},e.CreateNewFromScene=function(t,n){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,n)},e.CreateNewFromPrimitive=function(t,n,r,i){return new e(t,n.x,n.y,null,r,i)},e}();exports.ActionEvent=e;
},{}],"kR/o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Action=void 0;var e=require("../Misc/observable"),t=require("../Maths/math"),i=require("../Misc/typeStore"),r=function(){function i(t,i){this.triggerOptions=t,this.onBeforeExecuteObservable=new e.Observable,t.parameter?(this.trigger=t.trigger,this._triggerParameter=t.parameter):t.trigger?this.trigger=t.trigger:this.trigger=t,this._nextActiveAction=this,this._condition=i}return i.prototype._prepare=function(){},i.prototype.getTriggerParameter=function(){return this._triggerParameter},i.prototype._executeCurrent=function(e){if(this._nextActiveAction._condition){var t=this._nextActiveAction._condition,i=this._actionManager.getScene().getRenderId();if(t._evaluationId===i){if(!t._currentResult)return}else{if(t._evaluationId=i,!t.isValid())return void(t._currentResult=!1);t._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(e),this.skipToNextActiveAction()},i.prototype.execute=function(e){},i.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},i.prototype.then=function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},i.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},i.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},i.prototype.serialize=function(e){},i.prototype._serialize=function(e,t){var i={type:1,children:[],name:e.name,properties:e.properties||[]};if(this._child&&this._child.serialize(i),this._condition){var r=this._condition.serialize();return r.children.push(i),t&&t.children.push(r),r}return t&&t.children.push(i),i},i._SerializeValueAsString=function(e){return"number"==typeof e?e.toString():"boolean"==typeof e?e?"true":"false":e instanceof t.Vector2?e.x+", "+e.y:e instanceof t.Vector3?e.x+", "+e.y+", "+e.z:e instanceof t.Color3?e.r+", "+e.g+", "+e.b:e instanceof t.Color4?e.r+", "+e.g+", "+e.b+", "+e.a:e},i._GetTargetProperty=function(e){return{name:"target",targetType:e._isMesh?"MeshProperties":e._isLight?"LightProperties":e._isCamera?"CameraProperties":"SceneProperties",value:e._isScene?"Scene":e.name}},i}();exports.Action=r,i._TypeStore.RegisteredTypes["BABYLON.Action"]=r;
},{"../Misc/observable":"gtkL","../Maths/math":"Iizi","../Misc/typeStore":"WgxS"}],"2aIN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StateCondition=exports.PredicateCondition=exports.ValueCondition=exports.Condition=void 0;var e=i(require("tslib")),t=require("./action"),r=require("../Misc/typeStore");function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var n=function(){function e(e){this._actionManager=e}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e.prototype.serialize=function(){},e.prototype._serialize=function(e){return{type:2,children:[],name:e.name,properties:e.properties}},e}();exports.Condition=n;var o=function(r){function i(e,t,n,o,a){void 0===a&&(a=i.IsEqual);var s=r.call(this,e)||this;return s.propertyPath=n,s.value=o,s.operator=a,s._target=t,s._effectiveTarget=s._getEffectiveTarget(t,s.propertyPath),s._property=s._getProperty(s.propertyPath),s}return e.__extends(i,r),Object.defineProperty(i,"IsEqual",{get:function(){return i._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsDifferent",{get:function(){return i._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsGreater",{get:function(){return i._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsLesser",{get:function(){return i._IsLesser},enumerable:!0,configurable:!0}),i.prototype.isValid=function(){switch(this.operator){case i.IsGreater:return this._effectiveTarget[this._property]>this.value;case i.IsLesser:return this._effectiveTarget[this._property]<this.value;case i.IsEqual:case i.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===i.IsEqual?e:!e}return!1},i.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[t.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:t.Action._SerializeValueAsString(this.value)},{name:"operator",value:i.GetOperatorName(this.operator)}]})},i.GetOperatorName=function(e){switch(e){case i._IsEqual:return"IsEqual";case i._IsDifferent:return"IsDifferent";case i._IsGreater:return"IsGreater";case i._IsLesser:return"IsLesser";default:return""}},i._IsEqual=0,i._IsDifferent=1,i._IsGreater=2,i._IsLesser=3,i}(n);exports.ValueCondition=o;var a=function(t){function r(e,r){var i=t.call(this,e)||this;return i.predicate=r,i}return e.__extends(r,t),r.prototype.isValid=function(){return this.predicate()},r}(n);exports.PredicateCondition=a;var s=function(r){function i(e,t,i){var n=r.call(this,e)||this;return n.value=i,n._target=t,n}return e.__extends(i,r),i.prototype.isValid=function(){return this._target.state===this.value},i.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[t.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},i}(n);exports.StateCondition=s,r._TypeStore.RegisteredTypes["BABYLON.ValueCondition"]=o,r._TypeStore.RegisteredTypes["BABYLON.PredicateCondition"]=a,r._TypeStore.RegisteredTypes["BABYLON.StateCondition"]=s;
},{"tslib":"vCxL","./action":"kR/o","../Misc/typeStore":"WgxS"}],"g2kX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SetParentAction=exports.ExecuteCodeAction=exports.CombineAction=exports.DoNothingAction=exports.StopAnimationAction=exports.PlayAnimationAction=exports.IncrementValueAction=exports.SetValueAction=exports.SetStateAction=exports.SwitchBooleanAction=void 0;var t=a(require("tslib")),e=require("../Misc/logger"),r=require("../Maths/math"),i=require("./action"),o=require("../Engines/constants"),n=require("../Misc/typeStore");function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};i.get||i.set?Object.defineProperty(e,r,i):e[r]=t[r]}return e.default=t,e}var p=function(e){function r(t,r,i,o){var n=e.call(this,t,o)||this;return n.propertyPath=i,n._target=n._effectiveTarget=r,n}return t.__extends(r,e),r.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},r.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},r.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[i.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},t)},r}(i.Action);exports.SwitchBooleanAction=p;var s=function(e){function r(t,r,i,o){var n=e.call(this,t,o)||this;return n.value=i,n._target=r,n}return t.__extends(r,e),r.prototype.execute=function(){this._target.state=this.value},r.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetStateAction",properties:[i.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},t)},r}(i.Action);exports.SetStateAction=s;var c=function(e){function r(t,r,i,o,n){var a=e.call(this,t,n)||this;return a.propertyPath=i,a.value=o,a._target=a._effectiveTarget=r,a}return t.__extends(r,e),r.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},r.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},r.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetValueAction",properties:[i.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:i.Action._SerializeValueAsString(this.value)}]},t)},r}(i.Action);exports.SetValueAction=c;var h=function(r){function o(t,e,i,o,n){var a=r.call(this,t,n)||this;return a.propertyPath=i,a.value=o,a._target=a._effectiveTarget=e,a}return t.__extends(o,r),o.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&e.Logger.Warn("Warning: IncrementValueAction can only be used with number values")},o.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},o.prototype.serialize=function(t){return r.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[i.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:i.Action._SerializeValueAsString(this.value)}]},t)},o}(i.Action);exports.IncrementValueAction=h;var u=function(e){function r(t,r,i,o,n,a){var p=e.call(this,t,a)||this;return p.from=i,p.to=o,p.loop=n,p._target=r,p}return t.__extends(r,e),r.prototype._prepare=function(){},r.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},r.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[i.Action._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:i.Action._SerializeValueAsString(this.loop)||!1}]},t)},r}(i.Action);exports.PlayAnimationAction=u;var l=function(e){function r(t,r,i){var o=e.call(this,t,i)||this;return o._target=r,o}return t.__extends(r,e),r.prototype._prepare=function(){},r.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},r.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[i.Action._GetTargetProperty(this._target)]},t)},r}(i.Action);exports.StopAnimationAction=l;var _=function(e){function r(t,r){return void 0===t&&(t=o.Constants.ACTION_NothingTrigger),e.call(this,t,r)||this}return t.__extends(r,e),r.prototype.execute=function(){},r.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},t)},r}(i.Action);exports.DoNothingAction=_;var y=function(e){function r(t,r,i){var o=e.call(this,t,i)||this;return o.children=r,o}return t.__extends(r,e),r.prototype._prepare=function(){for(var t=0;t<this.children.length;t++)this.children[t]._actionManager=this._actionManager,this.children[t]._prepare()},r.prototype.execute=function(t){for(var e=0;e<this.children.length;e++)this.children[e].execute(t)},r.prototype.serialize=function(t){for(var r=e.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},t),i=0;i<this.children.length;i++)r.combine.push(this.children[i].serialize(null));return r},r}(i.Action);exports.CombineAction=y;var f=function(e){function r(t,r,i){var o=e.call(this,t,i)||this;return o.func=r,o}return t.__extends(r,e),r.prototype.execute=function(t){this.func(t)},r}(i.Action);exports.ExecuteCodeAction=f;var g=function(e){function o(t,r,i,o){var n=e.call(this,t,o)||this;return n._target=r,n._parent=i,n}return t.__extends(o,e),o.prototype._prepare=function(){},o.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=r.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},o.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetParentAction",properties:[i.Action._GetTargetProperty(this._target),i.Action._GetTargetProperty(this._parent)]},t)},o}(i.Action);exports.SetParentAction=g,n._TypeStore.RegisteredTypes["BABYLON.SetParentAction"]=g,n._TypeStore.RegisteredTypes["BABYLON.ExecuteCodeAction"]=f,n._TypeStore.RegisteredTypes["BABYLON.DoNothingAction"]=_,n._TypeStore.RegisteredTypes["BABYLON.StopAnimationAction"]=l,n._TypeStore.RegisteredTypes["BABYLON.PlayAnimationAction"]=u,n._TypeStore.RegisteredTypes["BABYLON.IncrementValueAction"]=h,n._TypeStore.RegisteredTypes["BABYLON.SetValueAction"]=c,n._TypeStore.RegisteredTypes["BABYLON.SetStateAction"]=s,n._TypeStore.RegisteredTypes["BABYLON.SetParentAction"]=g;
},{"tslib":"vCxL","../Misc/logger":"Fvml","../Maths/math":"Iizi","./action":"kR/o","../Engines/constants":"vn8z","../Misc/typeStore":"WgxS"}],"2X/t":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActionManager=void 0;var r=require("../Maths/math"),e=require("./condition"),t=require("./action"),n=require("./directActions"),i=require("../Engines/constants"),g=require("../Engines/engineStore"),o=require("../Misc/logger"),a=require("../Misc/deepCopier"),s=require("../Misc/typeStore"),c=function(){function c(r){this.actions=new Array,this.hoverCursor="",this._scene=r||g.EngineStore.LastCreatedScene,r.actionManagers.push(this)}return c.prototype.dispose=function(){for(var r=this._scene.actionManagers.indexOf(this),e=0;e<this.actions.length;e++){var t=this.actions[e];c.Triggers[t.trigger]--,0===c.Triggers[t.trigger]&&delete c.Triggers[t.trigger]}r>-1&&this._scene.actionManagers.splice(r,1)},c.prototype.getScene=function(){return this._scene},c.prototype.hasSpecificTriggers=function(r){for(var e=0;e<this.actions.length;e++){var t=this.actions[e];if(r.indexOf(t.trigger)>-1)return!0}return!1},c.prototype.hasSpecificTriggers2=function(r,e){for(var t=0;t<this.actions.length;t++){var n=this.actions[t];if(r==n.trigger||e==n.trigger)return!0}return!1},c.prototype.hasSpecificTrigger=function(r,e){for(var t=0;t<this.actions.length;t++){var n=this.actions[t];if(n.trigger===r){if(!e)return!0;if(e(n.getTriggerParameter()))return!0}}return!1},Object.defineProperty(c.prototype,"hasPointerTriggers",{get:function(){for(var r=0;r<this.actions.length;r++){var e=this.actions[r];if(e.trigger>=c.OnPickTrigger&&e.trigger<=c.OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasPickTriggers",{get:function(){for(var r=0;r<this.actions.length;r++){var e=this.actions[r];if(e.trigger>=c.OnPickTrigger&&e.trigger<=c.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(c,"HasTriggers",{get:function(){for(var r in c.Triggers)if(c.Triggers.hasOwnProperty(r))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(c,"HasPickTriggers",{get:function(){for(var r in c.Triggers)if(c.Triggers.hasOwnProperty(r)){var e=parseInt(r);if(e>=c.OnPickTrigger&&e<=c.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),c.HasSpecificTrigger=function(r){for(var e in c.Triggers){if(c.Triggers.hasOwnProperty(e))if(parseInt(e)===r)return!0}return!1},c.prototype.registerAction=function(r){return r.trigger===c.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(o.Logger.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(r),c.Triggers[r.trigger]?c.Triggers[r.trigger]++:c.Triggers[r.trigger]=1,r._actionManager=this,r._prepare(),r)},c.prototype.unregisterAction=function(r){var e=this.actions.indexOf(r);return-1!==e&&(this.actions.splice(e,1),c.Triggers[r.trigger]-=1,0===c.Triggers[r.trigger]&&delete c.Triggers[r.trigger],delete r._actionManager,!0)},c.prototype.processTrigger=function(r,e){for(var t=0;t<this.actions.length;t++){var n=this.actions[t];if(n.trigger===r){if(e&&(r===c.OnKeyUpTrigger||r===c.OnKeyDownTrigger)){var i=n.getTriggerParameter();if(i&&i!==e.sourceEvent.keyCode){if(!i.toLowerCase)continue;var g=i.toLowerCase();if(g!==e.sourceEvent.key){var o=e.sourceEvent.charCode?e.sourceEvent.charCode:e.sourceEvent.keyCode;if(String.fromCharCode(o).toLowerCase()!==g)continue}}}n._executeCurrent(e)}}},c.prototype._getEffectiveTarget=function(r,e){for(var t=e.split("."),n=0;n<t.length-1;n++)r=r[t[n]];return r},c.prototype._getProperty=function(r){var e=r.split(".");return e[e.length-1]},c.prototype.serialize=function(r){for(var e={children:new Array,name:r,type:3,properties:new Array},n=0;n<this.actions.length;n++){var i={type:0,children:new Array,name:c.GetTriggerName(this.actions[n].trigger),properties:new Array},g=this.actions[n].triggerOptions;if(g&&"number"!=typeof g)if(g.parameter instanceof Node)i.properties.push(t.Action._GetTargetProperty(g.parameter));else{var o={};a.DeepCopier.DeepCopy(g.parameter,o,["mesh"]),g.parameter&&g.parameter.mesh&&(o._meshId=g.parameter.mesh.id),i.properties.push({name:"parameter",targetType:null,value:o})}this.actions[n].serialize(i),e.children.push(i)}return e},c.Parse=function(t,i,g){var o=new c(g);null===i?g.actionManager=o:i.actionManager=o;for(var a=function(e,t,n,i){if(null===i){var g=parseFloat(t);return"true"===t||"false"===t?"true"===t:isNaN(g)?t:g}for(var o=i.split("."),a=t.split(","),s=0;s<o.length;s++)n=n[o[s]];if("boolean"==typeof n)return"true"===a[0];if("string"==typeof n)return a[0];var c=new Array;for(s=0;s<a.length;s++)c.push(parseFloat(a[s]));return n instanceof r.Vector3?r.Vector3.FromArray(c):n instanceof r.Vector4?r.Vector4.FromArray(c):n instanceof r.Color3?r.Color3.FromArray(c):n instanceof r.Color4?r.Color4.FromArray(c):parseFloat(a[0])},u=function(r,t,i,p,h){if(void 0===h&&(h=null),!r.detached){var l=new Array,T=null,f=null,O=r.combine&&r.combine.length>0;if(2===r.type?l.push(o):l.push(t),O){for(var y=new Array,v=0;v<r.combine.length;v++)u(r.combine[v],c.NothingTrigger,i,p,y);l.push(y)}else for(var C=0;C<r.properties.length;C++){var P=r.properties[C].value,d=r.properties[C].name,m=r.properties[C].targetType;"target"===d?P=T=null!==m&&"SceneProperties"===m?g:g.getNodeByName(P):"parent"===d?P=g.getNodeByName(P):"sound"===d?g.getSoundByName&&(P=g.getSoundByName(P)):"propertyPath"!==d?P=2===r.type&&"operator"===d?e.ValueCondition[P]:a(0,P,T,"value"===d?f:null):f=P,l.push(P)}if(null===h?l.push(i):l.push(null),"InterpolateValueAction"===r.name){var A=l[l.length-2];l[l.length-1]=A,l[l.length-2]=i}var N=function(r,e){var t=s._TypeStore.GetClass("BABYLON."+r);if(t){var n=Object.create(t.prototype);return n.constructor.apply(n,e),n}}(r.name,l);if(N instanceof e.Condition&&null!==i){var k=new n.DoNothingAction(t,i);p?p.then(k):o.registerAction(k),p=k}null===h?N instanceof e.Condition?(i=N,N=p):(i=null,p?p.then(N):o.registerAction(N)):h.push(N);for(C=0;C<r.children.length;C++)u(r.children[C],t,i,N,null)}},p=0;p<t.children.length;p++){var h,l=t.children[p];if(l.properties.length>0){var T=l.properties[0].value,f=null===l.properties[0].targetType?T:g.getMeshByName(T);f._meshId&&(f.mesh=g.getMeshByID(f._meshId)),h={trigger:c[l.name],parameter:f}}else h=c[l.name];for(var O=0;O<l.children.length;O++)l.detached||u(l.children[O],h,null,null)}},c.GetTriggerName=function(r){switch(r){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},c.NothingTrigger=i.Constants.ACTION_NothingTrigger,c.OnPickTrigger=i.Constants.ACTION_OnPickTrigger,c.OnLeftPickTrigger=i.Constants.ACTION_OnLeftPickTrigger,c.OnRightPickTrigger=i.Constants.ACTION_OnRightPickTrigger,c.OnCenterPickTrigger=i.Constants.ACTION_OnCenterPickTrigger,c.OnPickDownTrigger=i.Constants.ACTION_OnPickDownTrigger,c.OnDoublePickTrigger=i.Constants.ACTION_OnDoublePickTrigger,c.OnPickUpTrigger=i.Constants.ACTION_OnPickUpTrigger,c.OnPickOutTrigger=i.Constants.ACTION_OnPickOutTrigger,c.OnLongPressTrigger=i.Constants.ACTION_OnLongPressTrigger,c.OnPointerOverTrigger=i.Constants.ACTION_OnPointerOverTrigger,c.OnPointerOutTrigger=i.Constants.ACTION_OnPointerOutTrigger,c.OnEveryFrameTrigger=i.Constants.ACTION_OnEveryFrameTrigger,c.OnIntersectionEnterTrigger=i.Constants.ACTION_OnIntersectionEnterTrigger,c.OnIntersectionExitTrigger=i.Constants.ACTION_OnIntersectionExitTrigger,c.OnKeyDownTrigger=i.Constants.ACTION_OnKeyDownTrigger,c.OnKeyUpTrigger=15,c.Triggers={},c}();exports.ActionManager=c;
},{"../Maths/math":"Iizi","./condition":"2aIN","./action":"kR/o","./directActions":"g2kX","../Engines/constants":"vn8z","../Engines/engineStore":"n+VE","../Misc/logger":"Fvml","../Misc/deepCopier":"RVA4","../Misc/typeStore":"WgxS"}],"Rqxo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PostProcessManager=void 0;var e=require("../Materials/material"),r=require("../Meshes/buffer"),t=require("../Engines/constants"),s=function(){function s(e){this._vertexBuffers={},this._scene=e}return s.prototype._prepareBuffers=function(){if(!this._vertexBuffers[r.VertexBuffer.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[r.VertexBuffer.PositionKind]=new r.VertexBuffer(this._scene.getEngine(),e,r.VertexBuffer.PositionKind,!1,!1,2),this._buildIndexBuffer()}},s.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},s.prototype._rebuild=function(){var e=this._vertexBuffers[r.VertexBuffer.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},s.prototype._prepareFrame=function(e,r){void 0===e&&(e=null),void 0===r&&(r=null);var t=this._scene.activeCamera;return!!t&&(!(!(r=r||t._postProcesses.filter(function(e){return null!=e}))||0===r.length||!this._scene.postProcessesEnabled)&&(r[0].activate(t,e,null!=r),!0))},s.prototype.directRender=function(r,t,s,i,n){void 0===t&&(t=null),void 0===s&&(s=!1),void 0===i&&(i=0),void 0===n&&(n=0);for(var f=this._scene.getEngine(),u=0;u<r.length;u++){u<r.length-1?r[u+1].activate(this._scene.activeCamera,t):t?f.bindFramebuffer(t,i,void 0,void 0,s,void 0,n):f.restoreDefaultFramebuffer();var o=r[u],a=o.apply();a&&(o.onBeforeRenderObservable.notifyObservers(a),this._prepareBuffers(),f.bindBuffers(this._vertexBuffers,this._indexBuffer,a),f.drawElementsType(e.Material.TriangleFillMode,0,6),o.onAfterRenderObservable.notifyObservers(a))}f.setDepthBuffer(!0),f.setDepthWrite(!0)},s.prototype._finalizeFrame=function(r,s,i,n,f){void 0===f&&(f=!1);var u=this._scene.activeCamera;if(u&&0!==(n=n||u._postProcesses.filter(function(e){return null!=e})).length&&this._scene.postProcessesEnabled){for(var o=this._scene.getEngine(),a=0,l=n.length;a<l;a++){var p=n[a];if(a<l-1?p._outputTexture=n[a+1].activate(u,s):s?(o.bindFramebuffer(s,i,void 0,void 0,f),p._outputTexture=s):(o.restoreDefaultFramebuffer(),p._outputTexture=null),r)break;var d=p.apply();d&&(p.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,d),o.drawElementsType(e.Material.TriangleFillMode,0,6),p.onAfterRenderObservable.notifyObservers(d))}o.setDepthBuffer(!0),o.setDepthWrite(!0),o.setAlphaMode(t.Constants.ALPHA_DISABLE)}},s.prototype.dispose=function(){var e=this._vertexBuffers[r.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[r.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},s}();exports.PostProcessManager=s;
},{"../Materials/material":"v46b","../Meshes/buffer":"YHhW","../Engines/constants":"vn8z"}],"cNWH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderingGroup=void 0;var e=require("../Misc/smartArray"),t=require("../Maths/math"),r=require("../Engines/constants"),s=function(){function s(t,r,s,n,a){void 0===s&&(s=null),void 0===n&&(n=null),void 0===a&&(a=null),this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._depthOnlySubMeshes=new e.SmartArray(256),this._particleSystems=new e.SmartArray(256),this._spriteManagers=new e.SmartArray(256),this._edgesRenderers=new e.SmartArray(16),this._scene=r,this.opaqueSortCompareFn=s,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=a}return Object.defineProperty(s.prototype,"opaqueSortCompareFn",{set:function(e){this._opaqueSortCompareFn=e,this._renderOpaque=e?this.renderOpaqueSorted:s.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"alphaTestSortCompareFn",{set:function(e){this._alphaTestSortCompareFn=e,this._renderAlphaTest=e?this.renderAlphaTestSorted:s.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"transparentSortCompareFn",{set:function(e){this._transparentSortCompareFn=e||s.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),s.prototype.render=function(e,t,s,n){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var a=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(a.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),a.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var i=a.getStencilBuffer();if(a.setStencilBuffer(!1),t&&this._renderSprites(),s&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),a.setAlphaMode(r.Constants.ALPHA_DISABLE)),a.setStencilBuffer(!1),this._edgesRenderers.length){for(var o=0;o<this._edgesRenderers.length;o++)this._edgesRenderers.data[o].render();a.setAlphaMode(r.Constants.ALPHA_DISABLE)}a.setStencilBuffer(i)}},s.prototype.renderOpaqueSorted=function(e){return s.renderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},s.prototype.renderAlphaTestSorted=function(e){return s.renderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},s.prototype.renderTransparentSorted=function(e){return s.renderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)},s.renderSorted=function(e,s,n,a){for(var i,o=0,h=n?n.globalPosition:t.Vector3.Zero();o<e.length;o++)(i=e.data[o])._alphaIndex=i.getMesh().alphaIndex,i._distanceToCamera=i.getBoundingInfo().boundingSphere.centerWorld.subtract(h).length();var p=e.data.slice(0,e.length);for(s&&p.sort(s),o=0;o<p.length;o++){if(i=p[o],a){var d=i.getMaterial();if(d&&d.needDepthPrePass){var u=d.getScene().getEngine();u.setColorWrite(!1),u.setAlphaMode(r.Constants.ALPHA_DISABLE),i.render(!1),u.setColorWrite(!0)}}i.render(a)}},s.renderUnsorted=function(e){for(var t=0;t<e.length;t++){e.data[t].render(!1)}},s.defaultTransparentSortCompare=function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:s.backToFrontSortCompare(e,t)},s.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},s.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},s.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},s.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},s.prototype.dispatch=function(e,t,r){void 0===t&&(t=e.getMesh()),void 0===r&&(r=e.getMaterial()),null!=r&&(r.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):r.needAlphaTesting()?(r.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(r.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.push(t._edgesRenderer))},s.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},s.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},s.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var r=0;r<this._particleSystems.length;r++){var s=this._particleSystems.data[r];if(0!==(t&&t.layerMask&s.layerMask)){var n=s.emitter;n.position&&e&&-1===e.indexOf(n)||this._scene._activeParticles.addCount(s.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},s.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var r=this._spriteManagers.data[t];0!==(e&&e.layerMask&r.layerMask)&&r.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},s}();exports.RenderingGroup=s;
},{"../Misc/smartArray":"vK5Y","../Maths/math":"Iizi","../Engines/constants":"vn8z"}],"6R9t":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderingManager=exports.RenderingGroupInfo=void 0;var e=require("./renderingGroup"),r=function(){return function(){}}();exports.RenderingGroupInfo=r;var t=function(){function t(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new r,this._scene=e;for(var n=t.MIN_RENDERINGGROUPS;n<t.MAX_RENDERINGGROUPS;n++)this._autoClearDepthStencil[n]={autoClear:!0,depth:!0,stencil:!0}}return t.prototype._clearDepthStencilBuffer=function(e,r){void 0===e&&(e=!0),void 0===r&&(r=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,r),this._depthStencilBufferAlreadyCleaned=!0)},t.prototype.render=function(e,r,n,o){var i=this._renderingGroupInfo;if(i.scene=this._scene,i.camera=this._scene.activeCamera,this._scene.spriteManagers&&o)for(var s=0;s<this._scene.spriteManagers.length;s++){var p=this._scene.spriteManagers[s];this.dispatchSprites(p)}for(s=t.MIN_RENDERINGGROUPS;s<t.MAX_RENDERINGGROUPS;s++){this._depthStencilBufferAlreadyCleaned=s===t.MIN_RENDERINGGROUPS;var a=this._renderingGroups[s];if(a){var u=Math.pow(2,s);if(i.renderingGroupId=s,this._scene.onBeforeRenderingGroupObservable.notifyObservers(i,u),t.AUTOCLEAR){var h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(s):this._autoClearDepthStencil[s];h&&h.autoClear&&this._clearDepthStencilBuffer(h.depth,h.stencil)}for(var c=0,d=this._scene._beforeRenderingGroupDrawStage;c<d.length;c++){d[c].action(s)}a.render(e,o,n,r);for(var _=0,l=this._scene._afterRenderingGroupDrawStage;_<l.length;_++){l[_].action(s)}this._scene.onAfterRenderingGroupObservable.notifyObservers(i,u)}}},t.prototype.reset=function(){for(var e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){var r=this._renderingGroups[e];r&&r.prepare()}},t.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},t.prototype.freeRenderingGroups=function(){for(var e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){var r=this._renderingGroups[e];r&&r.dispose()}},t.prototype._prepareRenderingGroup=function(r){void 0===this._renderingGroups[r]&&(this._renderingGroups[r]=new e.RenderingGroup(r,this._scene,this._customOpaqueSortCompareFn[r],this._customAlphaTestSortCompareFn[r],this._customTransparentSortCompareFn[r]))},t.prototype.dispatchSprites=function(e){var r=e.renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[r].dispatchSprites(e)},t.prototype.dispatchParticles=function(e){var r=e.renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[r].dispatchParticles(e)},t.prototype.dispatch=function(e,r,t){void 0===r&&(r=e.getMesh());var n=r.renderingGroupId||0;this._prepareRenderingGroup(n),this._renderingGroups[n].dispatch(e,r,t)},t.prototype.setRenderingOrder=function(e,r,t,n){if(void 0===r&&(r=null),void 0===t&&(t=null),void 0===n&&(n=null),this._customOpaqueSortCompareFn[e]=r,this._customAlphaTestSortCompareFn[e]=t,this._customTransparentSortCompareFn[e]=n,this._renderingGroups[e]){var o=this._renderingGroups[e];o.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],o.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],o.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},t.prototype.setRenderingAutoClearDepthStencil=function(e,r,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0),this._autoClearDepthStencil[e]={autoClear:r,depth:t,stencil:n}},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},t.MAX_RENDERINGGROUPS=4,t.MIN_RENDERINGGROUPS=0,t.AUTOCLEAR=!0,t}();exports.RenderingManager=t;
},{"./renderingGroup":"cNWH"}],"8yKz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Stage=exports.SceneComponentConstants=void 0;var E=R(require("tslib"));function R(E){if(E&&E.__esModule)return E;var R={};if(null!=E)for(var A in E)if(Object.prototype.hasOwnProperty.call(E,A)){var e=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(E,A):{};e.get||e.set?Object.defineProperty(R,A,e):R[A]=E[A]}return R.default=E,R}var A=function(){function E(){}return E.NAME_EFFECTLAYER="EffectLayer",E.NAME_LAYER="Layer",E.NAME_LENSFLARESYSTEM="LensFlareSystem",E.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",E.NAME_PARTICLESYSTEM="ParticleSystem",E.NAME_GAMEPAD="Gamepad",E.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",E.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",E.NAME_DEPTHRENDERER="DepthRenderer",E.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",E.NAME_SPRITE="Sprite",E.NAME_OUTLINERENDERER="Outline",E.NAME_PROCEDURALTEXTURE="ProceduralTexture",E.NAME_SHADOWGENERATOR="ShadowGenerator",E.NAME_OCTREE="Octree",E.NAME_PHYSICSENGINE="PhysicsEngine",E.NAME_AUDIO="Audio",E.STEP_ISREADYFORMESH_EFFECTLAYER=0,E.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,E.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,E.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,E.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,E.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,E.STEP_BEFORECAMERADRAW_LAYER=1,E.STEP_BEFORERENDERTARGETDRAW_LAYER=0,E.STEP_BEFORERENDERINGMESH_OUTLINE=0,E.STEP_AFTERRENDERINGMESH_OUTLINE=0,E.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,E.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,E.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,E.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,E.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,E.STEP_AFTERRENDERTARGETDRAW_LAYER=0,E.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,E.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,E.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,E.STEP_AFTERCAMERADRAW_LAYER=3,E.STEP_AFTERRENDER_AUDIO=0,E.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=0,E.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,E.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=2,E.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,E.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,E.STEP_POINTERMOVE_SPRITE=0,E.STEP_POINTERDOWN_SPRITE=0,E.STEP_POINTERUP_SPRITE=0,E}();exports.SceneComponentConstants=A;var e=function(R){function A(E){return R.apply(this,E)||this}return E.__extends(A,R),A.Create=function(){return Object.create(A.prototype)},A.prototype.registerStep=function(E,R,A){var e=0;for(Number.MAX_VALUE;e<this.length;e++){if(E<this[e].index)break}this.splice(e,0,{index:E,component:R,action:A.bind(R)})},A.prototype.clear=function(){this.length=0},A}(Array);exports.Stage=e;
},{"tslib":"vCxL"}],"FKAx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scene=void 0;var e=D(require("tslib")),t=require("./Misc/tools"),r=require("./Misc/precisionDate"),i=require("./Misc/observable"),n=require("./Misc/smartArray"),s=require("./Misc/stringDictionary"),a=require("./Misc/tags"),o=require("./Maths/math"),h=require("./Meshes/abstractMesh"),l=require("./Cameras/camera"),c=require("./abstractScene"),u=require("./Materials/imageProcessingConfiguration"),d=require("./Materials/uniformBuffer"),g=require("./Animations/animation"),p=require("./Animations/animatable"),f=require("./Lights/light"),v=require("./Collisions/pickingInfo"),m=require("./Collisions/collisionCoordinator"),b=require("./Events/pointerEvents"),_=require("./Events/keyboardEvents"),y=require("./Actions/actionEvent"),P=require("./Actions/actionManager"),M=require("./PostProcesses/postProcessManager"),O=require("./Rendering/renderingManager"),C=require("./sceneComponent"),T=require("./Culling/ray"),A=require("./Engines/constants"),R=require("./Misc/domManagement"),w=require("./Misc/logger"),S=require("./Engines/engineStore");function D(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var k=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!0,configurable:!0}),e}(),I=function(c){function D(e,r){var s=c.call(this)||this;return s._isScene=!0,s.autoClear=!0,s.autoClearDepthAndStencil=!0,s.clearColor=new o.Color4(.2,.2,.3,1),s.ambientColor=new o.Color3(0,0,0),s._forceWireframe=!1,s._forcePointsCloud=!1,s.animationsEnabled=!0,s._animationPropertiesOverride=null,s.useConstantAnimationDeltaTime=!1,s.constantlyUpdateMeshUnderPointer=!1,s.hoverCursor="pointer",s.defaultCursor="",s.preventDefaultOnPointerDown=!0,s.preventDefaultOnPointerUp=!0,s.metadata=null,s.reservedDataStore=null,s.disableOfflineSupportExceptionRules=new Array,s.onDisposeObservable=new i.Observable,s._onDisposeObserver=null,s.onBeforeRenderObservable=new i.Observable,s._onBeforeRenderObserver=null,s.onAfterRenderObservable=new i.Observable,s._onAfterRenderObserver=null,s.onBeforeAnimationsObservable=new i.Observable,s.onAfterAnimationsObservable=new i.Observable,s.onBeforeDrawPhaseObservable=new i.Observable,s.onAfterDrawPhaseObservable=new i.Observable,s.onReadyObservable=new i.Observable,s.onBeforeCameraRenderObservable=new i.Observable,s._onBeforeCameraRenderObserver=null,s.onAfterCameraRenderObservable=new i.Observable,s._onAfterCameraRenderObserver=null,s.onBeforeActiveMeshesEvaluationObservable=new i.Observable,s.onAfterActiveMeshesEvaluationObservable=new i.Observable,s.onBeforeParticlesRenderingObservable=new i.Observable,s.onAfterParticlesRenderingObservable=new i.Observable,s.onDataLoadedObservable=new i.Observable,s.onNewCameraAddedObservable=new i.Observable,s.onCameraRemovedObservable=new i.Observable,s.onNewLightAddedObservable=new i.Observable,s.onLightRemovedObservable=new i.Observable,s.onNewGeometryAddedObservable=new i.Observable,s.onGeometryRemovedObservable=new i.Observable,s.onNewTransformNodeAddedObservable=new i.Observable,s.onTransformNodeRemovedObservable=new i.Observable,s.onNewMeshAddedObservable=new i.Observable,s.onMeshRemovedObservable=new i.Observable,s.onNewMaterialAddedObservable=new i.Observable,s.onMaterialRemovedObservable=new i.Observable,s.onNewTextureAddedObservable=new i.Observable,s.onTextureRemovedObservable=new i.Observable,s.onBeforeRenderTargetsRenderObservable=new i.Observable,s.onAfterRenderTargetsRenderObservable=new i.Observable,s.onBeforeStepObservable=new i.Observable,s.onAfterStepObservable=new i.Observable,s.onActiveCameraChanged=new i.Observable,s.onBeforeRenderingGroupObservable=new i.Observable,s.onAfterRenderingGroupObservable=new i.Observable,s.onMeshImportedObservable=new i.Observable,s._registeredForLateAnimationBindings=new n.SmartArrayNoDuplicate(256),s.onPrePointerObservable=new i.Observable,s.onPointerObservable=new i.Observable,s._meshPickProceed=!1,s._currentPickResult=null,s._previousPickResult=null,s._totalPointersPressed=0,s._doubleClickOccured=!1,s.cameraToUseForPointers=null,s._pointerX=0,s._pointerY=0,s._startingPointerPosition=new o.Vector2(0,0),s._previousStartingPointerPosition=new o.Vector2(0,0),s._startingPointerTime=0,s._previousStartingPointerTime=0,s._pointerCaptures={},s._timeAccumulator=0,s._currentStepId=0,s._currentInternalStep=0,s.onPreKeyboardObservable=new i.Observable,s.onKeyboardObservable=new i.Observable,s._useRightHandedSystem=!1,s._fogEnabled=!0,s._fogMode=D.FOGMODE_NONE,s.fogColor=new o.Color3(.2,.2,.3),s.fogDensity=.1,s.fogStart=0,s.fogEnd=1e3,s._shadowsEnabled=!0,s._lightsEnabled=!0,s.activeCameras=new Array,s._texturesEnabled=!0,s.particlesEnabled=!0,s.spritesEnabled=!0,s._skeletonsEnabled=!0,s.lensFlaresEnabled=!0,s.collisionsEnabled=!0,s.gravity=new o.Vector3(0,-9.807,0),s.postProcessesEnabled=!0,s.postProcesses=new Array,s.renderTargetsEnabled=!0,s.dumpNextRenderTargets=!1,s.customRenderTargets=new Array,s.importedMeshesFiles=new Array,s.probesEnabled=!0,s._meshesForIntersections=new n.SmartArrayNoDuplicate(256),s.proceduralTexturesEnabled=!0,s._totalVertices=new t.PerfCounter,s._activeIndices=new t.PerfCounter,s._activeParticles=new t.PerfCounter,s._activeBones=new t.PerfCounter,s._animationTime=0,s.animationTimeScale=1,s._renderId=0,s._frameId=0,s._executeWhenReadyTimeoutId=-1,s._intermediateRendering=!1,s._viewUpdateFlag=-1,s._projectionUpdateFlag=-1,s._alternateViewUpdateFlag=-1,s._alternateProjectionUpdateFlag=-1,s._toBeDisposed=new Array(256),s._activeRequests=new Array,s._pendingData=new Array,s._isDisposed=!1,s.dispatchAllSubMeshesOfActiveMeshes=!1,s._activeMeshes=new n.SmartArray(256),s._processedMaterials=new n.SmartArray(256),s._renderTargets=new n.SmartArrayNoDuplicate(256),s._activeParticleSystems=new n.SmartArray(256),s._activeSkeletons=new n.SmartArrayNoDuplicate(32),s._softwareSkinnedMeshes=new n.SmartArrayNoDuplicate(32),s._activeAnimatables=new Array,s._transformMatrix=o.Matrix.Zero(),s._useAlternateCameraConfiguration=!1,s._alternateRendering=!1,s._wheelEventName="",s.requireLightSorting=!1,s._components=[],s._serializableComponents=[],s._transientComponents=[],s._beforeCameraUpdateStage=C.Stage.Create(),s._beforeClearStage=C.Stage.Create(),s._gatherRenderTargetsStage=C.Stage.Create(),s._gatherActiveCameraRenderTargetsStage=C.Stage.Create(),s._isReadyForMeshStage=C.Stage.Create(),s._beforeEvaluateActiveMeshStage=C.Stage.Create(),s._evaluateSubMeshStage=C.Stage.Create(),s._activeMeshStage=C.Stage.Create(),s._cameraDrawRenderTargetStage=C.Stage.Create(),s._beforeCameraDrawStage=C.Stage.Create(),s._beforeRenderTargetDrawStage=C.Stage.Create(),s._beforeRenderingGroupDrawStage=C.Stage.Create(),s._beforeRenderingMeshStage=C.Stage.Create(),s._afterRenderingMeshStage=C.Stage.Create(),s._afterRenderingGroupDrawStage=C.Stage.Create(),s._afterCameraDrawStage=C.Stage.Create(),s._afterRenderTargetDrawStage=C.Stage.Create(),s._afterRenderStage=C.Stage.Create(),s._pointerMoveStage=C.Stage.Create(),s._pointerDownStage=C.Stage.Create(),s._pointerUpStage=C.Stage.Create(),s.geometriesByUniqueId=null,s._defaultMeshCandidates={data:[],length:0},s._defaultSubMeshCandidates={data:[],length:0},s._preventFreeActiveMeshesAndRenderingGroups=!1,s._activeMeshesFrozen=!1,s._allowPostProcessClearColor=!0,s.getDeterministicFrameTime=function(){return 1e3/60},s._tempPickingRay=T.Ray?T.Ray.Zero():null,s._blockMaterialDirtyMechanism=!1,s._engine=e||S.EngineStore.LastCreatedEngine,s._engine.scenes.push(s),s._uid=null,s._renderingManager=new O.RenderingManager(s),M.PostProcessManager&&(s.postProcessManager=new M.PostProcessManager(s)),R.DomManagement.IsWindowObjectExist()&&s.attachControl(),s.workerCollisions=!1,s._createUbo(),u.ImageProcessingConfiguration&&(s._imageProcessingConfiguration=new u.ImageProcessingConfiguration),s.setDefaultCandidateProviders(),r&&!0===r.useGeometryUniqueIdsMap&&(s.geometriesByUniqueId={}),s.useMaterialMeshMap=r&&r.useGeometryUniqueIdsMap||!1,s.useClonedMeshhMap=r&&r.useClonedMeshhMap||!1,s._engine.onNewSceneAddedObservable.notifyObservers(s),s}return e.__extends(D,c),D.DefaultMaterialFactory=function(e){throw"Import StandardMaterial or Fill DefaultMaterialFactory static property on scene before relying on default material creation."},Object.defineProperty(D.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"unTranslatedPointer",{get:function(){return new o.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),D.prototype.setStepId=function(e){this._currentStepId=e},D.prototype.getStepId=function(){return this._currentStepId},D.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(D.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=D.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(A.Constants.MATERIAL_AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"_isAlternateRenderingEnabled",{get:function(){return this._alternateRendering},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),D.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,t=this._transientComponents;e<t.length;e++){t[e].register()}this._transientComponents=[]}},D.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var t=e;t.addFromContainer&&this._serializableComponents.push(t)},D.prototype._getComponent=function(e){for(var t=0,r=this._components;t<r.length;t++){var i=r[t];if(i.name===e)return i}return null},D.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},D.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},D.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(D.prototype,"workerCollisions",{get:function(){return!1},set:function(e){m.CollisionCoordinatorLegacy&&(this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=new m.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this))},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(D.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!0,configurable:!0}),D.prototype.getCachedMaterial=function(){return this._cachedMaterial},D.prototype.getCachedEffect=function(){return this._cachedEffect},D.prototype.getCachedVisibility=function(){return this._cachedVisibility},D.prototype.isCachedMaterialInvalid=function(e,t,r){return void 0===r&&(r=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==r},D.prototype.getEngine=function(){return this._engine},D.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(D.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),D.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(D.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),D.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(D.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),D.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(D.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),D.prototype.getActiveMeshes=function(){return this._activeMeshes},D.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},D.prototype.getRenderId=function(){return this._renderId},D.prototype.getFrameId=function(){return this._frameId},D.prototype.incrementRenderId=function(){this._renderId++},D.prototype._updatePointerPosition=function(e){var t=this._engine.getRenderingCanvasClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},D.prototype._createUbo=function(){this._sceneUbo=new d.UniformBuffer(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},D.prototype._createAlternateUbo=function(){this._alternateSceneUbo=new d.UniformBuffer(this._engine,void 0,!0),this._alternateSceneUbo.addUniform("viewProjection",16),this._alternateSceneUbo.addUniform("view",16)},D.prototype._setRayOnPointerInfo=function(e){e.pickInfo&&(e.pickInfo.ray||(e.pickInfo.ray=this.createPickingRay(e.event.offsetX,e.event.offsetY,o.Matrix.Identity(),this.activeCamera)))},D.prototype.simulatePointerMove=function(e,t){var r=new PointerEvent("pointermove",t);return this._checkPrePointerObservable(e,r,b.PointerEventTypes.POINTERMOVE)?this:this._processPointerMove(e,r)},D.prototype._processPointerMove=function(e,t){var r=this._engine.getRenderingCanvas();if(!r)return this;r.style.cursor=this.defaultCursor;var i=!!(e&&e.hit&&e.pickedMesh);i?(this.setPointerOverMesh(e.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(this._pointerOverMesh.actionManager.hoverCursor?r.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:r.style.cursor=this.hoverCursor)):this.setPointerOverMesh(null);for(var n=0,s=this._pointerMoveStage;n<s.length;n++){e=s[n].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,r)}if(e){var a=t.type===this._wheelEventName?b.PointerEventTypes.POINTERWHEEL:b.PointerEventTypes.POINTERMOVE;if(this.onPointerMove&&this.onPointerMove(t,e,a),this.onPointerObservable.hasObservers()){var o=new b.PointerInfo(a,t,e);this._setRayOnPointerInfo(o),this.onPointerObservable.notifyObservers(o,a)}}return this},D.prototype._checkPrePointerObservable=function(e,t,r){var i=new b.PointerInfoPre(r,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(i.ray=e.ray),this.onPrePointerObservable.notifyObservers(i,r),!!i.skipOnPointerObservable},D.prototype.simulatePointerDown=function(e,t){var r=new PointerEvent("pointerdown",t);return this._checkPrePointerObservable(e,r,b.PointerEventTypes.POINTERDOWN)?this:this._processPointerDown(e,r)},D.prototype._processPointerDown=function(e,t){var r=this;if(e&&e.hit&&e.pickedMesh){this._pickedDownMesh=e.pickedMesh;var i=e.pickedMesh.actionManager;if(i){if(i.hasPickTriggers)switch(i.processTrigger(A.Constants.ACTION_OnPickDownTrigger,y.ActionEvent.CreateNew(e.pickedMesh,t)),t.button){case 0:i.processTrigger(A.Constants.ACTION_OnLeftPickTrigger,y.ActionEvent.CreateNew(e.pickedMesh,t));break;case 1:i.processTrigger(A.Constants.ACTION_OnCenterPickTrigger,y.ActionEvent.CreateNew(e.pickedMesh,t));break;case 2:i.processTrigger(A.Constants.ACTION_OnRightPickTrigger,y.ActionEvent.CreateNew(e.pickedMesh,t))}i.hasSpecificTrigger(A.Constants.ACTION_OnLongPressTrigger)&&window.setTimeout(function(){var e=r.pick(r._unTranslatedPointerX,r._unTranslatedPointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(A.Constants.ACTION_OnLongPressTrigger)&&e==r._pickedDownMesh},!1,r.cameraToUseForPointers);e&&e.hit&&e.pickedMesh&&i&&0!==r._totalPointersPressed&&Date.now()-r._startingPointerTime>D.LongPressDelay&&!r._isPointerSwiping()&&(r._startingPointerTime=0,i.processTrigger(A.Constants.ACTION_OnLongPressTrigger,y.ActionEvent.CreateNew(e.pickedMesh,t)))},D.LongPressDelay)}}else for(var n=0,s=this._pointerDownStage;n<s.length;n++){e=s[n].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t)}if(e){var a=b.PointerEventTypes.POINTERDOWN;if(this.onPointerDown&&this.onPointerDown(t,e,a),this.onPointerObservable.hasObservers()){var o=new b.PointerInfo(a,t,e);this._setRayOnPointerInfo(o),this.onPointerObservable.notifyObservers(o,a)}}return this},D.prototype.simulatePointerUp=function(e,t,r){var i=new PointerEvent("pointerup",t),n=new k;return r?n.doubleClick=!0:n.singleClick=!0,this._checkPrePointerObservable(e,i,b.PointerEventTypes.POINTERUP)?this:this._processPointerUp(e,i,n)},D.prototype._processPointerUp=function(e,t,r){if(e&&e&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(this.onPointerPick&&this.onPointerPick(t,e),r.singleClick&&!r.ignore&&this.onPointerObservable.hasObservers())){var i=b.PointerEventTypes.POINTERPICK,n=new b.PointerInfo(i,t,e);this._setRayOnPointerInfo(n),this.onPointerObservable.notifyObservers(n,i)}e.pickedMesh.actionManager&&!r.ignore&&(e.pickedMesh.actionManager.processTrigger(A.Constants.ACTION_OnPickUpTrigger,y.ActionEvent.CreateNew(e.pickedMesh,t)),!r.hasSwiped&&r.singleClick&&e.pickedMesh.actionManager.processTrigger(A.Constants.ACTION_OnPickTrigger,y.ActionEvent.CreateNew(e.pickedMesh,t)),r.doubleClick&&e.pickedMesh.actionManager.hasSpecificTrigger(A.Constants.ACTION_OnDoublePickTrigger)&&e.pickedMesh.actionManager.processTrigger(A.Constants.ACTION_OnDoublePickTrigger,y.ActionEvent.CreateNew(e.pickedMesh,t)))}else if(!r.ignore)for(var s=0,a=this._pointerUpStage;s<a.length;s++){e=a[s].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t)}this._pickedDownMesh&&this._pickedDownMesh.actionManager&&this._pickedDownMesh.actionManager.hasSpecificTrigger(A.Constants.ACTION_OnPickOutTrigger)&&this._pickedDownMesh!==this._pickedUpMesh&&this._pickedDownMesh.actionManager.processTrigger(A.Constants.ACTION_OnPickOutTrigger,y.ActionEvent.CreateNew(this._pickedDownMesh,t));var o=0;if(this.onPointerObservable.hasObservers()){if(!r.ignore&&!r.hasSwiped&&(r.singleClick&&this.onPointerObservable.hasSpecificMask(b.PointerEventTypes.POINTERTAP)?o=b.PointerEventTypes.POINTERTAP:r.doubleClick&&this.onPointerObservable.hasSpecificMask(b.PointerEventTypes.POINTERDOUBLETAP)&&(o=b.PointerEventTypes.POINTERDOUBLETAP),o)){n=new b.PointerInfo(o,t,e);this._setRayOnPointerInfo(n),this.onPointerObservable.notifyObservers(n,o)}if(!r.ignore){o=b.PointerEventTypes.POINTERUP;n=new b.PointerInfo(o,t,e);this._setRayOnPointerInfo(n),this.onPointerObservable.notifyObservers(n,o)}}return this.onPointerUp&&!r.ignore&&this.onPointerUp(t,e,o),this},D.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[e]},D.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>D.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>D.DragMovementThreshold},D.prototype.attachControl=function(e,r,i){var n=this;void 0===e&&(e=!0),void 0===r&&(r=!0),void 0===i&&(i=!0),this._initActionManager=function(e,t){if(!n._meshPickProceed){var r=n.pick(n._unTranslatedPointerX,n._unTranslatedPointerY,n.pointerDownPredicate,!1,n.cameraToUseForPointers);n._currentPickResult=r,r&&(e=r.hit&&r.pickedMesh?r.pickedMesh.actionManager:null),n._meshPickProceed=!0}return e},this._delayedSimpleClick=function(e,t,r){(Date.now()-n._previousStartingPointerTime>D.DoubleClickDelay&&!n._doubleClickOccured||e!==n._previousButtonPressed)&&(n._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,r(t,n._currentPickResult))},this._initClickEvent=function(e,t,r,i){var s=new k;n._currentPickResult=null;var a=null,o=e.hasSpecificMask(b.PointerEventTypes.POINTERPICK)||t.hasSpecificMask(b.PointerEventTypes.POINTERPICK)||e.hasSpecificMask(b.PointerEventTypes.POINTERTAP)||t.hasSpecificMask(b.PointerEventTypes.POINTERTAP)||e.hasSpecificMask(b.PointerEventTypes.POINTERDOUBLETAP)||t.hasSpecificMask(b.PointerEventTypes.POINTERDOUBLETAP);!o&&P.ActionManager&&(a=n._initActionManager(a,s))&&(o=a.hasPickTriggers);var h=!1;if(o){var l=r.button;if(s.hasSwiped=n._isPointerSwiping(),!s.hasSwiped){var c=!D.ExclusiveDoubleClickMode;c||(c=!e.hasSpecificMask(b.PointerEventTypes.POINTERDOUBLETAP)&&!t.hasSpecificMask(b.PointerEventTypes.POINTERDOUBLETAP))&&!P.ActionManager.HasSpecificTrigger(A.Constants.ACTION_OnDoublePickTrigger)&&(a=n._initActionManager(a,s))&&(c=!a.hasSpecificTrigger(A.Constants.ACTION_OnDoublePickTrigger)),c?(Date.now()-n._previousStartingPointerTime>D.DoubleClickDelay||l!==n._previousButtonPressed)&&(s.singleClick=!0,i(s,n._currentPickResult),h=!0):(n._previousDelayedSimpleClickTimeout=n._delayedSimpleClickTimeout,n._delayedSimpleClickTimeout=window.setTimeout(n._delayedSimpleClick.bind(n,l,s,i),D.DoubleClickDelay));var u=e.hasSpecificMask(b.PointerEventTypes.POINTERDOUBLETAP)||t.hasSpecificMask(b.PointerEventTypes.POINTERDOUBLETAP);!u&&P.ActionManager.HasSpecificTrigger(A.Constants.ACTION_OnDoublePickTrigger)&&(a=n._initActionManager(a,s))&&(u=a.hasSpecificTrigger(A.Constants.ACTION_OnDoublePickTrigger)),u&&(l===n._previousButtonPressed&&Date.now()-n._previousStartingPointerTime<D.DoubleClickDelay&&!n._doubleClickOccured?(s.hasSwiped||n._isPointerSwiping()?(n._doubleClickOccured=!1,n._previousStartingPointerTime=n._startingPointerTime,n._previousStartingPointerPosition.x=n._startingPointerPosition.x,n._previousStartingPointerPosition.y=n._startingPointerPosition.y,n._previousButtonPressed=l,D.ExclusiveDoubleClickMode?(n._previousDelayedSimpleClickTimeout&&clearTimeout(n._previousDelayedSimpleClickTimeout),n._previousDelayedSimpleClickTimeout=n._delayedSimpleClickTimeout,i(s,n._previousPickResult)):i(s,n._currentPickResult)):(n._previousStartingPointerTime=0,n._doubleClickOccured=!0,s.doubleClick=!0,s.ignore=!1,D.ExclusiveDoubleClickMode&&n._previousDelayedSimpleClickTimeout&&clearTimeout(n._previousDelayedSimpleClickTimeout),n._previousDelayedSimpleClickTimeout=n._delayedSimpleClickTimeout,i(s,n._currentPickResult)),h=!0):(n._doubleClickOccured=!1,n._previousStartingPointerTime=n._startingPointerTime,n._previousStartingPointerPosition.x=n._startingPointerPosition.x,n._previousStartingPointerPosition.y=n._startingPointerPosition.y,n._previousButtonPressed=l))}}h||i(s,n._currentPickResult)},this._onPointerMove=function(e){if(n._updatePointerPosition(e),!n._checkPrePointerObservable(null,e,e.type===n._wheelEventName?b.PointerEventTypes.POINTERWHEEL:b.PointerEventTypes.POINTERMOVE)&&(n.cameraToUseForPointers||n.activeCamera)){n.pointerMovePredicate||(n.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||n.constantlyUpdateMeshUnderPointer||null!==e.actionManager&&void 0!==e.actionManager)});var t=n.pick(n._unTranslatedPointerX,n._unTranslatedPointerY,n.pointerMovePredicate,!1,n.cameraToUseForPointers);n._processPointerMove(t,e)}},this._onPointerDown=function(e){if(n._totalPointersPressed++,n._pickedDownMesh=null,n._meshPickProceed=!1,n._updatePointerPosition(e),n.preventDefaultOnPointerDown&&o&&(e.preventDefault(),o.focus()),n._startingPointerPosition.x=n._pointerX,n._startingPointerPosition.y=n._pointerY,n._startingPointerTime=Date.now(),!n._checkPrePointerObservable(null,e,b.PointerEventTypes.POINTERDOWN)&&(n.cameraToUseForPointers||n.activeCamera)){n._pointerCaptures[e.pointerId]=!0,n.pointerDownPredicate||(n.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()}),n._pickedDownMesh=null;var t=n.pick(n._unTranslatedPointerX,n._unTranslatedPointerY,n.pointerDownPredicate,!1,n.cameraToUseForPointers);n._processPointerDown(t,e)}},this._onPointerUp=function(e){0!==n._totalPointersPressed&&(n._totalPointersPressed--,n._pickedUpMesh=null,n._meshPickProceed=!1,n._updatePointerPosition(e),n.preventDefaultOnPointerUp&&o&&(e.preventDefault(),o.focus()),n._initClickEvent(n.onPrePointerObservable,n.onPointerObservable,e,function(t,r){if(n._pointerCaptures[e.pointerId]=!1,n.onPrePointerObservable.hasObservers()&&!t.ignore){if(!t.hasSwiped){if(t.singleClick&&n.onPrePointerObservable.hasSpecificMask(b.PointerEventTypes.POINTERTAP)&&n._checkPrePointerObservable(null,e,b.PointerEventTypes.POINTERTAP))return;if(t.doubleClick&&n.onPrePointerObservable.hasSpecificMask(b.PointerEventTypes.POINTERDOUBLETAP)&&n._checkPrePointerObservable(null,e,b.PointerEventTypes.POINTERDOUBLETAP))return}if(n._checkPrePointerObservable(null,e,b.PointerEventTypes.POINTERUP))return}(n.cameraToUseForPointers||n.activeCamera)&&(n.pointerUpPredicate||(n.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()}),!n._meshPickProceed&&(P.ActionManager&&P.ActionManager.HasTriggers||n.onPointerObservable.hasObservers())&&n._initActionManager(null,t),r||(r=n._currentPickResult),n._processPointerUp(r,e,t),n._previousPickResult=n._currentPickResult)}))},this._onKeyDown=function(e){var t=_.KeyboardEventTypes.KEYDOWN;if(n.onPreKeyboardObservable.hasObservers()){var r=new _.KeyboardInfoPre(t,e);if(n.onPreKeyboardObservable.notifyObservers(r,t),r.skipOnPointerObservable)return}if(n.onKeyboardObservable.hasObservers()){r=new _.KeyboardInfo(t,e);n.onKeyboardObservable.notifyObservers(r,t)}n.actionManager&&n.actionManager.processTrigger(A.Constants.ACTION_OnKeyDownTrigger,y.ActionEvent.CreateNewFromScene(n,e))},this._onKeyUp=function(e){var t=_.KeyboardEventTypes.KEYUP;if(n.onPreKeyboardObservable.hasObservers()){var r=new _.KeyboardInfoPre(t,e);if(n.onPreKeyboardObservable.notifyObservers(r,t),r.skipOnPointerObservable)return}if(n.onKeyboardObservable.hasObservers()){r=new _.KeyboardInfo(t,e);n.onKeyboardObservable.notifyObservers(r,t)}n.actionManager&&n.actionManager.processTrigger(A.Constants.ACTION_OnKeyUpTrigger,y.ActionEvent.CreateNewFromScene(n,e))};var s=this.getEngine();this._onCanvasFocusObserver=s.onCanvasFocusObservable.add(function(){o&&(o.addEventListener("keydown",n._onKeyDown,!1),o.addEventListener("keyup",n._onKeyUp,!1))}),this._onCanvasBlurObserver=s.onCanvasBlurObservable.add(function(){o&&(o.removeEventListener("keydown",n._onKeyDown),o.removeEventListener("keyup",n._onKeyUp))});var a=t.Tools.GetPointerPrefix(),o=this._engine.getRenderingCanvas();o&&(i&&(o.addEventListener(a+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",o.addEventListener(this._wheelEventName,this._onPointerMove,!1)),r&&o.addEventListener(a+"down",this._onPointerDown,!1),e&&window.addEventListener(a+"up",this._onPointerUp,!1),o.tabIndex=1)},D.prototype.detachControl=function(){var e=this.getEngine(),r=t.Tools.GetPointerPrefix(),i=e.getRenderingCanvas();i&&(i.removeEventListener(r+"move",this._onPointerMove),i.removeEventListener(r+"down",this._onPointerDown),window.removeEventListener(r+"up",this._onPointerUp),this._onCanvasBlurObserver&&e.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&e.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),i.removeEventListener(this._wheelEventName,this._onPointerMove),i.removeEventListener("keydown",this._onKeyDown),i.removeEventListener("keyup",this._onKeyUp),this.onKeyboardObservable.clear(),this.onPreKeyboardObservable.clear(),this.onPointerObservable.clear(),this.onPrePointerObservable.clear())},D.prototype.isReady=function(){if(this._isDisposed)return!1;var e,t=this.getEngine();if(!t.areAllEffectsReady())return!1;if(this._pendingData.length>0)return!1;for(e=0;e<this.meshes.length;e++){var r=this.meshes[e];if(r.isEnabled()&&(r.subMeshes&&0!==r.subMeshes.length)){if(!r.isReady(!0))return!1;for(var i="InstancedMesh"===r.getClassName()||"InstancedLinesMesh"===r.getClassName()||t.getCaps().instancedArrays&&r.instances.length>0,n=0,s=this._isReadyForMeshStage;n<s.length;n++){if(!s[n].action(r,i))return!1}}}for(e=0;e<this.geometries.length;e++){if(this.geometries[e].delayLoadState===A.Constants.DELAYLOADSTATE_LOADING)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var a=0,o=this.activeCameras;a<o.length;a++){if(!o[a].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var h=0,l=this.particleSystems;h<l.length;h++){if(!l[h].isReady())return!1}return!0},D.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},D.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},D.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},D.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},D.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},D.prototype._executeOnceBeforeRender=function(e){var t=this,r=function(){e(),setTimeout(function(){t.unregisterBeforeRender(r)})};this.registerBeforeRender(r)},D.prototype.executeOnceBeforeRender=function(e,t){var r=this;void 0!==t?setTimeout(function(){r._executeOnceBeforeRender(e)},t):this._executeOnceBeforeRender(e)},D.prototype._addPendingData=function(e){this._pendingData.push(e)},D.prototype._removePendingData=function(e){var t=this.isLoading,r=this._pendingData.indexOf(e);-1!==r&&this._pendingData.splice(r,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},D.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(D.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),D.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},D.prototype.whenReadyAsync=function(){var e=this;return new Promise(function(t){e.executeWhenReady(function(){t()})})},D.prototype._checkIsReady=function(){var e=this;if(this._registerTransientComponents(),this.isReady())return this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1);this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150)},D.prototype.beginWeightedAnimation=function(e,t,r,i,n,s,a,o,h,l){void 0===i&&(i=1),void 0===s&&(s=1);var c=this.beginAnimation(e,t,r,n,s,a,o,!1,h,l);return c.weight=i,c},D.prototype.beginAnimation=function(e,t,r,i,n,s,a,o,h,l){void 0===n&&(n=1),void 0===o&&(o=!0),t>r&&n>0&&(n*=-1),o&&this.stopAnimation(e,void 0,h),a||(a=new p.Animatable(this,e,t,r,i,n,s,void 0,l));var c=!h||h(e);if(e.animations&&c&&a.appendAnimations(e,e.animations),e.getAnimatables)for(var u=e.getAnimatables(),d=0;d<u.length;d++)this.beginAnimation(u[d],t,r,i,n,s,a,o,h,l);return a.reset(),a},D.prototype.beginHierarchyAnimation=function(e,t,r,i,n,s,a,o,h,l,c){void 0===s&&(s=1),void 0===h&&(h=!0);var u=e.getDescendants(t),d=[];d.push(this.beginAnimation(e,r,i,n,s,a,o,h,l));for(var g=0,p=u;g<p.length;g++){var f=p[g];d.push(this.beginAnimation(f,r,i,n,s,a,o,h,l))}return d},D.prototype.beginDirectAnimation=function(e,t,r,i,n,s,a,o){return void 0===s&&(s=1),new p.Animatable(this,e,r,i,n,s,a,t,o)},D.prototype.beginDirectHierarchyAnimation=function(e,t,r,i,n,s,a,o,h){var l=e.getDescendants(t),c=[];c.push(this.beginDirectAnimation(e,r,i,n,s,a,o,h));for(var u=0,d=l;u<d.length;u++){var g=d[u];c.push(this.beginDirectAnimation(g,r,i,n,s,a,o,h))}return c},D.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},D.prototype.getAllAnimatablesByTarget=function(e){for(var t=[],r=0;r<this._activeAnimatables.length;r++)this._activeAnimatables[r].target===e&&t.push(this._activeAnimatables[r]);return t},Object.defineProperty(D.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),D.prototype.stopAnimation=function(e,t,r){for(var i=0,n=this.getAllAnimatablesByTarget(e);i<n.length;i++){n[i].stop(t,r)}},D.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop();this._activeAnimatables=[]}for(var t=0,r=this.animationGroups;t<r.length;t++){r[t].stop()}},D.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=r.PrecisionDate.Now},D.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){var e=r.PrecisionDate.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=e}var t=this.useConstantAnimationDeltaTime?16:(e-this._animationTimeLast)*this.animationTimeScale;this._animationTime+=t,this._animationTimeLast=e;for(var i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i]._animate(this._animationTime);this._processLateAnimationBindings()}},D.prototype._registerTargetForLateAnimationBinding=function(e,t){var r=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(r),r._lateAnimationHolders||(r._lateAnimationHolders={}),r._lateAnimationHolders[e.targetPath]||(r._lateAnimationHolders[e.targetPath]={totalWeight:0,animations:[],originalValue:t}),r._lateAnimationHolders[e.targetPath].animations.push(e),r._lateAnimationHolders[e.targetPath].totalWeight+=e.weight},D.prototype._processLateAnimationBindingsForMatrices=function(e){var t=1,r=o.Tmp.Vector3[0],i=o.Tmp.Vector3[1],n=o.Tmp.Quaternion[0],s=0,a=e.animations[0],h=e.originalValue,l=1;if(e.totalWeight<1)h.decompose(i,n,r),l=1-e.totalWeight;else if(s=1,t=e.totalWeight,a.currentValue.decompose(i,n,r),1==(l=a.weight/t))return a.currentValue;i.scaleInPlace(l),r.scaleInPlace(l),n.scaleInPlace(l);for(var c=s;c<e.animations.length;c++){var u=e.animations[c],d=(l=u.weight/t,o.Tmp.Vector3[2]),g=o.Tmp.Vector3[3],p=o.Tmp.Quaternion[1];u.currentValue.decompose(g,p,d),g.scaleAndAddToRef(l,i),p.scaleAndAddToRef(l,n),d.scaleAndAddToRef(l,r)}return o.Matrix.ComposeToRef(i,n,r,a._workValue),a._workValue},D.prototype._processLateAnimationBindingsForQuaternions=function(e,t){var r=e.animations[0],i=e.originalValue;if(1===e.animations.length)return o.Quaternion.SlerpToRef(i,r.currentValue,Math.min(1,e.totalWeight),t),t;var n,s,a=1;if(e.totalWeight<1){var h=1-e.totalWeight;s=[],(n=[]).push(i),s.push(h)}else{if(2===e.animations.length)return o.Quaternion.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),t;n=[],s=[],a=e.totalWeight}for(var l=0;l<e.animations.length;l++){var c=e.animations[l];n.push(c.currentValue),s.push(c.weight/a)}for(var u=0,d=null,g=0;g<n.length;)d?(u+=s[g],o.Quaternion.SlerpToRef(d,n[g],s[g]/u,d),g++):(o.Quaternion.SlerpToRef(n[g],n[g+1],s[g+1]/(s[g]+s[g+1]),t),d=t,u=s[g]+s[g+1],g+=2);return d},D.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var e=0;e<this._registeredForLateAnimationBindings.length;e++){var t=this._registeredForLateAnimationBindings.data[e];for(var r in t._lateAnimationHolders){var i=t._lateAnimationHolders[r],n=i.animations[0],s=i.originalValue,a=g.Animation.AllowMatrixDecomposeForInterpolation&&s.m,h=t[r];if(a)h=this._processLateAnimationBindingsForMatrices(i);else if(void 0!==s.w)h=this._processLateAnimationBindingsForQuaternions(i,h||o.Quaternion.Identity());else{var l=0,c=1;if(i.totalWeight<1)h=s.scale?s.scale(1-i.totalWeight):s*(1-i.totalWeight);else{c=i.totalWeight;var u=n.weight/c;h=1!==u?n.currentValue.scale?n.currentValue.scale(u):n.currentValue*u:n.currentValue,l=1}for(var d=l;d<i.animations.length;d++){var p=i.animations[d],f=p.weight/c;p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(f,h):h+=p.currentValue*f}}t[r]=h}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},D.prototype._switchToAlternateCameraConfiguration=function(e){this._useAlternateCameraConfiguration=e},D.prototype.getViewMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateViewMatrix:this._viewMatrix},D.prototype.getProjectionMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateProjectionMatrix:this._projectionMatrix},D.prototype.getTransformMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateTransformMatrix:this._transformMatrix},D.prototype.setTransformMatrix=function(e,t){if(this._viewUpdateFlag!==e.updateFlag||this._projectionUpdateFlag!==t.updateFlag){if(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?o.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=o.Frustum.GetPlanes(this._transformMatrix),this.activeCamera&&this.activeCamera._alternateCamera){var r=this.activeCamera._alternateCamera;r.getViewMatrix().multiplyToRef(r.getProjectionMatrix(),o.Tmp.Matrix[0]),o.Frustum.GetRightPlaneToRef(o.Tmp.Matrix[0],this._frustumPlanes[3])}this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update())}},D.prototype._setAlternateTransformMatrix=function(e,t){this._alternateViewUpdateFlag===e.updateFlag&&this._alternateProjectionUpdateFlag===t.updateFlag||(this._alternateViewUpdateFlag=e.updateFlag,this._alternateProjectionUpdateFlag=t.updateFlag,this._alternateViewMatrix=e,this._alternateProjectionMatrix=t,this._alternateTransformMatrix||(this._alternateTransformMatrix=o.Matrix.Zero()),this._alternateViewMatrix.multiplyToRef(this._alternateProjectionMatrix,this._alternateTransformMatrix),this._alternateSceneUbo||this._createAlternateUbo(),this._alternateSceneUbo.useUbo&&(this._alternateSceneUbo.updateMatrix("viewProjection",this._alternateTransformMatrix),this._alternateSceneUbo.updateMatrix("view",this._alternateViewMatrix),this._alternateSceneUbo.update()))},D.prototype.getSceneUniformBuffer=function(){return this._useAlternateCameraConfiguration?this._alternateSceneUbo:this._sceneUbo},D.prototype.getUniqueId=function(){var e=D._uniqueIdCounter;return D._uniqueIdCounter++,e},D.prototype.addMesh=function(e,t){var r=this;void 0===t&&(t=!1),this.meshes.push(e),this.collisionCoordinator&&this.collisionCoordinator.onMeshAdded(e),e._resyncLightSources(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){r.addMesh(e)})},D.prototype.removeMesh=function(e,t){var r=this;void 0===t&&(t=!1);var i=this.meshes.indexOf(e);return-1!==i&&(this.meshes[i]=this.meshes[this.meshes.length-1],this.meshes.pop()),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){r.removeMesh(e)}),i},D.prototype.addTransformNode=function(e){e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),this.onNewTransformNodeAddedObservable.notifyObservers(e)},D.prototype.removeTransformNode=function(e){var t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){var r=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=r,r._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t},D.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&this.skeletons.splice(t,1),t},D.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},D.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var r=0,i=this.meshes;r<i.length;r++){i[r]._removeLightSource(e)}this.lights.splice(t,1),this.sortLightsByPriority()}return this.onLightRemovedObservable.notifyObservers(e),t},D.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var r=this.activeCameras.indexOf(e);return-1!==r&&this.activeCameras.splice(r,1),this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},D.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&this.particleSystems.splice(t,1),t},D.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},D.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},D.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),t},D.prototype.removeMaterial=function(e){var t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){var r=this.materials[this.materials.length-1];this.materials[t]=r,r._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t},D.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},D.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},D.prototype.addLight=function(e){this.lights.push(e),this.sortLightsByPriority();for(var t=0,r=this.meshes;t<r.length;t++){var i=r[t];-1===i._lightSources.indexOf(e)&&(i._lightSources.push(e),i._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)},D.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(f.Light.CompareLightsPriority)},D.prototype.addCamera=function(e){this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e)},D.prototype.addSkeleton=function(e){this.skeletons.push(e)},D.prototype.addParticleSystem=function(e){this.particleSystems.push(e)},D.prototype.addAnimation=function(e){this.animations.push(e)},D.prototype.addAnimationGroup=function(e){this.animationGroups.push(e)},D.prototype.addMultiMaterial=function(e){this.multiMaterials.push(e)},D.prototype.addMaterial=function(e){e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e)},D.prototype.addMorphTargetManager=function(e){this.morphTargetManagers.push(e)},D.prototype.addGeometry=function(e){this.geometriesByUniqueId&&(this.geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e)},D.prototype.addActionManager=function(e){this.actionManagers.push(e)},D.prototype.addTexture=function(e){this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e)},D.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0);var r=this._engine.getRenderingCanvas();r&&(this.activeCamera&&this.activeCamera.detachControl(r),this.activeCamera=e,t&&e.attachControl(r))},D.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},D.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},D.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},D.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},D.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},D.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},D.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},D.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},D.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],i=0;i<r.bones.length;i++)if(r.bones[i].id===e)return r.bones[i];return null},D.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],i=0;i<r.bones.length;i++)if(r.bones[i].name===e)return r.bones[i];return null},D.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},D.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},D.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},D.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},D.prototype.getGeometryByID=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},D.prototype._getGeometryByUniqueID=function(e){if(this.geometriesByUniqueId){var t=this.geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(var r=0;r<this.geometries.length;r++)if(this.geometries[r].uniqueId===e)return this.geometries[r];return null},D.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueID(e.uniqueId))&&(this.addGeometry(e),this.collisionCoordinator&&this.collisionCoordinator.onGeometryAdded(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},D.prototype.removeGeometry=function(e){var t;if(this.geometriesByUniqueId){if(void 0===(t=this.geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;if(t!==this.geometries.length-1){var r=this.geometries[this.geometries.length-1];this.geometries[t]=r,this.geometriesByUniqueId&&(this.geometriesByUniqueId[r.uniqueId]=t,this.geometriesByUniqueId[e.uniqueId]=void 0)}return this.geometries.pop(),this.collisionCoordinator&&this.collisionCoordinator.onGeometryDeleted(e),this.onGeometryRemovedObservable.notifyObservers(e),!0},D.prototype.getGeometries=function(){return this.geometries},D.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},D.prototype.getMeshesByID=function(e){return this.meshes.filter(function(t){return t.id===e})},D.prototype.getTransformNodeByID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},D.prototype.getTransformNodesByID=function(e){return this.transformNodes.filter(function(t){return t.id===e})},D.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},D.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},D.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},D.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var r=this.getTransformNodeByID(e);if(r)return r;var i=this.getLightByID(e);if(i)return i;var n=this.getCameraByID(e);if(n)return n;var s=this.getBoneByID(e);return s||null},D.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var r=this.getTransformNodeByName(e);if(r)return r;var i=this.getLightByName(e);if(i)return i;var n=this.getCameraByName(e);if(n)return n;var s=this.getBoneByName(e);return s||null},D.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},D.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},D.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},D.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},D.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},D.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},D.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var r=this.morphTargetManagers[t],i=0;i<r.numTargets;++i){var n=r.getTarget(i);if(n.id===e)return n}return null},D.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(D.prototype,"uid",{get:function(){return this._uid||(this._uid=t.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),D.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new s.StringDictionary),this._externalData.add(e,t)},D.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},D.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new s.StringDictionary),this._externalData.getOrAddWithFactory(e,t)},D.prototype.removeExternalData=function(e){return this._externalData.remove(e)},D.prototype._evaluateSubMesh=function(e,t){if(this.dispatchAllSubMeshesOfActiveMeshes||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var r=0,i=this._evaluateSubMeshStage;r<i.length;r++){i[r].action(t,e)}var n=e.getMaterial();null!=n&&(n.hasRenderTargetTextures&&void 0!==n.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(n)&&(this._processedMaterials.push(n),this._renderTargets.concatWithNoDuplicate(n.getRenderTargetTextures())),this._activeIndices.addCount(e.indexCount,!1),this._renderingManager.dispatch(e,t,n))}},D.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(D.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!0,configurable:!0}),D.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},D.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},D.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},D.prototype.freezeActiveMeshes=function(){return this.activeCamera?(this._frustumPlanes||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this):this},D.prototype.unfreezeActiveMeshes=function(){return this._activeMeshesFrozen=!1,this},D.prototype._evaluateActiveMeshes=function(){if((!this._activeMeshesFrozen||!this._activeMeshes.length)&&this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var e=0,t=this._beforeEvaluateActiveMeshStage;e<t.length;e++){t[e].action()}for(var r=this.getActiveMeshCandidates(),i=r.length,n=0;n<i;n++){var s=r.data[n];if(!s.isBlocked&&(this._totalVertices.addCount(s.getTotalVertices(),!1),s.isReady()&&s.isEnabled())){s.computeWorldMatrix(),s.actionManager&&s.actionManager.hasSpecificTriggers2(A.Constants.ACTION_OnIntersectionEnterTrigger,A.Constants.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(s);var a=s.getLOD(this.activeCamera);null!=a&&(s._preActivate(),s.isVisible&&s.visibility>0&&0!=(s.layerMask&this.activeCamera.layerMask)&&(s.alwaysSelectAsActiveMesh||s.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),s._activate(this._renderId),a!==s&&a._activate(this._renderId),this._activeMesh(s,a)))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var o=0;o<this.particleSystems.length;o++){var h=this.particleSystems[o];if(h.isStarted()&&h.emitter){var l=h.emitter;l.position&&!l.isEnabled()||(this._activeParticleSystems.push(h),h.animate(),this._renderingManager.dispatchParticles(h))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},D.prototype._activeMesh=function(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&t.skeleton.prepare(),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));for(var r=0,i=this._activeMeshStage;r<i.length;r++){i[r].action(e,t)}if(null!=t&&void 0!==t.subMeshes&&null!==t.subMeshes&&t.subMeshes.length>0)for(var n=this.getActiveSubMeshCandidates(t),s=n.length,a=0;a<s;a++){var o=n.data[a];this._evaluateSubMesh(o,t)}},D.prototype.updateTransformMatrix=function(e){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},D.prototype.updateAlternateTransformMatrix=function(e){this._setAlternateTransformMatrix(e.getViewMatrix(),e.getProjectionMatrix())},D.prototype._renderForCamera=function(e,r){if(!e||!e._skipRendering){var i=this._engine;if(this.activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");i.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.updateTransformMatrix(),e._alternateCamera&&(this.updateAlternateTransformMatrix(e._alternateCamera),this._alternateRendering=!0),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var n=0;n<this._softwareSkinnedMeshes.length;n++){var s=this._softwareSkinnedMeshes.data[n];s.applySkeleton(s.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),r&&r.customRenderTargets&&r.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(r.customRenderTargets);for(var a=0,o=this._gatherActiveCameraRenderTargetsStage;a<o.length;a++){o[a].action(this._renderTargets)}if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){t.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var h=0;h<this._renderTargets.length;h++){var l=this._renderTargets.data[h];if(l._shouldRender()){this._renderId++;var c=l.activeCamera&&l.activeCamera!==this.activeCamera;l.render(c,this.dumpNextRenderTargets)}}t.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var u=0,d=this._cameraDrawRenderTargetStage;u<d.length;u++){d[u].action(this.activeCamera)}if(this._intermediateRendering=!1,this.activeCamera.outputRenderTarget){var g=this.activeCamera.outputRenderTarget.getInternalTexture();g?i.bindFramebuffer(g):w.Logger.Error("Camera contains invalid customDefaultRenderTarget")}else i.restoreDefaultFramebuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&this.postProcessManager._prepareFrame();for(var p=0,f=this._beforeCameraDrawStage;p<f.length;p++){f[p].action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var v=0,m=this._afterCameraDrawStage;v<m.length;v++){m[v].action(this.activeCamera)}this.postProcessManager&&this.postProcessManager._finalizeFrame(e.isIntermediate),this._renderTargets.reset(),this._alternateRendering=!1,this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},D.prototype._processSubCameras=function(e){if(e.cameraRigMode!==l.Camera.RIG_MODE_NONE){for(var t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e);this.activeCamera=e,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix())}else this._renderForCamera(e)},D.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var r=0;r<t.actionManager.actions.length;r++){var i=t.actionManager.actions[r];if(i.trigger===A.Constants.ACTION_OnIntersectionEnterTrigger||i.trigger===A.Constants.ACTION_OnIntersectionExitTrigger){var n=i.getTriggerParameter(),s=n instanceof h.AbstractMesh?n:n.mesh,a=s.intersectsMesh(t,n.usePreciseIntersection),o=t._intersectionsInProgress.indexOf(s);a&&-1===o?i.trigger===A.Constants.ACTION_OnIntersectionEnterTrigger?(i._executeCurrent(y.ActionEvent.CreateNew(t,void 0,s)),t._intersectionsInProgress.push(s)):i.trigger===A.Constants.ACTION_OnIntersectionExitTrigger&&t._intersectionsInProgress.push(s):!a&&o>-1&&(i.trigger===A.Constants.ACTION_OnIntersectionExitTrigger&&i._executeCurrent(y.ActionEvent.CreateNew(t,void 0,s)),t.actionManager.hasSpecificTrigger(A.Constants.ACTION_OnIntersectionExitTrigger,function(e){var t=e instanceof h.AbstractMesh?e:e.mesh;return s===t})&&i.trigger!==A.Constants.ACTION_OnIntersectionExitTrigger||t._intersectionsInProgress.splice(o,1))}}}},D.prototype._advancePhysicsEngineStep=function(e){},D.prototype.render=function(e){if(void 0===e&&(e=!0),!this.isDisposed){if(this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(A.Constants.ACTION_OnEveryFrameTrigger),this._engine.isDeterministicLockStep()){var r=Math.max(D.MinDeltaTime,Math.min(this._engine.getDeltaTime(),D.MaxDeltaTime))+this._timeAccumulator,i=this.getDeterministicFrameTime(),n=0,s=this._engine.getLockstepMaxSteps(),a=Math.floor(r/60);a=Math.min(a,s);do{this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=.06*i,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(i),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,n++,r-=i}while(r>0&&n<a);this._timeAccumulator=r<0?0:r}else{r=this.useConstantAnimationDeltaTime?16:Math.max(D.MinDeltaTime,Math.min(this._engine.getDeltaTime(),D.MaxDeltaTime));this._animationRatio=.06*r,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(r)}for(var o=0,h=this._beforeCameraUpdateStage;o<h.length;o++){h[o].action()}if(e)if(this.activeCameras.length>0)for(var c=0;c<this.activeCameras.length;c++){var u=this.activeCameras[c];if(u.update(),u.cameraRigMode!==l.Camera.RIG_MODE_NONE)for(var d=0;d<u._rigCameras.length;d++)u._rigCameras[d].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==l.Camera.RIG_MODE_NONE))for(d=0;d<this.activeCamera._rigCameras.length;d++)this.activeCamera._rigCameras[d].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var g=this.getEngine(),p=this.activeCamera;if(this.renderTargetsEnabled){t.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var f=0;f<this.customRenderTargets.length;f++){var v=this.customRenderTargets[f];if(v._shouldRender()){if(this._renderId++,this.activeCamera=v.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");g.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),v.render(p!==this.activeCamera,this.dumpNextRenderTargets)}}t.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.customRenderTargets.length>0&&g.restoreDefaultFramebuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.activeCamera=p;for(var m=0,b=this._beforeClearStage;m<b.length;m++){b[m].action()}(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var _=0,y=this._gatherRenderTargetsStage;_<y.length;_++){y[_].action(this._renderTargets)}if(this.activeCameras.length>0)for(c=0;c<this.activeCameras.length;c++)c>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[c]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var P=0,M=this._afterRenderStage;P<M.length;P++){M[P].action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(d=0;d<this._toBeDisposed.length;d++){var O=this._toBeDisposed[d];O&&O.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},D.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},D.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},D.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,t=this._components;e<t.length;e++){t[e].dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var r=0,i=this._activeRequests;r<i.length;r++){i[r].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var n,s=this._engine.getRenderingCanvas();if(s)for(n=0;n<this.cameras.length;n++)this.cameras[n].detachControl(s);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.removeTransformNode(this.transformNodes[0]);for(;this.cameras.length;)this.cameras[0].dispose();for(this.defaultMaterial&&this.defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._alternateSceneUbo&&this._alternateSceneUbo.dispose(),this.postProcessManager.dispose(),(n=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(n,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(D.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),D.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;if(t)for(var r in t._indices=[],t._vertexBuffers)t._vertexBuffers.hasOwnProperty(r)&&(t._vertexBuffers[r]._buffer._data=null)}},D.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var r=t[e];r._buffer&&(r._buffer=null)}},D.prototype.getWorldExtends=function(e){var r=new o.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new o.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach(function(e){if(e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance){var n=e.getBoundingInfo(),s=n.boundingBox.minimumWorld,a=n.boundingBox.maximumWorld;t.Tools.CheckExtends(s,r,i),t.Tools.CheckExtends(a,r,i)}}),{min:r,max:i}},D.prototype.createPickingRay=function(e,t,r,i,n){void 0===n&&(n=!1);var s=T.Ray.Zero();return this.createPickingRayToRef(e,t,r,s,i,n),s},D.prototype.createPickingRayToRef=function(e,t,r,i,n,s){void 0===s&&(s=!1);var a=this._engine;if(!n){if(!this.activeCamera)throw new Error("Active camera not set");n=this.activeCamera}var h=n.viewport.toGlobal(a.getRenderWidth(),a.getRenderHeight());return e=e/this._engine.getHardwareScalingLevel()-h.x,t=t/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-h.y-h.height),i.update(e,t,h.width,h.height,r||o.Matrix.IdentityReadOnly,s?o.Matrix.IdentityReadOnly:n.getViewMatrix(),n.getProjectionMatrix()),this},D.prototype.createPickingRayInCameraSpace=function(e,t,r){var i=T.Ray.Zero();return this.createPickingRayInCameraSpaceToRef(e,t,i,r),i},D.prototype.createPickingRayInCameraSpaceToRef=function(e,t,r,i){if(!v.PickingInfo)return this;var n=this._engine;if(!i){if(!this.activeCamera)throw new Error("Active camera not set");i=this.activeCamera}var s=i.viewport.toGlobal(n.getRenderWidth(),n.getRenderHeight()),a=o.Matrix.Identity();return e=e/this._engine.getHardwareScalingLevel()-s.x,t=t/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-s.y-s.height),r.update(e,t,s.width,s.height,a,a,i.getProjectionMatrix()),this},D.prototype._internalPick=function(e,t,r){if(!v.PickingInfo)return null;for(var i=null,n=0;n<this.meshes.length;n++){var s=this.meshes[n];if(t){if(!t(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var a=e(s.getWorldMatrix()),o=s.intersects(a,r);if(o&&o.hit&&((r||null==i||!(o.distance>=i.distance))&&(i=o,r)))break}return i||new v.PickingInfo},D.prototype._internalMultiPick=function(e,t){if(!v.PickingInfo)return null;for(var r=new Array,i=0;i<this.meshes.length;i++){var n=this.meshes[i];if(t){if(!t(n))continue}else if(!n.isEnabled()||!n.isVisible||!n.isPickable)continue;var s=e(n.getWorldMatrix()),a=n.intersects(s,!1);a&&a.hit&&r.push(a)}return r},D.prototype.pick=function(e,t,r,i,n){var s=this;if(!v.PickingInfo)return null;var a=this._internalPick(function(r){return s.createPickingRayToRef(e,t,r,s._tempPickingRay,n||null),s._tempPickingRay},r,i);return a&&(a.ray=this.createPickingRay(e,t,o.Matrix.Identity(),n||null)),a},D.prototype.pickWithRay=function(e,t,r){var i=this,n=this._internalPick(function(t){return i._pickWithRayInverseMatrix||(i._pickWithRayInverseMatrix=o.Matrix.Identity()),t.invertToRef(i._pickWithRayInverseMatrix),i._cachedRayForTransform||(i._cachedRayForTransform=T.Ray.Zero()),T.Ray.TransformToRef(e,i._pickWithRayInverseMatrix,i._cachedRayForTransform),i._cachedRayForTransform},t,r);return n&&(n.ray=e),n},D.prototype.multiPick=function(e,t,r,i){var n=this;return this._internalMultiPick(function(r){return n.createPickingRay(e,t,r,i||null)},r)},D.prototype.multiPickWithRay=function(e,t){var r=this;return this._internalMultiPick(function(t){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=o.Matrix.Identity()),t.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=T.Ray.Zero()),T.Ray.TransformToRef(e,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform},t)},D.prototype.setPointerOverMesh=function(e){this._pointerOverMesh!==e&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(A.Constants.ACTION_OnPointerOutTrigger,y.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=e,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(A.Constants.ACTION_OnPointerOverTrigger,y.ActionEvent.CreateNew(this._pointerOverMesh)))},D.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},D.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++){t[e]._rebuild()}for(var r=0,i=this.meshes;r<i.length;r++){i[r]._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var n=0,s=this._components;n<s.length;n++){s[n].rebuild()}for(var a=0,o=this.particleSystems;a<o.length;a++){o[a].rebuild()}},D.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++){t[e]._rebuild()}this.markAllMaterialsAsDirty(A.Constants.MATERIAL_TextureDirtyFlag)},D.prototype._getByTags=function(e,t,r){if(void 0===t)return e;var i=[];for(var n in r=r||function(e){},e){var s=e[n];a.Tags&&a.Tags.MatchesQuery(s,t)&&(i.push(s),r(s))}return i},D.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},D.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},D.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},D.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},D.prototype.setRenderingOrder=function(e,t,r,i){void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,r,i)},D.prototype.setRenderingAutoClearDepthStencil=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,r,i)},D.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(D.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(A.Constants.MATERIAL_AllDirtyFlag))},enumerable:!0,configurable:!0}),D.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var r=0,i=this.materials;r<i.length;r++){var n=i[r];t&&!t(n)||n.markAsDirty(e)}},D.prototype._loadFile=function(e,r,i,n,s,a){var o=this,h=t.Tools.LoadFile(e,r,i,n?this.offlineProvider:void 0,s,a);return this._activeRequests.push(h),h.onCompleteObservable.add(function(e){o._activeRequests.splice(o._activeRequests.indexOf(e),1)}),h},D.prototype._loadFileAsync=function(e,t,r){var i=this;return new Promise(function(n,s){i._loadFile(e,function(e){n(e)},void 0,t,r,function(e,t){s(t)})})},D._uniqueIdCounter=0,D.FOGMODE_NONE=0,D.FOGMODE_EXP=1,D.FOGMODE_EXP2=2,D.FOGMODE_LINEAR=3,D.MinDeltaTime=1,D.MaxDeltaTime=1e3,D.DragMovementThreshold=10,D.LongPressDelay=500,D.DoubleClickDelay=300,D.ExclusiveDoubleClickMode=!1,D}(c.AbstractScene);exports.Scene=I;
},{"tslib":"vCxL","./Misc/tools":"RkuS","./Misc/precisionDate":"V1yO","./Misc/observable":"gtkL","./Misc/smartArray":"vK5Y","./Misc/stringDictionary":"xdbM","./Misc/tags":"Ae8d","./Maths/math":"Iizi","./Meshes/abstractMesh":"Nnvo","./Cameras/camera":"ZyNI","./abstractScene":"x731","./Materials/imageProcessingConfiguration":"Ik3r","./Materials/uniformBuffer":"oGUW","./Animations/animation":"8SP4","./Animations/animatable":"AnKL","./Lights/light":"U3iz","./Collisions/pickingInfo":"7JHM","./Collisions/collisionCoordinator":"MxsK","./Events/pointerEvents":"6huE","./Events/keyboardEvents":"urGo","./Actions/actionEvent":"dqHz","./Actions/actionManager":"2X/t","./PostProcesses/postProcessManager":"Rqxo","./Rendering/renderingManager":"6R9t","./sceneComponent":"8yKz","./Culling/ray":"5ppN","./Engines/constants":"vn8z","./Misc/domManagement":"+D0i","./Misc/logger":"Fvml","./Engines/engineStore":"n+VE"}],"Np0R":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TargetCamera=void 0;var t=e(require("tslib")),o=require("../Misc/decorators"),i=require("./camera"),a=require("../Maths/math");function e(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};a.get||a.set?Object.defineProperty(o,i,a):o[i]=t[i]}return o.default=t,o}var r=function(e){function r(t,o,i,r){void 0===r&&(r=!0);var n=e.call(this,t,o,i,r)||this;return n.cameraDirection=new a.Vector3(0,0,0),n.cameraRotation=new a.Vector2(0,0),n.updateUpVectorFromRotation=!1,n._tmpQuaternion=new a.Quaternion,n.rotation=new a.Vector3(0,0,0),n.speed=2,n.noRotationConstraint=!1,n.lockedTarget=null,n._currentTarget=a.Vector3.Zero(),n._initialFocalDistance=1,n._viewMatrix=a.Matrix.Zero(),n._camMatrix=a.Matrix.Zero(),n._cameraTransformMatrix=a.Matrix.Zero(),n._cameraRotationMatrix=a.Matrix.Zero(),n._referencePoint=new a.Vector3(0,0,1),n._transformedReferencePoint=a.Vector3.Zero(),n._globalCurrentTarget=a.Vector3.Zero(),n._globalCurrentUpVector=a.Vector3.Zero(),n._defaultUp=a.Vector3.Up(),n._cachedRotationZ=0,n._cachedQuaternionRotationZ=0,n}return t.__extends(r,e),r.prototype.getFrontPosition=function(t){this.getWorldMatrix();var o=this.getTarget().subtract(this.position);return o.normalize(),o.scaleInPlace(t),this.globalPosition.add(o)},r.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},r.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),e.prototype.storeState.call(this)},r.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},r.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.lockedTarget=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new a.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},r.prototype._updateCache=function(t){t||e.prototype._updateCache.call(this);var o=this._getLockedTargetPosition();o?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(o):this._cache.lockedTarget=o.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},r.prototype._isSynchronizedViewMatrix=function(){if(!e.prototype._isSynchronizedViewMatrix.call(this))return!1;var t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},r.prototype._computeLocalCameraSpeed=function(){var t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))},r.prototype.setTarget=function(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=a.Epsilon),a.Matrix.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var o=t.subtract(this.position);o.x>=0?this.rotation.y=-Math.atan(o.z/o.x)+Math.PI/2:this.rotation.y=-Math.atan(o.z/o.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&a.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},r.prototype.getTarget=function(){return this._currentTarget},r.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},r.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(a.Tmp.Matrix[0]),a.Vector3.TransformNormalToRef(this.cameraDirection,a.Tmp.Matrix[0],a.Tmp.Vector3[0]),void this.position.addInPlace(a.Tmp.Vector3[0]);this.position.addInPlace(this.cameraDirection)},r.prototype._checkInputs=function(){var t=this._decideIfNeedsToMove(),o=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(t&&this._updatePosition(),o){if(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion)this.rotation.lengthSquared()&&a.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion);if(!this.noRotationConstraint){var i=Math.PI/2*.95;this.rotation.x>i&&(this.rotation.x=i),this.rotation.x<-i&&(this.rotation.x=-i)}}t&&(Math.abs(this.cameraDirection.x)<this.speed*a.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*a.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*a.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),o&&(Math.abs(this.cameraRotation.x)<this.speed*a.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*a.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),e.prototype._checkInputs.call(this)},r.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):a.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},r.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return a.Vector3.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},r.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),a.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?a.Axis.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(a.Quaternion.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),a.Axis.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},r.prototype._computeViewMatrix=function(t,o,i){if(this.parent){var e=this.parent.getWorldMatrix();a.Vector3.TransformCoordinatesToRef(t,e,this._globalPosition),a.Vector3.TransformCoordinatesToRef(o,e,this._globalCurrentTarget),a.Vector3.TransformNormalToRef(i,e,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._globalCurrentTarget.copyFrom(o),this._globalCurrentUpVector.copyFrom(i);this.getScene().useRightHandedSystem?a.Matrix.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):a.Matrix.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},r.prototype.createRigCamera=function(t,o){if(this.cameraRigMode!==i.Camera.RIG_MODE_NONE){var e=new r(t,this.position.clone(),this.getScene());return this.cameraRigMode!==i.Camera.RIG_MODE_VR&&this.cameraRigMode!==i.Camera.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new a.Quaternion),e._cameraRigParams={},e.rotationQuaternion=new a.Quaternion),e}return null},r.prototype._updateRigCameras=function(){var t=this._rigCameras[0],o=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case i.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case i.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var a=this.cameraRigMode===i.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,r=this.cameraRigMode===i.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*a,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,o);break;case i.Camera.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),o.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),o.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),o.position.copyFrom(this.position)}e.prototype._updateRigCameras.call(this)},r.prototype._getRigCamPositionAndTarget=function(t,o){this.getTarget().subtractToRef(this.position,r._TargetFocalPoint),r._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var i=r._TargetFocalPoint.addInPlace(this.position);a.Matrix.TranslationToRef(-i.x,-i.y,-i.z,r._TargetTransformMatrix),r._TargetTransformMatrix.multiplyToRef(a.Matrix.RotationY(t),r._RigCamTransformMatrix),a.Matrix.TranslationToRef(i.x,i.y,i.z,r._TargetTransformMatrix),r._RigCamTransformMatrix.multiplyToRef(r._TargetTransformMatrix,r._RigCamTransformMatrix),a.Vector3.TransformCoordinatesToRef(this.position,r._RigCamTransformMatrix,o.position),o.setTarget(i)},r.prototype.getClassName=function(){return"TargetCamera"},r._RigCamTransformMatrix=new a.Matrix,r._TargetTransformMatrix=new a.Matrix,r._TargetFocalPoint=new a.Vector3,t.__decorate([(0,o.serializeAsVector3)()],r.prototype,"rotation",void 0),t.__decorate([(0,o.serialize)()],r.prototype,"speed",void 0),t.__decorate([(0,o.serializeAsMeshReference)("lockedTargetId")],r.prototype,"lockedTarget",void 0),r}(i.Camera);exports.TargetCamera=r;
},{"tslib":"vCxL","../Misc/decorators":"knvU","./camera":"ZyNI","../Maths/math":"Iizi"}],"H3O2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraInputsManager=exports.CameraInputTypes=void 0;var t=require("../Misc/logger"),e=require("../Misc/decorators"),a=require("./camera"),n={};exports.CameraInputTypes=n;var i=function(){function i(t){this.attached={},this.camera=t,this.checkInputs=function(){}}return i.prototype.add=function(e){var a=e.getSimpleName();this.attached[a]?t.Logger.Warn("camera input of type "+a+" already exists on camera"):(this.attached[a]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedElement&&e.attachControl(this.attachedElement))},i.prototype.remove=function(t){for(var e in this.attached){var a=this.attached[e];a===t&&(a.detachControl(this.attachedElement),a.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype.removeByType=function(t){for(var e in this.attached){var a=this.attached[e];a.getClassName()===t&&(a.detachControl(this.attachedElement),a.camera=null,delete this.attached[e],this.rebuildInputCheck())}},i.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},i.prototype.attachInput=function(t){this.attachedElement&&t.attachControl(this.attachedElement,this.noPreventDefault)},i.prototype.attachElement=function(t,e){if(void 0===e&&(e=!1),!this.attachedElement)for(var n in e=!a.Camera.ForceAttachControlToAlwaysPreventDefault&&e,this.attachedElement=t,this.noPreventDefault=e,this.attached)this.attached[n].attachControl(t,e)},i.prototype.detachElement=function(t,e){if(void 0===e&&(e=!1),this.attachedElement===t){for(var a in this.attached)this.attached[a].detachControl(t),e&&(this.attached[a].camera=null);this.attachedElement=null}},i.prototype.rebuildInputCheck=function(){for(var t in this.checkInputs=function(){},this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},i.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},i.prototype.serialize=function(t){var a={};for(var n in this.attached){var i=this.attached[n],h=e.SerializationHelper.Serialize(i);a[i.getClassName()]=h}t.inputsmgr=a},i.prototype.parse=function(t){var a=t.inputsmgr;if(a)for(var i in this.clear(),a){if(c=n[i]){var h=a[i],r=e.SerializationHelper.Parse(function(){return new c},h,null);this.add(r)}}else for(var i in this.attached){var c;if(c=n[this.attached[i].getClassName()]){r=e.SerializationHelper.Parse(function(){return new c},t,null);this.remove(this.attached[i]),this.add(r)}}},i}();exports.CameraInputsManager=i;
},{"../Misc/logger":"Fvml","../Misc/decorators":"knvU","./camera":"ZyNI"}],"7ycW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FreeCameraKeyboardMoveInput=void 0;var e=n(require("tslib")),r=require("../../Misc/decorators"),t=require("../../Cameras/cameraInputsManager"),o=require("../../Events/keyboardEvents"),s=require("../../Maths/math");function n(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};o.get||o.set?Object.defineProperty(r,t,o):r[t]=e[t]}return r.default=e,r}var i=function(){function t(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return t.prototype.attachControl=function(e,r){var t=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){t._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var s,n=e.event;n.metaKey||(e.type===o.KeyboardEventTypes.KEYDOWN?-1===t.keysUp.indexOf(n.keyCode)&&-1===t.keysDown.indexOf(n.keyCode)&&-1===t.keysLeft.indexOf(n.keyCode)&&-1===t.keysRight.indexOf(n.keyCode)||(-1===(s=t._keys.indexOf(n.keyCode))&&t._keys.push(n.keyCode),r||n.preventDefault()):-1===t.keysUp.indexOf(n.keyCode)&&-1===t.keysDown.indexOf(n.keyCode)&&-1===t.keysLeft.indexOf(n.keyCode)&&-1===t.keysRight.indexOf(n.keyCode)||((s=t._keys.indexOf(n.keyCode))>=0&&t._keys.splice(s,1),r||n.preventDefault()))}))},t.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,r=0;r<this._keys.length;r++){var t=this._keys[r],o=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(t)?e._localDirection.copyFromFloats(-o,0,0):-1!==this.keysUp.indexOf(t)?e._localDirection.copyFromFloats(0,0,o):-1!==this.keysRight.indexOf(t)?e._localDirection.copyFromFloats(o,0,0):-1!==this.keysDown.indexOf(t)&&e._localDirection.copyFromFloats(0,0,-o),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),s.Vector3.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}},t.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},t.prototype._onLostFocus=function(){this._keys=[]},t.prototype.getSimpleName=function(){return"keyboard"},e.__decorate([(0,r.serialize)()],t.prototype,"keysUp",void 0),e.__decorate([(0,r.serialize)()],t.prototype,"keysDown",void 0),e.__decorate([(0,r.serialize)()],t.prototype,"keysLeft",void 0),e.__decorate([(0,r.serialize)()],t.prototype,"keysRight",void 0),t}();exports.FreeCameraKeyboardMoveInput=i,t.CameraInputTypes.FreeCameraKeyboardMoveInput=i;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Cameras/cameraInputsManager":"H3O2","../../Events/keyboardEvents":"urGo","../../Maths/math":"Iizi"}],"u1Qs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FreeCameraMouseInput=void 0;var e=o(require("tslib")),t=require("../../Misc/decorators"),r=require("../../Cameras/cameraInputsManager"),n=require("../../Events/pointerEvents");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}var i=function(){function r(e){void 0===e&&(e=!0),this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null}return r.prototype.attachControl=function(e,t){var r=this,o=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(i){var a=i.event;if(!o.isInVRExclusivePointerMode&&(r.touchEnabled||"touch"!==a.pointerType)&&(i.type===n.PointerEventTypes.POINTERMOVE||-1!==r.buttons.indexOf(a.button))){var s=a.srcElement||a.target;if(i.type===n.PointerEventTypes.POINTERDOWN&&s){try{s.setPointerCapture(a.pointerId)}catch(v){}r.previousPosition={x:a.clientX,y:a.clientY},t||(a.preventDefault(),e.focus())}else if(i.type===n.PointerEventTypes.POINTERUP&&s){try{s.releasePointerCapture(a.pointerId)}catch(v){}r.previousPosition=null,t||a.preventDefault()}else if(i.type===n.PointerEventTypes.POINTERMOVE){if(!r.previousPosition||o.isPointerLock)return;var u=a.clientX-r.previousPosition.x;r.camera.getScene().useRightHandedSystem&&(u*=-1),r.camera.parent&&r.camera.parent._getWorldMatrixDeterminant()<0&&(u*=-1),r.camera.cameraRotation.y+=u/r.angularSensibility;var p=a.clientY-r.previousPosition.y;r.camera.cameraRotation.x+=p/r.angularSensibility,r.previousPosition={x:a.clientX,y:a.clientY},t||a.preventDefault()}}}),this._onMouseMove=function(e){if(o.isPointerLock&&!o.isInVRExclusivePointerMode){var n=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0;r.camera.getScene().useRightHandedSystem&&(n*=-1),r.camera.parent&&r.camera.parent._getWorldMatrixDeterminant()<0&&(n*=-1),r.camera.cameraRotation.y+=n/r.angularSensibility;var i=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;r.camera.cameraRotation.x+=i/r.angularSensibility,r.previousPosition=null,t||e.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,n.PointerEventTypes.POINTERDOWN|n.PointerEventTypes.POINTERUP|n.PointerEventTypes.POINTERMOVE),e.addEventListener("mousemove",this._onMouseMove,!1)},r.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&e.removeEventListener("mousemove",this._onMouseMove),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},r.prototype.getClassName=function(){return"FreeCameraMouseInput"},r.prototype.getSimpleName=function(){return"mouse"},e.__decorate([(0,t.serialize)()],r.prototype,"buttons",void 0),e.__decorate([(0,t.serialize)()],r.prototype,"angularSensibility",void 0),r}();exports.FreeCameraMouseInput=i,r.CameraInputTypes.FreeCameraMouseInput=i;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Cameras/cameraInputsManager":"H3O2","../../Events/pointerEvents":"6huE"}],"HqSh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FreeCameraDeviceOrientationInput=void 0;var e=require("../../Cameras/cameraInputsManager"),t=require("../../Maths/math"),n=require("../../Misc/tools"),i=function(){function e(){var e=this;this._screenOrientationAngle=0,this._screenQuaternion=new t.Quaternion,this._alpha=0,this._beta=0,this._gamma=0,this._orientationChanged=function(){e._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,e._screenOrientationAngle=-n.Tools.ToRadians(e._screenOrientationAngle/2),e._screenQuaternion.copyFromFloats(0,Math.sin(e._screenOrientationAngle),0,Math.cos(e._screenOrientationAngle))},this._deviceOrientation=function(t){e._alpha=null!==t.alpha?t.alpha:0,e._beta=null!==t.beta?t.beta:0,e._gamma=null!==t.gamma?t.gamma:0},this._constantTranform=new t.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},set:function(e){this._camera=e,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new t.Quaternion)},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(e,t){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},e.prototype.detachControl=function(e){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation)},e.prototype.checkInputs=function(){this._alpha&&(t.Quaternion.RotationYawPitchRollToRef(n.Tools.ToRadians(this._alpha),n.Tools.ToRadians(this._beta),-n.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},e.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"deviceOrientation"},e}();exports.FreeCameraDeviceOrientationInput=i,e.CameraInputTypes.FreeCameraDeviceOrientationInput=i;
},{"../../Cameras/cameraInputsManager":"H3O2","../../Maths/math":"Iizi","../../Misc/tools":"RkuS"}],"PMEZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FreeCameraTouchInput=void 0;var e=n(require("tslib")),t=require("../../Misc/decorators"),r=require("../../Cameras/cameraInputsManager"),o=require("../../Events/pointerEvents"),i=require("../../Maths/math");function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};o.get||o.set?Object.defineProperty(t,r,o):t[r]=e[r]}return t.default=e,t}var s=function(){function r(){this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return r.prototype.attachControl=function(e,t){var r=this,i=null;void 0===this._pointerInput&&(this._onLostFocus=function(){r._offsetX=null,r._offsetY=null},this._pointerInput=function(e){var n=e.event;if("mouse"!==n.pointerType)if(e.type===o.PointerEventTypes.POINTERDOWN){if(t||n.preventDefault(),r._pointerPressed.push(n.pointerId),1!==r._pointerPressed.length)return;i={x:n.clientX,y:n.clientY}}else if(e.type===o.PointerEventTypes.POINTERUP){if(t||n.preventDefault(),-1===(s=r._pointerPressed.indexOf(n.pointerId)))return;if(r._pointerPressed.splice(s,1),0!=s)return;i=null,r._offsetX=null,r._offsetY=null}else if(e.type===o.PointerEventTypes.POINTERMOVE){if(t||n.preventDefault(),!i)return;var s;if(0!=(s=r._pointerPressed.indexOf(n.pointerId)))return;r._offsetX=n.clientX-i.x,r._offsetY=-(n.clientY-i.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,o.PointerEventTypes.POINTERDOWN|o.PointerEventTypes.POINTERUP|o.PointerEventTypes.POINTERMOVE),this._onLostFocus&&e.addEventListener("blur",this._onLostFocus)},r.prototype.detachControl=function(e){this._pointerInput&&e&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},r.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var e=this.camera;if(e.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)e.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var t=e._computeLocalCameraSpeed(),r=new i.Vector3(0,0,t*this._offsetY/this.touchMoveSensibility);i.Matrix.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(i.Vector3.TransformCoordinates(r,e._cameraRotationMatrix))}}},r.prototype.getClassName=function(){return"FreeCameraTouchInput"},r.prototype.getSimpleName=function(){return"touch"},e.__decorate([(0,t.serialize)()],r.prototype,"touchAngularSensibility",void 0),e.__decorate([(0,t.serialize)()],r.prototype,"touchMoveSensibility",void 0),r}();exports.FreeCameraTouchInput=s,r.CameraInputTypes.FreeCameraTouchInput=s;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Cameras/cameraInputsManager":"H3O2","../../Events/pointerEvents":"6huE","../../Maths/math":"Iizi"}],"2KsL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VirtualJoystick=exports.JoystickAxis=void 0;var t,e=require("../Maths/math"),i=require("./stringDictionary");exports.JoystickAxis=t,function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(t||(exports.JoystickAxis=t={}));var o=function(){function o(n){var s=this;if(this._leftJoystick=!!n,o._globalJoystickIndex++,this._axisTargetedByLeftAndRight=t.X,this._axisTargetedByUpAndDown=t.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new i.StringDictionary,this.deltaPosition=e.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(t){o.vjCanvasWidth=window.innerWidth,o.vjCanvasHeight=window.innerHeight,o.Canvas&&(o.Canvas.width=o.vjCanvasWidth,o.Canvas.height=o.vjCanvasHeight),o.halfWidth=o.vjCanvasWidth/2},!o.Canvas){window.addEventListener("resize",this._onResize,!1),o.Canvas=document.createElement("canvas"),o.vjCanvasWidth=window.innerWidth,o.vjCanvasHeight=window.innerHeight,o.Canvas.width=window.innerWidth,o.Canvas.height=window.innerHeight,o.Canvas.style.width="100%",o.Canvas.style.height="100%",o.Canvas.style.position="absolute",o.Canvas.style.backgroundColor="transparent",o.Canvas.style.top="0px",o.Canvas.style.left="0px",o.Canvas.style.zIndex="5",o.Canvas.style.msTouchAction="none",o.Canvas.setAttribute("touch-action","none");var a=o.Canvas.getContext("2d");if(!a)throw new Error("Unable to create canvas for virtual joystick");o.vjCanvasContext=a,o.vjCanvasContext.strokeStyle="#ffffff",o.vjCanvasContext.lineWidth=2,document.body.appendChild(o.Canvas)}o.halfWidth=o.Canvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new e.Vector2(0,0),this._joystickPreviousPointerPos=new e.Vector2(0,0),this._joystickPointerStartPos=new e.Vector2(0,0),this._deltaJoystickVector=new e.Vector2(0,0),this._onPointerDownHandlerRef=function(t){s._onPointerDown(t)},this._onPointerMoveHandlerRef=function(t){s._onPointerMove(t)},this._onPointerUpHandlerRef=function(t){s._onPointerUp(t)},o.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),o.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),o.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),o.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),o.Canvas.addEventListener("contextmenu",function(t){t.preventDefault()},!1),requestAnimationFrame(function(){s._drawVirtualJoystick()})}return o.prototype.setJoystickSensibility=function(t){this._joystickSensibility=t,this._inversedSensibility=1/(this._joystickSensibility/1e3)},o.prototype._onPointerDown=function(t){t.preventDefault(),(!0===this._leftJoystick?t.clientX<o.halfWidth:t.clientX>o.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=t.pointerId,this._joystickPointerStartPos.x=t.clientX,this._joystickPointerStartPos.y=t.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(t.pointerId.toString(),t)):o._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(t.pointerId.toString(),{x:t.clientX,y:t.clientY,prevX:t.clientX,prevY:t.clientY}))},o.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var i=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,i));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,i));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,i))}var o=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,o));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,o));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,o))}}else{var n=this._touches.get(e.pointerId.toString());n&&(n.x=e.clientX,n.y=e.clientY)}},o.prototype._onPointerUp=function(t){if(this._joystickPointerID==t.pointerId)o.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),o.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var e=this._touches.get(t.pointerId.toString());e&&o.vjCanvasContext.clearRect(e.prevX-44,e.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(t.pointerId.toString())},o.prototype.setJoystickColor=function(t){this._joystickColor=t},o.prototype.setActionOnTouch=function(t){this._action=t},o.prototype.setAxisForLeftRight=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByLeftAndRight=e;break;default:this._axisTargetedByLeftAndRight=t.X}},o.prototype.setAxisForUpDown=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByUpAndDown=e;break;default:this._axisTargetedByUpAndDown=t.Y}},o.prototype._drawVirtualJoystick=function(){var t=this;this.pressed&&this._touches.forEach(function(e,i){i.pointerId===t._joystickPointerID?(o.vjCanvasContext.clearRect(t._joystickPointerStartPos.x-64,t._joystickPointerStartPos.y-64,128,128),o.vjCanvasContext.clearRect(t._joystickPreviousPointerPos.x-42,t._joystickPreviousPointerPos.y-42,84,84),o.vjCanvasContext.beginPath(),o.vjCanvasContext.lineWidth=6,o.vjCanvasContext.strokeStyle=t._joystickColor,o.vjCanvasContext.arc(t._joystickPointerStartPos.x,t._joystickPointerStartPos.y,40,0,2*Math.PI,!0),o.vjCanvasContext.stroke(),o.vjCanvasContext.closePath(),o.vjCanvasContext.beginPath(),o.vjCanvasContext.strokeStyle=t._joystickColor,o.vjCanvasContext.lineWidth=2,o.vjCanvasContext.arc(t._joystickPointerStartPos.x,t._joystickPointerStartPos.y,60,0,2*Math.PI,!0),o.vjCanvasContext.stroke(),o.vjCanvasContext.closePath(),o.vjCanvasContext.beginPath(),o.vjCanvasContext.strokeStyle=t._joystickColor,o.vjCanvasContext.arc(t._joystickPointerPos.x,t._joystickPointerPos.y,40,0,2*Math.PI,!0),o.vjCanvasContext.stroke(),o.vjCanvasContext.closePath(),t._joystickPreviousPointerPos=t._joystickPointerPos.clone()):(o.vjCanvasContext.clearRect(i.prevX-44,i.prevY-44,88,88),o.vjCanvasContext.beginPath(),o.vjCanvasContext.fillStyle="white",o.vjCanvasContext.beginPath(),o.vjCanvasContext.strokeStyle="red",o.vjCanvasContext.lineWidth=6,o.vjCanvasContext.arc(i.x,i.y,40,0,2*Math.PI,!0),o.vjCanvasContext.stroke(),o.vjCanvasContext.closePath(),i.prevX=i.x,i.prevY=i.y)}),requestAnimationFrame(function(){t._drawVirtualJoystick()})},o.prototype.releaseCanvas=function(){o.Canvas&&(o.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),o.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),o.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),o.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(o.Canvas),o.Canvas=null)},o._globalJoystickIndex=0,o}();exports.VirtualJoystick=o;
},{"../Maths/math":"Iizi","./stringDictionary":"xdbM"}],"Kpd3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FreeCameraVirtualJoystickInput=void 0;var t=require("../../Misc/virtualJoystick"),i=require("../../Cameras/cameraInputsManager"),e=require("../../Maths/math"),o=function(){function i(){}return i.prototype.getLeftJoystick=function(){return this._leftjoystick},i.prototype.getRightJoystick=function(){return this._rightjoystick},i.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,i=50*t._computeLocalCameraSpeed(),o=e.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),s=e.Vector3.TransformCoordinates(new e.Vector3(this._leftjoystick.deltaPosition.x*i,this._leftjoystick.deltaPosition.y*i,this._leftjoystick.deltaPosition.z*i),o);t.cameraDirection=t.cameraDirection.add(s),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},i.prototype.attachControl=function(i,e){this._leftjoystick=new t.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(t.JoystickAxis.Z),this._leftjoystick.setAxisForLeftRight(t.JoystickAxis.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new t.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(t.JoystickAxis.X),this._rightjoystick.setAxisForLeftRight(t.JoystickAxis.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},i.prototype.detachControl=function(t){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},i.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},i.prototype.getSimpleName=function(){return"virtualJoystick"},i}();exports.FreeCameraVirtualJoystickInput=o,i.CameraInputTypes.FreeCameraVirtualJoystickInput=o;
},{"../../Misc/virtualJoystick":"2KsL","../../Cameras/cameraInputsManager":"H3O2","../../Maths/math":"Iizi"}],"KF3P":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FreeCameraInputsManager=void 0;var e=o(require("tslib")),r=require("./cameraInputsManager"),t=require("../Cameras/Inputs/freeCameraKeyboardMoveInput"),a=require("../Cameras/Inputs/freeCameraMouseInput"),n=require("../Cameras/Inputs/freeCameraDeviceOrientationInput"),u=require("../Cameras/Inputs/freeCameraTouchInput"),i=require("../Cameras/Inputs/freeCameraVirtualJoystickInput");function o(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};a.get||a.set?Object.defineProperty(r,t,a):r[t]=e[t]}return r.default=e,r}var s=function(r){function o(e){return r.call(this,e)||this}return e.__extends(o,r),o.prototype.addKeyboard=function(){return this.add(new t.FreeCameraKeyboardMoveInput),this},o.prototype.addMouse=function(e){return void 0===e&&(e=!0),this.add(new a.FreeCameraMouseInput(e)),this},o.prototype.addDeviceOrientation=function(){return this.add(new n.FreeCameraDeviceOrientationInput),this},o.prototype.addTouch=function(){return this.add(new u.FreeCameraTouchInput),this},o.prototype.addVirtualJoystick=function(){return this.add(new i.FreeCameraVirtualJoystickInput),this},o}(r.CameraInputsManager);exports.FreeCameraInputsManager=s;
},{"tslib":"vCxL","./cameraInputsManager":"H3O2","../Cameras/Inputs/freeCameraKeyboardMoveInput":"7ycW","../Cameras/Inputs/freeCameraMouseInput":"u1Qs","../Cameras/Inputs/freeCameraDeviceOrientationInput":"HqSh","../Cameras/Inputs/freeCameraTouchInput":"PMEZ","../Cameras/Inputs/freeCameraVirtualJoystickInput":"Kpd3"}],"1Ewv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FreeCamera=void 0;var e=a(require("tslib")),t=require("../Misc/decorators"),i=require("../Maths/math"),o=require("../Collisions/collider"),r=require("../Engines/engine"),n=require("./targetCamera"),s=require("./freeCameraInputsManager");function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};o.get||o.set?Object.defineProperty(t,i,o):t[i]=e[i]}return t.default=e,t}var c=function(n){function a(e,t,o,a){void 0===a&&(a=!0);var c=n.call(this,e,t,o,a)||this;return c.ellipsoid=new i.Vector3(.5,1,.5),c.ellipsoidOffset=new i.Vector3(0,0,0),c.checkCollisions=!1,c.applyGravity=!1,c._needMoveForGravity=!1,c._oldPosition=i.Vector3.Zero(),c._diffPosition=i.Vector3.Zero(),c._newPosition=i.Vector3.Zero(),c._collisionMask=-1,c._onCollisionPositionChange=function(e,t,i){void 0===i&&(i=null);var o;o=t,c._newPosition.copyFrom(o),c._newPosition.subtractToRef(c._oldPosition,c._diffPosition),c._diffPosition.length()>r.Engine.CollisionsEpsilon&&(c.position.addInPlace(c._diffPosition),c.onCollide&&i&&c.onCollide(i))},c.inputs=new s.FreeCameraInputsManager(c),c.inputs.addKeyboard().addMouse(),c}return e.__extends(a,n),Object.defineProperty(a.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),a.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},a.prototype.detachControl=function(e){this.inputs.detachElement(e),this.cameraDirection=new i.Vector3(0,0,0),this.cameraRotation=new i.Vector2(0,0)},Object.defineProperty(a.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),a.prototype._collideWithWorld=function(e){(this.parent?i.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset),this._collider||(this._collider=new o.Collider),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var t=e;this.applyGravity&&(t=e.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,t,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},a.prototype._checkInputs=function(){this._localDirection||(this._localDirection=i.Vector3.Zero(),this._transformedDirection=i.Vector3.Zero()),this.inputs.checkInputs(),n.prototype._checkInputs.call(this)},a.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},a.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):n.prototype._updatePosition.call(this)},a.prototype.dispose=function(){this.inputs.clear(),n.prototype.dispose.call(this)},a.prototype.getClassName=function(){return"FreeCamera"},e.__decorate([(0,t.serializeAsVector3)()],a.prototype,"ellipsoid",void 0),e.__decorate([(0,t.serializeAsVector3)()],a.prototype,"ellipsoidOffset",void 0),e.__decorate([(0,t.serialize)()],a.prototype,"checkCollisions",void 0),e.__decorate([(0,t.serialize)()],a.prototype,"applyGravity",void 0),a}(n.TargetCamera);exports.FreeCamera=c;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi","../Collisions/collider":"Lnna","../Engines/engine":"Z5lb","./targetCamera":"Np0R","./freeCameraInputsManager":"KF3P"}],"Gju8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneLoaderFlags=void 0;var e=require("../Engines/constants"),n=function(){function n(){}return Object.defineProperty(n,"ForceFullSceneLoadingForIncremental",{get:function(){return n._ForceFullSceneLoadingForIncremental},set:function(e){n._ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ShowLoadingScreen",{get:function(){return n._ShowLoadingScreen},set:function(e){n._ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(n,"loggingLevel",{get:function(){return n._loggingLevel},set:function(e){n._loggingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CleanBoneMatrixWeights",{get:function(){return n._CleanBoneMatrixWeights},set:function(e){n._CleanBoneMatrixWeights=e},enumerable:!0,configurable:!0}),n._ForceFullSceneLoadingForIncremental=!1,n._ShowLoadingScreen=!0,n._CleanBoneMatrixWeights=!1,n._loggingLevel=e.Constants.SCENELOADER_NO_LOGGING,n}();exports.SceneLoaderFlags=n;
},{"../Engines/constants":"vn8z"}],"QQcI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TorusKnotGeometry=exports.PlaneGeometry=exports.TiledGroundGeometry=exports.GroundGeometry=exports.TorusGeometry=exports.CylinderGeometry=exports.DiscGeometry=exports.SphereGeometry=exports.BoxGeometry=exports.RibbonGeometry=exports._PrimitiveGeometry=exports.Geometry=void 0;var e=h(require("tslib")),t=require("../Maths/math"),r=require("../Meshes/mesh.vertexData"),s=require("../Meshes/buffer"),i=require("../Meshes/subMesh"),n=require("../Loading/sceneLoaderFlags"),a=require("../Culling/boundingInfo"),o=require("../Engines/constants"),u=require("../Misc/tools"),d=require("../Misc/tags");function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}var f=function(){function e(e,t,r,s,i){void 0===s&&(s=!1),void 0===i&&(i=null),this.delayLoadState=o.Constants.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=e,this.uniqueId=t.getUniqueId(),this._engine=t.getEngine(),this._meshes=[],this._scene=t,this._vertexBuffers={},this._indices=[],this._updatable=s,r?this.setAllVerticesData(r,s):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),i&&(this.applyToMesh(i),i.computeWorldMatrix(!0))}return Object.defineProperty(e.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),e.CreateGeometryForMesh=function(t){var r=new e(e.RandomId(),t.getScene());return r.applyToMesh(t),r},Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return this.delayLoadState===o.Constants.DELAYLOADSTATE_LOADED||this.delayLoadState===o.Constants.DELAYLOADSTATE_NONE},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers){this._vertexBuffers[e]._rebuild()}},e.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},e.prototype.setVerticesData=function(e,t,r,i){void 0===r&&(r=!1);var n=new s.VertexBuffer(this._engine,t,e,r,0===this._meshes.length,i);this.setVerticesBuffer(n)},e.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},e.prototype.setVerticesBuffer=function(e,t){void 0===t&&(t=null);var r=e.getKind();if(this._vertexBuffers[r]&&this._vertexBuffers[r].dispose(),this._vertexBuffers[r]=e,r===s.VertexBuffer.PositionKind){var i=e.getData();null!=t?this._totalVertices=t:null!=i&&(this._totalVertices=i.length/(e.byteStride/4)),this._updateExtend(i),this._resetPointsArrayCache();for(var n=this._meshes,o=n.length,u=0;u<o;u++){var d=n[u];d._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),d._createGlobalSubMesh(!1),d.computeWorldMatrix(!0)}}this.notifyUpdate(r),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},e.prototype.updateVerticesDataDirectly=function(e,t,r,s){void 0===s&&(s=!1);var i=this.getVertexBuffer(e);i&&(i.updateDirectly(t,r,s),this.notifyUpdate(e))},e.prototype.updateVerticesData=function(e,t,r){void 0===r&&(r=!1);var i=this.getVertexBuffer(e);i&&(i.update(t),e===s.VertexBuffer.PositionKind&&this._updateBoundingInfo(r,t),this.notifyUpdate(e))},e.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var r=0,s=this._meshes;r<s.length;r++){var i=s[r];i._boundingInfo?i._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):i._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var n=0,o=i.subMeshes;n<o.length;n++){o[n].refreshBoundingInfo()}}},e.prototype._bind=function(e,t){if(e){void 0===t&&(t=this._indexBuffer);var r=this.getVertexBuffers();r&&(t==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(r,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)):this._engine.bindBuffers(r,t,e))}},e.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},e.prototype.getVerticesData=function(e,t,r){var i=this.getVertexBuffer(e);if(!i)return null;var n=i.getData();if(!n)return null;var a=i.getSize()*s.VertexBuffer.GetTypeByteLength(i.type),o=this._totalVertices*i.getSize();if(i.type!==s.VertexBuffer.FLOAT||i.byteStride!==a){var d=[];return i.forEach(o,function(e){return d.push(e)}),d}if(!(n instanceof Array||n instanceof Float32Array)||0!==i.byteOffset||n.length!==o){if(n instanceof Array){var h=i.byteOffset/4;return u.Tools.Slice(n,h,h+o)}if(n instanceof ArrayBuffer)return new Float32Array(n,i.byteOffset,o);h=n.byteOffset+i.byteOffset;if(r||t&&1!==this._meshes.length){var f=new Float32Array(o),c=new Float32Array(n.buffer,h,o);return f.set(c),f}return new Float32Array(n.buffer,h,o)}return r||t&&1!==this._meshes.length?u.Tools.Slice(n):n},e.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},e.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},e.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},e.prototype.updateIndices=function(e,t){if(this._indexBuffer)if(this._indexBufferIsUpdatable){var r=e.length!==this._indices.length;if(this._indices=e,this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),r)for(var s=0,i=this._meshes;s<i.length;s++){i[s]._createGlobalSubMesh(!0)}}else this.setIndices(e,null,!0)},e.prototype.setIndices=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=r,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,r)),null!=t&&(this._totalVertices=t);for(var s=0,i=this._meshes;s<i.length;s++){i[s]._createGlobalSubMesh(!0)}this.notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(e,t){if(!this.isReady())return null;var r=this._indices;if(t||e&&1!==this._meshes.length){for(var s=r.length,i=[],n=0;n<s;n++)i.push(r[n]);return i}return r},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},e.prototype.releaseForMesh=function(e,t){var r=this._meshes,s=r.indexOf(e);-1!==s&&(r.splice(s,1),e._geometry=null,0===r.length&&t&&this.dispose())},e.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var r=this._meshes;e._geometry=this,this._scene.pushGeometry(this),r.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},e.prototype._updateExtend=function(e){void 0===e&&(e=null),e||(e=this.getVerticesData(s.VertexBuffer.PositionKind)),this._extend=u.Tools.ExtractMinAndMax(e,0,this._totalVertices,this.boundingBias,3)},e.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var r in this._vertexBuffers){1===t&&this._vertexBuffers[r].create();var i=this._vertexBuffers[r].getBuffer();i&&(i.references=t),r===s.VertexBuffer.PositionKind&&(this._extend||this._updateExtend(),e._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(!1),e._updateBoundingInfo())}1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=t),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},e.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,r=this._meshes;t<r.length;t++){r[t]._markSubMeshesAsAttributesDirty()}},e.prototype.load=function(e,t){this.delayLoadState!==o.Constants.DELAYLOADSTATE_LOADING&&(this.isReady()?t&&t():(this.delayLoadState=o.Constants.DELAYLOADSTATE_LOADING,this._queueLoad(e,t)))},e.prototype._queueLoad=function(e,t){var r=this;this.delayLoadingFile&&(e._addPendingData(this),e._loadFile(this.delayLoadingFile,function(s){if(r._delayLoadingFunction){r._delayLoadingFunction(JSON.parse(s),r),r.delayLoadState=o.Constants.DELAYLOADSTATE_LOADED,r._delayInfo=[],e._removePendingData(r);for(var i=r._meshes,n=i.length,a=0;a<n;a++)r._applyToMesh(i[a]);t&&t()}},void 0,!0))},e.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var r=e[t+0];e[t+0]=e[t+2],e[t+2]=r}this.setIndices(e)}var i=this.getVerticesData(s.VertexBuffer.PositionKind,!1);if(null!=i&&i.length>0){for(t=0;t<i.length;t+=3)i[t+2]=-i[t+2];this.setVerticesData(s.VertexBuffer.PositionKind,i,!1)}var n=this.getVerticesData(s.VertexBuffer.NormalKind,!1);if(null!=n&&n.length>0){for(t=0;t<n.length;t+=3)n[t+2]=-n[t+2];this.setVerticesData(s.VertexBuffer.NormalKind,n,!1)}},e.prototype._resetPointsArrayCache=function(){this._positions=null},e.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(s.VertexBuffer.PositionKind);if(!e||0===e.length)return!1;this._positions=[];for(var r=0;r<e.length;r+=3)this._positions.push(t.Vector3.FromArray(e,r));return!0},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},e.prototype.dispose=function(){var e,t=this._meshes,r=t.length;for(e=0;e<r;e++)this.releaseForMesh(t[e]);for(var s in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[s].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=o.Constants.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},e.prototype.copy=function(t){var s=new r.VertexData;s.indices=[];var i=this.getIndices();if(i)for(var n=0;n<i.length;n++)s.indices.push(i[n]);var o,u=!1,d=!1;for(o in this._vertexBuffers){var h=this.getVerticesData(o);if(h&&(h instanceof Float32Array?s.set(new Float32Array(h),o):s.set(h.slice(0),o),!d)){var f=this.getVertexBuffer(o);f&&(d=!(u=f.isUpdatable()))}}var c=new e(t,this._scene,s,u);for(o in c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(o);return c._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),c},e.prototype.serialize=function(){var e={};return e.id=this.id,e.updatable=this._updatable,d.Tags&&d.Tags.HasTags(this)&&(e.tags=d.Tags.GetTags(this)),e},e.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},e.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(s.VertexBuffer.PositionKind)&&(e.positions=this.toNumberArray(this.getVerticesData(s.VertexBuffer.PositionKind)),this.isVertexBufferUpdatable(s.VertexBuffer.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.NormalKind)&&(e.normals=this.toNumberArray(this.getVerticesData(s.VertexBuffer.NormalKind)),this.isVertexBufferUpdatable(s.VertexBuffer.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.TangentKind)&&(e.tangets=this.toNumberArray(this.getVerticesData(s.VertexBuffer.TangentKind)),this.isVertexBufferUpdatable(s.VertexBuffer.TangentKind)&&(e.tangets._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UVKind)&&(e.uvs=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UVKind)),this.isVertexBufferUpdatable(s.VertexBuffer.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV2Kind)&&(e.uv2s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV2Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV3Kind)&&(e.uv3s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV3Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV4Kind)&&(e.uv4s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV4Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV5Kind)&&(e.uv5s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV5Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.UV6Kind)&&(e.uv6s=this.toNumberArray(this.getVerticesData(s.VertexBuffer.UV6Kind)),this.isVertexBufferUpdatable(s.VertexBuffer.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.ColorKind)&&(e.colors=this.toNumberArray(this.getVerticesData(s.VertexBuffer.ColorKind)),this.isVertexBufferUpdatable(s.VertexBuffer.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices=this.toNumberArray(this.getVerticesData(s.VertexBuffer.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(s.VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(s.VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights=this.toNumberArray(this.getVerticesData(s.VertexBuffer.MatricesWeightsKind)),this.isVertexBufferUpdatable(s.VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this.toNumberArray(this.getIndices()),e},e.ExtractFromMesh=function(e,t){var r=e._geometry;return r?r.copy(t):null},e.RandomId=function(){return u.Tools.RandomId()},e._ImportGeometry=function(r,n){var a=n.getScene(),o=r.geometryId;if(o){var u=a.getGeometryByID(o);u&&u.applyToMesh(n)}else if(r instanceof ArrayBuffer){var d=n._binaryInfo;if(d.positionsAttrDesc&&d.positionsAttrDesc.count>0){var h=new Float32Array(r,d.positionsAttrDesc.offset,d.positionsAttrDesc.count);n.setVerticesData(s.VertexBuffer.PositionKind,h,!1)}if(d.normalsAttrDesc&&d.normalsAttrDesc.count>0){var f=new Float32Array(r,d.normalsAttrDesc.offset,d.normalsAttrDesc.count);n.setVerticesData(s.VertexBuffer.NormalKind,f,!1)}if(d.tangetsAttrDesc&&d.tangetsAttrDesc.count>0){var c=new Float32Array(r,d.tangetsAttrDesc.offset,d.tangetsAttrDesc.count);n.setVerticesData(s.VertexBuffer.TangentKind,c,!1)}if(d.uvsAttrDesc&&d.uvsAttrDesc.count>0){var l=new Float32Array(r,d.uvsAttrDesc.offset,d.uvsAttrDesc.count);n.setVerticesData(s.VertexBuffer.UVKind,l,!1)}if(d.uvs2AttrDesc&&d.uvs2AttrDesc.count>0){var p=new Float32Array(r,d.uvs2AttrDesc.offset,d.uvs2AttrDesc.count);n.setVerticesData(s.VertexBuffer.UV2Kind,p,!1)}if(d.uvs3AttrDesc&&d.uvs3AttrDesc.count>0){var y=new Float32Array(r,d.uvs3AttrDesc.offset,d.uvs3AttrDesc.count);n.setVerticesData(s.VertexBuffer.UV3Kind,y,!1)}if(d.uvs4AttrDesc&&d.uvs4AttrDesc.count>0){var g=new Float32Array(r,d.uvs4AttrDesc.offset,d.uvs4AttrDesc.count);n.setVerticesData(s.VertexBuffer.UV4Kind,g,!1)}if(d.uvs5AttrDesc&&d.uvs5AttrDesc.count>0){var x=new Float32Array(r,d.uvs5AttrDesc.offset,d.uvs5AttrDesc.count);n.setVerticesData(s.VertexBuffer.UV5Kind,x,!1)}if(d.uvs6AttrDesc&&d.uvs6AttrDesc.count>0){var _=new Float32Array(r,d.uvs6AttrDesc.offset,d.uvs6AttrDesc.count);n.setVerticesData(s.VertexBuffer.UV6Kind,_,!1)}if(d.colorsAttrDesc&&d.colorsAttrDesc.count>0){var v=new Float32Array(r,d.colorsAttrDesc.offset,d.colorsAttrDesc.count);n.setVerticesData(s.VertexBuffer.ColorKind,v,!1,d.colorsAttrDesc.stride)}if(d.matricesIndicesAttrDesc&&d.matricesIndicesAttrDesc.count>0){for(var V=new Int32Array(r,d.matricesIndicesAttrDesc.offset,d.matricesIndicesAttrDesc.count),m=[],D=0;D<V.length;D++){var B=V[D];m.push(255&B),m.push((65280&B)>>8),m.push((16711680&B)>>16),m.push(B>>24)}n.setVerticesData(s.VertexBuffer.MatricesIndicesKind,m,!1)}if(d.matricesWeightsAttrDesc&&d.matricesWeightsAttrDesc.count>0){var b=new Float32Array(r,d.matricesWeightsAttrDesc.offset,d.matricesWeightsAttrDesc.count);n.setVerticesData(s.VertexBuffer.MatricesWeightsKind,b,!1)}if(d.indicesAttrDesc&&d.indicesAttrDesc.count>0){var A=new Int32Array(r,d.indicesAttrDesc.offset,d.indicesAttrDesc.count);n.setIndices(A,null)}if(d.subMeshesAttrDesc&&d.subMeshesAttrDesc.count>0){var I=new Int32Array(r,d.subMeshesAttrDesc.offset,5*d.subMeshesAttrDesc.count);n.subMeshes=[];for(D=0;D<d.subMeshesAttrDesc.count;D++){var T=I[5*D+0],K=I[5*D+1],S=I[5*D+2],M=I[5*D+3],U=I[5*D+4];i.SubMesh.AddToMesh(T,K,S,M,U,n)}}}else if(r.positions&&r.normals&&r.indices){if(n.setVerticesData(s.VertexBuffer.PositionKind,r.positions,r.positions._updatable),n.setVerticesData(s.VertexBuffer.NormalKind,r.normals,r.normals._updatable),r.tangents&&n.setVerticesData(s.VertexBuffer.TangentKind,r.tangents,r.tangents._updatable),r.uvs&&n.setVerticesData(s.VertexBuffer.UVKind,r.uvs,r.uvs._updatable),r.uvs2&&n.setVerticesData(s.VertexBuffer.UV2Kind,r.uvs2,r.uvs2._updatable),r.uvs3&&n.setVerticesData(s.VertexBuffer.UV3Kind,r.uvs3,r.uvs3._updatable),r.uvs4&&n.setVerticesData(s.VertexBuffer.UV4Kind,r.uvs4,r.uvs4._updatable),r.uvs5&&n.setVerticesData(s.VertexBuffer.UV5Kind,r.uvs5,r.uvs5._updatable),r.uvs6&&n.setVerticesData(s.VertexBuffer.UV6Kind,r.uvs6,r.uvs6._updatable),r.colors&&n.setVerticesData(s.VertexBuffer.ColorKind,t.Color4.CheckColors4(r.colors,r.positions.length/3),r.colors._updatable),r.matricesIndices)if(r.matricesIndices._isExpanded)delete r.matricesIndices._isExpanded,n.setVerticesData(s.VertexBuffer.MatricesIndicesKind,r.matricesIndices,r.matricesIndices._updatable);else{for(m=[],D=0;D<r.matricesIndices.length;D++){var O=r.matricesIndices[D];m.push(255&O),m.push((65280&O)>>8),m.push((16711680&O)>>16),m.push(O>>24)}n.setVerticesData(s.VertexBuffer.MatricesIndicesKind,m,r.matricesIndices._updatable)}if(r.matricesIndicesExtra)if(r.matricesIndicesExtra._isExpanded)delete r.matricesIndices._isExpanded,n.setVerticesData(s.VertexBuffer.MatricesIndicesExtraKind,r.matricesIndicesExtra,r.matricesIndicesExtra._updatable);else{for(m=[],D=0;D<r.matricesIndicesExtra.length;D++){O=r.matricesIndicesExtra[D];m.push(255&O),m.push((65280&O)>>8),m.push((16711680&O)>>16),m.push(O>>24)}n.setVerticesData(s.VertexBuffer.MatricesIndicesExtraKind,m,r.matricesIndicesExtra._updatable)}r.matricesWeights&&(e._CleanMatricesWeights(r,n),n.setVerticesData(s.VertexBuffer.MatricesWeightsKind,r.matricesWeights,r.matricesWeights._updatable)),r.matricesWeightsExtra&&n.setVerticesData(s.VertexBuffer.MatricesWeightsExtraKind,r.matricesWeightsExtra,r.matricesWeights._updatable),n.setIndices(r.indices,null)}if(r.subMeshes){n.subMeshes=[];for(var E=0;E<r.subMeshes.length;E++){var G=r.subMeshes[E];i.SubMesh.AddToMesh(G.materialIndex,G.verticesStart,G.verticesCount,G.indexStart,G.indexCount,n)}}n._shouldGenerateFlatShading&&(n.convertToFlatShadedMesh(),delete n._shouldGenerateFlatShading),n.computeWorldMatrix(!0),a.onMeshImportedObservable.notifyObservers(n)},e._CleanMatricesWeights=function(e,t){if(n.SceneLoaderFlags.CleanBoneMatrixWeights){var r=0;if(e.skeletonId>-1){var i=t.getScene().getLastSkeletonByID(e.skeletonId);if(i){r=i.bones.length;for(var a=t.getVerticesData(s.VertexBuffer.MatricesIndicesKind),o=t.getVerticesData(s.VertexBuffer.MatricesIndicesExtraKind),u=e.matricesWeights,d=e.matricesWeightsExtra,h=e.numBoneInfluencer,f=u.length,c=0;c<f;c+=4){for(var l=0,p=-1,y=0;y<4;y++){l+=g=u[c+y],g<.001&&p<0&&(p=y)}if(d)for(y=0;y<4;y++){var g;l+=g=d[c+y],g<.001&&p<0&&(p=y+4)}if((p<0||p>h-1)&&(p=h-1),l>.001){var x=1/l;for(y=0;y<4;y++)u[c+y]*=x;if(d)for(y=0;y<4;y++)d[c+y]*=x}else p>=4?(d[c+p-4]=1-l,o[c+p-4]=r):(u[c+p]=1-l,a[c+p]=r)}t.setVerticesData(s.VertexBuffer.MatricesIndicesKind,a),e.matricesWeightsExtra&&t.setVerticesData(s.VertexBuffer.MatricesIndicesExtraKind,o)}}}},e.Parse=function(i,n,u){if(n.getGeometryByID(i.id))return null;var h=new e(i.id,n,void 0,i.updatable);return d.Tags&&d.Tags.AddTagsTo(h,i.tags),i.delayLoadingFile?(h.delayLoadState=o.Constants.DELAYLOADSTATE_NOTLOADED,h.delayLoadingFile=u+i.delayLoadingFile,h._boundingInfo=new a.BoundingInfo(t.Vector3.FromArray(i.boundingBoxMinimum),t.Vector3.FromArray(i.boundingBoxMaximum)),h._delayInfo=[],i.hasUVs&&h._delayInfo.push(s.VertexBuffer.UVKind),i.hasUVs2&&h._delayInfo.push(s.VertexBuffer.UV2Kind),i.hasUVs3&&h._delayInfo.push(s.VertexBuffer.UV3Kind),i.hasUVs4&&h._delayInfo.push(s.VertexBuffer.UV4Kind),i.hasUVs5&&h._delayInfo.push(s.VertexBuffer.UV5Kind),i.hasUVs6&&h._delayInfo.push(s.VertexBuffer.UV6Kind),i.hasColors&&h._delayInfo.push(s.VertexBuffer.ColorKind),i.hasMatricesIndices&&h._delayInfo.push(s.VertexBuffer.MatricesIndicesKind),i.hasMatricesWeights&&h._delayInfo.push(s.VertexBuffer.MatricesWeightsKind),h._delayLoadingFunction=r.VertexData.ImportVertexData):r.VertexData.ImportVertexData(i,h),n.pushGeometry(h,!0),h},e}();exports.Geometry=f;var c=function(t){function r(e,r,s,i){void 0===s&&(s=!1),void 0===i&&(i=null);var n=t.call(this,e,r,void 0,!1,i)||this;return n._canBeRegenerated=s,n._beingRegenerated=!0,n.regenerate(),n._beingRegenerated=!1,n}return e.__extends(r,t),r.prototype.canBeRegenerated=function(){return this._canBeRegenerated},r.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},r.prototype.asNewGeometry=function(e){return t.prototype.copy.call(this,e)},r.prototype.setAllVerticesData=function(e,r){this._beingRegenerated&&t.prototype.setAllVerticesData.call(this,e,!1)},r.prototype.setVerticesData=function(e,r,s){this._beingRegenerated&&t.prototype.setVerticesData.call(this,e,r,!1)},r.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},r.prototype.copy=function(e){throw new Error("Must be overriden in sub-classes.")},r.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.canBeRegenerated=this.canBeRegenerated(),e},r}(f);exports._PrimitiveGeometry=c;var l=function(t){function s(e,s,i,n,a,o,u,d,h){void 0===h&&(h=r.VertexData.DEFAULTSIDE);var f=t.call(this,e,s,u,d)||this;return f.pathArray=i,f.closeArray=n,f.closePath=a,f.offset=o,f.side=h,f}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),void 0,this.side)},s}(c);exports.RibbonGeometry=l;var p=function(t){function s(e,s,i,n,a,o){void 0===a&&(a=null),void 0===o&&(o=r.VertexData.DEFAULTSIDE);var u=t.call(this,e,s,n,a)||this;return u.size=i,u.side=o,u}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.size,this.canBeRegenerated(),void 0,this.side)},s.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.size=this.size,e},s.Parse=function(e,t){if(t.getGeometryByID(e.id))return null;var r=new s(e.id,t,e.size,e.canBeRegenerated,null);return d.Tags&&d.Tags.AddTagsTo(r,e.tags),t.pushGeometry(r,!0),r},s}(c);exports.BoxGeometry=p;var y=function(t){function s(e,s,i,n,a,o,u){void 0===o&&(o=null),void 0===u&&(u=r.VertexData.DEFAULTSIDE);var d=t.call(this,e,s,a,o)||this;return d.segments=i,d.diameter=n,d.side=u,d}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},s.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.segments=this.segments,e.diameter=this.diameter,e},s.Parse=function(e,t){if(t.getGeometryByID(e.id))return null;var r=new s(e.id,t,e.segments,e.diameter,e.canBeRegenerated,null);return d.Tags&&d.Tags.AddTagsTo(r,e.tags),t.pushGeometry(r,!0),r},s}(c);exports.SphereGeometry=y;var g=function(t){function s(e,s,i,n,a,o,u){void 0===o&&(o=null),void 0===u&&(u=r.VertexData.DEFAULTSIDE);var d=t.call(this,e,s,a,o)||this;return d.radius=i,d.tessellation=n,d.side=u,d}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},s}(c);exports.DiscGeometry=g;var x=function(t){function s(e,s,i,n,a,o,u,d,h,f){void 0===u&&(u=1),void 0===h&&(h=null),void 0===f&&(f=r.VertexData.DEFAULTSIDE);var c=t.call(this,e,s,d,h)||this;return c.height=i,c.diameterTop=n,c.diameterBottom=a,c.tessellation=o,c.subdivisions=u,c.side=f,c}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},s.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.height=this.height,e.diameterTop=this.diameterTop,e.diameterBottom=this.diameterBottom,e.tessellation=this.tessellation,e},s.Parse=function(e,t){if(t.getGeometryByID(e.id))return null;var r=new s(e.id,t,e.height,e.diameterTop,e.diameterBottom,e.tessellation,e.subdivisions,e.canBeRegenerated,null);return d.Tags&&d.Tags.AddTagsTo(r,e.tags),t.pushGeometry(r,!0),r},s}(c);exports.CylinderGeometry=x;var _=function(t){function s(e,s,i,n,a,o,u,d){void 0===u&&(u=null),void 0===d&&(d=r.VertexData.DEFAULTSIDE);var h=t.call(this,e,s,o,u)||this;return h.diameter=i,h.thickness=n,h.tessellation=a,h.side=d,h}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},s.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.diameter=this.diameter,e.thickness=this.thickness,e.tessellation=this.tessellation,e},s.Parse=function(e,t){if(t.getGeometryByID(e.id))return null;var r=new s(e.id,t,e.diameter,e.thickness,e.tessellation,e.canBeRegenerated,null);return d.Tags&&d.Tags.AddTagsTo(r,e.tags),t.pushGeometry(r,!0),r},s}(c);exports.TorusGeometry=_;var v=function(t){function s(e,r,s,i,n,a,o){void 0===o&&(o=null);var u=t.call(this,e,r,a,o)||this;return u.width=s,u.height=i,u.subdivisions=n,u}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},s.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.width=this.width,e.height=this.height,e.subdivisions=this.subdivisions,e},s.Parse=function(e,t){if(t.getGeometryByID(e.id))return null;var r=new s(e.id,t,e.width,e.height,e.subdivisions,e.canBeRegenerated,null);return d.Tags&&d.Tags.AddTagsTo(r,e.tags),t.pushGeometry(r,!0),r},s}(c);exports.GroundGeometry=v;var V=function(t){function s(e,r,s,i,n,a,o,u,d,h){void 0===h&&(h=null);var f=t.call(this,e,r,d,h)||this;return f.xmin=s,f.zmin=i,f.xmax=n,f.zmax=a,f.subdivisions=o,f.precision=u,f}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},s}(c);exports.TiledGroundGeometry=V;var m=function(t){function s(e,s,i,n,a,o){void 0===a&&(a=null),void 0===o&&(o=r.VertexData.DEFAULTSIDE);var u=t.call(this,e,s,n,a)||this;return u.size=i,u.side=o,u}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreatePlane({size:this.size,sideOrientation:this.side})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},s.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.size=this.size,e},s.Parse=function(e,t){if(t.getGeometryByID(e.id))return null;var r=new s(e.id,t,e.size,e.canBeRegenerated,null);return d.Tags&&d.Tags.AddTagsTo(r,e.tags),t.pushGeometry(r,!0),r},s}(c);exports.PlaneGeometry=m;var D=function(t){function s(e,s,i,n,a,o,u,d,h,f,c){void 0===f&&(f=null),void 0===c&&(c=r.VertexData.DEFAULTSIDE);var l=t.call(this,e,s,h,f)||this;return l.radius=i,l.tube=n,l.radialSegments=a,l.tubularSegments=o,l.p=u,l.q=d,l.side=c,l}return e.__extends(s,t),s.prototype._regenerateVertexData=function(){return r.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},s.prototype.copy=function(e){return new s(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},s.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.radius=this.radius,e.tube=this.tube,e.radialSegments=this.radialSegments,e.tubularSegments=this.tubularSegments,e.p=this.p,e.q=this.q,e},s.Parse=function(e,t){if(t.getGeometryByID(e.id))return null;var r=new s(e.id,t,e.radius,e.tube,e.radialSegments,e.tubularSegments,e.p,e.q,e.canBeRegenerated,null);return d.Tags&&d.Tags.AddTagsTo(r,e.tags),t.pushGeometry(r,!0),r},s}(c);exports.TorusKnotGeometry=D;
},{"tslib":"vCxL","../Maths/math":"Iizi","../Meshes/mesh.vertexData":"+kld","../Meshes/buffer":"YHhW","../Meshes/subMesh":"MMoF","../Loading/sceneLoaderFlags":"Gju8","../Culling/boundingInfo":"1eEz","../Engines/constants":"vn8z","../Misc/tools":"RkuS","../Misc/tags":"Ae8d"}],"peT8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Hinge2Joint=exports.HingeJoint=exports.MotorEnabledJoint=exports.DistanceJoint=exports.PhysicsJoint=void 0;var t=i(require("tslib"));function i(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var e=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,n):{};e.get||e.set?Object.defineProperty(i,n,e):i[n]=t[n]}return i.default=t,i}var n=function(){function t(t,i){this.type=t,this.jointData=i,i.nativeParams=i.nativeParams||{}}return Object.defineProperty(t.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(t){this._physicsJoint,this._physicsJoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"physicsPlugin",{set:function(t){this._physicsPlugin=t},enumerable:!0,configurable:!0}),t.prototype.executeNativeFunction=function(t){t(this._physicsPlugin.world,this._physicsJoint)},t.DistanceJoint=0,t.HingeJoint=1,t.BallAndSocketJoint=2,t.WheelJoint=3,t.SliderJoint=4,t.PrismaticJoint=5,t.UniversalJoint=6,t.Hinge2Joint=t.WheelJoint,t.PointToPointJoint=8,t.SpringJoint=9,t.LockJoint=10,t}();exports.PhysicsJoint=n;var e=function(i){function e(t){return i.call(this,n.DistanceJoint,t)||this}return t.__extends(e,i),e.prototype.updateDistance=function(t,i){this._physicsPlugin.updateDistanceJoint(this,t,i)},e}(n);exports.DistanceJoint=e;var o=function(i){function n(t,n){return i.call(this,t,n)||this}return t.__extends(n,i),n.prototype.setMotor=function(t,i){this._physicsPlugin.setMotor(this,t||0,i)},n.prototype.setLimit=function(t,i){this._physicsPlugin.setLimit(this,t,i)},n}(n);exports.MotorEnabledJoint=o;var s=function(i){function e(t){return i.call(this,n.HingeJoint,t)||this}return t.__extends(e,i),e.prototype.setMotor=function(t,i){this._physicsPlugin.setMotor(this,t||0,i)},e.prototype.setLimit=function(t,i){this._physicsPlugin.setLimit(this,t,i)},e}(o);exports.HingeJoint=s;var r=function(i){function e(t){return i.call(this,n.Hinge2Joint,t)||this}return t.__extends(e,i),e.prototype.setMotor=function(t,i,n){void 0===n&&(n=0),this._physicsPlugin.setMotor(this,t||0,i,n)},e.prototype.setLimit=function(t,i,n){void 0===n&&(n=0),this._physicsPlugin.setLimit(this,t,i,n)},e}(o);exports.Hinge2Joint=r;
},{"tslib":"vCxL"}],"jNlR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PhysicsImpostor=void 0;var t=require("../Misc/logger"),i=require("../Misc/arrayTools"),e=require("../Maths/math"),o=require("../Meshes/abstractMesh"),n=require("./physicsJoint"),s=function(){function s(i,o,n,s){void 0===n&&(n={mass:0});var r=this;this.object=i,this.type=o,this._options=n,this._scene=s,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=e.Vector3.Zero(),this._isDisposed=!1,this._tmpQuat=new e.Quaternion,this._tmpQuat2=new e.Quaternion,this.beforeStep=function(){r._physicsEngine&&(r.object.translate(r._deltaPosition,-1),r._deltaRotationConjugated&&r.object.rotationQuaternion&&r.object.rotationQuaternion.multiplyToRef(r._deltaRotationConjugated,r.object.rotationQuaternion),r.object.computeWorldMatrix(!1),r.object.parent&&r.object.rotationQuaternion?(r.getParentsRotation(),r._tmpQuat.multiplyToRef(r.object.rotationQuaternion,r._tmpQuat)):r._tmpQuat.copyFrom(r.object.rotationQuaternion||new e.Quaternion),r._options.disableBidirectionalTransformation||r.object.rotationQuaternion&&r._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(r,r.object.getAbsolutePosition(),r._tmpQuat),r._onBeforePhysicsStepCallbacks.forEach(function(t){t(r)}))},this.afterStep=function(){r._physicsEngine&&(r._onAfterPhysicsStepCallbacks.forEach(function(t){t(r)}),r._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(r),r.object.parent&&r.object.rotationQuaternion&&(r.getParentsRotation(),r._tmpQuat.conjugateInPlace(),r._tmpQuat.multiplyToRef(r.object.rotationQuaternion,r.object.rotationQuaternion)),r.object.setAbsolutePosition(r.object.position),r._deltaRotation&&r.object.rotationQuaternion&&r.object.rotationQuaternion.multiplyToRef(r._deltaRotation,r.object.rotationQuaternion),r.object.translate(r._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(t){if((r._onPhysicsCollideCallbacks.length||r.onCollideEvent)&&r._physicsEngine){var i=r._physicsEngine.getImpostorWithPhysicsBody(t.body);i&&(r.onCollideEvent&&r.onCollideEvent(r,i),r._onPhysicsCollideCallbacks.filter(function(t){return-1!==t.otherImpostors.indexOf(i)}).forEach(function(t){t.callback(r,i)}))}},this.object?(!this._scene&&i.getScene&&(this._scene=i.getScene()),this._scene&&(this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new e.Quaternion),this._options.mass=void 0===n.mass?0:n.mass,this._options.friction=void 0===n.friction?.2:n.friction,this._options.restitution=void 0===n.restitution?.2:n.restitution,this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&t.Logger.Warn("You must affect impostors to children before affecting impostor to parent.")):t.Logger.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):t.Logger.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(s.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(t){this.setMass(t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,t)},enumerable:!0,configurable:!0}),s.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},s.prototype._getPhysicsParent=function(){return this.object.parent instanceof o.AbstractMesh?this.object.parent.physicsImpostor:null},s.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},s.prototype.setScalingUpdated=function(){this.forceUpdate()},s.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(s.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(t){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=t,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(t){this._parent=t},enumerable:!0,configurable:!0}),s.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},s.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var t=this.object.rotationQuaternion;this.object.rotationQuaternion=s.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var i=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=t,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),i}return s.DEFAULT_OBJECT_SIZE},s.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},s.prototype.getParam=function(t){return this._options[t]},s.prototype.setParam=function(t,i){this._options[t]=i,this._bodyUpdateRequired=!0},s.prototype.setMass=function(t){this.getParam("mass")!==t&&this.setParam("mass",t),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,t)},s.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):e.Vector3.Zero()},s.prototype.setLinearVelocity=function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,t)},s.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):e.Vector3.Zero()},s.prototype.setAngularVelocity=function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,t)},s.prototype.executeNativeFunction=function(t){this._physicsEngine&&t(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},s.prototype.registerBeforePhysicsStep=function(t){this._onBeforePhysicsStepCallbacks.push(t)},s.prototype.unregisterBeforePhysicsStep=function(i){var e=this._onBeforePhysicsStepCallbacks.indexOf(i);e>-1?this._onBeforePhysicsStepCallbacks.splice(e,1):t.Logger.Warn("Function to remove was not found")},s.prototype.registerAfterPhysicsStep=function(t){this._onAfterPhysicsStepCallbacks.push(t)},s.prototype.unregisterAfterPhysicsStep=function(i){var e=this._onAfterPhysicsStepCallbacks.indexOf(i);e>-1?this._onAfterPhysicsStepCallbacks.splice(e,1):t.Logger.Warn("Function to remove was not found")},s.prototype.registerOnPhysicsCollide=function(t,i){var e=t instanceof Array?t:[t];this._onPhysicsCollideCallbacks.push({callback:i,otherImpostors:e})},s.prototype.unregisterOnPhysicsCollide=function(i,e){var o=i instanceof Array?i:[i],n=-1;this._onPhysicsCollideCallbacks.some(function(t,i){if(t.callback===e&&t.otherImpostors.length===o.length){var s=t.otherImpostors.every(function(t){return o.indexOf(t)>-1});return s&&(n=i),s}return!1})?this._onPhysicsCollideCallbacks.splice(n,1):t.Logger.Warn("Function to remove was not found")},s.prototype.getParentsRotation=function(){var t=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);t;)t.rotationQuaternion?this._tmpQuat2.copyFrom(t.rotationQuaternion):e.Quaternion.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,t.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),t=t.parent;return this._tmpQuat},s.prototype.applyForce=function(t,i){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,t,i),this},s.prototype.applyImpulse=function(t,i){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,t,i),this},s.prototype.createJoint=function(t,i,e){var o=new n.PhysicsJoint(i,e);return this.addJoint(t,o),this},s.prototype.addJoint=function(t,i){return this._joints.push({otherImpostor:t,joint:i}),this._physicsEngine&&this._physicsEngine.addJoint(this,t,i),this},s.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},s.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},s.prototype.clone=function(t){return t?new s(t,this.type,this._options,this._scene):null},s.prototype.dispose=function(){var t=this;this._physicsEngine&&(this._joints.forEach(function(i){t._physicsEngine&&t._physicsEngine.removeJoint(t,i.otherImpostor,i.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},s.prototype.setDeltaPosition=function(t){this._deltaPosition.copyFrom(t)},s.prototype.setDeltaRotation=function(t){this._deltaRotation||(this._deltaRotation=new e.Quaternion),this._deltaRotation.copyFrom(t),this._deltaRotationConjugated=this._deltaRotation.conjugate()},s.prototype.getBoxSizeToRef=function(t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,t),this},s.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},s.prototype.syncBoneWithImpostor=function(t,i,o,n,r){var c=s._tmpVecs[0],a=this.object;if(a.rotationQuaternion)if(r){var h=s._tmpQuat;a.rotationQuaternion.multiplyToRef(r,h),t.setRotationQuaternion(h,e.Space.WORLD,i)}else t.setRotationQuaternion(a.rotationQuaternion,e.Space.WORLD,i);c.x=0,c.y=0,c.z=0,o&&(c.x=o.x,c.y=o.y,c.z=o.z,t.getDirectionToRef(c,i,c),null==n&&(n=o.length()),c.x*=n,c.y*=n,c.z*=n),t.getParent()?(c.addInPlace(a.getAbsolutePosition()),t.setAbsolutePosition(c,i)):(i.setAbsolutePosition(a.getAbsolutePosition()),i.position.x-=c.x,i.position.y-=c.y,i.position.z-=c.z)},s.prototype.syncImpostorWithBone=function(t,i,o,n,r,c){var a=this.object;if(a.rotationQuaternion)if(r){var h=s._tmpQuat;t.getRotationQuaternionToRef(e.Space.WORLD,i,h),h.multiplyToRef(r,a.rotationQuaternion)}else t.getRotationQuaternionToRef(e.Space.WORLD,i,a.rotationQuaternion);var p=s._tmpVecs[0],u=s._tmpVecs[1];c||((c=s._tmpVecs[2]).x=0,c.y=1,c.z=0),t.getDirectionToRef(c,i,u),t.getAbsolutePositionToRef(i,p),null==n&&o&&(n=o.length()),null!=n&&(p.x+=u.x*n,p.y+=u.y*n,p.z+=u.z*n),a.setAbsolutePosition(p)},s.DEFAULT_OBJECT_SIZE=new e.Vector3(1,1,1),s.IDENTITY_QUATERNION=e.Quaternion.Identity(),s._tmpVecs=i.ArrayTools.BuildArray(3,e.Vector3.Zero),s._tmpQuat=e.Quaternion.Identity(),s.NoImpostor=0,s.SphereImpostor=1,s.BoxImpostor=2,s.PlaneImpostor=3,s.MeshImpostor=4,s.CylinderImpostor=7,s.ParticleImpostor=8,s.HeightmapImpostor=9,s}();exports.PhysicsImpostor=s;
},{"../Misc/logger":"Fvml","../Misc/arrayTools":"eIrG","../Maths/math":"Iizi","../Meshes/abstractMesh":"Nnvo","./physicsJoint":"peT8"}],"aXN+":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mesh=exports._InstancesBatch=exports._CreationDataStorage=exports.MeshLODLevel=void 0;var e=b(require("tslib")),t=require("../Misc/observable"),r=require("../Misc/tools"),i=require("../Misc/deepCopier"),s=require("../Misc/tags"),n=require("../Maths/math"),a=require("../node"),o=require("./buffer"),h=require("./mesh.vertexData"),l=require("./geometry"),c=require("./abstractMesh"),u=require("./subMesh"),f=require("../Culling/boundingInfo"),d=require("../Materials/material"),g=require("../Animations/animation"),p=require("../Loading/sceneLoaderFlags"),m=require("../Physics/physicsImpostor"),y=require("../Engines/constants"),v=require("../Misc/decorators"),_=require("../Misc/logger");function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var M=function(){return function(e,t){this.distance=e,this.mesh=t}}();exports.MeshLODLevel=M;var I=function(){return function(){}}();exports._CreationDataStorage=I;var x=function(){return function(){this.visibleInstances={},this.renderIdForInstances=new Array,this.batchCache=new V,this.instancesBufferSize=2048}}(),V=function(){return function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}}();exports._InstancesBatch=V;var D=function(c){function b(e,t,r,n,a,o){void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=!0);var h=c.call(this,e,t)||this;if(h.delayLoadState=y.Constants.DELAYLOADSTATE_NONE,h.instances=new Array,h._LODLevels=new Array,h._instanceDataStorage=new x,h._originalBuilderSideOrientation=b.DEFAULTSIDE,h.overrideMaterialSideOrientation=null,h._areNormalsFrozen=!1,h._source=null,h._isMesh=!0,t=h.getScene(),n){if(n._geometry&&n._geometry.applyToMesh(h),i.DeepCopier.DeepCopy(n,h,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable"],["_poseMatrix"]),h._source=n,t.useClonedMeshhMap&&(n.meshMap||(n.meshMap={}),n.meshMap[h.uniqueId]=h),h._originalBuilderSideOrientation=n._originalBuilderSideOrientation,h._creationDataStorage=n._creationDataStorage,h._source._ranges){var l=h._source._ranges;for(var e in l)l.hasOwnProperty(e)&&l[e]&&h.createAnimationRange(e,l[e].from,l[e].to)}var u;if(n.metadata&&n.metadata.clone?h.metadata=n.metadata.clone():h.metadata=n.metadata,s.Tags&&s.Tags.HasTags(n)&&s.Tags.AddTagsTo(h,s.Tags.GetTags(n,!0)),h.parent=n.parent,h.setPivotMatrix(n.getPivotMatrix()),h.id=e+"."+n.id,h.material=n.material,!a)for(var f=n.getDescendants(!0),d=0;d<f.length;d++){var g=f[d];g.clone&&g.clone(e+"."+g.name,h)}var p=h.getScene().getPhysicsEngine();if(o&&p){var m=p.getImpostorForPhysicsObject(n);m&&(h.physicsImpostor=m.clone(h))}for(u=0;u<t.particleSystems.length;u++){var v=t.particleSystems[u];v.emitter===n&&v.clone(v.name,h)}h.refreshBoundingInfo(),h.computeWorldMatrix(!0)}return null!==r&&(h.parent=r),h}return e.__extends(b,c),Object.defineProperty(b.prototype,"onBeforeRenderObservable",{get:function(){return this._onBeforeRenderObservable||(this._onBeforeRenderObservable=new t.Observable),this._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onAfterRenderObservable",{get:function(){return this._onAfterRenderObservable||(this._onAfterRenderObservable=new t.Observable),this._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeDrawObservable",{get:function(){return this._onBeforeDrawObservable||(this._onBeforeDrawObservable=new t.Observable),this._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"morphTargetManager",{get:function(){return this._morphTargetManager},set:function(e){this._morphTargetManager!==e&&(this._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"Mesh"},b.prototype.toString=function(e){var t=c.prototype.toString.call(this,e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var r=0;r<this.animations.length;r++)t+=", animation[0]: "+this.animations[r].toString(e);if(e)if(this._geometry){var i=this.getIndices(),s=this.getVerticesData(o.VertexBuffer.PositionKind);s&&i&&(t+=", flat shading: "+(s.length/3===i.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t},b.prototype._unBindEffect=function(){c.prototype._unBindEffect.call(this);for(var e=0,t=this.instances;e<t.length;e++){t[e]._unBindEffect()}},Object.defineProperty(b.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),b.prototype.getLODLevels=function(){return this._LODLevels},b.prototype._sortLODLevels=function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},b.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return _.Logger.Warn("You cannot use a mesh as LOD level twice"),this;var r=new M(e,t);return this._LODLevels.push(r),t&&(t._masterMesh=this),this._sortLODLevels(),this},b.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var r=this._LODLevels[t];if(r.distance===e)return r.mesh}return null},b.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[t].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},b.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var r;t?r=t:r=this.getBoundingInfo().boundingSphere;var i=r.centerWorld.subtract(e.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>i)return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var s=0;s<this._LODLevels.length;s++){var n=this._LODLevels[s];if(n.distance<i)return n.mesh&&(n.mesh._preActivate(),n.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(i,this,n.mesh),n.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},Object.defineProperty(b.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),b.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},b.prototype.getVerticesData=function(e,t,r){return this._geometry?this._geometry.getVerticesData(e,t,r):null},b.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},b.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},b.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},b.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach(function(t){e.push(t)}),e}return this._geometry.getVerticesDataKinds()},b.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},b.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(b.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),b.prototype.isReady=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.delayLoadState===y.Constants.DELAYLOADSTATE_LOADING)return!1;if(!c.prototype.isReady.call(this,e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;var r=this.getEngine(),i=this.getScene(),s=t||r.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var n=this.material||i.defaultMaterial;if(n)if(n._storeEffectOnSubMeshes)for(var a=0,o=this.subMeshes;a<o.length;a++){var h=(p=o[a]).getMaterial();if(h)if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,p,s))return!1}else if(!h.isReady(this,s))return!1}else if(!n.isReady(this,s))return!1;for(var l=0,u=this._lightSources;l<u.length;l++){var f=u[l].getShadowGenerator();if(f)for(var d=0,g=this.subMeshes;d<g.length;d++){var p=g[d];if(!f.isReady(p,s))return!1}}for(var m=0,v=this._LODLevels;m<v.length;m++){var _=v[m];if(_.mesh&&!_.mesh.isReady(s))return!1}return!0},Object.defineProperty(b.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),b.prototype.freezeNormals=function(){return this._areNormalsFrozen=!0,this},b.prototype.unfreezeNormals=function(){return this._areNormalsFrozen=!1,this},Object.defineProperty(b.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),b.prototype._preActivate=function(){var e=this.getScene().getRenderId();return this._preActivateId===e?this:(this._preActivateId=e,this._instanceDataStorage.visibleInstances=null,this)},b.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},b.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},b.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},b.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var r=this.getIndices();if(!r)return null;var i=r.length,s=!1;if(e)s=!0;else for(var n=0,a=this.subMeshes;n<a.length;n++){var o=a[n];if(o.indexStart+o.indexCount>=i){s=!0;break}if(o.verticesStart+o.verticesCount>=t){s=!0;break}}if(!s)return this.subMeshes[0]}return this.releaseSubMeshes(),new u.SubMesh(0,0,t,0,this.getTotalIndices(),this)},b.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),r=t/e|0,i=0;r%3!=0;)r++;this.releaseSubMeshes();for(var s=0;s<e&&!(i>=t);s++)u.SubMesh.CreateFromIndices(0,i,Math.min(r,t-i),this),i+=r;this.synchronizeInstances()}},b.prototype.setVerticesData=function(e,t,r,i){if(void 0===r&&(r=!1),this._geometry)this._geometry.setVerticesData(e,t,r,i);else{var s=new h.VertexData;s.set(t,e);var n=this.getScene();new l.Geometry(l.Geometry.RandomId(),n,s,r,this)}return this},b.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var r=this.getVertexBuffer(e);r&&r.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},b.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=l.Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},b.prototype.updateVerticesData=function(e,t,r,i){return this._geometry?(i?(this.makeGeometryUnique(),this.updateVerticesData(e,t,r,!1)):this._geometry.updateVerticesData(e,t,r),this):this},b.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var r=this.getVerticesData(o.VertexBuffer.PositionKind);if(!r)return this;if(e(r),this.updateVerticesData(o.VertexBuffer.PositionKind,r,!1,!1),t){var i=this.getIndices(),s=this.getVerticesData(o.VertexBuffer.NormalKind);if(!s)return this;h.VertexData.ComputeNormals(r,i,s),this.updateVerticesData(o.VertexBuffer.NormalKind,s,!1,!1)}return this},b.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(l.Geometry.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},b.prototype.setIndices=function(e,t,r){if(void 0===t&&(t=null),void 0===r&&(r=!1),this._geometry)this._geometry.setIndices(e,t,r);else{var i=new h.VertexData;i.indices=e;var s=this.getScene();new l.Geometry(l.Geometry.RandomId(),s,i,r,this)}return this},b.prototype.updateIndices=function(e,t){return this._geometry?(this._geometry.updateIndices(e,t),this):this},b.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},b.prototype._bind=function(e,t,r){if(!this._geometry)return this;var i,s=this.getScene().getEngine();if(this._unIndexed)i=null;else switch(r){case d.Material.PointFillMode:i=null;break;case d.Material.WireFrameFillMode:i=e._getLinesIndexBuffer(this.getIndices(),s);break;default:case d.Material.TriangleFillMode:i=this._unIndexed?null:this._geometry.getIndexBuffer()}return this._geometry._bind(t,i),this},b.prototype._draw=function(e,t,r,i){if(void 0===i&&(i=!1),!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeDrawObservable&&this._onBeforeDrawObservable.notifyObservers(this);var s=this.getScene(),n=s.getEngine();if(this._unIndexed||t==d.Material.PointFillMode?n.drawArraysType(t,e.verticesStart,e.verticesCount,r):t==d.Material.WireFrameFillMode?n.drawElementsType(t,0,e._linesIndexCount,r):n.drawElementsType(t,e.indexStart,e.indexCount,r),s._isAlternateRenderingEnabled&&!i){var a=e.effect||this._effectiveMaterial.getEffect();if(!a||!s.activeCamera)return this;s._switchToAlternateCameraConfiguration(!0),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a),n.setViewport(s.activeCamera._alternateCamera.viewport),this._draw(e,t,r,!0),n.setViewport(s.activeCamera.viewport),s._switchToAlternateCameraConfiguration(!1),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a)}return this},b.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},b.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},b.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},b.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},b.prototype._getInstancesRenderList=function(e){var t=this.getScene(),r=this._instanceDataStorage.batchCache;if(r.mustReturn=!1,r.renderSelf[e]=this.isEnabled()&&this.isVisible,r.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances){var i=this._instanceDataStorage.visibleInstances,s=t.getRenderId(),n=t._isInIntermediateRendering()?i.intermediateDefaultRenderId:i.defaultRenderId;r.visibleInstances[e]=i[s];var a=this._renderId;!r.visibleInstances[e]&&n&&(r.visibleInstances[e]=i[n],s=Math.max(n,s),a=Math.max(i.selfDefaultRenderId,s));var o=r.visibleInstances[e];if(o&&o.length){if(this._instanceDataStorage.renderIdForInstances[e]===s)return r.mustReturn=!0,r;s!==a&&(r.renderSelf[e]=!1)}this._instanceDataStorage.renderIdForInstances[e]=s}return r},b.prototype._renderWithInstances=function(e,t,r,i,s){var n=r.visibleInstances[e._id];if(!n)return this;for(var a=16*(n.length+1)*4,h=this._instanceDataStorage,l=h.instancesBufferSize,c=h.instancesBuffer;h.instancesBufferSize<a;)h.instancesBufferSize*=2;h.instancesData&&l==h.instancesBufferSize||(h.instancesData=new Float32Array(h.instancesBufferSize/4));var u=0,f=0,d=this.getWorldMatrix();if(r.renderSelf[e._id]&&(d.copyToArray(h.instancesData,u),u+=16,f++),n)for(var g=0;g<n.length;g++){n[g].getWorldMatrix().copyToArray(h.instancesData,u),u+=16,f++}return c&&l==h.instancesBufferSize?c.updateDirectly(h.instancesData,0,f):(c&&c.dispose(),c=new o.Buffer(s,h.instancesData,!0,16,!1,!0),h.instancesBuffer=c,this.setVerticesBuffer(c.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(c.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(c.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(c.createVertexBuffer("world3",12,4))),this._bind(e,i,t),this._draw(e,t,f),s.unbindInstanceAttributes(),this},b.prototype._processRendering=function(e,t,r,i,s,n,a){var o=this.getScene().getEngine();if(s)this._renderWithInstances(e,r,i,t,o);else{i.renderSelf[e._id]&&(n&&n(!1,this.getWorldMatrix(),a),this._draw(e,r,this._instanceDataStorage.overridenInstanceCount));var h=i.visibleInstances[e._id];if(h)for(var l=0;l<h.length;l++){var c=h[l].getWorldMatrix();n&&n(!0,c,a),this._draw(e,r)}}return this},b.prototype.render=function(e,t){if(this._checkOcclusionQuery())return this;var r=this.getScene(),i=this._getInstancesRenderList(e._id);if(i.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeRenderObservable&&this._onBeforeRenderObservable.notifyObservers(this);var s,n=r.getEngine(),a=n.getCaps().instancedArrays&&null!==i.visibleInstances[e._id]&&void 0!==i.visibleInstances[e._id],o=e.getMaterial();if(!o)return this;if(this._effectiveMaterial=o,this._effectiveMaterial._storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,e,a))return this}else if(!this._effectiveMaterial.isReady(this,a))return this;t&&n.setAlphaMode(this._effectiveMaterial.alphaMode);for(var h=0,l=r._beforeRenderingMeshStage;h<l.length;h++){l[h].action(this,e,i)}if(!(s=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var c=this.skeleton&&this.skeleton.overrideMesh||this,u=this.overrideMaterialSideOrientation;null==u&&(u=this._effectiveMaterial.sideOrientation,c._getWorldMatrixDeterminant()<0&&(u=u===d.Material.ClockWiseSideOrientation?d.Material.CounterClockWiseSideOrientation:d.Material.ClockWiseSideOrientation));var f=this._effectiveMaterial._preBind(s,u);this._effectiveMaterial.forceDepthWrite&&n.setDepthWrite(!0);var g=r.forcePointsCloud?d.Material.PointFillMode:r.forceWireframe?d.Material.WireFrameFillMode:this._effectiveMaterial.fillMode;a||this._bind(e,s,g);var p=c.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(p,this,e):this._effectiveMaterial.bind(p,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(n.setState(!0,this._effectiveMaterial.zOffset,!1,!f),this._processRendering(e,s,g,i,a,this._onBeforeDraw,this._effectiveMaterial),n.setState(!0,this._effectiveMaterial.zOffset,!1,f)),this._processRendering(e,s,g,i,a,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var m=0,y=r._afterRenderingMeshStage;m<y.length;m++){y[m].action(this,e,i)}return this._onAfterRenderObservable&&this._onAfterRenderObservable.notifyObservers(this),this},b.prototype._onBeforeDraw=function(e,t,r){e&&r&&r.bindOnlyWorldMatrix(t)},b.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(o.VertexBuffer.MatricesWeightsKind)&&(this.isVerticesDataPresent(o.VertexBuffer.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},b.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind),t=e.length,r=0;r<t;r+=4){var i=e[r]+e[r+1]+e[r+2]+e[r+3];if(0===i)e[r]=1;else{var s=1/i;e[r]*=s,e[r+1]*=s,e[r+2]*=s,e[r+3]*=s}}this.setVerticesData(o.VertexBuffer.MatricesWeightsKind,e)},b.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(o.VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind),r=t.length,i=0;i<r;i+=4){var s=t[i]+t[i+1]+t[i+2]+t[i+3];if(0===(s+=e[i]+e[i+1]+e[i+2]+e[i+3]))t[i]=1;else{var n=1/s;t[i]*=n,t[i+1]*=n,t[i+2]*=n,t[i+3]*=n,e[i]*=n,e[i+1]*=n,e[i+2]*=n,e[i+3]*=n}}this.setVerticesData(o.VertexBuffer.MatricesWeightsKind,t),this.setVerticesData(o.VertexBuffer.MatricesWeightsKind,e)},b.prototype.validateSkinning=function(){var e=this.getVerticesData(o.VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var r=t.length,i=0,s=0,n=0,a=0,h=null===e?4:8,l=new Array,c=0;c<=h;c++)l[c]=0;for(c=0;c<r;c+=4){for(var u=t[c],f=u,d=0===f?0:1,g=1;g<h;g++){var p=g<4?t[c+g]:e[c+g-4];p>u&&i++,0!==p&&d++,f+=p,u=p}if(l[d]++,d>n&&(n=d),0===f)s++;else{var m=1/f,y=0;for(g=0;g<h;g++)y+=g<4?Math.abs(t[c+g]-t[c+g]*m):Math.abs(e[c+g-4]-e[c+g-4]*m);y>.001&&a++}}var v=this.skeleton.bones.length,_=this.getVerticesData(o.VertexBuffer.MatricesIndicesKind),b=this.getVerticesData(o.VertexBuffer.MatricesIndicesExtraKind),M=0;for(c=0;c<r;c++)for(g=0;g<h;g++){var I=g<4?_[g]:b[g-4];(I>=v||I<0)&&M++}return{skinned:!0,valid:0===s&&0===a&&0===M,report:"Number of Weights = "+r/4+"\nMaximum influences = "+n+"\nMissing Weights = "+s+"\nNot Sorted = "+i+"\nNot Normalized = "+a+"\nWeightCounts = ["+l+"]\nNumber of bones = "+v+"\nBad Bone Indices = "+M}},b.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):this.delayLoadState===y.Constants.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=y.Constants.DELAYLOADSTATE_LOADING,this._queueLoad(e)),this},b.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var i=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return r.Tools.LoadFile(this.delayLoadingFile,function(r){r instanceof ArrayBuffer?t._delayLoadingFunction(r,t):t._delayLoadingFunction(JSON.parse(r),t),t.instances.forEach(function(e){e._syncSubMeshes()}),t.delayLoadState=y.Constants.DELAYLOADSTATE_LOADED,e._removePendingData(t)},function(){},e.offlineProvider,i),this},b.prototype.isInFrustum=function(e){return this.delayLoadState!==y.Constants.DELAYLOADSTATE_LOADING&&(!!c.prototype.isInFrustum.call(this,e)&&(this._checkDelayState(),!0))},b.prototype.setMaterialByID=function(e){var t,r=this.getScene().materials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;var i=this.getScene().multiMaterials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;return this},b.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},b.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(o.VertexBuffer.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var r,i=this.getVerticesData(o.VertexBuffer.PositionKind),s=new Array;for(r=0;r<i.length;r+=3)n.Vector3.TransformCoordinates(n.Vector3.FromArray(i,r),e).toArray(s,r);if(this.setVerticesData(o.VertexBuffer.PositionKind,s,this.getVertexBuffer(o.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(o.VertexBuffer.NormalKind)){for(i=this.getVerticesData(o.VertexBuffer.NormalKind),s=[],r=0;r<i.length;r+=3)n.Vector3.TransformNormal(n.Vector3.FromArray(i,r),e).normalize().toArray(s,r);this.setVerticesData(o.VertexBuffer.NormalKind,s,this.getVertexBuffer(o.VertexBuffer.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},b.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=n.Quaternion.Identity()),this._worldMatrix=n.Matrix.Identity(),this},Object.defineProperty(b.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),b.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},b.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},b.prototype.clone=function(e,t,r,i){return void 0===e&&(e=""),void 0===i&&(i=!0),new b(e,this.getScene(),t,this,r,i)},b.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0),this._onBeforeDrawObservable&&this._onBeforeDrawObservable.clear(),this._onBeforeRenderObservable&&this._onBeforeRenderObservable.clear(),this._onAfterRenderObservable&&this._onAfterRenderObservable.clear(),this._scene.useClonedMeshhMap){if(this.meshMap)for(var r in this.meshMap){(n=this.meshMap[r])&&(n._source=null,this.meshMap[r]=void 0)}this._source&&this._source.meshMap&&(this._source.meshMap[this.uniqueId]=void 0)}else for(var i=0,s=this.getScene().meshes;i<s.length;i++){var n;(n=s[i])._source&&n._source===this&&(n._source=null)}for(this._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();c.prototype.dispose.call(this,e,t)},b.prototype.applyDisplacementMap=function(e,t,i,s,n,a,o){var h=this;void 0===o&&(o=!1);var l=this.getScene();return r.Tools.LoadImage(e,function(e){var r=document.createElement("canvas"),l=r.getContext("2d"),c=e.width,u=e.height;r.width=c,r.height=u,l.drawImage(e,0,0);var f=l.getImageData(0,0,c,u).data;h.applyDisplacementMapFromBuffer(f,c,u,t,i,n,a,o),s&&s(h)},function(){},l.offlineProvider),this},b.prototype.applyDisplacementMapFromBuffer=function(e,t,r,i,s,a,l,c){if(void 0===c&&(c=!1),!this.isVerticesDataPresent(o.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(o.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(o.VertexBuffer.UVKind))return _.Logger.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var u=this.getVerticesData(o.VertexBuffer.PositionKind,!0,!0),f=this.getVerticesData(o.VertexBuffer.NormalKind),d=this.getVerticesData(o.VertexBuffer.UVKind),g=n.Vector3.Zero(),p=n.Vector3.Zero(),m=n.Vector2.Zero();a=a||n.Vector2.Zero(),l=l||new n.Vector2(1,1);for(var y=0;y<u.length;y+=3){n.Vector3.FromArrayToRef(u,y,g),n.Vector3.FromArrayToRef(f,y,p),n.Vector2.FromArrayToRef(d,y/3*2,m);var v=4*((Math.abs(m.x*l.x+a.x)*t%t|0)+(Math.abs(m.y*l.y+a.y)*r%r|0)*t),b=.3*(e[v]/255)+.59*(e[v+1]/255)+.11*(e[v+2]/255);p.normalize(),p.scaleInPlace(i+(s-i)*b),(g=g.add(p)).toArray(u,y)}return h.VertexData.ComputeNormals(u,this.getIndices(),f),c?(this.setVerticesData(o.VertexBuffer.PositionKind,u),this.setVerticesData(o.VertexBuffer.NormalKind,f)):(this.updateVerticesData(o.VertexBuffer.PositionKind,u),this.updateVerticesData(o.VertexBuffer.NormalKind,f)),this},b.prototype.convertToFlatShadedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},s={},a={},h=!1;for(e=0;e<r.length;e++){t=r[e];var l=this.getVertexBuffer(t);t!==o.VertexBuffer.NormalKind?(i[t]=l,s[t]=i[t].getData(),a[t]=[]):(h=l.isUpdatable(),r.splice(e,1),e--)}var c,f=this.subMeshes.slice(0),d=this.getIndices(),g=this.getTotalIndices();for(c=0;c<g;c++){var p=d[c];for(e=0;e<r.length;e++)for(var m=i[t=r[e]].getStrideSize(),y=0;y<m;y++)a[t].push(s[t][p*m+y])}var v=[],_=a[o.VertexBuffer.PositionKind];for(c=0;c<g;c+=3){d[c]=c,d[c+1]=c+1,d[c+2]=c+2;for(var b=n.Vector3.FromArray(_,3*c),M=n.Vector3.FromArray(_,3*(c+1)),I=n.Vector3.FromArray(_,3*(c+2)),x=b.subtract(M),V=I.subtract(M),D=n.Vector3.Normalize(n.Vector3.Cross(x,V)),B=0;B<3;B++)v.push(D.x),v.push(D.y),v.push(D.z)}for(this.setIndices(d),this.setVerticesData(o.VertexBuffer.NormalKind,v,h),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,a[t],i[t].isUpdatable());this.releaseSubMeshes();for(var S=0;S<f.length;S++){var A=f[S];u.SubMesh.AddToMesh(A.materialIndex,A.indexStart,A.indexCount,A.indexStart,A.indexCount,this)}return this.synchronizeInstances(),this},b.prototype.convertToUnIndexedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},s={},n={};for(e=0;e<r.length;e++){t=r[e];var a=this.getVertexBuffer(t);i[t]=a,s[t]=i[t].getData(),n[t]=[]}var o,h=this.subMeshes.slice(0),l=this.getIndices(),c=this.getTotalIndices();for(o=0;o<c;o++){var f=l[o];for(e=0;e<r.length;e++)for(var d=i[t=r[e]].getStrideSize(),g=0;g<d;g++)n[t].push(s[t][f*d+g])}for(o=0;o<c;o+=3)l[o]=o,l[o+1]=o+1,l[o+2]=o+2;for(this.setIndices(l),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,n[t],i[t].isUpdatable());this.releaseSubMeshes();for(var p=0;p<h.length;p++){var m=h[p];u.SubMesh.AddToMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},b.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,r,i=h.VertexData.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(o.VertexBuffer.NormalKind)&&i.normals)for(t=0;t<i.normals.length;t++)i.normals[t]*=-1;if(i.indices)for(t=0;t<i.indices.length;t+=3)r=i.indices[t+1],i.indices[t+1]=i.indices[t+2],i.indices[t+2]=r;return i.applyToMesh(this),this},b.prototype.createInstance=function(e){return b._instancedMeshFactory(e,this)},b.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this},b.prototype.optimizeIndices=function(e){var t=this,i=this.getIndices(),s=this.getVerticesData(o.VertexBuffer.PositionKind);if(!s||!i)return this;for(var a=new Array,h=0;h<s.length;h+=3)a.push(n.Vector3.FromArray(s,h));var l=new Array;return r.AsyncLoop.SyncAsyncForLoop(a.length,40,function(e){for(var t=a.length-1-e,r=a[t],i=0;i<t;++i){var s=a[i];if(r.equals(s)){l[t]=i;break}}},function(){for(var r=0;r<i.length;++r)i[r]=l[i[r]]||i[r];var s=t.subMeshes.slice(0);t.setIndices(i),t.subMeshes=s,e&&e(t)}),this},b.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),s.Tags&&s.Tags.HasTags(this)&&(e.tags=s.Tags.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t){var r=t.id;e.geometryId=r,e.subMeshes=[];for(var i=0;i<this.subMeshes.length;i++){var n=this.subMeshes[i];e.subMeshes.push({materialIndex:n.materialIndex,verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount})}}this.material?e.materialId=this.material.id:this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id);var a=this.getPhysicsImpostor();a&&(e.physicsMass=a.getParam("mass"),e.physicsFriction=a.getParam("friction"),e.physicsRestitution=a.getParam("mass"),e.physicsImpostor=a.type),this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var o=0;o<this.instances.length;o++){var h=this.instances[o];if(!h.doNotSerialize){var l={name:h.name,id:h.id,position:h.position.asArray(),scaling:h.scaling.asArray()};h.parent&&(l.parentId=h.parent.id),h.rotationQuaternion?l.rotationQuaternion=h.rotationQuaternion.asArray():h.rotation&&(l.rotation=h.rotation.asArray()),e.instances.push(l),v.SerializationHelper.AppendSerializedAnimations(h,l),l.ranges=h.serializeAnimationRanges()}}v.SerializationHelper.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},b.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return _.Logger.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var r=e.getActiveTarget(t),i=r.getPositions();if(!i)return void _.Logger.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(o.VertexBuffer.PositionKind+t,i,!1,3);var s=r.getNormals();s&&this.geometry.setVerticesData(o.VertexBuffer.NormalKind+t,s,!1,3);var n=r.getTangents();n&&this.geometry.setVerticesData(o.VertexBuffer.TangentKind+t,n,!1,3)}}else for(t=0;this.geometry.isVerticesDataPresent(o.VertexBuffer.PositionKind+t);)this.geometry.removeVerticesData(o.VertexBuffer.PositionKind+t),this.geometry.isVerticesDataPresent(o.VertexBuffer.NormalKind+t)&&this.geometry.removeVerticesData(o.VertexBuffer.NormalKind+t),this.geometry.isVerticesDataPresent(o.VertexBuffer.TangentKind+t)&&this.geometry.removeVerticesData(o.VertexBuffer.TangentKind+t),t++}},b.Parse=function(e,t,r){var i;if((i=e.type&&"GroundMesh"===e.type?b._GroundMeshParser(e,t):new b(e.name,t)).id=e.id,s.Tags&&s.Tags.AddTagsTo(i,e.tags),i.position=n.Vector3.FromArray(e.position),void 0!==e.metadata&&(i.metadata=e.metadata),e.rotationQuaternion?i.rotationQuaternion=n.Quaternion.FromArray(e.rotationQuaternion):e.rotation&&(i.rotation=n.Vector3.FromArray(e.rotation)),i.scaling=n.Vector3.FromArray(e.scaling),e.localMatrix?i.setPreTransformMatrix(n.Matrix.FromArray(e.localMatrix)):e.pivotMatrix&&i.setPivotMatrix(n.Matrix.FromArray(e.pivotMatrix)),i.setEnabled(e.isEnabled),i.isVisible=e.isVisible,i.infiniteDistance=e.infiniteDistance,i.showBoundingBox=e.showBoundingBox,i.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(i.applyFog=e.applyFog),void 0!==e.pickable&&(i.isPickable=e.pickable),void 0!==e.alphaIndex&&(i.alphaIndex=e.alphaIndex),i.receiveShadows=e.receiveShadows,i.billboardMode=e.billboardMode,void 0!==e.visibility&&(i.visibility=e.visibility),i.checkCollisions=e.checkCollisions,void 0!==e.isBlocker&&(i.isBlocker=e.isBlocker),i._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(i._waitingFreezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(i._waitingParentId=e.parentId),void 0!==e.actions&&(i._waitingActions=e.actions),void 0!==e.overlayAlpha&&(i.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(i.overlayColor=n.Color3.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(i.renderOverlay=e.renderOverlay),i.isUnIndexed=!!e.isUnIndexed,i.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(i.delayLoadState=y.Constants.DELAYLOADSTATE_NOTLOADED,i.delayLoadingFile=r+e.delayLoadingFile,i._boundingInfo=new f.BoundingInfo(n.Vector3.FromArray(e.boundingBoxMinimum),n.Vector3.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(i._binaryInfo=e._binaryInfo),i._delayInfo=[],e.hasUVs&&i._delayInfo.push(o.VertexBuffer.UVKind),e.hasUVs2&&i._delayInfo.push(o.VertexBuffer.UV2Kind),e.hasUVs3&&i._delayInfo.push(o.VertexBuffer.UV3Kind),e.hasUVs4&&i._delayInfo.push(o.VertexBuffer.UV4Kind),e.hasUVs5&&i._delayInfo.push(o.VertexBuffer.UV5Kind),e.hasUVs6&&i._delayInfo.push(o.VertexBuffer.UV6Kind),e.hasColors&&i._delayInfo.push(o.VertexBuffer.ColorKind),e.hasMatricesIndices&&i._delayInfo.push(o.VertexBuffer.MatricesIndicesKind),e.hasMatricesWeights&&i._delayInfo.push(o.VertexBuffer.MatricesWeightsKind),i._delayLoadingFunction=l.Geometry._ImportGeometry,p.SceneLoaderFlags.ForceFullSceneLoadingForIncremental&&i._checkDelayState()):l.Geometry._ImportGeometry(e,i),e.materialId?i.setMaterialByID(e.materialId):i.material=null,e.morphTargetManagerId>-1&&(i.morphTargetManager=t.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId>-1&&(i.skeleton=t.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(i.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var h=0;h<e.animations.length;h++){var c=e.animations[h];i.animations.push(g.Animation.Parse(c))}a.Node.ParseAnimationRanges(i,e,t)}if(e.autoAnimate&&t.beginAnimation(i,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?i.layerMask=Math.abs(parseInt(e.layerMask)):i.layerMask=268435455,e.physicsImpostor&&(i.physicsImpostor=new m.PhysicsImpostor(i,e.physicsImpostor,{mass:e.physicsMass,friction:e.physicsFriction,restitution:e.physicsRestitution},t)),e.instances)for(var u=0;u<e.instances.length;u++){var d=e.instances[u],v=i.createInstance(d.name);if(d.id&&(v.id=d.id),s.Tags&&(d.tags?s.Tags.AddTagsTo(v,d.tags):s.Tags.AddTagsTo(v,e.tags)),v.position=n.Vector3.FromArray(d.position),d.parentId&&(v._waitingParentId=d.parentId),d.rotationQuaternion?v.rotationQuaternion=n.Quaternion.FromArray(d.rotationQuaternion):d.rotation&&(v.rotation=n.Vector3.FromArray(d.rotation)),v.scaling=n.Vector3.FromArray(d.scaling),null!=d.checkCollisions&&null!=d.checkCollisions&&(v.checkCollisions=d.checkCollisions),null!=d.pickable&&null!=d.pickable&&(v.isPickable=d.pickable),null!=d.showBoundingBox&&null!=d.showBoundingBox&&(v.showBoundingBox=d.showBoundingBox),null!=d.showSubMeshesBoundingBox&&null!=d.showSubMeshesBoundingBox&&(v.showSubMeshesBoundingBox=d.showSubMeshesBoundingBox),null!=d.alphaIndex&&null!=d.showSubMeshesBoundingBox&&(v.alphaIndex=d.alphaIndex),d.physicsImpostor&&(v.physicsImpostor=new m.PhysicsImpostor(v,d.physicsImpostor,{mass:d.physicsMass,friction:d.physicsFriction,restitution:d.physicsRestitution},t)),d.animations){for(h=0;h<d.animations.length;h++)c=d.animations[h],v.animations.push(g.Animation.Parse(c));a.Node.ParseAnimationRanges(v,d,t),d.autoAnimate&&t.beginAnimation(v,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1)}}return i},b.CreateRibbon=function(e,t,r,i,s,n,a,o,h){throw"Import MeshBuilder before creating meshes."},b.CreateDisc=function(e,t,r,i,s,n){throw void 0===i&&(i=null),"Import MeshBuilder before creating meshes."},b.CreateBox=function(e,t,r,i,s){throw void 0===r&&(r=null),"Import MeshBuilder before creating meshes."},b.CreateSphere=function(e,t,r,i,s,n){throw"Import MeshBuilder before creating meshes."},b.CreateCylinder=function(e,t,r,i,s,n,a,o,h){throw"Import MeshBuilder before creating meshes."},b.CreateTorus=function(e,t,r,i,s,n,a){throw"Import MeshBuilder before creating meshes."},b.CreateTorusKnot=function(e,t,r,i,s,n,a,o,h,l){throw"Import MeshBuilder before creating meshes."},b.CreateLines=function(e,t,r,i,s){throw void 0===r&&(r=null),void 0===i&&(i=!1),void 0===s&&(s=null),"Import MeshBuilder before creating meshes."},b.CreateDashedLines=function(e,t,r,i,s,n,a,o){throw void 0===n&&(n=null),"Import MeshBuilder before creating meshes."},b.CreatePolygon=function(e,t,r,i,s,n){throw"Import MeshBuilder before creating meshes."},b.ExtrudePolygon=function(e,t,r,i,s,n,a){throw"Import MeshBuilder before creating meshes."},b.ExtrudeShape=function(e,t,r,i,s,n,a,o,h,l){throw void 0===a&&(a=null),"Import MeshBuilder before creating meshes."},b.ExtrudeShapeCustom=function(e,t,r,i,s,n,a,o,h,l,c,u){throw"Import MeshBuilder before creating meshes."},b.CreateLathe=function(e,t,r,i,s,n,a){throw"Import MeshBuilder before creating meshes."},b.CreatePlane=function(e,t,r,i,s){throw"Import MeshBuilder before creating meshes."},b.CreateGround=function(e,t,r,i,s,n){throw"Import MeshBuilder before creating meshes."},b.CreateTiledGround=function(e,t,r,i,s,n,a,o,h){throw"Import MeshBuilder before creating meshes."},b.CreateGroundFromHeightMap=function(e,t,r,i,s,n,a,o,h,l,c){throw"Import MeshBuilder before creating meshes."},b.CreateTube=function(e,t,r,i,s,n,a,o,h,l){throw"Import MeshBuilder before creating meshes."},b.CreatePolyhedron=function(e,t,r){throw"Import MeshBuilder before creating meshes."},b.CreateIcoSphere=function(e,t,r){throw"Import MeshBuilder before creating meshes."},b.CreateDecal=function(e,t,r,i,s,n){throw"Import MeshBuilder before creating meshes."},b.prototype.setPositionsForCPUSkinning=function(){if(!this._sourcePositions){var e=this.getVerticesData(o.VertexBuffer.PositionKind);if(!e)return this._sourcePositions;this._sourcePositions=new Float32Array(e),this.isVertexBufferUpdatable(o.VertexBuffer.PositionKind)||this.setVerticesData(o.VertexBuffer.PositionKind,e,!0)}return this._sourcePositions},b.prototype.setNormalsForCPUSkinning=function(){if(!this._sourceNormals){var e=this.getVerticesData(o.VertexBuffer.NormalKind);if(!e)return this._sourceNormals;this._sourceNormals=new Float32Array(e),this.isVertexBufferUpdatable(o.VertexBuffer.NormalKind)||this.setVerticesData(o.VertexBuffer.NormalKind,e,!0)}return this._sourceNormals},b.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(o.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(o.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(o.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(o.VertexBuffer.MatricesWeightsKind))return this;if(!this._sourcePositions){var t=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=t}this._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(o.VertexBuffer.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var i=this.getVerticesData(o.VertexBuffer.NormalKind);if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i));var s=this.getVerticesData(o.VertexBuffer.MatricesIndicesKind),a=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind);if(!a||!s)return this;for(var h,l=this.numBoneInfluencers>4,c=l?this.getVerticesData(o.VertexBuffer.MatricesIndicesExtraKind):null,u=l?this.getVerticesData(o.VertexBuffer.MatricesWeightsExtraKind):null,f=e.getTransformMatrices(this),d=n.Vector3.Zero(),g=new n.Matrix,p=new n.Matrix,m=0,y=0;y<r.length;y+=3,m+=4){var v;for(h=0;h<4;h++)(v=a[m+h])>0&&(n.Matrix.FromFloat32ArrayToRefScaled(f,Math.floor(16*s[m+h]),v,p),g.addToSelf(p));if(l)for(h=0;h<4;h++)(v=u[m+h])>0&&(n.Matrix.FromFloat32ArrayToRefScaled(f,Math.floor(16*c[m+h]),v,p),g.addToSelf(p));n.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[y],this._sourcePositions[y+1],this._sourcePositions[y+2],g,d),d.toArray(r,y),n.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[y],this._sourceNormals[y+1],this._sourceNormals[y+2],g,d),d.toArray(i,y),g.reset()}return this.updateVerticesData(o.VertexBuffer.PositionKind,r),this.updateVerticesData(o.VertexBuffer.NormalKind,i),this},b.MinMax=function(e){var t=null,r=null;return e.forEach(function(e){var i=e.getBoundingInfo().boundingBox;t&&r?(t.minimizeInPlace(i.minimumWorld),r.maximizeInPlace(i.maximumWorld)):(t=i.minimumWorld,r=i.maximumWorld)}),t&&r?{min:t,max:r}:{min:n.Vector3.Zero(),max:n.Vector3.Zero()}},b.Center=function(e){var t=e instanceof Array?b.MinMax(e):e;return n.Vector3.Center(t.min,t.max)},b.MergeMeshes=function(e,t,r,i,s){var n;if(void 0===t&&(t=!0),!r){var a=0;for(n=0;n<e.length;n++)if(e[n]&&(a+=e[n].getTotalVertices())>65536)return _.Logger.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var o,l=null,c=new Array,f=null;for(n=0;n<e.length;n++)if(e[n]){var d=e[n].computeWorldMatrix(!0);(o=h.VertexData.ExtractFromMesh(e[n],!0,!0)).transform(d),l?l.merge(o,r):(l=o,f=e[n]),s&&c.push(e[n].getTotalIndices())}if(f=f,i||(i=new b(f.name+"_merged",f.getScene())),l.applyToMesh(i),i.material=f.material,i.checkCollisions=f.checkCollisions,t)for(n=0;n<e.length;n++)e[n]&&e[n].dispose();if(s){i.releaseSubMeshes(),n=0;for(var g=0;n<c.length;)u.SubMesh.CreateFromIndices(0,g,c[n],i),g+=c[n],n++}return i},b.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},b.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var r=this.instances[this.instances.length-1];this.instances[t]=r,r._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},b.FRONTSIDE=h.VertexData.FRONTSIDE,b.BACKSIDE=h.VertexData.BACKSIDE,b.DOUBLESIDE=h.VertexData.DOUBLESIDE,b.DEFAULTSIDE=h.VertexData.DEFAULTSIDE,b.NO_CAP=0,b.CAP_START=1,b.CAP_END=2,b.CAP_ALL=3,b._instancedMeshFactory=function(e,t){throw"Import InstancedMesh before creating instances."},b._GroundMeshParser=function(e,t){throw"Import GroundMesh before trying to parse it."},b}(c.AbstractMesh);exports.Mesh=D;
},{"tslib":"vCxL","../Misc/observable":"gtkL","../Misc/tools":"RkuS","../Misc/deepCopier":"RVA4","../Misc/tags":"Ae8d","../Maths/math":"Iizi","../node":"P+He","./buffer":"YHhW","./mesh.vertexData":"+kld","./geometry":"QQcI","./abstractMesh":"Nnvo","./subMesh":"MMoF","../Culling/boundingInfo":"1eEz","../Materials/material":"v46b","../Animations/animation":"8SP4","../Loading/sceneLoaderFlags":"Gju8","../Physics/physicsImpostor":"jNlR","../Engines/constants":"vn8z","../Misc/decorators":"knvU","../Misc/logger":"Fvml"}],"rAGZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AutoRotationBehavior=void 0;var t=require("../../Events/pointerEvents"),e=require("../../Misc/precisionDate"),i=function(){function i(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(i.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(t){this._idleRotationSpeed=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(t){this._idleRotationWaitTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(t){this._idleRotationSpinupTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(i){var a=this;this._attachedCamera=i;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(e){e.type!==t.PointerEventTypes.POINTERDOWN?e.type===t.PointerEventTypes.POINTERUP&&(a._isPointerDown=!1):a._isPointerDown=!0}),this._onAfterCheckInputsObserver=i.onAfterCheckInputsObservable.add(function(){var t=e.PrecisionDate.Now,i=0;null!=a._lastFrameTime&&(i=t-a._lastFrameTime),a._lastFrameTime=t,a._applyUserInteraction();var n=t-a._lastInteractionTime-a._idleRotationWaitTime,o=Math.max(Math.min(n/a._idleRotationSpinupTime,1),0);a._cameraRotationSpeed=a._idleRotationSpeed*o,a._attachedCamera&&(a._attachedCamera.alpha-=a._cameraRotationSpeed*(i/1e3))})},i.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},i.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},i.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()},i.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=e.PrecisionDate.Now)},i.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},i}();exports.AutoRotationBehavior=i;
},{"../../Events/pointerEvents":"6huE","../../Misc/precisionDate":"V1yO"}],"TYqm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BezierCurveEase=exports.SineEase=exports.QuinticEase=exports.QuarticEase=exports.QuadraticEase=exports.PowerEase=exports.ExponentialEase=exports.ElasticEase=exports.CubicEase=exports.BounceEase=exports.BackEase=exports.CircleEase=exports.EasingFunction=void 0;var t=r(require("tslib")),e=require("../Maths/math");function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};n.get||n.set?Object.defineProperty(e,r,n):e[r]=t[r]}return e.default=t,e}var n=function(){function t(){this._easingMode=t.EASINGMODE_EASEIN}return t.prototype.setEasingMode=function(t){var e=Math.min(Math.max(t,0),2);this._easingMode=e},t.prototype.getEasingMode=function(){return this._easingMode},t.prototype.easeInCore=function(t){throw new Error("You must implement this method")},t.prototype.ease=function(e){switch(this._easingMode){case t.EASINGMODE_EASEIN:return this.easeInCore(e);case t.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?.5*(1-this.easeInCore(2*(1-e)))+.5:.5*this.easeInCore(2*e)},t.EASINGMODE_EASEIN=0,t.EASINGMODE_EASEOUT=1,t.EASINGMODE_EASEINOUT=2,t}();exports.EasingFunction=n;var o=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.easeInCore=function(t){return t=Math.max(0,Math.min(1,t)),1-Math.sqrt(1-t*t)},r}(n);exports.CircleEase=o;var s=function(e){function r(t){void 0===t&&(t=1);var r=e.call(this)||this;return r.amplitude=t,r}return t.__extends(r,e),r.prototype.easeInCore=function(t){var e=Math.max(0,this.amplitude);return Math.pow(t,3)-t*e*Math.sin(3.141592653589793*t)},r}(n);exports.BackEase=s;var i=function(e){function r(t,r){void 0===t&&(t=3),void 0===r&&(r=2);var n=e.call(this)||this;return n.bounces=t,n.bounciness=r,n}return t.__extends(r,e),r.prototype.easeInCore=function(t){var e=Math.max(0,this.bounces),r=this.bounciness;r<=1&&(r=1.001);var n=Math.pow(r,e),o=1-r,s=(1-n)/o+.5*n,i=t*s,a=Math.log(-i*(1-r)+1)/Math.log(r),u=Math.floor(a),p=u+1,c=(1-Math.pow(r,u))/(o*s),h=.5*(c+(1-Math.pow(r,p))/(o*s)),x=t-h,E=h-c;return-Math.pow(1/r,e-u)/(E*E)*(x-E)*(x+E)},r}(n);exports.BounceEase=i;var a=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.easeInCore=function(t){return t*t*t},r}(n);exports.CubicEase=a;var u=function(e){function r(t,r){void 0===t&&(t=3),void 0===r&&(r=3);var n=e.call(this)||this;return n.oscillations=t,n.springiness=r,n}return t.__extends(r,e),r.prototype.easeInCore=function(t){var e=Math.max(0,this.oscillations),r=Math.max(0,this.springiness);return(0==r?t:(Math.exp(r*t)-1)/(Math.exp(r)-1))*Math.sin((6.283185307179586*e+1.5707963267948966)*t)},r}(n);exports.ElasticEase=u;var p=function(e){function r(t){void 0===t&&(t=2);var r=e.call(this)||this;return r.exponent=t,r}return t.__extends(r,e),r.prototype.easeInCore=function(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)},r}(n);exports.ExponentialEase=p;var c=function(e){function r(t){void 0===t&&(t=2);var r=e.call(this)||this;return r.power=t,r}return t.__extends(r,e),r.prototype.easeInCore=function(t){var e=Math.max(0,this.power);return Math.pow(t,e)},r}(n);exports.PowerEase=c;var h=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.easeInCore=function(t){return t*t},r}(n);exports.QuadraticEase=h;var x=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.easeInCore=function(t){return t*t*t*t},r}(n);exports.QuarticEase=x;var E=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.easeInCore=function(t){return t*t*t*t*t},r}(n);exports.QuinticEase=E;var l=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t.__extends(r,e),r.prototype.easeInCore=function(t){return 1-Math.sin(1.5707963267948966*(1-t))},r}(n);exports.SineEase=l;var f=function(r){function n(t,e,n,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===o&&(o=1);var s=r.call(this)||this;return s.x1=t,s.y1=e,s.x2=n,s.y2=o,s}return t.__extends(n,r),n.prototype.easeInCore=function(t){return e.BezierCurve.Interpolate(t,this.x1,this.y1,this.x2,this.y2)},n}(n);exports.BezierCurveEase=f;
},{"tslib":"vCxL","../Maths/math":"Iizi"}],"8sKY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BouncingBehavior=void 0;var a=require("../../Animations/easing"),t=require("../../Animations/animation"),i=function(){function i(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(i.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(a){var t=this;if(this._autoTransitionRange!==a){this._autoTransitionRange=a;var i=this._attachedCamera;i&&(a?this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add(function(a){if(a){a.computeWorldMatrix(!0);var i=a.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=.05*i,t.upperRadiusTransitionRange=.05*i}}):this._onMeshTargetChangedObserver&&i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),i.prototype.init=function(){},i.prototype.attach=function(a){var t=this;this._attachedCamera=a,this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add(function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},i.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},i.prototype._isRadiusAtLimit=function(a){return!!this._attachedCamera&&(this._attachedCamera.radius===a&&!this._radiusIsAnimating)},i.prototype._applyBoundRadiusAnimation=function(a){var e=this;if(this._attachedCamera){this._radiusBounceTransition||(i.EasingFunction.setEasingMode(i.EasingMode),this._radiusBounceTransition=t.Animation.CreateAnimation("radius",t.Animation.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var n=t.Animation.TransitionTo("radius",this._attachedCamera.radius+a,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return e._clearAnimationLocks()});n&&this._animatables.push(n)}},i.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},i.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},i.EasingFunction=new a.BackEase(.3),i.EasingMode=a.EasingFunction.EASINGMODE_EASEOUT,i}();exports.BouncingBehavior=i;
},{"../../Animations/easing":"TYqm","../../Animations/animation":"8SP4"}],"YqVX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FramingBehavior=void 0;var t=require("../../Animations/easing"),e=require("../../Events/pointerEvents"),i=require("../../Misc/tools"),a=require("../../Misc/precisionDate"),n=require("../../Maths/math"),o=require("../../Animations/animation"),r=function(){function r(){this._mode=r.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(r.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(t){this._radiusScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positionScale",{get:function(){return this._positionScale},set:function(t){this._positionScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(t){this._defaultElevation=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(t){this._elevationReturnTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(t){this._elevationReturnWaitTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"framingTime",{get:function(){return this._framingTime},set:function(t){this._framingTime=t},enumerable:!0,configurable:!0}),r.prototype.init=function(){},r.prototype.attach=function(t){var i=this;this._attachedCamera=t;var a=this._attachedCamera.getScene();r.EasingFunction.setEasingMode(r.EasingMode),this._onPrePointerObservableObserver=a.onPrePointerObservable.add(function(t){t.type!==e.PointerEventTypes.POINTERDOWN?t.type===e.PointerEventTypes.POINTERUP&&(i._isPointerDown=!1):i._isPointerDown=!0}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(t){t&&i.zoomOnMesh(t)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){i._applyUserInteraction(),i._maintainCameraAboveGround()})},r.prototype.detach=function(){if(this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},r.prototype.zoomOnMesh=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=null),t.computeWorldMatrix(!0);var a=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(a.minimumWorld,a.maximumWorld,e,i)},r.prototype.zoomOnMeshHierarchy=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=null),t.computeWorldMatrix(!0);var a=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(a.min,a.max,e,i)},r.prototype.zoomOnMeshesHierarchy=function(t,e,a){void 0===e&&(e=!1),void 0===a&&(a=null);for(var o=new n.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new n.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=0;s<t.length;s++){var h=t[s].getHierarchyBoundingVectors(!0);i.Tools.CheckExtends(h.min,o,r),i.Tools.CheckExtends(h.max,o,r)}this.zoomOnBoundingInfo(o,r,e,a)},r.prototype.zoomOnBoundingInfo=function(t,e,i,a){var s,h=this;if(void 0===i&&(i=!1),void 0===a&&(a=null),this._attachedCamera){var m=t.y,u=m+(e.y-m)*this._positionScale,c=e.subtract(t).scale(.5);if(i)s=new n.Vector3(0,u,0);else{var d=t.add(c);s=new n.Vector3(d.x,u,d.z)}this._vectorTransition||(this._vectorTransition=o.Animation.CreateAnimation("target",o.Animation.ANIMATIONTYPE_VECTOR3,60,r.EasingFunction)),this._betaIsAnimating=!0;var l=o.Animation.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);l&&this._animatables.push(l);var _=0;if(this._mode===r.FitFrustumSidesMode){var p=this._calculateLowerRadiusFromModelBoundingSphere(t,e);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=c.length()+this._attachedCamera.minZ),_=p}else this._mode===r.IgnoreBoundsSizeMode&&(_=this._calculateLowerRadiusFromModelBoundingSphere(t,e),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var f=e.subtract(t).length();this._attachedCamera.panningSensibility=5e3/f,this._attachedCamera.wheelPrecision=100/_}this._radiusTransition||(this._radiusTransition=o.Animation.CreateAnimation("radius",o.Animation.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),(l=o.Animation.TransitionTo("radius",_,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){h.stopAllAnimations(),a&&a(),h._attachedCamera&&h._attachedCamera.useInputToRestoreState&&h._attachedCamera.storeState()}))&&this._animatables.push(l)}},r.prototype._calculateLowerRadiusFromModelBoundingSphere=function(t,e){var i=e.subtract(t).length(),a=this._getFrustumSlope(),n=.5*i*this._radiusScale,o=n*Math.sqrt(1+1/(a.x*a.x)),s=n*Math.sqrt(1+1/(a.y*a.y)),h=Math.max(o,s),m=this._attachedCamera;return m?(m.lowerRadiusLimit&&this._mode===r.IgnoreBoundsSizeMode&&(h=h<m.lowerRadiusLimit?m.lowerRadiusLimit:h),m.upperRadiusLimit&&(h=h>m.upperRadiusLimit?m.upperRadiusLimit:h),h):0},r.prototype._maintainCameraAboveGround=function(){var t=this;if(!(this._elevationReturnTime<0)){var e=a.PrecisionDate.Now-this._lastInteractionTime,i=.5*Math.PI-this._defaultElevation,n=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>n&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=o.Animation.CreateAnimation("beta",o.Animation.ANIMATIONTYPE_FLOAT,60,r.EasingFunction));var s=o.Animation.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){t._clearAnimationLocks(),t.stopAllAnimations()});s&&this._animatables.push(s)}}},r.prototype._getFrustumSlope=function(){var t=this._attachedCamera;if(!t)return n.Vector2.Zero();var e=t.getScene().getEngine().getAspectRatio(t),i=Math.tan(t.fov/2),a=i*e;return new n.Vector2(a,i)},r.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},r.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=a.PrecisionDate.Now,this.stopAllAnimations(),this._clearAnimationLocks())},r.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(r.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),r.EasingFunction=new t.ExponentialEase,r.EasingMode=t.EasingFunction.EASINGMODE_EASEINOUT,r.IgnoreBoundsSizeMode=0,r.FitFrustumSidesMode=1,r}();exports.FramingBehavior=r;
},{"../../Animations/easing":"TYqm","../../Events/pointerEvents":"6huE","../../Misc/tools":"RkuS","../../Misc/precisionDate":"V1yO","../../Maths/math":"Iizi","../../Animations/animation":"8SP4"}],"TJBn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraVRDeviceOrientationInput=void 0;var t=require("../../Cameras/cameraInputsManager"),e=function(){function t(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return t.prototype.attachControl=function(t,e){this.camera.attachControl(t,e),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},t.prototype._onOrientationEvent=function(t){null!==t.alpha&&(this._alpha=(0|+t.alpha)*this.alphaCorrection),null!==t.gamma&&(this._gamma=(0|+t.gamma)*this.gammaCorrection),this._dirty=!0},t.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},t.prototype.detachControl=function(t){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},t.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},t.prototype.getSimpleName=function(){return"VRDeviceOrientation"},t}();exports.ArcRotateCameraVRDeviceOrientationInput=e,t.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=e;
},{"../../Cameras/cameraInputsManager":"H3O2"}],"mXvb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraPointersInput=void 0;var e=a(require("tslib")),t=require("../../Misc/decorators"),n=require("../../Misc/tools"),i=require("../../Cameras/cameraInputsManager"),r=require("../../Events/pointerEvents");function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};i.get||i.set?Object.defineProperty(t,n,i):t[n]=e[n]}return t.default=e,t}var o=function(){function i(){this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1}return i.prototype.attachControl=function(e,t){var i,a=this,o=this.camera.getEngine(),s=null,l=null,u=0,c=0,p=0,y={x:0,y:0,isPaning:!1,isPinching:!1};this._pointerInput=function(n,h){var d=n.event,v="touch"===n.event.pointerType;if(!o.isInVRExclusivePointerMode&&(n.type===r.PointerEventTypes.POINTERMOVE||-1!==a.buttons.indexOf(d.button))){var P=d.srcElement||d.target;if(n.type===r.PointerEventTypes.POINTERDOWN&&P){try{P.setPointerCapture(d.pointerId)}catch(C){}a._isPanClick=d.button===a.camera._panningMouseButton,i={x:d.clientX,y:d.clientY,pointerId:d.pointerId,type:d.pointerType},null===s?s=i:null===l&&(l=i),t||(d.preventDefault(),e.focus())}else if(n.type===r.PointerEventTypes.POINTERDOUBLETAP)a.camera.useInputToRestoreState&&a.camera.restoreState();else if(n.type===r.PointerEventTypes.POINTERUP&&P){try{P.releasePointerCapture(d.pointerId)}catch(C){}i=null,u=0,y.isPaning=!1,y.isPinching=!1,p=0,c=0,v||(l=null),o._badOS?s=l=null:l&&s&&s.pointerId==d.pointerId?(s=l,l=null,i={x:s.x,y:s.y,pointerId:s.pointerId,type:d.pointerType}):s&&l&&l.pointerId==d.pointerId?(l=null,i={x:s.x,y:s.y,pointerId:s.pointerId,type:d.pointerType}):s=l=null,t||d.preventDefault()}else if(n.type===r.PointerEventTypes.POINTERMOVE)if(t||d.preventDefault(),s&&null===l&&i){if(0!==a.panningSensibility&&(d.ctrlKey&&a.camera._useCtrlForPanning||a._isPanClick))a.camera.inertialPanningX+=-(d.clientX-i.x)/a.panningSensibility,a.camera.inertialPanningY+=(d.clientY-i.y)/a.panningSensibility;else{var m=d.clientX-i.x,g=d.clientY-i.y;a.camera.inertialAlphaOffset-=m/a.angularSensibilityX,a.camera.inertialBetaOffset-=g/a.angularSensibilityY}i.x=d.clientX,i.y=d.clientY}else if(s&&l){var _=s.pointerId===d.pointerId?s:l;_.x=d.clientX,_.y=d.clientY;var f=a.pinchInwards?1:-1,b=s.x-l.x,M=s.y-l.y,S=b*b+M*M,I=Math.sqrt(S);if(0===u)return c=I,u=S,y.x=(s.x+l.x)/2,void(y.y=(s.y+l.y)/2);if(a.multiTouchPanAndZoom){if(a.pinchDeltaPercentage?a.camera.inertialRadiusOffset+=.001*(S-u)*a.camera.radius*a.pinchDeltaPercentage:a.camera.inertialRadiusOffset+=(S-u)/(a.pinchPrecision*((a.angularSensibilityX+a.angularSensibilityY)/2)*f),0!==a.panningSensibility){var x=(s.x+l.x)/2,E=(s.y+l.y)/2,O=x-y.x,T=E-y.y;y.x=x,y.y=E,a.camera.inertialPanningX+=-O/a.panningSensibility,a.camera.inertialPanningY+=T/a.panningSensibility}}else{if(p++,y.isPinching||p<20&&Math.abs(I-c)>a.camera.pinchToPanMaxDistance)a.pinchDeltaPercentage?a.camera.inertialRadiusOffset+=.001*(S-u)*a.camera.radius*a.pinchDeltaPercentage:a.camera.inertialRadiusOffset+=(S-u)/(a.pinchPrecision*((a.angularSensibilityX+a.angularSensibilityY)/2)*f),y.isPaning=!1,y.isPinching=!0;else if(i&&i.pointerId===_.pointerId&&0!==a.panningSensibility&&a.multiTouchPanning){if(!y.isPaning)return y.isPaning=!0,y.isPinching=!1,y.x=_.x,void(y.y=_.y);a.camera.inertialPanningX+=-(_.x-y.x)/a.panningSensibility,a.camera.inertialPanningY+=(_.y-y.y)/a.panningSensibility}i&&i.pointerId===d.pointerId&&(y.x=_.x,y.y=_.y)}u=S}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,r.PointerEventTypes.POINTERDOWN|r.PointerEventTypes.POINTERUP|r.PointerEventTypes.POINTERMOVE|r.PointerEventTypes.POINTERDOUBLETAP),this._onContextMenu=function(e){e.preventDefault()},this.camera._useCtrlForPanning||e.addEventListener("contextmenu",this._onContextMenu,!1),this._onLostFocus=function(){s=l=null,u=0,y.isPaning=!1,y.isPinching=!1,p=0,i=null,c=0},this._onMouseMove=function(e){if(o.isPointerLock){var n=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;a.camera.inertialAlphaOffset-=n/a.angularSensibilityX,a.camera.inertialBetaOffset-=i/a.angularSensibilityY,t||e.preventDefault()}},this._onGestureStart=function(t){void 0!==window.MSGesture&&(a._MSGestureHandler||(a._MSGestureHandler=new MSGesture,a._MSGestureHandler.target=e),a._MSGestureHandler.addPointer(t.pointerId))},this._onGesture=function(e){a.camera.radius*=e.scale,e.preventDefault&&(t||(e.stopPropagation(),e.preventDefault()))},e.addEventListener("mousemove",this._onMouseMove,!1),e.addEventListener("MSPointerDown",this._onGestureStart,!1),e.addEventListener("MSGestureChange",this._onGesture,!1),n.Tools.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},i.prototype.detachControl=function(e){this._onLostFocus&&n.Tools.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),e&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._onContextMenu&&e.removeEventListener("contextmenu",this._onContextMenu),this._onMouseMove&&e.removeEventListener("mousemove",this._onMouseMove),this._onGestureStart&&e.removeEventListener("MSPointerDown",this._onGestureStart),this._onGesture&&e.removeEventListener("MSGestureChange",this._onGesture),this._isPanClick=!1,this.pinchInwards=!0,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null)},i.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},i.prototype.getSimpleName=function(){return"pointers"},e.__decorate([(0,t.serialize)()],i.prototype,"buttons",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"angularSensibilityX",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"angularSensibilityY",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"pinchPrecision",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"pinchDeltaPercentage",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"panningSensibility",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"multiTouchPanning",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"multiTouchPanAndZoom",void 0),i}();exports.ArcRotateCameraPointersInput=o,i.CameraInputTypes.ArcRotateCameraPointersInput=o;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Misc/tools":"RkuS","../../Cameras/cameraInputsManager":"H3O2","../../Events/pointerEvents":"6huE"}],"JJh1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraKeyboardMoveInput=void 0;var e=r(require("tslib")),t=require("../../Misc/decorators"),i=require("../../Cameras/cameraInputsManager"),s=require("../../Events/keyboardEvents");function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};s.get||s.set?Object.defineProperty(t,i,s):t[i]=e[i]}return t.default=e,t}var n=function(){function i(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return i.prototype.attachControl=function(e,t){var i=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){i._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var r,n=e.event;n.metaKey||(e.type===s.KeyboardEventTypes.KEYDOWN?(i._ctrlPressed=n.ctrlKey,i._altPressed=n.altKey,(-1!==i.keysUp.indexOf(n.keyCode)||-1!==i.keysDown.indexOf(n.keyCode)||-1!==i.keysLeft.indexOf(n.keyCode)||-1!==i.keysRight.indexOf(n.keyCode)||-1!==i.keysReset.indexOf(n.keyCode))&&(-1===(r=i._keys.indexOf(n.keyCode))&&i._keys.push(n.keyCode),n.preventDefault&&(t||n.preventDefault()))):-1===i.keysUp.indexOf(n.keyCode)&&-1===i.keysDown.indexOf(n.keyCode)&&-1===i.keysLeft.indexOf(n.keyCode)&&-1===i.keysRight.indexOf(n.keyCode)&&-1===i.keysReset.indexOf(n.keyCode)||((r=i._keys.indexOf(n.keyCode))>=0&&i._keys.splice(r,1),n.preventDefault&&(t||n.preventDefault())))}))},i.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},i.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&e.useInputToRestoreState&&e.restoreState()}},i.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},i.prototype.getSimpleName=function(){return"keyboard"},e.__decorate([(0,t.serialize)()],i.prototype,"keysUp",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"keysDown",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"keysLeft",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"keysRight",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"keysReset",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"panningSensibility",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"zoomingSensibility",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"useAltToZoom",void 0),e.__decorate([(0,t.serialize)()],i.prototype,"angularSpeed",void 0),i}();exports.ArcRotateCameraKeyboardMoveInput=n,i.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=n;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Cameras/cameraInputsManager":"H3O2","../../Events/keyboardEvents":"urGo"}],"jK48":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraMouseWheelInput=void 0;var e=o(require("tslib")),t=require("../../Misc/decorators"),r=require("../../Cameras/cameraInputsManager"),a=require("../../Events/pointerEvents");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};a.get||a.set?Object.defineProperty(t,r,a):t[r]=e[r]}return t.default=e,t}var n=function(){function r(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return r.prototype.attachControl=function(e,t){var r=this;this._wheel=function(e,o){if(e.type===a.PointerEventTypes.POINTERWHEEL){var n=e.event,i=0,l=n;if(l.wheelDelta)if(r.wheelDeltaPercentage){var s=.01*l.wheelDelta*r.wheelDeltaPercentage*r.camera.radius;i=l.wheelDelta>0?s/(1+r.wheelDeltaPercentage):s*(1+r.wheelDeltaPercentage)}else i=l.wheelDelta/(40*r.wheelPrecision);else i=-(n.deltaY||n.detail)/r.wheelPrecision;i&&(r.camera.inertialRadiusOffset+=i),n.preventDefault&&(t||n.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,a.PointerEventTypes.POINTERWHEEL)},r.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},r.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},r.prototype.getSimpleName=function(){return"mousewheel"},e.__decorate([(0,t.serialize)()],r.prototype,"wheelPrecision",void 0),e.__decorate([(0,t.serialize)()],r.prototype,"wheelDeltaPercentage",void 0),r}();exports.ArcRotateCameraMouseWheelInput=n,r.CameraInputTypes.ArcRotateCameraMouseWheelInput=n;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Cameras/cameraInputsManager":"H3O2","../../Events/pointerEvents":"6huE"}],"UO7W":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCameraInputsManager=void 0;var e=i(require("tslib")),t=require("../Cameras/Inputs/arcRotateCameraVRDeviceOrientationInput"),r=require("../Cameras/Inputs/arcRotateCameraPointersInput"),a=require("../Cameras/Inputs/arcRotateCameraKeyboardMoveInput"),n=require("../Cameras/Inputs/arcRotateCameraMouseWheelInput"),o=require("../Cameras/cameraInputsManager");function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};a.get||a.set?Object.defineProperty(t,r,a):t[r]=e[r]}return t.default=e,t}var u=function(o){function i(e){return o.call(this,e)||this}return e.__extends(i,o),i.prototype.addMouseWheel=function(){return this.add(new n.ArcRotateCameraMouseWheelInput),this},i.prototype.addPointers=function(){return this.add(new r.ArcRotateCameraPointersInput),this},i.prototype.addKeyboard=function(){return this.add(new a.ArcRotateCameraKeyboardMoveInput),this},i.prototype.addVRDeviceOrientation=function(){return this.add(new t.ArcRotateCameraVRDeviceOrientationInput),this},i}(o.CameraInputsManager);exports.ArcRotateCameraInputsManager=u;
},{"tslib":"vCxL","../Cameras/Inputs/arcRotateCameraVRDeviceOrientationInput":"TJBn","../Cameras/Inputs/arcRotateCameraPointersInput":"mXvb","../Cameras/Inputs/arcRotateCameraKeyboardMoveInput":"JJh1","../Cameras/Inputs/arcRotateCameraMouseWheelInput":"jK48","../Cameras/cameraInputsManager":"H3O2"}],"7z64":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArcRotateCamera=void 0;var t=d(require("tslib")),e=require("../Misc/decorators"),i=require("../Misc/observable"),a=require("../Maths/math"),r=require("../node"),o=require("../Meshes/mesh"),s=require("../Behaviors/Cameras/autoRotationBehavior"),n=require("../Behaviors/Cameras/bouncingBehavior"),h=require("../Behaviors/Cameras/framingBehavior"),c=require("../Collisions/collider"),l=require("./camera"),p=require("./targetCamera"),u=require("../Cameras/arcRotateCameraInputsManager");function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};a.get||a.set?Object.defineProperty(e,i,a):e[i]=t[i]}return e.default=t,e}r.Node.AddNodeConstructor("ArcRotateCamera",function(t,e){return function(){return new _(t,0,0,1,a.Vector3.Zero(),e)}});var _=function(r){function p(t,e,o,s,n,h,c){void 0===c&&(c=!0);var l=r.call(this,t,a.Vector3.Zero(),h,c)||this;return l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.lowerAlphaLimit=null,l.upperAlphaLimit=null,l.lowerBetaLimit=.01,l.upperBetaLimit=Math.PI-.01,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.inertialPanningX=0,l.inertialPanningY=0,l.pinchToPanMaxDistance=20,l.panningDistanceLimit=null,l.panningOriginTarget=a.Vector3.Zero(),l.panningInertia=.9,l.zoomOnFactor=1,l.targetScreenOffset=a.Vector2.Zero(),l.allowUpsideDown=!0,l.useInputToRestoreState=!0,l._viewMatrix=new a.Matrix,l.panningAxis=new a.Vector3(1,1,0),l.onMeshTargetChangedObservable=new i.Observable,l.checkCollisions=!1,l.collisionRadius=new a.Vector3(.5,.5,.5),l._previousPosition=a.Vector3.Zero(),l._collisionVelocity=a.Vector3.Zero(),l._newPosition=a.Vector3.Zero(),l._computationVector=a.Vector3.Zero(),l._onCollisionPositionChange=function(t,e,i){void 0===i&&(i=null),i?(l.setPosition(e),l.onCollide&&l.onCollide(i)):l._previousPosition.copyFrom(l.position);var a=Math.cos(l.alpha),r=Math.sin(l.alpha),o=Math.cos(l.beta),s=Math.sin(l.beta);0===s&&(s=1e-4);var n=l._getTargetPosition();l._computationVector.copyFromFloats(l.radius*a*s,l.radius*o,l.radius*r*s),n.addToRef(l._computationVector,l._newPosition),l.position.copyFrom(l._newPosition);var h=l.upVector;l.allowUpsideDown&&l.beta<0&&(h=(h=h.clone()).negate()),l._computeViewMatrix(l.position,n,h),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},l._target=a.Vector3.Zero(),n&&l.setTarget(n),l.alpha=e,l.beta=o,l.radius=s,l.getViewMatrix(),l.inputs=new u.ArcRotateCameraInputsManager(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}return t.__extends(p,r),Object.defineProperty(p.prototype,"target",{get:function(){return this._target},set:function(t){this.setTarget(t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"angularSensibilityX",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.angularSensibilityX=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"angularSensibilityY",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.angularSensibilityY=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"pinchPrecision",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchPrecision:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.pinchPrecision=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"pinchDeltaPercentage",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.pinchDeltaPercentage=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"panningSensibility",{get:function(){var t=this.inputs.attached.pointers;return t?t.panningSensibility:0},set:function(t){var e=this.inputs.attached.pointers;e&&(e.panningSensibility=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysUp=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysDown=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var e=this.inputs.attached.keyboard;e&&(e.keysRight=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"wheelPrecision",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.wheelPrecision=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"wheelDeltaPercentage",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0},set:function(t){var e=this.inputs.attached.mousewheel;e&&(e.wheelDeltaPercentage=t)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new n.BouncingBehavior,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new h.FramingBehavior,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new s.AutoRotationBehavior,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),p.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache._target=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=a.Vector2.Zero()},p.prototype._updateCache=function(t){t||r.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},p.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var t=this._targetHost.absolutePosition;this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}var e=this._getLockedTargetPosition();return e||this._target},p.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),r.prototype.storeState.call(this)},p.prototype._restoreStateValues=function(){return!!r.prototype._restoreStateValues.call(this)&&(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},p.prototype._isSynchronizedViewMatrix=function(){return!!r.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},p.prototype.attachControl=function(t,e,i,a){var r=this;void 0===i&&(i=!0),void 0===a&&(a=2),this._useCtrlForPanning=i,this._panningMouseButton=a,this.inputs.attachElement(t,e),this._reset=function(){r.inertialAlphaOffset=0,r.inertialBetaOffset=0,r.inertialRadiusOffset=0,r.inertialPanningX=0,r.inertialPanningY=0}},p.prototype.detachControl=function(t){this.inputs.detachElement(t),this._reset&&this._reset()},p.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var t=this.inertialAlphaOffset;this.beta<=0&&(t*=-1),this.getScene().useRightHandedSystem&&(t*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),this.alpha+=t,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<a.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<a.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*a.Epsilon&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){if(this._localDirection||(this._localDirection=a.Vector3.Zero(),this._transformedDirection=a.Vector3.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),a.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),a.Vector3.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*a.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*a.Epsilon&&(this.inertialPanningY=0)}this._checkLimits(),r.prototype._checkInputs.call(this)}},p.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},p.prototype.rebuildAnglesAndRadius=function(){this.position.subtractToRef(this._getTargetPosition(),this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},p.prototype.setPosition=function(t){this.position.equals(t)||(this.position.copyFrom(t),this.rebuildAnglesAndRadius())},p.prototype.setTarget=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),t.getBoundingInfo)this._targetBoundingCenter=e?t.getBoundingInfo().boundingBox.centerWorld.clone():null,this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var a=t,r=this._getTargetPosition();if(r&&!i&&r.equals(a))return;this._targetHost=null,this._target=a,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},p.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),e=Math.sin(this.alpha),i=Math.cos(this.beta),r=Math.sin(this.beta);0===r&&(r=1e-4);var o=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*r,this.radius*i,this.radius*e*r),0!==this.upVector.x||1!==this.upVector.y||0!==this.upVector.z){this._tempAxisVector||(this._tempAxisVector=new a.Vector3,this._tempAxisRotationMatrix=new a.Matrix),a.Vector3.CrossToRef(a.Vector3.Up(),this.upVector,this._tempAxisVector),this._tempAxisVector.normalize();var s=Math.acos(a.Vector3.Dot(a.Vector3.UpReadOnly,this.upVector));a.Matrix.RotationAxisToRef(this._tempAxisVector,s,this._tempAxisRotationMatrix),this._tempAxisVector.copyFrom(this._computationVector),a.Vector3.TransformCoordinatesToRef(this._tempAxisVector,this._tempAxisRotationMatrix,this._computationVector)}if(o.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider||(this._collider=new c.Collider),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var n=this.upVector;this.allowUpsideDown&&r<0&&(n=(n=n.clone()).negate()),this._computeViewMatrix(this.position,o,n),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=o,this._viewMatrix},p.prototype.zoomOn=function(t,e){void 0===e&&(e=!1),t=t||this.getScene().meshes;var i=o.Mesh.MinMax(t),r=a.Vector3.Distance(i.min,i.max);this.radius=r*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:r},e)},p.prototype.focusOn=function(t,e){var i,r;if(void 0===e&&(e=!1),void 0===t.min){var s=t||this.getScene().meshes;i=o.Mesh.MinMax(s),r=a.Vector3.Distance(i.min,i.max)}else{i=t,r=t.distance}this._target=o.Mesh.Center(i),e||(this.maxZ=2*r)},p.prototype.createRigCamera=function(t,e){var i=0;switch(this.cameraRigMode){case l.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case l.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case l.Camera.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===e?1:-1);break;case l.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===e?-1:1)}var a=new p(t,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return a._cameraRigParams={},a},p.prototype._updateRigCameras=function(){var t=this._rigCameras[0],e=this._rigCameras[1];switch(t.beta=e.beta=this.beta,this.cameraRigMode){case l.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case l.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case l.Camera.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case l.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}r.prototype._updateRigCameras.call(this)},p.prototype.dispose=function(){this.inputs.clear(),r.prototype.dispose.call(this)},p.prototype.getClassName=function(){return"ArcRotateCamera"},t.__decorate([(0,e.serialize)()],p.prototype,"alpha",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"beta",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"radius",void 0),t.__decorate([(0,e.serializeAsVector3)("target")],p.prototype,"_target",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"inertialAlphaOffset",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"inertialBetaOffset",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"inertialRadiusOffset",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"lowerAlphaLimit",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"upperAlphaLimit",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"lowerBetaLimit",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"upperBetaLimit",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"lowerRadiusLimit",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"upperRadiusLimit",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"inertialPanningX",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"inertialPanningY",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"pinchToPanMaxDistance",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"panningDistanceLimit",void 0),t.__decorate([(0,e.serializeAsVector3)()],p.prototype,"panningOriginTarget",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"panningInertia",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"zoomOnFactor",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"targetScreenOffset",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"allowUpsideDown",void 0),t.__decorate([(0,e.serialize)()],p.prototype,"useInputToRestoreState",void 0),p}(p.TargetCamera);exports.ArcRotateCamera=_;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Misc/observable":"gtkL","../Maths/math":"Iizi","../node":"P+He","../Meshes/mesh":"aXN+","../Behaviors/Cameras/autoRotationBehavior":"rAGZ","../Behaviors/Cameras/bouncingBehavior":"8sKY","../Behaviors/Cameras/framingBehavior":"YqVX","../Collisions/collider":"Lnna","./camera":"ZyNI","./targetCamera":"Np0R","../Cameras/arcRotateCameraInputsManager":"UO7W"}],"JO9C":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GenericPad=exports.Gamepad=exports.StickValues=void 0;var t=i(require("tslib")),e=require("../Misc/observable");function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};s.get||s.set?Object.defineProperty(e,i,s):e[i]=t[i]}return e.default=t,e}var s=function(){return function(t,e){this.x=t,this.y=e}}();exports.StickValues=s;var o=function(){function t(e,i,s,o,r,n,h){void 0===o&&(o=0),void 0===r&&(r=1),void 0===n&&(n=2),void 0===h&&(h=3),this.id=e,this.index=i,this.browserGamepad=s,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=t.GAMEPAD,this._leftStickAxisX=o,this._leftStickAxisY=r,this._rightStickAxisX=n,this._rightStickAxisY=h,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(t.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),t.prototype.onleftstickchanged=function(t){this._onleftstickchanged=t},t.prototype.onrightstickchanged=function(t){this._onrightstickchanged=t},Object.defineProperty(t.prototype,"leftStick",{get:function(){return this._leftStick},set:function(t){!this._onleftstickchanged||this._leftStick.x===t.x&&this._leftStick.y===t.y||this._onleftstickchanged(t),this._leftStick=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightStick",{get:function(){return this._rightStick},set:function(t){!this._onrightstickchanged||this._rightStick.x===t.x&&this._rightStick.y===t.y||this._onrightstickchanged(t),this._rightStick=t},enumerable:!0,configurable:!0}),t.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},t.prototype.dispose=function(){},t.GAMEPAD=0,t.GENERIC=1,t.XBOX=2,t.POSE_ENABLED=3,t}();exports.Gamepad=o;var r=function(i){function s(t,s,r){var n=i.call(this,t,s,r)||this;return n.onButtonDownObservable=new e.Observable,n.onButtonUpObservable=new e.Observable,n.type=o.GENERIC,n._buttons=new Array(r.buttons.length),n}return t.__extends(s,i),s.prototype.onbuttondown=function(t){this._onbuttondown=t},s.prototype.onbuttonup=function(t){this._onbuttonup=t},s.prototype._setButtonValue=function(t,e,i){return t!==e&&(1===t&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===t&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),t},s.prototype.update=function(){i.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.browserGamepad.buttons[t].value,this._buttons[t],t)},s.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},s}(o);exports.GenericPad=r;
},{"tslib":"vCxL","../Misc/observable":"gtkL"}],"seX3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PoseEnabledController=exports.PoseEnabledControllerHelper=exports.PoseEnabledControllerType=void 0;var t,e=s(require("tslib")),o=require("../../Misc/observable"),i=require("../../Maths/math"),n=require("../../Culling/ray"),r=require("../../Engines/engineStore"),a=require("../../Gamepads/gamepad");function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,o):{};i.get||i.set?Object.defineProperty(e,o,i):e[o]=t[o]}return e.default=t,e}exports.PoseEnabledControllerType=t,function(t){t[t.VIVE=0]="VIVE",t[t.OCULUS=1]="OCULUS",t[t.WINDOWS=2]="WINDOWS",t[t.GEAR_VR=3]="GEAR_VR",t[t.DAYDREAM=4]="DAYDREAM",t[t.GENERIC=5]="GENERIC"}(t||(exports.PoseEnabledControllerType=t={}));var c=function(){function t(){}return t.InitiateController=function(t){for(var e=0,o=this._ControllerFactories;e<o.length;e++){var i=o[e];if(i.canCreate(t))return i.create(t)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(t);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},t._ControllerFactories=[],t._DefaultControllerFactory=null,t}();exports.PoseEnabledControllerHelper=c;var l=function(s){function c(e){var n=s.call(this,e.id,e.index,e)||this;return n._deviceRoomPosition=i.Vector3.Zero(),n._deviceRoomRotationQuaternion=new i.Quaternion,n.devicePosition=i.Vector3.Zero(),n.deviceRotationQuaternion=new i.Quaternion,n.deviceScaleFactor=1,n._trackPosition=!0,n._maxRotationDistFromHeadset=Math.PI/5,n._draggedRoomRotation=0,n._leftHandSystemQuaternion=new i.Quaternion,n._deviceToWorld=i.Matrix.Identity(),n._pointingPoseNode=null,n._workingMatrix=i.Matrix.Identity(),n._meshAttachedObservable=new o.Observable,n.type=a.Gamepad.POSE_ENABLED,n.controllerType=t.GENERIC,n.position=i.Vector3.Zero(),n.rotationQuaternion=new i.Quaternion,n._calculatedPosition=i.Vector3.Zero(),n._calculatedRotation=new i.Quaternion,i.Quaternion.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return e.__extends(c,s),c.prototype._disableTrackPosition=function(t){this._trackPosition&&(this._calculatedPosition.copyFrom(t),this._trackPosition=!1)},c.prototype.update=function(){s.prototype.update.call(this),this._updatePoseAndMesh()},c.prototype._updatePoseAndMesh=function(){var t=this.browserGamepad.pose;if((this.updateFromDevice(t),!this._trackPosition&&r.EngineStore.LastCreatedScene&&r.EngineStore.LastCreatedScene.activeCamera&&r.EngineStore.LastCreatedScene.activeCamera.devicePosition)&&((e=r.EngineStore.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(e.devicePosition),e.deviceRotationQuaternion)){var e;(e=e)._deviceRoomRotationQuaternion.toEulerAnglesToRef(i.Tmp.Vector3[0]);var o=Math.atan2(Math.sin(i.Tmp.Vector3[0].y-this._draggedRoomRotation),Math.cos(i.Tmp.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(o)>this._maxRotationDistFromHeadset){var n=o-(o<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=n;var a=Math.sin(-n),s=Math.cos(-n);this._calculatedPosition.x=this._calculatedPosition.x*s-this._calculatedPosition.z*a,this._calculatedPosition.z=this._calculatedPosition.x*a+this._calculatedPosition.z*s}}i.Vector3.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),i.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},c.prototype.updateFromDevice=function(t){if(t){this.rawPose=t,t.position&&(this._deviceRoomPosition.copyFromFloats(t.position[0],t.position[1],-t.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var e=this.rawPose;t.orientation&&e.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},c.prototype.attachToMesh=function(t){if(this._mesh&&(this._mesh.parent=null),this._mesh=t,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new i.Quaternion),this._updatePoseAndMesh(),this._pointingPoseNode){for(var e=[],o=this._pointingPoseNode;o.parent;)e.push(o.parent),o=o.parent;e.reverse().forEach(function(t){t.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(t)},c.prototype.attachToPoseControlledCamera=function(t){this._poseControlledCamera=t,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},c.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,s.prototype.dispose.call(this)},Object.defineProperty(c.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),c.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this.mesh)return new n.Ray(i.Vector3.Zero(),new i.Vector3(0,0,1),t);var e=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),o=e.getTranslation(),r=new i.Vector3(0,0,-1),a=i.Vector3.TransformNormal(r,e),s=i.Vector3.Normalize(a);return new n.Ray(o,s,t)},c.POINTING_POSE="POINTING_POSE",c}(a.Gamepad);exports.PoseEnabledController=l;
},{"tslib":"vCxL","../../Misc/observable":"gtkL","../../Maths/math":"Iizi","../../Culling/ray":"5ppN","../../Engines/engineStore":"n+VE","../../Gamepads/gamepad":"JO9C"}],"uh0e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Xbox360Pad=exports.Xbox360Dpad=exports.Xbox360Button=void 0;var t,e,o=r(require("tslib")),n=require("../Misc/observable"),i=require("../Gamepads/gamepad");function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,o):{};n.get||n.set?Object.defineProperty(e,o,n):e[o]=t[o]}return e.default=t,e}exports.Xbox360Button=t,function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.X=2]="X",t[t.Y=3]="Y",t[t.Start=4]="Start",t[t.Back=5]="Back",t[t.LB=6]="LB",t[t.RB=7]="RB",t[t.LeftStick=8]="LeftStick",t[t.RightStick=9]="RightStick"}(t||(exports.Xbox360Button=t={})),exports.Xbox360Dpad=e,function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(e||(exports.Xbox360Dpad=e={}));var s=function(r){function s(t,e,o,s){void 0===s&&(s=!1);var u=r.call(this,t,e,o,0,1,2,3)||this;return u._leftTrigger=0,u._rightTrigger=0,u.onButtonDownObservable=new n.Observable,u.onButtonUpObservable=new n.Observable,u.onPadDownObservable=new n.Observable,u.onPadUpObservable=new n.Observable,u._buttonA=0,u._buttonB=0,u._buttonX=0,u._buttonY=0,u._buttonBack=0,u._buttonStart=0,u._buttonLB=0,u._buttonRB=0,u._buttonLeftStick=0,u._buttonRightStick=0,u._dPadUp=0,u._dPadDown=0,u._dPadLeft=0,u._dPadRight=0,u._isXboxOnePad=!1,u.type=i.Gamepad.XBOX,u._isXboxOnePad=s,u}return o.__extends(s,r),s.prototype.onlefttriggerchanged=function(t){this._onlefttriggerchanged=t},s.prototype.onrighttriggerchanged=function(t){this._onrighttriggerchanged=t},Object.defineProperty(s.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(t){this._onlefttriggerchanged&&this._leftTrigger!==t&&this._onlefttriggerchanged(t),this._leftTrigger=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(t){this._onrighttriggerchanged&&this._rightTrigger!==t&&this._onrighttriggerchanged(t),this._rightTrigger=t},enumerable:!0,configurable:!0}),s.prototype.onbuttondown=function(t){this._onbuttondown=t},s.prototype.onbuttonup=function(t){this._onbuttonup=t},s.prototype.ondpaddown=function(t){this._ondpaddown=t},s.prototype.ondpadup=function(t){this._ondpadup=t},s.prototype._setButtonValue=function(t,e,o){return t!==e&&(1===t&&(this._onbuttondown&&this._onbuttondown(o),this.onButtonDownObservable.notifyObservers(o)),0===t&&(this._onbuttonup&&this._onbuttonup(o),this.onButtonUpObservable.notifyObservers(o))),t},s.prototype._setDPadValue=function(t,e,o){return t!==e&&(1===t&&(this._ondpaddown&&this._ondpaddown(o),this.onPadDownObservable.notifyObservers(o)),0===t&&(this._ondpadup&&this._ondpadup(o),this.onPadUpObservable.notifyObservers(o))),t},Object.defineProperty(s.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,t.A)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,t.B)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,t.X)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,t.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,t.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,t.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,t.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,t.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,t.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,t.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(t){this._dPadUp=this._setDPadValue(t,this._dPadUp,e.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(t){this._dPadDown=this._setDPadValue(t,this._dPadDown,e.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(t){this._dPadLeft=this._setDPadValue(t,this._dPadLeft,e.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(t){this._dPadRight=this._setDPadValue(t,this._dPadRight,e.Right)},enumerable:!0,configurable:!0}),s.prototype.update=function(){r.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.axes[2],this.rightTrigger=this.browserGamepad.axes[5],this.buttonBack=this.browserGamepad.buttons[9].value,this.buttonStart=this.browserGamepad.buttons[8].value,this.buttonLeftStick=this.browserGamepad.buttons[6].value,this.buttonRightStick=this.browserGamepad.buttons[7].value,this.dPadUp=this.browserGamepad.buttons[11].value,this.dPadDown=this.browserGamepad.buttons[12].value,this.dPadLeft=this.browserGamepad.buttons[13].value,this.dPadRight=this.browserGamepad.buttons[14].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},s.prototype.dispose=function(){r.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},s}(i.Gamepad);exports.Xbox360Pad=s;
},{"tslib":"vCxL","../Misc/observable":"gtkL","../Gamepads/gamepad":"JO9C"}],"f8eF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GamepadManager=void 0;var e=require("../Misc/tools"),a=require("../Misc/observable"),n=require("../Misc/domManagement"),t=require("../Gamepads/Controllers/poseEnabledController"),o=require("./xboxGamepad"),i=require("./gamepad"),s=function(){function s(e){var t=this;this._scene=e,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new a.Observable,n.DomManagement.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new a.Observable(function(e){for(var a in t._babylonGamepads){var n=t._babylonGamepads[a];n&&n._isConnected&&t.onGamepadConnectedObservable.notifyObserver(e,n)}}),this._onGamepadConnectedEvent=function(e){var a,n=e.gamepad;n.index in t._babylonGamepads&&t._babylonGamepads[n.index].isConnected||(t._babylonGamepads[n.index]?((a=t._babylonGamepads[n.index]).browserGamepad=n,a._isConnected=!0):a=t._addNewGamepad(n),t.onGamepadConnectedObservable.notifyObservers(a),t._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(e){var a=e.gamepad;for(var n in t._babylonGamepads)if(t._babylonGamepads[n].index===a.index){var o=t._babylonGamepads[n];o._isConnected=!1,t.onGamepadDisconnectedObservable.notifyObservers(o);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(s.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),s.prototype.getGamepadByType=function(e){void 0===e&&(e=i.Gamepad.XBOX);for(var a=0,n=this._babylonGamepads;a<n.length;a++){var t=n[a];if(t&&t.type===e)return t}return null},s.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(e){e.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},s.prototype._addNewGamepad=function(e){var a;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var n=-1!==e.id.search("Xbox One");return a=n||-1!==e.id.search("Xbox 360")||-1!==e.id.search("xinput")?new o.Xbox360Pad(e.id,e.index,e,n):e.pose?t.PoseEnabledControllerHelper.InitiateController(e):new i.GenericPad(e.id,e.index,e),this._babylonGamepads[a.index]=a,a},s.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},s.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},s.prototype._checkGamepadsStatus=function(){var a=this;for(var n in this._updateGamepadObjects(),this._babylonGamepads){var t=this._babylonGamepads[n];t&&t.isConnected&&t.update()}this._isMonitoring&&!this._scene&&e.Tools.QueueNewFrame(function(){a._checkGamepadsStatus()})},s.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],a=0;a<e.length;a++){var n=e[a];if(n)if(this._babylonGamepads[n.index])this._babylonGamepads[a].browserGamepad=n,this._babylonGamepads[a].isConnected||(this._babylonGamepads[a]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[a]));else{var t=this._addNewGamepad(n);this.onGamepadConnectedObservable.notifyObservers(t)}}},s}();exports.GamepadManager=s;
},{"../Misc/tools":"RkuS","../Misc/observable":"gtkL","../Misc/domManagement":"+D0i","../Gamepads/Controllers/poseEnabledController":"seX3","./xboxGamepad":"uh0e","./gamepad":"JO9C"}],"Z8ce":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TouchCamera=void 0;var e=o(require("tslib")),t=require("./freeCamera"),r=require("../Maths/math"),n=require("../node");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}n.Node.AddNodeConstructor("TouchCamera",function(e,t){return function(){return new u(e,r.Vector3.Zero(),t)}});var u=function(t){function r(e,r,n){var o=t.call(this,e,r,n)||this;return o.inputs.addTouch(),o._setupInputs(),o}return e.__extends(r,t),Object.defineProperty(r.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchMoveSensibility=e)},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"TouchCamera"},r.prototype._setupInputs=function(){var e=this.inputs.attached.mouse;e&&(e.touchEnabled=!1)},r}(t.FreeCamera);exports.TouchCamera=u;
},{"tslib":"vCxL","./freeCamera":"1Ewv","../Maths/math":"Iizi","../node":"P+He"}],"X50r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UniversalCamera=void 0;var e=i(require("tslib")),t=require("./touchCamera"),r=require("../node"),a=require("../Maths/math"),n=require("./camera");function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};a.get||a.set?Object.defineProperty(t,r,a):t[r]=e[r]}return t.default=e,t}r.Node.AddNodeConstructor("FreeCamera",function(e,t){return function(){return new o(e,a.Vector3.Zero(),t)}});var o=function(t){function r(e,r,a){var n=t.call(this,e,r,a)||this;return n.inputs.addGamepad(),n}return e.__extends(r,t),Object.defineProperty(r.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"UniversalCamera"},r}(t.TouchCamera);exports.UniversalCamera=o,n.Camera._createDefaultParsedCamera=function(e,t){return new o(e,a.Vector3.Zero(),t)};
},{"tslib":"vCxL","./touchCamera":"Z8ce","../node":"P+He","../Maths/math":"Iizi","./camera":"ZyNI"}],"N8Ph":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HemisphericLight=void 0;var r=n(require("tslib")),t=require("../Misc/decorators"),e=require("../Maths/math"),o=require("../node"),i=require("./light");function n(r){if(r&&r.__esModule)return r;var t={};if(null!=r)for(var e in r)if(Object.prototype.hasOwnProperty.call(r,e)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(r,e):{};o.get||o.set?Object.defineProperty(t,e,o):t[e]=r[e]}return t.default=r,t}o.Node.AddNodeConstructor("Light_Type_3",function(r,t){return function(){return new u(r,e.Vector3.Zero(),t)}});var u=function(o){function n(r,t,i){var n=o.call(this,r,i)||this;return n.groundColor=new e.Color3(0,0,0),n.direction=t||e.Vector3.Up(),n}return r.__extends(n,o),n.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},n.prototype.getClassName=function(){return"HemisphericLight"},n.prototype.setDirectionToTarget=function(r){return this.direction=e.Vector3.Normalize(r.subtract(e.Vector3.Zero())),this.direction},n.prototype.getShadowGenerator=function(){return null},n.prototype.transferToEffect=function(r,t){var o=e.Vector3.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",o.x,o.y,o.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this},n.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},n.prototype.getTypeID=function(){return i.Light.LIGHTTYPEID_HEMISPHERICLIGHT},n.prototype.prepareLightSpecificDefines=function(r,t){r["HEMILIGHT"+t]=!0},r.__decorate([(0,t.serializeAsColor3)()],n.prototype,"groundColor",void 0),r.__decorate([(0,t.serializeAsVector3)()],n.prototype,"direction",void 0),n}(i.Light);exports.HemisphericLight=u;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi","../node":"P+He","./light":"U3iz"}],"S8Iy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShadowLight=void 0;var t=r(require("tslib")),i=require("../Misc/decorators"),o=require("../Maths/math"),e=require("./light");function r(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var e=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,o):{};e.get||e.set?Object.defineProperty(i,o,e):i[o]=t[o]}return i.default=t,i}var n=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._needProjectionMatrixCompute=!0,t}return t.__extends(r,e),r.prototype._setPosition=function(t){this._position=t},Object.defineProperty(r.prototype,"position",{get:function(){return this._position},set:function(t){this._setPosition(t)},enumerable:!0,configurable:!0}),r.prototype._setDirection=function(t){this._direction=t},Object.defineProperty(r.prototype,"direction",{get:function(){return this._direction},set:function(t){this._setDirection(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(t){this._shadowMinZ=t,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(t){this._shadowMaxZ=t,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),r.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=o.Vector3.Zero()),o.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=o.Vector3.Zero()),o.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},r.prototype.getDepthScale=function(){return 50},r.prototype.getShadowDirection=function(t){return this.transformedDirection?this.transformedDirection:this.direction},r.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},r.prototype.setDirectionToTarget=function(t){return this.direction=o.Vector3.Normalize(t.subtract(this.position)),this.direction},r.prototype.getRotation=function(){this.direction.normalize();var t=o.Vector3.Cross(this.direction,o.Axis.Y),i=o.Vector3.Cross(t,this.direction);return o.Vector3.RotationFromAxis(t,i,this.direction)},r.prototype.needCube=function(){return!1},r.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},r.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},r.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=o.Vector3.Zero()},r.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},r.prototype.computeWorldMatrix=function(t){return!t&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=o.Matrix.Identity()),o.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix)},r.prototype.getDepthMinZ=function(t){return void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ},r.prototype.getDepthMaxZ=function(t){return void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ},r.prototype.setShadowProjectionMatrix=function(t,i,o){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(i,o,t):this._setDefaultShadowProjectionMatrix(t,i,o),this},t.__decorate([(0,i.serializeAsVector3)()],r.prototype,"position",null),t.__decorate([(0,i.serializeAsVector3)()],r.prototype,"direction",null),t.__decorate([(0,i.serialize)()],r.prototype,"shadowMinZ",null),t.__decorate([(0,i.serialize)()],r.prototype,"shadowMaxZ",null),r}(e.Light);exports.ShadowLight=n;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi","./light":"U3iz"}],"mO+F":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SpotLight=void 0;var t=c(require("tslib")),e=require("../Misc/decorators"),i=require("../Maths/math"),r=require("../node"),o=require("./light"),n=require("./shadowLight");function c(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,i):{};r.get||r.set?Object.defineProperty(e,i,r):e[i]=t[i]}return e.default=t,e}r.Node.AddNodeConstructor("Light_Type_2",function(t,e){return function(){return new u(t,i.Vector3.Zero(),i.Vector3.Zero(),0,0,e)}});var u=function(r){function n(t,e,o,n,c,u){var p=r.call(this,t,u)||this;return p._innerAngle=0,p._projectionTextureMatrix=i.Matrix.Zero(),p._projectionTextureLightNear=1e-6,p._projectionTextureLightFar=1e3,p._projectionTextureUpDirection=i.Vector3.Up(),p._projectionTextureViewLightDirty=!0,p._projectionTextureProjectionLightDirty=!0,p._projectionTextureDirty=!0,p._projectionTextureViewTargetVector=i.Vector3.Zero(),p._projectionTextureViewLightMatrix=i.Matrix.Zero(),p._projectionTextureProjectionLightMatrix=i.Matrix.Zero(),p._projectionTextureScalingMatrix=i.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),p.position=e,p.direction=o,p.angle=n,p.exponent=c,p}return t.__extends(n,r),Object.defineProperty(n.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._cosHalfAngle=Math.cos(.5*t),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(t){this._innerAngle=t,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(t){this._shadowAngleScale=t,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(t){this._projectionTextureLightNear=t,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(t){this._projectionTextureLightFar=t,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(t){this._projectionTextureUpDirection=t,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(t){this._projectionTexture=t,this._projectionTextureDirty=!0},enumerable:!0,configurable:!0}),n.prototype.getClassName=function(){return"SpotLight"},n.prototype.getTypeID=function(){return o.Light.LIGHTTYPEID_SPOTLIGHT},n.prototype._setDirection=function(t){r.prototype._setDirection.call(this,t),this._projectionTextureViewLightDirty=!0},n.prototype._setPosition=function(t){r.prototype._setPosition.call(this,t),this._projectionTextureViewLightDirty=!0},n.prototype._setDefaultShadowProjectionMatrix=function(t,e,r){var o=this.getScene().activeCamera;if(o){this._shadowAngleScale=this._shadowAngleScale||1;var n=this._shadowAngleScale*this._angle;i.Matrix.PerspectiveFovLHToRef(n,1,this.getDepthMinZ(o),this.getDepthMaxZ(o),t)}},n.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),i.Matrix.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},n.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var t=this.projectionTextureLightFar,e=this.projectionTextureLightNear,r=t/(t-e),o=-r*e,n=1/Math.tan(this._angle/2);i.Matrix.FromValuesToRef(n/1,0,0,0,0,n,0,0,0,0,r,1,0,0,o,0,this._projectionTextureProjectionLightMatrix)},n.prototype._computeProjectionTextureMatrix=function(){this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},n.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},n.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},n.prototype.transferToEffect=function(t,e){var r;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,e),r=i.Vector3.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,e),r=i.Vector3.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",r.x,r.y,r.z,this._cosHalfAngle,e),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,e),this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),t.setMatrix("textureProjectionMatrix"+e,this._projectionTextureMatrix),t.setTexture("projectionLightSampler"+e,this.projectionTexture)),this},n.prototype.dispose=function(){r.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},n.prototype.prepareLightSpecificDefines=function(t,e){t["SPOTLIGHT"+e]=!0,t["PROJECTEDLIGHTTEXTURE"+e]=!!this.projectionTexture},t.__decorate([(0,e.serialize)()],n.prototype,"angle",null),t.__decorate([(0,e.serialize)()],n.prototype,"innerAngle",null),t.__decorate([(0,e.serialize)()],n.prototype,"shadowAngleScale",null),t.__decorate([(0,e.serialize)()],n.prototype,"exponent",void 0),t.__decorate([(0,e.serialize)()],n.prototype,"projectionTextureLightNear",null),t.__decorate([(0,e.serialize)()],n.prototype,"projectionTextureLightFar",null),t.__decorate([(0,e.serialize)()],n.prototype,"projectionTextureUpDirection",null),t.__decorate([(0,e.serializeAsTexture)("projectedLightTexture")],n.prototype,"_projectionTexture",void 0),n}(n.ShadowLight);exports.SpotLight=u;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi","../node":"P+He","./light":"U3iz","./shadowLight":"S8Iy"}],"ZeQ6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstancedMesh=void 0;var e=o(require("tslib")),t=require("../Misc/logger"),r=require("../Meshes/abstractMesh"),s=require("../Meshes/mesh"),n=require("../Misc/deepCopier");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};s.get||s.set?Object.defineProperty(t,r,s):t[r]=e[r]}return t.default=e,t}s.Mesh._instancedMeshFactory=function(e,t){return new i(e,t)};var i=function(r){function s(e,t){var s=r.call(this,e,t.getScene())||this;return s._indexInSourceMeshInstanceArray=-1,t.addInstance(s),s._sourceMesh=t,s.position.copyFrom(t.position),s.rotation.copyFrom(t.rotation),s.scaling.copyFrom(t.scaling),t.rotationQuaternion&&(s.rotationQuaternion=t.rotationQuaternion.clone()),s.infiniteDistance=t.infiniteDistance,s.setPivotMatrix(t.getPivotMatrix()),s.refreshBoundingInfo(),s._syncSubMeshes(),s}return e.__extends(s,r),s.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(s.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&t.Logger.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),s.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},s.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(s.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),s.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},s.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},s.prototype.setVerticesData=function(e,t,r,s){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,r,s),this.sourceMesh},s.prototype.updateVerticesData=function(e,t,r,s){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,r,s),this.sourceMesh},s.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},s.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},s.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(s.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),s.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},s.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},s.prototype._activate=function(e){return this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e),this},s.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},s.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},s.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},s.prototype.clone=function(e,t,r){var s=this._sourceMesh.createInstance(e);if(n.DeepCopier.DeepCopy(this,s,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),t&&(s.parent=t),!r)for(var o=0;o<this.getScene().meshes.length;o++){var i=this.getScene().meshes[o];i.parent===this&&i.clone(i.name,s)}return s.computeWorldMatrix(!0),s},s.prototype.dispose=function(e,t){void 0===t&&(t=!1),this._sourceMesh.removeInstance(this),r.prototype.dispose.call(this,e,t)},s}(r.AbstractMesh);exports.InstancedMesh=i;
},{"tslib":"vCxL","../Misc/logger":"Fvml","../Meshes/abstractMesh":"Nnvo","../Meshes/mesh":"aXN+","../Misc/deepCopier":"RVA4"}],"DR7Q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MaterialHelper=void 0;var e=require("../Misc/logger"),r=require("../scene"),t=require("../Maths/math"),o=require("../Engines/engineStore"),i=require("../Meshes/buffer"),n=require("../Lights/light"),a=function(){function a(){}return a.BindEyePosition=function(e,r){r._forcedViewPosition?e.setVector3("vEyePosition",r._forcedViewPosition):e.setVector3("vEyePosition",r._mirroredCameraPosition?r._mirroredCameraPosition:r.activeCamera.globalPosition)},a.PrepareDefinesForMergedUV=function(e,r,t){r._needUVs=!0,r[t]=!0,e.getTextureMatrix().isIdentityAs3x2()?(r[t+"DIRECTUV"]=e.coordinatesIndex+1,0===e.coordinatesIndex?r.MAINUV1=!0:r.MAINUV2=!0):r[t+"DIRECTUV"]=0},a.BindTextureMatrix=function(e,r,t){var o=e.getTextureMatrix();o.isIdentityAs3x2()||r.updateMatrix(t+"Matrix",o)},a.PrepareDefinesForMisc=function(e,t,o,i,n,a,s){s._areMiscDirty&&(s.LOGARITHMICDEPTH=o,s.POINTSIZE=i,s.FOG=t.fogEnabled&&e.applyFog&&t.fogMode!==r.Scene.FOGMODE_NONE&&n,s.NONUNIFORMSCALING=e.nonUniformScaling,s.ALPHATEST=a)},a.PrepareDefinesForFrameBoundValues=function(e,r,t,o,i){void 0===i&&(i=null);var n,a,s,l,u=!1;n=null==i?void 0!==e.clipPlane&&null!==e.clipPlane:i,a=null==i?void 0!==e.clipPlane2&&null!==e.clipPlane2:i,s=null==i?void 0!==e.clipPlane3&&null!==e.clipPlane3:i,l=null==i?void 0!==e.clipPlane4&&null!==e.clipPlane4:i,t.CLIPPLANE!==n&&(t.CLIPPLANE=n,u=!0),t.CLIPPLANE2!==a&&(t.CLIPPLANE2=a,u=!0),t.CLIPPLANE3!==s&&(t.CLIPPLANE3=s,u=!0),t.CLIPPLANE4!==l&&(t.CLIPPLANE4=l,u=!0),t.DEPTHPREPASS!==!r.getColorWrite()&&(t.DEPTHPREPASS=!t.DEPTHPREPASS,u=!0),t.INSTANCES!==o&&(t.INSTANCES=o,u=!0),u&&t.markAsUnprocessed()},a.PrepareDefinesForAttributes=function(e,r,t,o,n,a){if(void 0===n&&(n=!1),void 0===a&&(a=!0),!r._areAttributesDirty&&r._needNormals===r._normals&&r._needUVs===r._uvs)return!1;if(r._normals=r._needNormals,r._uvs=r._needUVs,r.NORMAL=r._needNormals&&e.isVerticesDataPresent(i.VertexBuffer.NormalKind),r._needNormals&&e.isVerticesDataPresent(i.VertexBuffer.TangentKind)&&(r.TANGENT=!0),r._needUVs?(r.UV1=e.isVerticesDataPresent(i.VertexBuffer.UVKind),r.UV2=e.isVerticesDataPresent(i.VertexBuffer.UV2Kind)):(r.UV1=!1,r.UV2=!1),t){var s=e.useVertexColors&&e.isVerticesDataPresent(i.VertexBuffer.ColorKind);r.VERTEXCOLOR=s,r.VERTEXALPHA=e.hasVertexAlpha&&s&&a}if(o)if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){r.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var l=void 0!==r.BONETEXTURE;e.skeleton.isUsingTextureForMatrices&&l?r.BONETEXTURE=!0:(r.BonesPerMesh=e.skeleton.bones.length+1,r.BONETEXTURE=!l&&void 0)}else r.NUM_BONE_INFLUENCERS=0,r.BonesPerMesh=0;if(n){var u=e.morphTargetManager;u?(r.MORPHTARGETS_TANGENT=u.supportsTangents&&r.TANGENT,r.MORPHTARGETS_NORMAL=u.supportsNormals&&r.NORMAL,r.MORPHTARGETS=u.numInfluencers>0,r.NUM_MORPH_INFLUENCERS=u.numInfluencers):(r.MORPHTARGETS_TANGENT=!1,r.MORPHTARGETS_NORMAL=!1,r.MORPHTARGETS=!1,r.NUM_MORPH_INFLUENCERS=0)}return!0},a.PrepareDefinesForLights=function(e,r,t,o,i,a){if(void 0===i&&(i=4),void 0===a&&(a=!1),!t._areLightsDirty)return t._needNormals;var s=0,l=!1,u=!1,d=!1,f=!1,L=!1;if(e.lightsEnabled&&!a)for(var T=0,P=r._lightSources;T<P.length;T++){var p=P[T];switch(l=!0,void 0===t["LIGHT"+s]&&(u=!0),t["LIGHT"+s]=!0,t["SPOTLIGHT"+s]=!1,t["HEMILIGHT"+s]=!1,t["POINTLIGHT"+s]=!1,t["DIRLIGHT"+s]=!1,p.prepareLightSpecificDefines(t,s),t["LIGHT_FALLOFF_PHYSICAL"+s]=!1,t["LIGHT_FALLOFF_GLTF"+s]=!1,t["LIGHT_FALLOFF_STANDARD"+s]=!1,p.falloffType){case n.Light.FALLOFF_GLTF:t["LIGHT_FALLOFF_GLTF"+s]=!0;break;case n.Light.FALLOFF_PHYSICAL:t["LIGHT_FALLOFF_PHYSICAL"+s]=!0;break;case n.Light.FALLOFF_STANDARD:t["LIGHT_FALLOFF_STANDARD"+s]=!0}if(o&&!p.specular.equalsFloats(0,0,0)&&(L=!0),t["SHADOW"+s]=!1,t["SHADOWPCF"+s]=!1,t["SHADOWPCSS"+s]=!1,t["SHADOWPOISSON"+s]=!1,t["SHADOWESM"+s]=!1,t["SHADOWCUBE"+s]=!1,t["SHADOWLOWQUALITY"+s]=!1,t["SHADOWMEDIUMQUALITY"+s]=!1,r&&r.receiveShadows&&e.shadowsEnabled&&p.shadowEnabled){var S=p.getShadowGenerator();if(S){var c=S.getShadowMap();c&&c.renderList&&c.renderList.length>0&&(f=!0,S.prepareDefines(t,s))}}if(p.lightmapMode!=n.Light.LIGHTMAP_DEFAULT?(d=!0,t["LIGHTMAPEXCLUDED"+s]=!0,t["LIGHTMAPNOSPECULAR"+s]=p.lightmapMode==n.Light.LIGHTMAP_SHADOWSONLY):(t["LIGHTMAPEXCLUDED"+s]=!1,t["LIGHTMAPNOSPECULAR"+s]=!1),++s===i)break}t.SPECULARTERM=L,t.SHADOWS=f;for(var g=s;g<i;g++)void 0!==t["LIGHT"+g]&&(t["LIGHT"+g]=!1,t["HEMILIGHT"+s]=!1,t["POINTLIGHT"+s]=!1,t["DIRLIGHT"+s]=!1,t["SPOTLIGHT"+s]=!1,t["SHADOW"+s]=!1);var E=e.getEngine().getCaps();return void 0===t.SHADOWFLOAT&&(u=!0),t.SHADOWFLOAT=f&&(E.textureFloatRender&&E.textureFloatLinearFiltering||E.textureHalfFloatRender&&E.textureHalfFloatLinearFiltering),t.LIGHTMAPEXCLUDED=d,u&&t.rebuild(),l},a.PrepareUniformsAndSamplersList=function(e,r,t,o){var i;void 0===o&&(o=4);var n=null;if(e.uniformsNames){var a=e;i=a.uniformsNames,n=a.uniformBuffersNames,r=a.samplers,t=a.defines,o=a.maxSimultaneousLights}else i=e,r||(r=[]);for(var s=0;s<o&&t["LIGHT"+s];s++)i.push("vLightData"+s,"vLightDiffuse"+s,"vLightSpecular"+s,"vLightDirection"+s,"vLightFalloff"+s,"vLightGround"+s,"lightMatrix"+s,"shadowsInfo"+s,"depthValues"+s),n&&n.push("Light"+s),r.push("shadowSampler"+s),r.push("depthSampler"+s),t["PROJECTEDLIGHTTEXTURE"+s]&&(r.push("projectionLightSampler"+s),i.push("textureProjectionMatrix"+s));t.NUM_MORPH_INFLUENCERS&&i.push("morphTargetInfluences")},a.HandleFallbacksForShadows=function(e,r,t,o){void 0===t&&(t=4),void 0===o&&(o=0);for(var i=0,n=0;n<t&&e["LIGHT"+n];n++)n>0&&(i=o+n,r.addFallback(i,"LIGHT"+n)),e.SHADOWS||(e["SHADOW"+n]&&r.addFallback(o,"SHADOW"+n),e["SHADOWPCF"+n]&&r.addFallback(o,"SHADOWPCF"+n),e["SHADOWPCSS"+n]&&r.addFallback(o,"SHADOWPCSS"+n),e["SHADOWPOISSON"+n]&&r.addFallback(o,"SHADOWPOISSON"+n),e["SHADOWESM"+n]&&r.addFallback(o,"SHADOWESM"+n));return i++},a.PrepareAttributesForMorphTargets=function(r,t,n){var a=n.NUM_MORPH_INFLUENCERS;if(a>0&&o.EngineStore.LastCreatedEngine)for(var s=o.EngineStore.LastCreatedEngine.getCaps().maxVertexAttribs,l=t.morphTargetManager,u=l&&l.supportsNormals&&n.NORMAL,d=l&&l.supportsTangents&&n.TANGENT,f=0;f<a;f++)r.push(i.VertexBuffer.PositionKind+f),u&&r.push(i.VertexBuffer.NormalKind+f),d&&r.push(i.VertexBuffer.TangentKind+f),r.length>s&&e.Logger.Error("Cannot add more vertex attributes for mesh "+t.name)},a.PrepareAttributesForBones=function(e,r,t,o){t.NUM_BONE_INFLUENCERS>0&&(o.addCPUSkinningFallback(0,r),e.push(i.VertexBuffer.MatricesIndicesKind),e.push(i.VertexBuffer.MatricesWeightsKind),t.NUM_BONE_INFLUENCERS>4&&(e.push(i.VertexBuffer.MatricesIndicesExtraKind),e.push(i.VertexBuffer.MatricesWeightsExtraKind)))},a.PrepareAttributesForInstances=function(e,r){r.INSTANCES&&(e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"))},a.BindLightShadow=function(e,r,t,o){if(e.shadowEnabled&&r.receiveShadows){var i=e.getShadowGenerator();i&&i.bindShadowLight(t,o)}},a.BindLightProperties=function(e,r,t){e.transferToEffect(r,t+"")},a.BindLights=function(e,r,o,i,n,s){void 0===n&&(n=4),void 0===s&&(s=!1);for(var l=Math.min(r._lightSources.length,n),u=0;u<l;u++){var d=r._lightSources[u],f=u.toString(),L=d.getScaledIntensity();d._uniformBuffer.bindToEffect(o,"Light"+u),a.BindLightProperties(d,o,u),d.diffuse.scaleToRef(L,t.Tmp.Color3[0]),d._uniformBuffer.updateColor4("vLightDiffuse",t.Tmp.Color3[0],s?d.radius:d.range,f),i.SPECULARTERM&&(d.specular.scaleToRef(L,t.Tmp.Color3[1]),d._uniformBuffer.updateColor3("vLightSpecular",t.Tmp.Color3[1],f)),e.shadowsEnabled&&this.BindLightShadow(d,r,f,o),d._uniformBuffer.update()}},a.BindFogParameters=function(e,t,o,i){void 0===i&&(i=!1),e.fogEnabled&&t.applyFog&&e.fogMode!==r.Scene.FOGMODE_NONE&&(o.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),i?(e.fogColor.toLinearSpaceToRef(this._tempFogColor),o.setColor3("vFogColor",this._tempFogColor)):o.setColor3("vFogColor",e.fogColor))},a.BindBonesParameters=function(e,r){if(r&&e&&(e.computeBonesUsingShaders&&r._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){var t=e.skeleton;if(t.isUsingTextureForMatrices&&r.getUniformIndex("boneTextureWidth")>-1){var o=t.getTransformMatrixTexture();r.setTexture("boneSampler",o),r.setFloat("boneTextureWidth",4*(t.bones.length+1))}else{var i=t.getTransformMatrices(e);i&&r.setMatrices("mBones",i)}}},a.BindMorphTargetParameters=function(e,r){var t=e.morphTargetManager;e&&t&&r.setFloatArray("morphTargetInfluences",t.influences)},a.BindLogDepth=function(e,r,t){e.LOGARITHMICDEPTH&&r.setFloat("logarithmicDepthConstant",2/(Math.log(t.activeCamera.maxZ+1)/Math.LN2))},a.BindClipPlane=function(e,r){if(r.clipPlane){var t=r.clipPlane;e.setFloat4("vClipPlane",t.normal.x,t.normal.y,t.normal.z,t.d)}if(r.clipPlane2){t=r.clipPlane2;e.setFloat4("vClipPlane2",t.normal.x,t.normal.y,t.normal.z,t.d)}if(r.clipPlane3){t=r.clipPlane3;e.setFloat4("vClipPlane3",t.normal.x,t.normal.y,t.normal.z,t.d)}if(r.clipPlane4){t=r.clipPlane4;e.setFloat4("vClipPlane4",t.normal.x,t.normal.y,t.normal.z,t.d)}},a._tempFogColor=t.Color3.Black(),a}();exports.MaterialHelper=a;
},{"../Misc/logger":"Fvml","../scene":"FKAx","../Maths/math":"Iizi","../Engines/engineStore":"n+VE","../Meshes/buffer":"YHhW","../Lights/light":"U3iz"}],"i5/R":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShaderMaterial=void 0;var t=c(require("tslib")),r=require("../Misc/decorators"),e=require("../Maths/math"),s=require("../Meshes/buffer"),i=require("../Materials/Textures/texture"),o=require("./materialHelper"),n=require("./effect"),a=require("./material"),h=require("../Misc/typeStore");function c(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,e):{};s.get||s.set?Object.defineProperty(r,e,s):r[e]=t[e]}return r.default=t,r}var f=function(a){function h(r,s,i,o){void 0===o&&(o={});var n=a.call(this,r,s)||this;return n._textures={},n._textureArrays={},n._floats={},n._ints={},n._floatsArrays={},n._colors3={},n._colors3Arrays={},n._colors4={},n._vectors2={},n._vectors3={},n._vectors4={},n._matrices={},n._matrices3x3={},n._matrices2x2={},n._vectors2Arrays={},n._vectors3Arrays={},n._cachedWorldViewMatrix=new e.Matrix,n._shaderPath=i,n._options=t.__assign({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},o),n}return t.__extends(h,a),h.prototype.getClassName=function(){return"ShaderMaterial"},h.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},h.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},h.prototype._checkUniform=function(t){-1===this._options.uniforms.indexOf(t)&&this._options.uniforms.push(t)},h.prototype.setTexture=function(t,r){return-1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._textures[t]=r,this},h.prototype.setTextureArray=function(t,r){return-1===this._options.samplers.indexOf(t)&&this._options.samplers.push(t),this._checkUniform(t),this._textureArrays[t]=r,this},h.prototype.setFloat=function(t,r){return this._checkUniform(t),this._floats[t]=r,this},h.prototype.setInt=function(t,r){return this._checkUniform(t),this._ints[t]=r,this},h.prototype.setFloats=function(t,r){return this._checkUniform(t),this._floatsArrays[t]=r,this},h.prototype.setColor3=function(t,r){return this._checkUniform(t),this._colors3[t]=r,this},h.prototype.setColor3Array=function(t,r){return this._checkUniform(t),this._colors3Arrays[t]=r.reduce(function(t,r){return r.toArray(t,t.length),t},[]),this},h.prototype.setColor4=function(t,r){return this._checkUniform(t),this._colors4[t]=r,this},h.prototype.setVector2=function(t,r){return this._checkUniform(t),this._vectors2[t]=r,this},h.prototype.setVector3=function(t,r){return this._checkUniform(t),this._vectors3[t]=r,this},h.prototype.setVector4=function(t,r){return this._checkUniform(t),this._vectors4[t]=r,this},h.prototype.setMatrix=function(t,r){return this._checkUniform(t),this._matrices[t]=r,this},h.prototype.setMatrix3x3=function(t,r){return this._checkUniform(t),this._matrices3x3[t]=r,this},h.prototype.setMatrix2x2=function(t,r){return this._checkUniform(t),this._matrices2x2[t]=r,this},h.prototype.setArray2=function(t,r){return this._checkUniform(t),this._vectors2Arrays[t]=r,this},h.prototype.setArray3=function(t,r){return this._checkUniform(t),this._vectors3Arrays[t]=r,this},h.prototype._checkCache=function(t,r){return!t||(this._effect&&this._effect.defines.indexOf("#define INSTANCES"),!1)},h.prototype.isReady=function(t,r){var e=this.getScene(),i=e.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===e.getRenderId()&&this._checkCache(t,r))return!0;for(var a=[],h=[],c=new n.EffectFallbacks,f=0;f<this._options.defines.length;f++)a.push(this._options.defines[f]);for(f=0;f<this._options.attributes.length;f++)h.push(this._options.attributes[f]);if(t&&t.isVerticesDataPresent(s.VertexBuffer.ColorKind)&&(h.push(s.VertexBuffer.ColorKind),a.push("#define VERTEXCOLOR")),r&&(a.push("#define INSTANCES"),o.MaterialHelper.PrepareAttributesForInstances(h,a)),t&&t.useBones&&t.computeBonesUsingShaders&&t.skeleton){h.push(s.VertexBuffer.MatricesIndicesKind),h.push(s.VertexBuffer.MatricesWeightsKind),t.numBoneInfluencers>4&&(h.push(s.VertexBuffer.MatricesIndicesExtraKind),h.push(s.VertexBuffer.MatricesWeightsExtraKind));var u=t.skeleton;a.push("#define NUM_BONE_INFLUENCERS "+t.numBoneInfluencers),c.addCPUSkinningFallback(0,t),u.isUsingTextureForMatrices?(a.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(a.push("#define BonesPerMesh "+(u.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else a.push("#define NUM_BONE_INFLUENCERS 0");for(var _ in this._textures)if(!this._textures[_].isReady())return!1;t&&this._shouldTurnAlphaTestOn(t)&&a.push("#define ALPHATEST");var l=this._effect,p=a.join("\n");return this._effect=i.createEffect(this._shaderPath,{attributes:h,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:p,fallbacks:c,onCompiled:this.onCompiled,onError:this.onError},i),!!this._effect.isReady()&&(l!==this._effect&&e.resetCachedMaterial(),this._renderId=e.getRenderId(),!0)},h.prototype.bindOnlyWorldMatrix=function(t){var r=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",t),-1!==this._options.uniforms.indexOf("worldView")&&(t.multiplyToRef(r.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",t.multiply(r.getTransformMatrix())))},h.prototype.bind=function(t,r){if(this.bindOnlyWorldMatrix(t),this._effect&&this.getScene().getCachedMaterial()!==this){var e;for(e in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),o.MaterialHelper.BindBonesParameters(r,this._effect),this._textures)this._effect.setTexture(e,this._textures[e]);for(e in this._textureArrays)this._effect.setTextureArray(e,this._textureArrays[e]);for(e in this._ints)this._effect.setInt(e,this._ints[e]);for(e in this._floats)this._effect.setFloat(e,this._floats[e]);for(e in this._floatsArrays)this._effect.setArray(e,this._floatsArrays[e]);for(e in this._colors3)this._effect.setColor3(e,this._colors3[e]);for(e in this._colors3Arrays)this._effect.setArray3(e,this._colors3Arrays[e]);for(e in this._colors4){var s=this._colors4[e];this._effect.setFloat4(e,s.r,s.g,s.b,s.a)}for(e in this._vectors2)this._effect.setVector2(e,this._vectors2[e]);for(e in this._vectors3)this._effect.setVector3(e,this._vectors3[e]);for(e in this._vectors4)this._effect.setVector4(e,this._vectors4[e]);for(e in this._matrices)this._effect.setMatrix(e,this._matrices[e]);for(e in this._matrices3x3)this._effect.setMatrix3x3(e,this._matrices3x3[e]);for(e in this._matrices2x2)this._effect.setMatrix2x2(e,this._matrices2x2[e]);for(e in this._vectors2Arrays)this._effect.setArray2(e,this._vectors2Arrays[e]);for(e in this._vectors3Arrays)this._effect.setArray3(e,this._vectors3Arrays[e])}this._afterBind(r)},h.prototype.getActiveTextures=function(){var t=a.prototype.getActiveTextures.call(this);for(var r in this._textures)t.push(this._textures[r]);for(var r in this._textureArrays)for(var e=this._textureArrays[r],s=0;s<e.length;s++)t.push(e[s]);return t},h.prototype.hasTexture=function(t){if(a.prototype.hasTexture.call(this,t))return!0;for(var r in this._textures)if(this._textures[r]===t)return!0;for(var r in this._textureArrays)for(var e=this._textureArrays[r],s=0;s<e.length;s++)if(e[s]===t)return!0;return!1},h.prototype.clone=function(t){return new h(t,this.getScene(),this._shaderPath,this._options)},h.prototype.dispose=function(t,r,e){if(r){var s;for(s in this._textures)this._textures[s].dispose();for(s in this._textureArrays)for(var i=this._textureArrays[s],o=0;o<i.length;o++)i[o].dispose()}this._textures={},a.prototype.dispose.call(this,t,r,e)},h.prototype.serialize=function(){var t,e=r.SerializationHelper.Serialize(this);for(t in e.customType="ShaderMaterial",e.options=this._options,e.shaderPath=this._shaderPath,e.textures={},this._textures)e.textures[t]=this._textures[t].serialize();for(t in e.textureArrays={},this._textureArrays){e.textureArrays[t]=[];for(var s=this._textureArrays[t],i=0;i<s.length;i++)e.textureArrays[t].push(s[i].serialize())}for(t in e.floats={},this._floats)e.floats[t]=this._floats[t];for(t in e.FloatArrays={},this._floatsArrays)e.FloatArrays[t]=this._floatsArrays[t];for(t in e.colors3={},this._colors3)e.colors3[t]=this._colors3[t].asArray();for(t in e.colors3Arrays={},this._colors3Arrays)e.colors3Arrays[t]=this._colors3Arrays[t];for(t in e.colors4={},this._colors4)e.colors4[t]=this._colors4[t].asArray();for(t in e.vectors2={},this._vectors2)e.vectors2[t]=this._vectors2[t].asArray();for(t in e.vectors3={},this._vectors3)e.vectors3[t]=this._vectors3[t].asArray();for(t in e.vectors4={},this._vectors4)e.vectors4[t]=this._vectors4[t].asArray();for(t in e.matrices={},this._matrices)e.matrices[t]=this._matrices[t].asArray();for(t in e.matrices3x3={},this._matrices3x3)e.matrices3x3[t]=this._matrices3x3[t];for(t in e.matrices2x2={},this._matrices2x2)e.matrices2x2[t]=this._matrices2x2[t];for(t in e.vectors2Arrays={},this._vectors2Arrays)e.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in e.vectors3Arrays={},this._vectors3Arrays)e.vectors3Arrays[t]=this._vectors3Arrays[t];return e},h.Parse=function(t,s,o){var n,a=r.SerializationHelper.Parse(function(){return new h(t.name,s,t.shaderPath,t.options)},t,s,o);for(n in t.textures)a.setTexture(n,i.Texture.Parse(t.textures[n],s,o));for(n in t.textureArrays){for(var c=t.textureArrays[n],f=new Array,u=0;u<c.length;u++)f.push(i.Texture.Parse(c[u],s,o));a.setTextureArray(n,f)}for(n in t.floats)a.setFloat(n,t.floats[n]);for(n in t.floatsArrays)a.setFloats(n,t.floatsArrays[n]);for(n in t.colors3)a.setColor3(n,e.Color3.FromArray(t.colors3[n]));for(n in t.colors3Arrays){var _=t.colors3Arrays[n].reduce(function(t,r,e){return e%3==0?t.push([r]):t[t.length-1].push(r),t},[]).map(function(t){return e.Color3.FromArray(t)});a.setColor3Array(n,_)}for(n in t.colors4)a.setColor4(n,e.Color4.FromArray(t.colors4[n]));for(n in t.vectors2)a.setVector2(n,e.Vector2.FromArray(t.vectors2[n]));for(n in t.vectors3)a.setVector3(n,e.Vector3.FromArray(t.vectors3[n]));for(n in t.vectors4)a.setVector4(n,e.Vector4.FromArray(t.vectors4[n]));for(n in t.matrices)a.setMatrix(n,e.Matrix.FromArray(t.matrices[n]));for(n in t.matrices3x3)a.setMatrix3x3(n,t.matrices3x3[n]);for(n in t.matrices2x2)a.setMatrix2x2(n,t.matrices2x2[n]);for(n in t.vectors2Arrays)a.setArray2(n,t.vectors2Arrays[n]);for(n in t.vectors3Arrays)a.setArray3(n,t.vectors3Arrays[n]);return a},h}(a.Material);exports.ShaderMaterial=f,h._TypeStore.RegisteredTypes["BABYLON.ShaderMaterial"]=f;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi","../Meshes/buffer":"YHhW","../Materials/Textures/texture":"KNsj","./materialHelper":"DR7Q","./effect":"Ru7D","./material":"v46b","../Misc/typeStore":"WgxS"}],"gah5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.colorPixelShader=void 0;var e=require("../Materials/effect"),r="colorPixelShader",o="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\nvoid main(void) {\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}";e.Effect.ShadersStore[r]=o;var l={name:r,shader:o};exports.colorPixelShader=l;
},{"../Materials/effect":"Ru7D"}],"1TNa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bonesDeclaration=void 0;var e=require("../../Materials/effect"),t="bonesDeclaration",n="#if NUM_BONE_INFLUENCERS>0\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifdef BONETEXTURE\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index*4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif";e.Effect.IncludesShadersStore[t]=n;var r={name:t,shader:n};exports.bonesDeclaration=r;
},{"../../Materials/effect":"Ru7D"}],"YHup":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.instancesDeclaration=void 0;var e=require("../../Materials/effect"),t="instancesDeclaration",r="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif";e.Effect.IncludesShadersStore[t]=r;var a={name:t,shader:r};exports.instancesDeclaration=a;
},{"../../Materials/effect":"Ru7D"}],"yjPN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.instancesVertex=void 0;var e=require("../../Materials/effect"),r="instancesVertex",t="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif";e.Effect.IncludesShadersStore[r]=t;var s={name:r,shader:t};exports.instancesVertex=s;
},{"../../Materials/effect":"Ru7D"}],"60le":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bonesVertex=void 0;var e=require("../../Materials/effect"),n="bonesVertex",i="#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif";e.Effect.IncludesShadersStore[n]=i;var r={name:n,shader:i};exports.bonesVertex=r;
},{"../../Materials/effect":"Ru7D"}],"IyRn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.colorVertexShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/bonesDeclaration"),require("./ShadersInclude/instancesDeclaration"),require("./ShadersInclude/instancesVertex"),require("./ShadersInclude/bonesVertex");var n="colorVertexShader",r="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}";e.Effect.ShadersStore[n]=r;var i={name:n,shader:r};exports.colorVertexShader=i;
},{"../Materials/effect":"Ru7D","./ShadersInclude/bonesDeclaration":"1TNa","./ShadersInclude/instancesDeclaration":"YHup","./ShadersInclude/instancesVertex":"yjPN","./ShadersInclude/bonesVertex":"60le"}],"ztjm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstancedLinesMesh=exports.LinesMesh=void 0;var e=l(require("tslib")),r=require("../Maths/math"),t=require("../Meshes/buffer"),o=require("../Meshes/mesh"),n=require("../Meshes/instancedMesh"),s=require("../Materials/material"),i=require("../Materials/shaderMaterial");function l(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};o.get||o.set?Object.defineProperty(r,t,o):r[t]=e[t]}return r.default=e,r}require("../Shaders/color.fragment"),require("../Shaders/color.vertex");var a=function(o){function n(e,n,s,l,a,h,u){void 0===n&&(n=null),void 0===s&&(s=null);var c=o.call(this,e,n,s,l,a)||this;c.useVertexColor=h,c.useVertexAlpha=u,c.color=new r.Color3(1,1,1),c.alpha=1,l&&(c.color=l.color.clone(),c.alpha=l.alpha,c.useVertexColor=l.useVertexColor,c.useVertexAlpha=l.useVertexAlpha),c.intersectionThreshold=.1;var d={attributes:[t.VertexBuffer.PositionKind,"world0","world1","world2","world3"],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===u&&(d.needAlphaBlending=!1),h?(d.defines.push("#define VERTEXCOLOR"),d.attributes.push(t.VertexBuffer.ColorKind)):d.uniforms.push("color"),c._colorShader=new i.ShaderMaterial("colorShader",c.getScene(),"color",d),c}return e.__extends(n,o),n.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(n.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),n.prototype._bind=function(e,r,t){return this._geometry?(this._geometry._bind(this._colorShader.getEffect()),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),this):this},n.prototype._draw=function(e,r,t){return this._geometry&&this._geometry.getVertexBuffers()&&(this._unIndexed||this._geometry.getIndexBuffer())?(this.getScene().getEngine().drawElementsType(s.Material.LineListDrawMode,e.indexStart,e.indexCount,t),this):this},n.prototype.dispose=function(e){this._colorShader.dispose(!1,!1,!0),o.prototype.dispose.call(this,e)},n.prototype.clone=function(e,r,t){return new n(e,this.getScene(),r,this,t)},n.prototype.createInstance=function(e){return new h(e,this)},n}(o.Mesh);exports.LinesMesh=a;var h=function(r){function t(e,t){var o=r.call(this,e,t)||this;return o.intersectionThreshold=t.intersectionThreshold,o}return e.__extends(t,r),t.prototype.getClassName=function(){return"InstancedLinesMesh"},t}(n.InstancedMesh);exports.InstancedLinesMesh=h;
},{"tslib":"vCxL","../Maths/math":"Iizi","../Meshes/buffer":"YHhW","../Meshes/mesh":"aXN+","../Meshes/instancedMesh":"ZeQ6","../Materials/material":"v46b","../Materials/shaderMaterial":"i5/R","../Shaders/color.fragment":"gah5","../Shaders/color.vertex":"IyRn"}],"JvWG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GroundMesh=void 0;var t=r(require("tslib")),i=require("../Maths/math"),e=require("../Meshes/buffer"),s=require("../Meshes/mesh");function r(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,e):{};s.get||s.set?Object.defineProperty(i,e,s):i[e]=t[e]}return i.default=t,i}s.Mesh._GroundMeshParser=function(t,i){return o.Parse(t,i)};var o=function(s){function r(t,i){var e=s.call(this,t,i)||this;return e.generateOctree=!1,e}return t.__extends(r,s),r.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(r.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),r.prototype.optimize=function(t,i){void 0===i&&(i=32),this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(i)},r.prototype.getHeightAtCoordinates=function(t,e){var s=this.getWorldMatrix(),r=i.Tmp.Matrix[5];s.invertToRef(r);var o=i.Tmp.Vector3[8];if(i.Vector3.TransformCoordinatesFromFloatsToRef(t,0,e,r,o),t=o.x,e=o.z,t<this._minX||t>this._maxX||e<this._minZ||e>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var n=this._getFacetAt(t,e),h=-(n.x*t+n.z*e+n.w)/n.y;return i.Vector3.TransformCoordinatesFromFloatsToRef(0,h,0,s,o),o.y},r.prototype.getNormalAtCoordinates=function(t,e){var s=new i.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(t,e,s),s},r.prototype.getNormalAtCoordinatesToRef=function(t,e,s){var r=this.getWorldMatrix(),o=i.Tmp.Matrix[5];r.invertToRef(o);var n=i.Tmp.Vector3[8];if(i.Vector3.TransformCoordinatesFromFloatsToRef(t,0,e,o,n),t=n.x,e=n.z,t<this._minX||t>this._maxX||e<this._minZ||e>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var h=this._getFacetAt(t,e);return i.Vector3.TransformNormalFromFloatsToRef(h.x,h.y,h.z,r,s),this},r.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},r.prototype._getFacetAt=function(t,i){var e=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),s=Math.floor(-(i+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),r=this._heightQuads[s*this._subdivisionsX+e];return i<r.slope.x*t+r.slope.y?r.facet1:r.facet2},r.prototype._initHeightQuads=function(){var t=this._subdivisionsX,e=this._subdivisionsY;this._heightQuads=new Array;for(var s=0;s<e;s++)for(var r=0;r<t;r++){var o={slope:i.Vector2.Zero(),facet1:new i.Vector4(0,0,0,0),facet2:new i.Vector4(0,0,0,0)};this._heightQuads[s*t+r]=o}return this},r.prototype._computeHeightQuads=function(){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return this;for(var s=i.Tmp.Vector3[3],r=i.Tmp.Vector3[2],o=i.Tmp.Vector3[1],n=i.Tmp.Vector3[0],h=i.Tmp.Vector3[4],a=i.Tmp.Vector3[5],u=i.Tmp.Vector3[6],c=i.Tmp.Vector3[7],d=i.Tmp.Vector3[8],p=0,m=0,_=0,f=0,v=0,g=0,b=0,l=this._subdivisionsX,y=this._subdivisionsY,x=0;x<y;x++)for(var T=0;T<l;T++){p=3*T,m=x*(l+1)*3,_=(x+1)*(l+1)*3,s.x=t[m+p],s.y=t[m+p+1],s.z=t[m+p+2],r.x=t[m+p+3],r.y=t[m+p+4],r.z=t[m+p+5],o.x=t[_+p],o.y=t[_+p+1],o.z=t[_+p+2],n.x=t[_+p+3],n.y=t[_+p+4],n.z=t[_+p+5],f=(n.z-s.z)/(n.x-s.x),v=s.z-f*s.x,r.subtractToRef(s,h),o.subtractToRef(s,a),n.subtractToRef(s,u),i.Vector3.CrossToRef(u,a,c),i.Vector3.CrossToRef(h,u,d),c.normalize(),d.normalize(),g=-(c.x*s.x+c.y*s.y+c.z*s.z),b=-(d.x*r.x+d.y*r.y+d.z*r.z);var X=this._heightQuads[x*l+T];X.slope.copyFromFloats(f,v),X.facet1.copyFromFloats(c.x,c.y,c.z,g),X.facet2.copyFromFloats(d.x,d.y,d.z,b)}return this},r.prototype.serialize=function(t){s.prototype.serialize.call(this,t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height},r.Parse=function(t,i){var e=new r(t.name,i);return e._subdivisionsX=t.subdivisionsX||1,e._subdivisionsY=t.subdivisionsY||1,e._minX=t.minX,e._maxX=t.maxX,e._minZ=t.minZ,e._maxZ=t.maxZ,e._width=t.width,e._height=t.height,e},r}(s.Mesh);exports.GroundMesh=o;
},{"tslib":"vCxL","../Maths/math":"Iizi","../Meshes/buffer":"YHhW","../Meshes/mesh":"aXN+"}],"t6eO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PolygonMeshBuilder=exports.Polygon=void 0;var e=i(require("tslib")),t=require("../Misc/logger"),n=require("../Maths/math"),s=require("../Meshes/buffer"),r=require("../Meshes/mesh");function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};s.get||s.set?Object.defineProperty(t,n,s):t[n]=e[n]}return t.default=e,t}var o=function(t){function n(e,n){var s=t.call(this,e.x,e.y)||this;return s.index=n,s}return e.__extends(n,t),n}(n.Vector2),h=function(){function e(){this.elements=new Array}return e.prototype.add=function(e){var t=this,n=new Array;return e.forEach(function(e){if(0===n.length||!e.equalsWithEpsilon(n[0])){var s=new o(e,t.elements.length);n.push(s),t.elements.push(s)}}),n},e.prototype.computeBounds=function(){var e=new n.Vector2(this.elements[0].x,this.elements[0].y),t=new n.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(n){n.x<e.x?e.x=n.x:n.x>t.x&&(t.x=n.x),n.y<e.y?e.y=n.y:n.y>t.y&&(t.y=n.y)}),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}},e}(),u=function(){function e(){}return e.Rectangle=function(e,t,s,r){return[new n.Vector2(e,t),new n.Vector2(s,t),new n.Vector2(s,r),new n.Vector2(e,r)]},e.Circle=function(e,t,s,r){void 0===t&&(t=0),void 0===s&&(s=0),void 0===r&&(r=32);for(var i=new Array,o=0,h=2*Math.PI/r,u=0;u<r;u++)i.push(new n.Vector2(t+Math.cos(o)*e,s+Math.sin(o)*e)),o-=h;return i},e.Parse=function(e){var t,s=e.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),r=[];for(t=0;t<(2147483646&s.length);t+=2)r.push(new n.Vector2(s[t],s[t+1]));return r},e.StartingAt=function(e,t){return n.Path2.StartingAt(e,t)},e}();exports.Polygon=u;var p=function(){function e(e,s,r,i){var o;void 0===i&&(i=earcut),this._points=new h,this._outlinepoints=new h,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=i,this._name=e,this._scene=r,o=s instanceof n.Path2?s.getPoints():s,this._addToepoint(o),this._points.add(o),this._outlinepoints.add(o),void 0===this.bjsEarcut&&t.Logger.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(e){for(var t=0,n=e;t<n.length;t++){var s=n[t];this._epoints.push(s.x,s.y)}},e.prototype.addHole=function(e){this._points.add(e);var t=new h;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},e.prototype.build=function(e,t){var n=this;void 0===e&&(e=!1),void 0===t&&(t=0);var i=new r.Mesh(this._name,this._scene),o=new Array,h=new Array,u=new Array,p=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),h.push(e.x,0,e.y),u.push((e.x-p.min.x)/p.width,(e.y-p.min.y)/p.height)});for(var a=new Array,c=this.bjsEarcut(this._epoints,this._eholes,2),l=0;l<c.length;l++)a.push(c[l]);if(t>0){var y=h.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),h.push(e.x,-t,e.y),u.push(1-(e.x-p.min.x)/p.width,1-(e.y-p.min.y)/p.height)});var d=a.length;for(l=0;l<d;l+=3){var f=a[l+0],x=a[l+1],w=a[l+2];a.push(w+y),a.push(x+y),a.push(f+y)}this.addSide(h,o,u,a,p,this._outlinepoints,t,!1),this._holes.forEach(function(e){n.addSide(h,o,u,a,p,e,t,!0)})}return i.setVerticesData(s.VertexBuffer.PositionKind,h,e),i.setVerticesData(s.VertexBuffer.NormalKind,o,e),i.setVerticesData(s.VertexBuffer.UVKind,u,e),i.setIndices(a),i},e.prototype.addSide=function(e,t,s,r,i,o,h,u){for(var p=e.length/3,a=0,c=0;c<o.elements.length;c++){var l,y=o.elements[c];l=c+1>o.elements.length-1?o.elements[0]:o.elements[c+1],e.push(y.x,0,y.y),e.push(y.x,-h,y.y),e.push(l.x,0,l.y),e.push(l.x,-h,l.y);var d=new n.Vector3(y.x,0,y.y),f=new n.Vector3(l.x,0,l.y).subtract(d),x=new n.Vector3(0,1,0),w=n.Vector3.Cross(f,x);w=w.normalize(),s.push(a/i.width,0),s.push(a/i.width,1),a+=f.length(),s.push(a/i.width,0),s.push(a/i.width,1),u?(t.push(w.x,w.y,w.z),t.push(w.x,w.y,w.z),t.push(w.x,w.y,w.z),t.push(w.x,w.y,w.z),r.push(p),r.push(p+2),r.push(p+1),r.push(p+1),r.push(p+2),r.push(p+3)):(t.push(-w.x,-w.y,-w.z),t.push(-w.x,-w.y,-w.z),t.push(-w.x,-w.y,-w.z),t.push(-w.x,-w.y,-w.z),r.push(p),r.push(p+1),r.push(p+2),r.push(p+1),r.push(p+3),r.push(p+2)),p+=4}},e}();exports.PolygonMeshBuilder=p;
},{"tslib":"vCxL","../Misc/logger":"Fvml","../Maths/math":"Iizi","../Meshes/buffer":"YHhW","../Meshes/mesh":"aXN+"}],"vVKK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshBuilder=void 0;var e=require("../Misc/tools"),t=require("../scene"),a=require("../Maths/math"),r=require("./mesh"),n=require("./buffer"),i=require("./linesMesh"),o=require("./mesh.vertexData"),s=require("./groundMesh"),u=require("./polygonMesh"),l=require("../Culling/boundingInfo");r.Mesh.CreateRibbon=function(e,t,a,r,n,i,o,s,u){return void 0===a&&(a=!1),void 0===o&&(o=!1),d.CreateRibbon(e,{pathArray:t,closeArray:a,closePath:r,offset:n,updatable:o,sideOrientation:s,instance:u},i)},r.Mesh.CreateDisc=function(e,t,a,r,n,i){void 0===r&&(r=null);var o={radius:t,tessellation:a,sideOrientation:i,updatable:n};return d.CreateDisc(e,o,r)},r.Mesh.CreateBox=function(e,t,a,r,n){void 0===a&&(a=null);var i={size:t,sideOrientation:n,updatable:r};return d.CreateBox(e,i,a)},r.Mesh.CreateSphere=function(e,t,a,r,n,i){var o={segments:t,diameterX:a,diameterY:a,diameterZ:a,sideOrientation:i,updatable:n};return d.CreateSphere(e,o,r)},r.Mesh.CreateCylinder=function(e,a,n,i,o,s,u,l,h){void 0!==u&&u instanceof t.Scene||(void 0!==u&&(h=l||r.Mesh.DEFAULTSIDE,l=u),u=s,s=1);var c={height:a,diameterTop:n,diameterBottom:i,tessellation:o,subdivisions:s,sideOrientation:h,updatable:l};return d.CreateCylinder(e,c,u)},r.Mesh.CreateTorus=function(e,t,a,r,n,i,o){var s={diameter:t,thickness:a,tessellation:r,sideOrientation:o,updatable:i};return d.CreateTorus(e,s,n)},r.Mesh.CreateTorusKnot=function(e,t,a,r,n,i,o,s,u,l){var h={radius:t,tube:a,radialSegments:r,tubularSegments:n,p:i,q:o,sideOrientation:l,updatable:u};return d.CreateTorusKnot(e,h,s)},r.Mesh.CreateLines=function(e,t,a,r,n){void 0===a&&(a=null),void 0===r&&(r=!1),void 0===n&&(n=null);var i={points:t,updatable:r,instance:n};return d.CreateLines(e,i,a)},r.Mesh.CreateDashedLines=function(e,t,a,r,n,i,o,s){void 0===i&&(i=null);var u={points:t,dashSize:a,gapSize:r,dashNb:n,updatable:o,instance:s};return d.CreateDashedLines(e,u,i)},r.Mesh.CreatePolygon=function(e,t,a,r,n,i){var o={shape:t,holes:r,updatable:n,sideOrientation:i};return d.CreatePolygon(e,o,a)},r.Mesh.ExtrudePolygon=function(e,t,a,r,n,i,o){var s={shape:t,holes:n,depth:a,updatable:i,sideOrientation:o};return d.ExtrudePolygon(e,s,r)},r.Mesh.ExtrudeShape=function(e,t,a,n,i,o,s,u,l,h){void 0===s&&(s=null);var c={shape:t,path:a,scale:n,rotation:i,cap:0===o?0:o||r.Mesh.NO_CAP,sideOrientation:l,instance:h,updatable:u};return d.ExtrudeShape(e,c,s)},r.Mesh.ExtrudeShapeCustom=function(e,t,a,n,i,o,s,u,l,h,c,p){var f={shape:t,path:a,scaleFunction:n,rotationFunction:i,ribbonCloseArray:o,ribbonClosePath:s,cap:0===u?0:u||r.Mesh.NO_CAP,sideOrientation:c,instance:p,updatable:h};return d.ExtrudeShapeCustom(e,f,l)},r.Mesh.CreateLathe=function(e,t,a,r,n,i,o){var s={shape:t,radius:a,tessellation:r,sideOrientation:o,updatable:i};return d.CreateLathe(e,s,n)},r.Mesh.CreatePlane=function(e,t,a,r,n){var i={size:t,width:t,height:t,sideOrientation:n,updatable:r};return d.CreatePlane(e,i,a)},r.Mesh.CreateGround=function(e,t,a,r,n,i){var o={width:t,height:a,subdivisions:r,updatable:i};return d.CreateGround(e,o,n)},r.Mesh.CreateTiledGround=function(e,t,a,r,n,i,o,s,u){var l={xmin:t,zmin:a,xmax:r,zmax:n,subdivisions:i,precision:o,updatable:u};return d.CreateTiledGround(e,l,s)},r.Mesh.CreateGroundFromHeightMap=function(e,t,a,r,n,i,o,s,u,l,h){var c={width:a,height:r,subdivisions:n,minHeight:i,maxHeight:o,updatable:u,onReady:l,alphaFilter:h};return d.CreateGroundFromHeightMap(e,t,c,s)},r.Mesh.CreateTube=function(e,t,a,r,n,i,o,s,u,l){var h={path:t,radius:a,tessellation:r,radiusFunction:n,arc:1,cap:i,updatable:s,sideOrientation:u,instance:l};return d.CreateTube(e,h,o)},r.Mesh.CreatePolyhedron=function(e,t,a){return d.CreatePolyhedron(e,t,a)},r.Mesh.CreateIcoSphere=function(e,t,a){return d.CreateIcoSphere(e,t,a)},r.Mesh.CreateDecal=function(e,t,a,r,n,i){var o={position:a,normal:r,size:n,angle:i};return d.CreateDecal(e,t,o)};var d=function(){function t(){}return t._UpdateSideOrientation=function(e){return e==r.Mesh.DOUBLESIDE?r.Mesh.DOUBLESIDE:null==e?r.Mesh.FRONTSIDE:e},t.CreateBox=function(e,a,n){void 0===n&&(n=null);var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateBox(a).applyToMesh(i,a.updatable),i},t.CreateSphere=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateSphere(a).applyToMesh(i,a.updatable),i},t.CreateDisc=function(e,a,n){void 0===n&&(n=null);var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateDisc(a).applyToMesh(i,a.updatable),i},t.CreateIcoSphere=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateIcoSphere(a).applyToMesh(i,a.updatable),i},t.CreateRibbon=function(e,i,s){void 0===s&&(s=null);var u=i.pathArray,d=i.closeArray,h=i.closePath,c=t._UpdateSideOrientation(i.sideOrientation),p=i.instance,f=i.updatable;if(p){var g=a.Tmp.Vector3[0].setAll(Number.MAX_VALUE),v=a.Tmp.Vector3[1].setAll(-Number.MAX_VALUE),C=p.getVerticesData(n.VertexBuffer.PositionKind);if(function(e){for(var t=u[0].length,a=p,n=0,i=a._originalBuilderSideOrientation===r.Mesh.DOUBLESIDE?2:1,o=1;o<=i;++o)for(var s=0;s<u.length;++s){var l=u[s],d=l.length;t=t<d?t:d;for(var h=0;h<t;++h){var c=l[h];e[n]=c.x,e[n+1]=c.y,e[n+2]=c.z,g.minimizeInPlaceFromFloats(c.x,c.y,c.z),v.maximizeInPlaceFromFloats(c.x,c.y,c.z),n+=3}a._creationDataStorage&&a._creationDataStorage.closePath&&(c=l[0],e[n]=c.x,e[n+1]=c.y,e[n+2]=c.z,n+=3)}}(C),p._boundingInfo?p._boundingInfo.reConstruct(g,v,p._worldMatrix):p._boundingInfo=new l.BoundingInfo(g,v,p._worldMatrix),p.updateVerticesData(n.VertexBuffer.PositionKind,C,!1,!1),i.colors){for(var b=p.getVerticesData(n.VertexBuffer.ColorKind),M=0,_=0;M<i.colors.length;M++,_+=4){var x=i.colors[M];b[_]=x.r,b[_+1]=x.g,b[_+2]=x.b,b[_+3]=x.a}p.updateVerticesData(n.VertexBuffer.ColorKind,b,!1,!1)}if(i.uvs){for(var V=p.getVerticesData(n.VertexBuffer.UVKind),D=0;D<i.uvs.length;D++)V[2*D]=i.uvs[D].x,V[2*D+1]=i.uvs[D].y;p.updateVerticesData(n.VertexBuffer.UVKind,V,!1,!1)}if(!p.areNormalsFrozen||p.isFacetDataEnabled){var y=p.getIndices(),m=p.getVerticesData(n.VertexBuffer.NormalKind),S=p.isFacetDataEnabled?p.getFacetDataParameters():null;if(o.VertexData.ComputeNormals(C,y,m,S),p._creationDataStorage&&p._creationDataStorage.closePath)for(var O=0,P=0,A=0;A<u.length;A++)O=3*p._creationDataStorage.idx[A],P=A+1<u.length?3*(p._creationDataStorage.idx[A+1]-1):m.length-3,m[O]=.5*(m[O]+m[P]),m[O+1]=.5*(m[O+1]+m[P+1]),m[O+2]=.5*(m[O+2]+m[P+2]),m[P]=m[O],m[P+1]=m[O+1],m[P+2]=m[O+2];p.areNormalsFrozen||p.updateVerticesData(n.VertexBuffer.NormalKind,m,!1,!1)}return p}var w=new r.Mesh(e,s);w._originalBuilderSideOrientation=c,w._creationDataStorage=new r._CreationDataStorage;var T=o.VertexData.CreateRibbon(i);return h&&(w._creationDataStorage.idx=T._idx),w._creationDataStorage.closePath=h,w._creationDataStorage.closeArray=d,T.applyToMesh(w,f),w},t.CreateCylinder=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateCylinder(a).applyToMesh(i,a.updatable),i},t.CreateTorus=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateTorus(a).applyToMesh(i,a.updatable),i},t.CreateTorusKnot=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateTorusKnot(a).applyToMesh(i,a.updatable),i},t.CreateLineSystem=function(e,t,a){var r=t.instance,s=t.lines,u=t.colors;if(r){var l,d,h=r.getVerticesData(n.VertexBuffer.PositionKind);u&&(l=r.getVerticesData(n.VertexBuffer.ColorKind));for(var c=0,p=0,f=0;f<s.length;f++)for(var g=s[f],v=0;v<g.length;v++)h[c]=g[v].x,h[c+1]=g[v].y,h[c+2]=g[v].z,u&&l&&(d=u[f],l[p]=d[v].r,l[p+1]=d[v].g,l[p+2]=d[v].b,l[p+3]=d[v].a,p+=4),c+=3;return r.updateVerticesData(n.VertexBuffer.PositionKind,h,!1,!1),u&&l&&r.updateVerticesData(n.VertexBuffer.ColorKind,l,!1,!1),r}var C=!!u,b=new i.LinesMesh(e,a,null,void 0,void 0,C,t.useVertexAlpha);return o.VertexData.CreateLineSystem(t).applyToMesh(b,t.updatable),b},t.CreateLines=function(e,a,r){void 0===r&&(r=null);var n=a.colors?[a.colors]:null;return t.CreateLineSystem(e,{lines:[a.points],updatable:a.updatable,instance:a.instance,colors:n,useVertexAlpha:a.useVertexAlpha},r)},t.CreateDashedLines=function(e,t,n){void 0===n&&(n=null);var s=t.points,u=t.instance,l=t.gapSize||1,d=t.dashSize||3;if(u){return u.updateMeshPositions(function(e){var t,r,n=a.Vector3.Zero(),i=e.length/6,o=0,l=0,d=0,h=0,c=0,p=0;for(c=0;c<s.length-1;c++)s[c+1].subtractToRef(s[c],n),o+=n.length();t=o/i;var f=u._creationDataStorage.dashSize;for(r=f*t/(f+u._creationDataStorage.gapSize),c=0;c<s.length-1;c++)for(s[c+1].subtractToRef(s[c],n),l=Math.floor(n.length()/t),n.normalize(),p=0;p<l&&h<e.length;)d=t*p,e[h]=s[c].x+d*n.x,e[h+1]=s[c].y+d*n.y,e[h+2]=s[c].z+d*n.z,e[h+3]=s[c].x+(d+r)*n.x,e[h+4]=s[c].y+(d+r)*n.y,e[h+5]=s[c].z+(d+r)*n.z,h+=6,p++;for(;h<e.length;)e[h]=s[c].x,e[h+1]=s[c].y,e[h+2]=s[c].z,h+=3},!1),u}var h=new i.LinesMesh(e,n);return o.VertexData.CreateDashedLines(t).applyToMesh(h,t.updatable),h._creationDataStorage=new r._CreationDataStorage,h._creationDataStorage.dashSize=d,h._creationDataStorage.gapSize=l,h},t.ExtrudeShape=function(e,a,n){void 0===n&&(n=null);var i=a.path,o=a.shape,s=a.scale||1,u=a.rotation||0,l=0===a.cap?0:a.cap||r.Mesh.NO_CAP,d=a.updatable,h=t._UpdateSideOrientation(a.sideOrientation),c=a.instance||null,p=a.invertUV||!1;return t._ExtrudeShapeGeneric(e,o,i,s,u,null,null,!1,!1,l,!1,n,!!d,h,c,p,a.frontUVs||null,a.backUVs||null)},t.ExtrudeShapeCustom=function(e,a,n){var i=a.path,o=a.shape,s=a.scaleFunction||function(){return 1},u=a.rotationFunction||function(){return 0},l=a.ribbonCloseArray||!1,d=a.ribbonClosePath||!1,h=0===a.cap?0:a.cap||r.Mesh.NO_CAP,c=a.updatable,p=t._UpdateSideOrientation(a.sideOrientation),f=a.instance,g=a.invertUV||!1;return t._ExtrudeShapeGeneric(e,o,i,null,null,s,u,l,d,h,!0,n,!!c,p,f||null,g,a.frontUVs||null,a.backUVs||null)},t.CreateLathe=function(e,n,i){var o,s=n.arc?n.arc<=0||n.arc>1?1:n.arc:1,u=void 0===n.closed||n.closed,l=n.shape,d=n.radius||1,h=n.tessellation||64,c=n.clip||0,p=n.updatable,f=t._UpdateSideOrientation(n.sideOrientation),g=n.cap||r.Mesh.NO_CAP,v=2*Math.PI,C=new Array,b=n.invertUV||!1,M=0,_=0,x=v/h*s,V=new Array;for(M=0;M<=h-c;M++){V=[];for(g!=r.Mesh.CAP_START&&g!=r.Mesh.CAP_ALL||(V.push(new a.Vector3(0,l[0].y,0)),V.push(new a.Vector3(Math.cos(M*x)*l[0].x*d,l[0].y,Math.sin(M*x)*l[0].x*d))),_=0;_<l.length;_++)o=new a.Vector3(Math.cos(M*x)*l[_].x*d,l[_].y,Math.sin(M*x)*l[_].x*d),V.push(o);g!=r.Mesh.CAP_END&&g!=r.Mesh.CAP_ALL||(V.push(new a.Vector3(Math.cos(M*x)*l[l.length-1].x*d,l[l.length-1].y,Math.sin(M*x)*l[l.length-1].x*d)),V.push(new a.Vector3(0,l[l.length-1].y,0))),C.push(V)}return t.CreateRibbon(e,{pathArray:C,closeArray:u,sideOrientation:f,updatable:p,invertUV:b,frontUVs:n.frontUVs,backUVs:n.backUVs},i)},t.CreatePlane=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreatePlane(a).applyToMesh(i,a.updatable),a.sourcePlane&&(i.translate(a.sourcePlane.normal,-a.sourcePlane.d),i.setDirection(a.sourcePlane.normal.scale(-1))),i},t.CreateGround=function(e,t,a){var r=new s.GroundMesh(e,a);return r._setReady(!1),r._subdivisionsX=t.subdivisionsX||t.subdivisions||1,r._subdivisionsY=t.subdivisionsY||t.subdivisions||1,r._width=t.width||1,r._height=t.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,o.VertexData.CreateGround(t).applyToMesh(r,t.updatable),r._setReady(!0),r},t.CreateTiledGround=function(e,t,a){var n=new r.Mesh(e,a);return o.VertexData.CreateTiledGround(t).applyToMesh(n,t.updatable),n},t.CreateGroundFromHeightMap=function(t,r,n,i){var u=n.width||10,l=n.height||10,d=n.subdivisions||1,h=n.minHeight||0,c=n.maxHeight||1,p=n.colorFilter||new a.Color3(.3,.59,.11),f=n.alphaFilter||0,g=n.updatable,v=n.onReady,C=new s.GroundMesh(t,i);C._subdivisionsX=d,C._subdivisionsY=d,C._width=u,C._height=l,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ,C._setReady(!1);return e.Tools.LoadImage(r,function(e){var t=document.createElement("canvas"),a=t.getContext("2d");if(!a)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!i.isDisposed){var r=e.width,n=e.height;t.width=r,t.height=n,a.drawImage(e,0,0);var s=a.getImageData(0,0,r,n).data;o.VertexData.CreateGroundFromHeightMap({width:u,height:l,subdivisions:d,minHeight:h,maxHeight:c,colorFilter:p,buffer:s,bufferWidth:r,bufferHeight:n,alphaFilter:f}).applyToMesh(C,g),v&&v(C),C._setReady(!0)}},function(){},i.offlineProvider),C},t.CreatePolygon=function(e,r,n){r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation);for(var i=r.shape,s=r.holes||[],l=r.depth||0,d=[],h=[],c=0;c<i.length;c++)d[c]=new a.Vector2(i[c].x,i[c].z);d[0].equalsWithEpsilon(d[d.length-1],1e-8)&&d.pop();for(var p=new u.PolygonMeshBuilder(e,d,n),f=0;f<s.length;f++){h=[];for(var g=0;g<s[f].length;g++)h.push(new a.Vector2(s[f][g].x,s[f][g].z));p.addHole(h)}var v=p.build(r.updatable,l);return v._originalBuilderSideOrientation=r.sideOrientation,o.VertexData.CreatePolygon(v,r.sideOrientation,r.faceUV,r.faceColors,r.frontUVs,r.backUVs).applyToMesh(v,r.updatable),v},t.ExtrudePolygon=function(e,a,r){return t.CreatePolygon(e,a,r)},t.CreateTube=function(e,n,i){var o=n.path,s=n.instance,u=1;void 0!==n.radius?u=n.radius:s&&(u=s._creationDataStorage.radius);var l=n.tessellation||64,d=n.radiusFunction||null,h=n.cap||r.Mesh.NO_CAP,c=n.invertUV||!1,p=n.updatable,f=t._UpdateSideOrientation(n.sideOrientation);n.arc=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1;var g,v,C=function(e,t,n,i,o,s,u,l){for(var d,h,c,p,f=t.getTangents(),g=t.getNormals(),v=t.getDistances(),C=2*Math.PI/o*l,b=s||function(){return i},M=a.Tmp.Matrix[0],_=u===r.Mesh.NO_CAP||u===r.Mesh.CAP_END?0:2,x=0;x<e.length;x++){h=b(x,v[x]),d=Array(),c=g[x];for(var V=0;V<o;V++)a.Matrix.RotationAxisToRef(f[x],C*V,M),p=d[V]?d[V]:a.Vector3.Zero(),a.Vector3.TransformCoordinatesToRef(c,M,p),p.scaleInPlace(h).addInPlace(e[x]),d[V]=p;n[_]=d,_++}var D=function(t,a){for(var r=Array(),n=0;n<t;n++)r.push(e[a]);return r};switch(u){case r.Mesh.NO_CAP:break;case r.Mesh.CAP_START:n[0]=D(o,0),n[1]=n[2].slice(0);break;case r.Mesh.CAP_END:n[_]=n[_-1].slice(0),n[_+1]=D(o,e.length-1);break;case r.Mesh.CAP_ALL:n[0]=D(o,0),n[1]=n[2].slice(0),n[_]=n[_-1].slice(0),n[_+1]=D(o,e.length-1)}return n};if(s){var b=s._creationDataStorage,M=n.arc||b.arc;return v=C(o,g=b.path3D.update(o),b.pathArray,u,b.tessellation,d,b.cap,M),s=t.CreateRibbon("",{pathArray:v,instance:s}),b.path3D=g,b.pathArray=v,b.arc=M,b.radius=u,s}v=C(o,g=new a.Path3D(o),new Array,u,l,d,h=h<0||h>3?0:h,n.arc);var _=t.CreateRibbon(e,{pathArray:v,closePath:!0,closeArray:!1,updatable:p,sideOrientation:f,invertUV:c,frontUVs:n.frontUVs,backUVs:n.backUVs},i);return _._creationDataStorage.pathArray=v,_._creationDataStorage.path3D=g,_._creationDataStorage.tessellation=l,_._creationDataStorage.cap=h,_._creationDataStorage.arc=n.arc,_._creationDataStorage.radius=u,_},t.CreatePolyhedron=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreatePolyhedron(a).applyToMesh(i,a.updatable),i},t.CreateDecal=function(e,t,i){var s=t.getIndices(),u=t.getVerticesData(n.VertexBuffer.PositionKind),l=t.getVerticesData(n.VertexBuffer.NormalKind),d=i.position||a.Vector3.Zero(),h=i.normal||a.Vector3.Up(),c=i.size||a.Vector3.One(),p=i.angle||0;if(!h){var f=new a.Vector3(0,0,1),g=t.getScene().activeCamera,v=a.Vector3.TransformCoordinates(f,g.getWorldMatrix());h=g.globalPosition.subtract(v)}var C=-Math.atan2(h.z,h.x)-Math.PI/2,b=Math.sqrt(h.x*h.x+h.z*h.z),M=Math.atan2(h.y,b),_=a.Matrix.RotationYawPitchRoll(C,M,p).multiply(a.Matrix.Translation(d.x,d.y,d.z)),x=a.Matrix.Invert(_),V=t.getWorldMatrix().multiply(x),D=new o.VertexData;D.indices=[],D.positions=[],D.normals=[],D.uvs=[];for(var y=0,m=function(e){var t=new a.PositionNormalVertex;if(!s||!u||!l)return t;var r=s[e];return t.position=new a.Vector3(u[3*r],u[3*r+1],u[3*r+2]),t.position=a.Vector3.TransformCoordinates(t.position,V),t.normal=new a.Vector3(l[3*r],l[3*r+1],l[3*r+2]),t.normal=a.Vector3.TransformNormal(t.normal,V),t},S=function(e,t){if(0===e.length)return e;for(var r=.5*Math.abs(a.Vector3.Dot(c,t)),n=function(e,n){var i=a.Vector3.GetClipFactor(e.position,n.position,t,r);return new a.PositionNormalVertex(a.Vector3.Lerp(e.position,n.position,i),a.Vector3.Lerp(e.normal,n.normal,i))},i=new Array,o=0;o<e.length;o+=3){var s,u,l,d=null,h=null,p=null,f=null;switch(((s=a.Vector3.Dot(e[o].position,t)-r>0)?1:0)+((u=a.Vector3.Dot(e[o+1].position,t)-r>0)?1:0)+((l=a.Vector3.Dot(e[o+2].position,t)-r>0)?1:0)){case 0:i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]);break;case 1:if(s&&(d=e[o+1],h=e[o+2],p=n(e[o],d),f=n(e[o],h)),u){d=e[o],h=e[o+2],p=n(e[o+1],d),f=n(e[o+1],h),i.push(p),i.push(h.clone()),i.push(d.clone()),i.push(h.clone()),i.push(p.clone()),i.push(f);break}l&&(d=e[o],h=e[o+1],p=n(e[o+2],d),f=n(e[o+2],h)),d&&h&&p&&f&&(i.push(d.clone()),i.push(h.clone()),i.push(p),i.push(f),i.push(p.clone()),i.push(h.clone()));break;case 2:s||(h=n(d=e[o].clone(),e[o+1]),p=n(d,e[o+2]),i.push(d),i.push(h),i.push(p)),u||(h=n(d=e[o+1].clone(),e[o+2]),p=n(d,e[o]),i.push(d),i.push(h),i.push(p)),l||(h=n(d=e[o+2].clone(),e[o]),p=n(d,e[o+1]),i.push(d),i.push(h),i.push(p))}}return i},O=0;O<s.length;O+=3){var P=new Array;if(P.push(m(O)),P.push(m(O+1)),P.push(m(O+2)),P=S(P,new a.Vector3(1,0,0)),P=S(P,new a.Vector3(-1,0,0)),P=S(P,new a.Vector3(0,1,0)),P=S(P,new a.Vector3(0,-1,0)),P=S(P,new a.Vector3(0,0,1)),0!==(P=S(P,new a.Vector3(0,0,-1))).length)for(var A=0;A<P.length;A++){var w=P[A];D.indices.push(y),w.position.toArray(D.positions,3*y),w.normal.toArray(D.normals,3*y),D.uvs.push(.5+w.position.x/c.x),D.uvs.push(.5+w.position.y/c.y),y++}}var T=new r.Mesh(e,t.getScene());return D.applyToMesh(T),T.position=d.clone(),T.rotation=new a.Vector3(M,C,p),T},t._ExtrudeShapeGeneric=function(e,n,i,o,s,u,l,d,h,c,p,f,g,v,C,b,M,_){var x,V,D=function(e,t,n,i,o,s,u,l,d,h){for(var c=n.getTangents(),p=n.getNormals(),f=n.getBinormals(),g=n.getDistances(),v=0,C=h&&l?l:function(){return null!==s?s:0},b=h&&u?u:function(){return null!==o?o:1},M=d===r.Mesh.NO_CAP||d===r.Mesh.CAP_END?0:2,_=a.Tmp.Matrix[0],x=0;x<t.length;x++){for(var V=new Array,D=C(x,g[x]),y=b(x,g[x]),m=0;m<e.length;m++){a.Matrix.RotationAxisToRef(c[x],v,_);var S=c[x].scale(e[m].z).add(p[x].scale(e[m].x)).add(f[x].scale(e[m].y)),O=V[m]?V[m]:a.Vector3.Zero();a.Vector3.TransformCoordinatesToRef(S,_,O),O.scaleInPlace(y).addInPlace(t[x]),V[m]=O}i[M]=V,v+=D,M++}var P=function(e){var t,r=Array(),n=a.Vector3.Zero();for(t=0;t<e.length;t++)n.addInPlace(e[t]);for(n.scaleInPlace(1/e.length),t=0;t<e.length;t++)r.push(n);return r};switch(d){case r.Mesh.NO_CAP:break;case r.Mesh.CAP_START:i[0]=P(i[2]),i[1]=i[2];break;case r.Mesh.CAP_END:i[M]=i[M-1],i[M+1]=P(i[M-1]);break;case r.Mesh.CAP_ALL:i[0]=P(i[2]),i[1]=i[2],i[M]=i[M-1],i[M+1]=P(i[M-1])}return i};if(C){var y=C._creationDataStorage;return x=y.path3D.update(i),V=D(n,i,y.path3D,y.pathArray,o,s,u,l,y.cap,p),C=r.Mesh.CreateRibbon("",V,!1,!1,0,f||void 0,!1,0,C)}V=D(n,i,x=new a.Path3D(i),new Array,o,s,u,l,c=c<0||c>3?0:c,p);var m=t.CreateRibbon(e,{pathArray:V,closeArray:d,closePath:h,updatable:g,sideOrientation:v,invertUV:b,frontUVs:M||void 0,backUVs:_||void 0},f);return m._creationDataStorage.pathArray=V,m._creationDataStorage.path3D=x,m._creationDataStorage.cap=c,m},t}();exports.MeshBuilder=d;
},{"../Misc/tools":"RkuS","../scene":"FKAx","../Maths/math":"Iizi","./mesh":"aXN+","./buffer":"YHhW","./linesMesh":"ztjm","./mesh.vertexData":"+kld","./groundMesh":"JvWG","./polygonMesh":"t6eO","../Culling/boundingInfo":"1eEz"}],"ji3V":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTargetTexture=void 0;var e=h(require("tslib")),t=require("../../Misc/observable"),r=require("../../Misc/tools"),i=require("../../Maths/math"),s=require("../../Materials/Textures/texture"),n=require("../../PostProcesses/postProcessManager"),o=require("../../Rendering/renderingManager"),a=require("../../Engines/constants");function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var d=function(h){function d(e,r,n,d,u,c,g,p,f,l,_,b,v){void 0===u&&(u=!0),void 0===c&&(c=a.Constants.TEXTURETYPE_UNSIGNED_INT),void 0===g&&(g=!1),void 0===p&&(p=s.Texture.TRILINEAR_SAMPLINGMODE),void 0===f&&(f=!0),void 0===l&&(l=!1),void 0===_&&(_=!1),void 0===b&&(b=a.Constants.TEXTUREFORMAT_RGBA),void 0===v&&(v=!1);var R=h.call(this,null,n,!d)||this;return R.isCube=g,R.renderParticles=!0,R.renderSprites=!1,R.coordinatesMode=s.Texture.PROJECTION_MODE,R.ignoreCameraViewport=!1,R.onBeforeBindObservable=new t.Observable,R.onAfterUnbindObservable=new t.Observable,R.onBeforeRenderObservable=new t.Observable,R.onAfterRenderObservable=new t.Observable,R.onClearObservable=new t.Observable,R._currentRefreshId=-1,R._refreshRate=1,R._samples=1,R.boundingBoxPosition=i.Vector3.Zero(),(n=R.getScene())?(R.renderList=new Array,R._engine=n.getEngine(),R.name=e,R.isRenderTarget=!0,R._initialSizeParameter=r,R._processSizeParameter(r),R._resizeObserver=R.getScene().getEngine().onResizeObservable.add(function(){}),R._generateMipMaps=!!d,R._doNotChangeAspectRatio=u,R._renderingManager=new o.RenderingManager(n),R._renderingManager._useSceneAutoClearSetup=!0,_?R:(R._renderTargetOptions={generateMipMaps:d,type:c,format:b,samplingMode:p,generateDepthBuffer:f,generateStencilBuffer:l},p===s.Texture.NEAREST_SAMPLINGMODE&&(R.wrapU=s.Texture.CLAMP_ADDRESSMODE,R.wrapV=s.Texture.CLAMP_ADDRESSMODE),v||(g?(R._texture=n.getEngine().createRenderTargetCubeTexture(R.getRenderSize(),R._renderTargetOptions),R.coordinatesMode=s.Texture.INVCUBIC_MODE,R._textureMatrix=i.Matrix.Identity()):R._texture=n.getEngine().createRenderTargetTexture(R._size,R._renderTargetOptions)),R)):R}return e.__extends(d,h),Object.defineProperty(d.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),d.prototype._hookArray=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var n=0===e.length,o=r.apply(e,i);return n&&t.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),o};var i=e.splice;e.splice=function(r,s){var n=i.apply(e,[r,s]);return 0===e.length&&t.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),n}},Object.defineProperty(d.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),d.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(d.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(a.Constants.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),d.prototype.createDepthStencilTexture=function(e,t,r){if(void 0===e&&(e=0),void 0===t&&(t=!0),void 0===r&&(r=!1),this.getScene()){var i=this.getScene().getEngine();this.depthStencilTexture=i.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:r,isCube:this.isCube}),i.setFrameBufferDepthStencilTexture(this)}},d.prototype._processSizeParameter=function(e){e.ratio?(this._sizeRatio=e.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=e},Object.defineProperty(d.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var t=this.getScene();t&&(this._samples=t.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!0,configurable:!0}),d.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(d.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),d.prototype.addPostProcess=function(e){if(!this._postProcessManager){var t=this.getScene();if(!t)return;this._postProcessManager=new n.PostProcessManager(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},d.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,r=this._postProcesses;t<r.length;t++){r[t].dispose()}this._postProcesses=[]}},d.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},d.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},d.prototype.getRenderSize=function(){return this.getRenderWidth()},d.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},d.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},Object.defineProperty(d.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),d.prototype.scale=function(e){var t=this.getRenderSize()*e;this.resize(t)},d.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:h.prototype.getReflectionTextureMatrix.call(this)},d.prototype.resize=function(e){this.releaseInternalTexture();var t=this.getScene();t&&(this._processSizeParameter(e),this.isCube?this._texture=t.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._texture=t.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions))},d.prototype.render=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),a=this.getScene()){var r,i=a.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var s=0;s<this._waitingRenderList.length;s++){var n=this._waitingRenderList[s],o=a.getMeshByID(n);o&&this.renderList.push(o)}delete this._waitingRenderList}if(this.renderListPredicate){var a;if(this.renderList?this.renderList.length=0:this.renderList=[],!(a=this.getScene()))return;var h=a.meshes;for(s=0;s<h.length;s++){var d=h[s];this.renderListPredicate(d)&&this.renderList.push(d)}}this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(r=this.activeCamera,i.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==a.activeCamera&&a.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(r=a.activeCamera)&&i.setViewport(r.viewport,this.getRenderWidth(),this.getRenderHeight()),this._renderingManager.reset();for(var u=this.renderList?this.renderList:a.getActiveMeshes().data,c=this.renderList?this.renderList.length:a.getActiveMeshes().length,g=a.getRenderId(),p=0;p<c;p++){if(d=u[p]){if(!d.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}d._preActivateForIntermediateRendering(g);var f=void 0;if(f=!(this.renderList||!r)&&0==(d.layerMask&r.layerMask),d.isEnabled()&&d.isVisible&&d.subMeshes&&!f){d._activate(g);for(var l=0;l<d.subMeshes.length;l++){var _=d.subMeshes[l];a._activeIndices.addCount(_.indexCount,!1),this._renderingManager.dispatch(_,d)}}}}for(var b=0;b<a.particleSystems.length;b++){var v=a.particleSystems[b],R=v.emitter;v.isStarted()&&R&&R.position&&R.isEnabled()&&(u.indexOf(R)>=0&&this._renderingManager.dispatchParticles(v))}if(this.isCube)for(var O=0;O<6;O++)this.renderToTarget(O,u,e,t),a.incrementRenderId(),a.resetCachedMaterial();else this.renderToTarget(0,u,e,t);this.onAfterUnbindObservable.notifyObservers(this),a.activeCamera&&(this.activeCamera&&this.activeCamera!==a.activeCamera&&a.setTransformMatrix(a.activeCamera.getViewMatrix(),a.activeCamera.getProjectionMatrix(!0)),i.setViewport(a.activeCamera.viewport)),a.resetCachedMaterial()}},d.prototype._bestReflectionRenderTargetDimension=function(e,t){var i=e*t,s=r.Tools.NearestPOT(i+16384/(128+i));return Math.min(r.Tools.FloorPOT(e),s)},d.prototype.unbindFrameBuffer=function(e,t){var r=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,function(){r.onAfterRenderObservable.notifyObservers(t)})},d.prototype.renderToTarget=function(e,t,i,s){var n=this.getScene();if(n){var o=n.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):i&&n.postProcessManager._prepareFrame(this._texture)||this._texture&&o.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,this.depthStencilTexture?this.depthStencilTexture:void 0),this.onBeforeRenderObservable.notifyObservers(e),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(o):o.clear(this.clearColor||n.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0);for(var a=0,h=n._beforeRenderTargetDrawStage;a<h.length;a++){h[a].action(this)}this._renderingManager.render(this.customRenderFunction,t,this.renderParticles,this.renderSprites);for(var d=0,u=n._afterRenderTargetDrawStage;d<u.length;d++){u[d].action(this)}this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):i&&n.postProcessManager._finalizeFrame(!1,this._texture,e),this._doNotChangeAspectRatio||n.updateTransformMatrix(!0),s&&r.Tools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),o),this.isCube&&5!==e?this.onAfterRenderObservable.notifyObservers(e):(this.isCube&&5===e&&o.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(o,e))}}},d.prototype.setRenderingOrder=function(e,t,r,i){void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,r,i)},d.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},d.prototype.clone=function(){var e=this.getSize(),t=new d(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t},d.prototype.serialize=function(){if(!this.name)return null;var e=h.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e},d.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),t=this.getScene();e&&t&&t.getEngine()._releaseFramebufferObjects(e)},d.prototype.dispose=function(){this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var e=this.getScene();if(e){var t=e.customRenderTargets.indexOf(this);t>=0&&e.customRenderTargets.splice(t,1);for(var r=0,i=e.cameras;r<i.length;r++){var s=i[r];(t=s.customRenderTargets.indexOf(this))>=0&&s.customRenderTargets.splice(t,1)}h.prototype.dispose.call(this)}},d.prototype._rebuild=function(){this.refreshRate===d.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=d.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},d.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},d.REFRESHRATE_RENDER_ONCE=0,d.REFRESHRATE_RENDER_ONEVERYFRAME=1,d.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,d}(s.Texture);exports.RenderTargetTexture=d,s.Texture._CreateRenderTargetTexture=function(e,t,r,i){return new d(e,t,r,i)};
},{"tslib":"vCxL","../../Misc/observable":"gtkL","../../Misc/tools":"RkuS","../../Maths/math":"Iizi","../../Materials/Textures/texture":"KNsj","../../PostProcesses/postProcessManager":"Rqxo","../../Rendering/renderingManager":"6R9t","../../Engines/constants":"vn8z"}],"4pyA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.kernelBlurVaryingDeclaration=void 0;var e=require("../../Materials/effect"),r="kernelBlurVaryingDeclaration",a="varying vec2 sampleCoord{X};";e.Effect.IncludesShadersStore[r]=a;var l={name:r,shader:a};exports.kernelBlurVaryingDeclaration=l;
},{"../../Materials/effect":"Ru7D"}],"1n4+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.kernelBlurFragment=void 0;var e=require("../../Materials/effect"),t="kernelBlurFragment",r="#ifdef DOF\nfactor=sampleCoC(sampleCoord{X});\ncomputedWeight=KERNEL_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif";e.Effect.IncludesShadersStore[t]=r;var n={name:t,shader:r};exports.kernelBlurFragment=n;
},{"../../Materials/effect":"Ru7D"}],"P0il":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.kernelBlurFragment2=void 0;var e=require("../../Materials/effect"),t="kernelBlurFragment2",r="#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});\ncomputedWeight=KERNEL_DEP_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif";e.Effect.IncludesShadersStore[t]=r;var n={name:t,shader:r};exports.kernelBlurFragment2=n;
},{"../../Materials/effect":"Ru7D"}],"x6ID":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.kernelBlurPixelShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/kernelBlurVaryingDeclaration"),require("./ShadersInclude/kernelBlurFragment"),require("./ShadersInclude/kernelBlurFragment2");var n="kernelBlurPixelShader",r="\nuniform sampler2D textureSampler;\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;\nuniform vec2 cameraMinMaxZ;\nfloat sampleDistance(const in vec2 offset) {\nfloat depth=texture2D(circleOfConfusionSampler,offset).g;\nreturn cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;\n}\nfloat sampleCoC(const in vec2 offset) {\nfloat coc=texture2D(circleOfConfusionSampler,offset).r;\nreturn coc;\n}\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nvoid main(void)\n{\nfloat computedWeight=0.0;\n#ifdef PACKEDFLOAT\nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT;\nfloat factor=0.0;\n\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}";e.Effect.ShadersStore[n]=r;var t={name:n,shader:r};exports.kernelBlurPixelShader=t;
},{"../Materials/effect":"Ru7D","./ShadersInclude/kernelBlurVaryingDeclaration":"4pyA","./ShadersInclude/kernelBlurFragment":"1n4+","./ShadersInclude/kernelBlurFragment2":"P0il"}],"gUWA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.kernelBlurVertex=void 0;var e=require("../../Materials/effect"),r="kernelBlurVertex",t="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};";e.Effect.IncludesShadersStore[r]=t;var l={name:r,shader:t};exports.kernelBlurVertex=l;
},{"../../Materials/effect":"Ru7D"}],"YpOB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.kernelBlurVertexShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/kernelBlurVaryingDeclaration"),require("./ShadersInclude/kernelBlurVertex");var r="kernelBlurVertexShader",n="\nattribute vec2 position;\n\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n}";e.Effect.ShadersStore[r]=n;var a={name:r,shader:n};exports.kernelBlurVertexShader=a;
},{"../Materials/effect":"Ru7D","./ShadersInclude/kernelBlurVaryingDeclaration":"4pyA","./ShadersInclude/kernelBlurVertex":"gUWA"}],"8dq3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BlurPostProcess=void 0;var e=o(require("tslib")),t=require("./postProcess"),r=require("../Materials/Textures/texture"),i=require("../Engines/constants");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}require("../Shaders/kernelBlur.fragment"),require("../Shaders/kernelBlur.vertex");var n=function(t){function o(e,o,n,a,s,l,u,p,c,h,d){void 0===l&&(l=r.Texture.BILINEAR_SAMPLINGMODE),void 0===c&&(c=i.Constants.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=""),void 0===d&&(d=!1);var f=t.call(this,e,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],a,s,l,u,p,null,c,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return f.direction=o,f.blockCompilation=d,f._packedFloat=!1,f._staticDefines="",f._staticDefines=h,f.onApplyObservable.add(function(e){f._outputTexture?e.setFloat2("delta",1/f._outputTexture.width*f.direction.x,1/f._outputTexture.height*f.direction.y):e.setFloat2("delta",1/f.width*f.direction.x,1/f.height*f.direction.y)}),f.kernel=n,f}return e.__extends(o,t),Object.defineProperty(o.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),o.prototype.updateEffect=function(e,t,r,i,o,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),this._updateParameters(o,n)},o.prototype._updateParameters=function(e,r){for(var i=this._kernel,o=(i-1)/2,n=[],a=[],s=0,l=0;l<i;l++){var u=l/(i-1),p=this._gaussianWeight(2*u-1);n[l]=l-o,a[l]=p,s+=p}for(l=0;l<a.length;l++)a[l]/=s;var c=[],h=[],d=[];for(l=0;l<=o;l+=2){var f=Math.min(l+1,Math.floor(o));if(l===f)d.push({o:n[l],w:a[l]});else{var _=f===o,g=a[l]+a[f]*(_?.5:1),v=n[l]+1/(1+a[l]/a[f]);0===v?(d.push({o:n[l],w:a[l]}),d.push({o:n[l+1],w:a[l+1]})):(d.push({o:v,w:g}),d.push({o:-v,w:g}))}}for(l=0;l<d.length;l++)h[l]=d[l].o,c[l]=d[l].w;n=h,a=c;var E=this.getEngine().getCaps().maxVaryingVectors,P=Math.max(E,0)-1,y=Math.min(n.length,P),x="";x+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(x+="#define CENTER_WEIGHT "+this._glslFloat(a[y-1])+"\r\n",y--);for(l=0;l<y;l++)x+="#define KERNEL_OFFSET"+l+" "+this._glslFloat(n[l])+"\r\n",x+="#define KERNEL_WEIGHT"+l+" "+this._glslFloat(a[l])+"\r\n";var F=0;for(l=P;l<n.length;l++)x+="#define KERNEL_DEP_OFFSET"+F+" "+this._glslFloat(n[l])+"\r\n",x+="#define KERNEL_DEP_WEIGHT"+F+" "+this._glslFloat(a[l])+"\r\n",F++;this.packedFloat&&(x+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,t.prototype.updateEffect.call(this,x,null,null,{varyingCount:y,depCount:F},e,r)},o.prototype._nearestBestKernel=function(e){for(var t=Math.round(e),r=0,i=[t,t-1,t+1,t-2,t+2];r<i.length;r++){var o=i[r];if(o%2!=0&&Math.floor(o/2)%2==0&&o>0)return Math.max(o,3)}return Math.max(t,3)},o.prototype._gaussianWeight=function(e){var t=-e*e/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(t)},o.prototype._glslFloat=function(e,t){return void 0===t&&(t=8),e.toFixed(t).replace(/0+$/,"")},o}(t.PostProcess);exports.BlurPostProcess=n;
},{"tslib":"vCxL","./postProcess":"pczz","../Materials/Textures/texture":"KNsj","../Engines/constants":"vn8z","../Shaders/kernelBlur.fragment":"x6ID","../Shaders/kernelBlur.vertex":"YpOB"}],"yRMj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shadowMapPixelShader=void 0;var e=require("../Materials/effect"),n="shadowMapPixelShader",a="#ifndef FLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=vDepthMetric;\n#ifdef ESM\ndepth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);\n#endif\n#ifdef FLOAT\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depth);\n#endif\n}";e.Effect.ShadersStore[n]=a;var i={name:n,shader:a};exports.shadowMapPixelShader=i;
},{"../Materials/effect":"Ru7D"}],"NDwH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.morphTargetsVertexGlobalDeclaration=void 0;var e=require("../../Materials/effect"),r="morphTargetsVertexGlobalDeclaration",a="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif";e.Effect.IncludesShadersStore[r]=a;var t={name:r,shader:a};exports.morphTargetsVertexGlobalDeclaration=t;
},{"../../Materials/effect":"Ru7D"}],"qccd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.morphTargetsVertexDeclaration=void 0;var e=require("../../Materials/effect"),t="morphTargetsVertexDeclaration",r="#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#endif";e.Effect.IncludesShadersStore[t]=r;var a={name:t,shader:r};exports.morphTargetsVertexDeclaration=a;
},{"../../Materials/effect":"Ru7D"}],"yU4e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.helperFunctions=void 0;var a=require("../../Materials/effect"),n="helperFunctions",e="const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nvec3 applyEaseInOut(vec3 x){\nreturn x*x*(3.0-2.0*x);\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=max(0.0000001,max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D);\n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}";a.Effect.IncludesShadersStore[n]=e;var r={name:n,shader:e};exports.helperFunctions=r;
},{"../../Materials/effect":"Ru7D"}],"71sF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.morphTargetsVertex=void 0;var e=require("../../Materials/effect"),n="morphTargetsVertex",r="#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=r;var t={name:n,shader:r};exports.morphTargetsVertex=t;
},{"../../Materials/effect":"Ru7D"}],"hvsq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shadowMapVertexShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/bonesDeclaration"),require("./ShadersInclude/morphTargetsVertexGlobalDeclaration"),require("./ShadersInclude/morphTargetsVertexDeclaration"),require("./ShadersInclude/instancesDeclaration"),require("./ShadersInclude/helperFunctions"),require("./ShadersInclude/morphTargetsVertex"),require("./ShadersInclude/instancesVertex"),require("./ShadersInclude/bonesVertex");var n="shadowMapVertexShader",r="\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\nuniform vec3 lightData;\n#endif\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\n#include<helperFunctions>\nuniform mat4 viewProjection;\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvec3 worldNor=normalize(normalWorld*normal);\n#ifdef DIRECTIONINLIGHTDATA\nvec3 worldLightDir=normalize(-lightData.xyz);\n#else\nvec3 directionToLight=lightData.xyz-worldPos.xyz;\nvec3 worldLightDir=normalize(directionToLight);\n#endif\nfloat ndl=dot(worldNor,worldLightDir);\nfloat sinNL=sqrt(1.0-ndl*ndl);\nfloat normalBias=biasAndScale.y*sinNL;\nworldPos.xyz-=worldNor*normalBias;\n#endif\n\ngl_Position=viewProjection*worldPos;\n#ifdef DEPTHTEXTURE\n\ngl_Position.z+=biasAndScale.x*gl_Position.w;\n#endif\n\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}";e.Effect.ShadersStore[n]=r;var i={name:n,shader:r};exports.shadowMapVertexShader=i;
},{"../Materials/effect":"Ru7D","./ShadersInclude/bonesDeclaration":"1TNa","./ShadersInclude/morphTargetsVertexGlobalDeclaration":"NDwH","./ShadersInclude/morphTargetsVertexDeclaration":"qccd","./ShadersInclude/instancesDeclaration":"YHup","./ShadersInclude/helperFunctions":"yU4e","./ShadersInclude/morphTargetsVertex":"71sF","./ShadersInclude/instancesVertex":"yjPN","./ShadersInclude/bonesVertex":"60le"}],"ioNA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.depthBoxBlurPixelShader=void 0;var e=require("../Materials/effect"),r="depthBoxBlurPixelShader",t="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}";e.Effect.ShadersStore[r]=t;var o={name:r,shader:t};exports.depthBoxBlurPixelShader=o;
},{"../Materials/effect":"Ru7D"}],"ssXa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShadowGenerator=void 0;var e=p(require("tslib")),t=require("../../Maths/math"),i=require("../../Meshes/buffer"),s=require("../../Lights/light"),r=require("../../Materials/material"),n=require("../../Materials/materialHelper"),a=require("../../Materials/Textures/texture"),o=require("../../Materials/Textures/renderTargetTexture"),h=require("../../PostProcesses/postProcess"),l=require("../../PostProcesses/blurPostProcess"),u=require("../../Engines/constants");function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};s.get||s.set?Object.defineProperty(t,i,s):t[i]=e[i]}return t.default=e,t}require("../../Shaders/shadowMap.fragment"),require("../../Shaders/shadowMap.vertex"),require("../../Shaders/depthBoxBlur.fragment");var d=function(){function p(e,i,s){this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=p.FILTER_NONE,this._filteringQuality=p.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=t.Vector3.Zero(),this._viewMatrix=t.Matrix.Zero(),this._projectionMatrix=t.Matrix.Zero(),this._transformMatrix=t.Matrix.Zero(),this._cachedPosition=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=t.Matrix.Identity(),this._mapSize=e,this._light=i,this._scene=i.getScene(),i._shadowGenerator=this,p._SceneComponentInitialization(this._scene);var r=this._scene.getEngine().getCaps();s?r.textureFloatRender&&r.textureFloatLinearFiltering?this._textureType=u.Constants.TEXTURETYPE_FLOAT:r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?this._textureType=u.Constants.TEXTURETYPE_HALF_FLOAT:this._textureType=u.Constants.TEXTURETYPE_UNSIGNED_INT:r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?this._textureType=u.Constants.TEXTURETYPE_HALF_FLOAT:r.textureFloatRender&&r.textureFloatLinearFiltering?this._textureType=u.Constants.TEXTURETYPE_FLOAT:this._textureType=u.Constants.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(p.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"normalBias",{get:function(){return this._normalBias},set:function(e){this._normalBias=e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"blurScale",{get:function(){return this._blurScale},set:function(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(e){this._depthScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"filter",{get:function(){return this._filter},set:function(e){if(this._light.needCube()){if(e===p.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(e===p.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(e===p.FILTER_PCF||e===p.FILTER_PCSS)return void(this.usePoissonSampling=!0)}e!==p.FILTER_PCF&&e!==p.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==e&&(this._filter=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"usePoissonSampling",{get:function(){return this.filter===p.FILTER_POISSONSAMPLING},set:function(e){(e||this.filter===p.FILTER_POISSONSAMPLING)&&(this.filter=e?p.FILTER_POISSONSAMPLING:p.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useExponentialShadowMap",{get:function(){return this.filter===p.FILTER_EXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===p.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=e?p.FILTER_EXPONENTIALSHADOWMAP:p.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===p.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===p.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=e?p.FILTER_BLUREXPONENTIALSHADOWMAP:p.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===p.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===p.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?p.FILTER_CLOSEEXPONENTIALSHADOWMAP:p.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===p.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===p.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?p.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:p.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===p.FILTER_PCF},set:function(e){(e||this.filter===p.FILTER_PCF)&&(this.filter=e?p.FILTER_PCF:p.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(e){this._filteringQuality=e},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"useContactHardeningShadow",{get:function(){return this.filter===p.FILTER_PCSS},set:function(e){(e||this.filter===p.FILTER_PCSS)&&(this.filter=e?p.FILTER_PCSS:p.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(e){this._contactHardeningLightSizeUVRatio=e},enumerable:!0,configurable:!0}),p.prototype.getDarkness=function(){return this._darkness},p.prototype.setDarkness=function(e){return this._darkness=e>=1?1:e<=0?0:e,this},p.prototype.setTransparencyShadow=function(e){return this._transparencyShadow=e,this},p.prototype.getShadowMap=function(){return this._shadowMap},p.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},p.prototype.addShadowCaster=function(e,t){var i;return void 0===t&&(t=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(e),t&&(i=this._shadowMap.renderList).push.apply(i,e.getChildMeshes()),this):this},p.prototype.removeShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var i=this._shadowMap.renderList.indexOf(e);if(-1!==i&&this._shadowMap.renderList.splice(i,1),t)for(var s=0,r=e.getChildren();s<r.length;s++){var n=r[s];this.removeShadowCaster(n)}return this},p.prototype.getLight=function(){return this._light},p.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},p.prototype._initializeShadowMap=function(){var e=this,i=this._scene.getEngine();i.webGLVersion>1?(this._shadowMap=new o.RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(u.Constants.LESS,!0)):this._shadowMap=new o.RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=a.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(a.Texture.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add(function(t){e._currentFaceIndex=t,e._filter===p.FILTER_PCF&&i.setColorWrite(!1)}),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add(function(){if(e._filter===p.FILTER_PCF&&i.setColorWrite(!0),e.useBlurExponentialShadowMap||e.useBlurCloseExponentialShadowMap){var t=e.getShadowMapForRendering();t&&e._scene.postProcessManager.directRender(e._blurPostProcesses,t.getInternalTexture(),!0)}});var s=new t.Color4(0,0,0,0),r=new t.Color4(1,1,1,1);this._shadowMap.onClearObservable.add(function(t){e._filter===p.FILTER_PCF?t.clear(r,!1,!0,!1):e.useExponentialShadowMap||e.useBlurExponentialShadowMap?t.clear(s,!0,!0,!1):t.clear(r,!0,!0,!1)})},p.prototype._initializeBlurRTTAndPostProcesses=function(){var e=this,i=this._scene.getEngine(),s=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new o.RenderTargetTexture(this._light.name+"_shadowMap2",s,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=a.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(a.Texture.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new l.BlurPostProcess(this._light.name+"KernelBlurX",new t.Vector2(1,0),this.blurKernel,1,null,a.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._textureType),this._kernelBlurXPostprocess.width=s,this._kernelBlurXPostprocess.height=s,this._kernelBlurXPostprocess.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._shadowMap)}),this._kernelBlurYPostprocess=new l.BlurPostProcess(this._light.name+"KernelBlurY",new t.Vector2(0,1),this.blurKernel,1,null,a.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===u.Constants.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new h.PostProcess(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,a.Texture.BILINEAR_SAMPLINGMODE,i,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(t){t.setFloat2("screenSize",s,s),t.setTexture("textureSampler",e._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},p.prototype._renderForShadowMap=function(e,t,i,s){var r,n=this._scene.getEngine();if(s.length){for(n.setColorWrite(!1),r=0;r<s.length;r++)this._renderSubMeshForShadowMap(s.data[r]);n.setColorWrite(!0)}for(r=0;r<e.length;r++)this._renderSubMeshForShadowMap(e.data[r]);for(r=0;r<t.length;r++)this._renderSubMeshForShadowMap(t.data[r]);if(this._transparencyShadow)for(r=0;r<i.length;r++)this._renderSubMeshForShadowMap(i.data[r])},p.prototype._renderSubMeshForShadowMap=function(e){var t=this,i=e.getRenderingMesh(),a=this._scene,o=a.getEngine(),h=e.getMaterial();if(h&&0!==e.verticesCount){o.setState(h.backFaceCulling);var l=i._getInstancesRenderList(e._id);if(!l.mustReturn){var u=o.getCaps().instancedArrays&&null!==l.visibleInstances[e._id]&&void 0!==l.visibleInstances[e._id];if(this.isReady(e,u)){if(o.enableEffect(this._effect),i._bind(e,this._effect,r.Material.TriangleFillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===s.Light.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),a.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(a.activeCamera),this.getLight().getDepthMinZ(a.activeCamera)+this.getLight().getDepthMaxZ(a.activeCamera)),h&&h.needAlphaTesting()){var p=h.getAlphaTestTexture();p&&(this._effect.setTexture("diffuseSampler",p),this._effect.setMatrix("diffuseMatrix",p.getTextureMatrix()||this._defaultTextureMatrix))}if(i.useBones&&i.computeBonesUsingShaders&&i.skeleton){var d=i.skeleton;if(d.isUsingTextureForMatrices){var c=d.getTransformMatrixTexture();if(!c)return;this._effect.setTexture("boneSampler",c),this._effect.setFloat("boneTextureWidth",4*(d.bones.length+1))}else this._effect.setMatrices("mBones",d.getTransformMatrices(i))}n.MaterialHelper.BindMorphTargetParameters(i,this._effect),this.forceBackFacesOnly&&o.setState(!0,0,!1,!0),i._processRendering(e,this._effect,r.Material.TriangleFillMode,l,u,function(e,i){return t._effect.setMatrix("world",i)}),this.forceBackFacesOnly&&o.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},p.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===p.FILTER_NONE||this.filter===p.FILTER_PCSS?this._shadowMap.updateSamplingMode(a.Texture.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(a.Texture.BILINEAR_SAMPLINGMODE))},p.prototype.forceCompilation=function(t,i){var s=this,r=e.__assign({useInstances:!1},i),n=this.getShadowMap();if(n){var a=n.renderList;if(a){for(var o=new Array,h=0,l=a;h<l.length;h++){var u=l[h];o.push.apply(o,u.subMeshes)}if(0!==o.length){var p=0,d=function(){if(s._scene&&s._scene.getEngine()){for(;s.isReady(o[p],r.useInstances);)if(++p>=o.length)return void(t&&t(s));setTimeout(d,16)}};d()}else t&&t(this)}else t&&t(this)}else t&&t(this)},p.prototype.forceCompilationAsync=function(e){var t=this;return new Promise(function(i){t.forceCompilation(function(){i()},e)})},p.prototype.isReady=function(e,t){var r=[];this._textureType!==u.Constants.TEXTURETYPE_UNSIGNED_INT&&r.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?r.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&r.push("#define DEPTHTEXTURE");var a=[i.VertexBuffer.PositionKind],o=e.getMesh(),h=e.getMaterial();if(this.normalBias&&o.isVerticesDataPresent(i.VertexBuffer.NormalKind)&&(a.push(i.VertexBuffer.NormalKind),r.push("#define NORMAL"),o.nonUniformScaling&&r.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===s.Light.LIGHTTYPEID_DIRECTIONALLIGHT&&r.push("#define DIRECTIONINLIGHTDATA")),h&&h.needAlphaTesting()){var l=h.getAlphaTestTexture();l&&(r.push("#define ALPHATEST"),o.isVerticesDataPresent(i.VertexBuffer.UVKind)&&(a.push(i.VertexBuffer.UVKind),r.push("#define UV1")),o.isVerticesDataPresent(i.VertexBuffer.UV2Kind)&&1===l.coordinatesIndex&&(a.push(i.VertexBuffer.UV2Kind),r.push("#define UV2")))}if(o.useBones&&o.computeBonesUsingShaders&&o.skeleton){a.push(i.VertexBuffer.MatricesIndicesKind),a.push(i.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(a.push(i.VertexBuffer.MatricesIndicesExtraKind),a.push(i.VertexBuffer.MatricesWeightsExtraKind));var p=o.skeleton;r.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),p.isUsingTextureForMatrices?r.push("#define BONETEXTURE"):r.push("#define BonesPerMesh "+(p.bones.length+1))}else r.push("#define NUM_BONE_INFLUENCERS 0");var d=o.morphTargetManager,c=0;d&&d.numInfluencers>0&&(r.push("#define MORPHTARGETS"),c=d.numInfluencers,r.push("#define NUM_MORPH_INFLUENCERS "+c),n.MaterialHelper.PrepareAttributesForMorphTargets(a,o,{NUM_MORPH_INFLUENCERS:c})),t&&(r.push("#define INSTANCES"),a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"));var _=r.join("\n");return this._cachedDefines!==_&&(this._cachedDefines=_,this._effect=this._scene.getEngine().createEffect("shadowMap",a,["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences","boneTextureWidth"],["diffuseSampler","boneSampler"],_,void 0,void 0,void 0,{maxSimultaneousMorphTargets:c})),!!this._effect.isReady()&&((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&(!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())))},p.prototype.prepareDefines=function(e,t){var i=this._scene,s=this._light;i.shadowsEnabled&&s.shadowEnabled&&(e["SHADOW"+t]=!0,this.useContactHardeningShadow&&(e["SHADOWPCSS"+t]=!0,this._filteringQuality===p.QUALITY_LOW?e["SHADOWLOWQUALITY"+t]=!0:this._filteringQuality===p.QUALITY_MEDIUM&&(e["SHADOWMEDIUMQUALITY"+t]=!0)),this.usePercentageCloserFiltering?(e["SHADOWPCF"+t]=!0,this._filteringQuality===p.QUALITY_LOW?e["SHADOWLOWQUALITY"+t]=!0:this._filteringQuality===p.QUALITY_MEDIUM&&(e["SHADOWMEDIUMQUALITY"+t]=!0)):this.usePoissonSampling?e["SHADOWPOISSON"+t]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?e["SHADOWESM"+t]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(e["SHADOWCLOSEESM"+t]=!0),s.needCube()&&(e["SHADOWCUBE"+t]=!0))},p.prototype.bindShadowLight=function(e,t){var i=this._light,s=this._scene;if(s.shadowsEnabled&&i.shadowEnabled){var r=s.activeCamera;if(r){var n=this.getShadowMap();n&&(i.needCube()||t.setMatrix("lightMatrix"+e,this.getTransformMatrix()),this._filter===p.FILTER_PCF?(t.setDepthStencilTexture("shadowSampler"+e,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),n.getSize().width,1/n.getSize().width,this.frustumEdgeFalloff,e)):this._filter===p.FILTER_PCSS?(t.setDepthStencilTexture("shadowSampler"+e,this.getShadowMapForRendering()),t.setTexture("depthSampler"+e,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/n.getSize().width,this._contactHardeningLightSizeUVRatio*n.getSize().width,this.frustumEdgeFalloff,e)):(t.setTexture("shadowSampler"+e,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/n.getSize().width,this.depthScale,this.frustumEdgeFalloff,e)),i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(r),this.getLight().getDepthMinZ(r)+this.getLight().getDepthMaxZ(r),e))}}},p.prototype.getTransformMatrix=function(){var e=this._scene;if(this._currentRenderID===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var i=this._light.position;if(this._light.computeTransformedInformation()&&(i=this._light.transformedPosition),t.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(t.Vector3.Dot(this._lightDirection,t.Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!i.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(i),this._cachedDirection.copyFrom(this._lightDirection),t.Matrix.LookAtLHToRef(i,i.add(this._lightDirection),t.Vector3.Up(),this._viewMatrix);var s=this.getShadowMap();if(s){var r=s.renderList;r&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,r)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},p.prototype.recreateShadowMap=function(){var e=this._shadowMap;if(e){var t=e.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=t}},p.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},p.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},p.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},p.prototype.serialize=function(){var e={},t=this.getShadowMap();if(!t)return e;if(e.lightId=this._light.id,e.mapSize=t.getRenderSize(),e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.forceBackFacesOnly=this.forceBackFacesOnly,e.depthScale=this.depthScale,e.darkness=this.getDarkness(),e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.filteringQuality=this.filteringQuality,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.renderList=[],t.renderList)for(var i=0;i<t.renderList.length;i++){var s=t.renderList[i];e.renderList.push(s.id)}return e},p.Parse=function(e,t){for(var i=t.getLightByID(e.lightId),s=new p(e.mapSize,i),r=s.getShadowMap(),n=0;n<e.renderList.length;n++){t.getMeshesByID(e.renderList[n]).forEach(function(e){r&&(r.renderList||(r.renderList=[]),r.renderList.push(e))})}return e.usePoissonSampling?s.usePoissonSampling=!0:e.useExponentialShadowMap?s.useExponentialShadowMap=!0:e.useBlurExponentialShadowMap?s.useBlurExponentialShadowMap=!0:e.useCloseExponentialShadowMap?s.useCloseExponentialShadowMap=!0:e.useBlurCloseExponentialShadowMap?s.useBlurCloseExponentialShadowMap=!0:e.usePercentageCloserFiltering?s.usePercentageCloserFiltering=!0:e.useContactHardeningShadow&&(s.useContactHardeningShadow=!0),e.filteringQuality&&(s.filteringQuality=e.filteringQuality),e.contactHardeningLightSizeUVRatio?s.contactHardeningLightSizeUVRatio=e.contactHardeningLightSizeUVRatio:e.useVarianceShadowMap?s.useExponentialShadowMap=!0:e.useBlurVarianceShadowMap&&(s.useBlurExponentialShadowMap=!0),e.depthScale&&(s.depthScale=e.depthScale),e.blurScale&&(s.blurScale=e.blurScale),e.blurBoxOffset&&(s.blurBoxOffset=e.blurBoxOffset),e.useKernelBlur&&(s.useKernelBlur=e.useKernelBlur),e.blurKernel&&(s.blurKernel=e.blurKernel),void 0!==e.bias&&(s.bias=e.bias),void 0!==e.normalBias&&(s.normalBias=e.normalBias),void 0!==e.frustumEdgeFalloff&&(s.frustumEdgeFalloff=e.frustumEdgeFalloff),e.darkness&&s.setDarkness(e.darkness),e.transparencyShadow&&s.setTransparencyShadow(!0),s.forceBackFacesOnly=e.forceBackFacesOnly,s},p.FILTER_NONE=0,p.FILTER_EXPONENTIALSHADOWMAP=1,p.FILTER_POISSONSAMPLING=2,p.FILTER_BLUREXPONENTIALSHADOWMAP=3,p.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,p.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,p.FILTER_PCF=6,p.FILTER_PCSS=7,p.QUALITY_HIGH=0,p.QUALITY_MEDIUM=1,p.QUALITY_LOW=2,p._SceneComponentInitialization=function(e){throw"Import ShadowGeneratorSceneComponent before creating ShadowGenerator."},p}();exports.ShadowGenerator=d;
},{"tslib":"vCxL","../../Maths/math":"Iizi","../../Meshes/buffer":"YHhW","../../Lights/light":"U3iz","../../Materials/material":"v46b","../../Materials/materialHelper":"DR7Q","../../Materials/Textures/texture":"KNsj","../../Materials/Textures/renderTargetTexture":"ji3V","../../PostProcesses/postProcess":"pczz","../../PostProcesses/blurPostProcess":"8dq3","../../Engines/constants":"vn8z","../../Shaders/shadowMap.fragment":"yRMj","../../Shaders/shadowMap.vertex":"hvsq","../../Shaders/depthBoxBlur.fragment":"ioNA"}],"M/Ri":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShadowGeneratorSceneComponent=void 0;var e=require("./shadowGenerator"),t=require("../../sceneComponent"),n=require("../../abstractScene");n.AbstractScene.AddParser(t.SceneComponentConstants.NAME_SHADOWGENERATOR,function(t,n){if(void 0!==t.shadowGenerators&&null!==t.shadowGenerators)for(var o=0,r=t.shadowGenerators.length;o<r;o++){var a=t.shadowGenerators[o];e.ShadowGenerator.Parse(a,n)}});var o=function(){function e(e){this.name=t.SceneComponentConstants.NAME_SHADOWGENERATOR,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(t.SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(e){e.shadowGenerators=[];for(var t=0,n=this.scene.lights;t<n.length;t++){var o=n[t].getShadowGenerator();o&&e.shadowGenerators.push(o.serialize())}},e.prototype.addFromContainer=function(e){},e.prototype.removeFromContainer=function(e){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(e){var t=this.scene;if(this.scene.shadowsEnabled)for(var n=0;n<t.lights.length;n++){var o=t.lights[n],r=o.getShadowGenerator();if(o.isEnabled()&&o.shadowEnabled&&r){var a=r.getShadowMap();-1!==t.textures.indexOf(a)&&e.push(a)}}},e}();exports.ShadowGeneratorSceneComponent=o,e.ShadowGenerator._SceneComponentInitialization=function(e){var n=e._getComponent(t.SceneComponentConstants.NAME_SHADOWGENERATOR);n||(n=new o(e),e._addComponent(n))};
},{"./shadowGenerator":"ssXa","../../sceneComponent":"8yKz","../../abstractScene":"x731"}],"t+y2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnimationPropertiesOverride=void 0;var e=require("../Animations/animation"),i=function(){return function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=e.Animation.ANIMATIONLOOPMODE_CYCLE}}();exports.AnimationPropertiesOverride=i;
},{"../Animations/animation":"8SP4"}],"6Ul+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PushMaterial=void 0;var t=i(require("tslib")),e=require("../Maths/math"),r=require("../Materials/material");function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};i.get||i.set?Object.defineProperty(e,r,i):e[r]=t[r]}return e.default=t,e}var o=function(r){function i(t,i){var o=r.call(this,t,i)||this;return o._normalMatrix=new e.Matrix,o.allowShaderHotSwapping=!0,o._storeEffectOnSubMeshes=!0,o}return t.__extends(i,r),i.prototype.getEffect=function(){return this._activeEffect},i.prototype.isReady=function(t,e){return!!t&&(!t.subMeshes||0===t.subMeshes.length||this.isReadyForSubMesh(t,t.subMeshes[0],e))},i.prototype.bindOnlyWorldMatrix=function(t){this._activeEffect.setMatrix("world",t)},i.prototype.bindOnlyNormalMatrix=function(t){this._activeEffect.setMatrix("normalMatrix",t)},i.prototype.bind=function(t,e){e&&this.bindForSubMesh(t,e,e.subMeshes[0])},i.prototype._afterBind=function(t,e){void 0===e&&(e=null),r.prototype._afterBind.call(this,t),this.getScene()._cachedEffect=e},i.prototype._mustRebind=function(t,e,r){return void 0===r&&(r=1),t.isCachedMaterialInvalid(this,e,r)},i}(r.Material);exports.PushMaterial=o;
},{"tslib":"vCxL","../Maths/math":"Iizi","../Materials/material":"v46b"}],"5KcB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MaterialFlags=void 0;var e=require("../Engines/engine"),t=require("../Engines/constants"),n=function(){function n(){}return Object.defineProperty(n,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(n){this._DiffuseTextureEnabled!==n&&(this._DiffuseTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(n){this._AmbientTextureEnabled!==n&&(this._AmbientTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(n){this._OpacityTextureEnabled!==n&&(this._OpacityTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(n){this._ReflectionTextureEnabled!==n&&(this._ReflectionTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(n){this._EmissiveTextureEnabled!==n&&(this._EmissiveTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(n){this._SpecularTextureEnabled!==n&&(this._SpecularTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(n){this._BumpTextureEnabled!==n&&(this._BumpTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(n){this._LightmapTextureEnabled!==n&&(this._LightmapTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(n){this._RefractionTextureEnabled!==n&&(this._RefractionTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(n){this._ColorGradingTextureEnabled!==n&&(this._ColorGradingTextureEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(n,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(n){this._FresnelEnabled!==n&&(this._FresnelEnabled=n,e.Engine.MarkAllMaterialsAsDirty(t.Constants.MATERIAL_FresnelDirtyFlag))},enumerable:!0,configurable:!0}),n._DiffuseTextureEnabled=!0,n._AmbientTextureEnabled=!0,n._OpacityTextureEnabled=!0,n._ReflectionTextureEnabled=!0,n._EmissiveTextureEnabled=!0,n._SpecularTextureEnabled=!0,n._BumpTextureEnabled=!0,n._LightmapTextureEnabled=!0,n._RefractionTextureEnabled=!0,n._ColorGradingTextureEnabled=!0,n._FresnelEnabled=!0,n}();exports.MaterialFlags=n;
},{"../Engines/engine":"Z5lb","../Engines/constants":"vn8z"}],"NGo8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultFragmentDeclaration=void 0;var n=require("../../Materials/effect"),e="defaultFragmentDeclaration",f="uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_SKYBOX\n#else\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif";n.Effect.IncludesShadersStore[e]=f;var i={name:e,shader:f};exports.defaultFragmentDeclaration=i;
},{"../../Materials/effect":"Ru7D"}],"mFAo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultUboDeclaration=void 0;var e=require("../../Materials/effect"),n="defaultUboDeclaration",t="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec4 vTangentSpaceParams;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nfloat pointSize;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};";e.Effect.IncludesShadersStore[n]=t;var o={name:n,shader:t};exports.defaultUboDeclaration=o;
},{"../../Materials/effect":"Ru7D"}],"eDit":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightFragmentDeclaration=void 0;var e=require("../../Materials/effect"),n="lightFragmentDeclaration",i="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#else\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=i;var r={name:n,shader:i};exports.lightFragmentDeclaration=r;
},{"../../Materials/effect":"Ru7D"}],"qU/b":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightUboDeclaration=void 0;var e=require("../../Materials/effect"),n="lightUboDeclaration",i="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec3 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=i;var r={name:n,shader:i};exports.lightUboDeclaration=r;
},{"../../Materials/effect":"Ru7D"}],"0E/H":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightsFragmentFunctions=void 0;var e=require("../../Materials/effect"),n="lightsFragmentFunctions",t="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}";e.Effect.IncludesShadersStore[n]=t;var o={name:n,shader:t};exports.lightsFragmentFunctions=o;
},{"../../Materials/effect":"Ru7D"}],"UheC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shadowsFragmentFunctions=void 0;var e=require("../../Materials/effect"),n="shadowsFragmentFunctions",t="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#endif\n#endif\n";e.Effect.IncludesShadersStore[n]=t;var o={name:n,shader:t};exports.shadowsFragmentFunctions=o;
},{"../../Materials/effect":"Ru7D"}],"BFry":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fresnelFunction=void 0;var e=require("../../Materials/effect"),r="fresnelFunction",n="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif";e.Effect.IncludesShadersStore[r]=n;var o={name:r,shader:n};exports.fresnelFunction=o;
},{"../../Materials/effect":"Ru7D"}],"Ls+y":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.reflectionFunction=void 0;var e=require("../../Materials/effect"),n="reflectionFunction",r="#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\n#endif\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvec3 direction=normalize(vDirectionW);\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nreturn vec3(1.0-s,t,0);\n#else\nreturn vec3(s,t,0);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=normalize(worldPos.xyz-vEyePosition.xyz);\n\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,vReflectionSize,vReflectionPosition);\n#endif\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}";e.Effect.IncludesShadersStore[n]=r;var o={name:n,shader:r};exports.reflectionFunction=o;
},{"../../Materials/effect":"Ru7D"}],"/fRP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.imageProcessingDeclaration=void 0;var e=require("../../Materials/effect"),n="imageProcessingDeclaration",r="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif";e.Effect.IncludesShadersStore[n]=r;var i={name:n,shader:r};exports.imageProcessingDeclaration=i;
},{"../../Materials/effect":"Ru7D"}],"/UJT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.imageProcessingFunctions=void 0;var e=require("../../Materials/effect"),n="imageProcessingFunctions",r="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x;\n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=clamp(color,0.0,1.0);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=clamp(result.rgb,0.0,1.0);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=applyEaseInOut(result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}";e.Effect.IncludesShadersStore[n]=r;var t={name:n,shader:r};exports.imageProcessingFunctions=t;
},{"../../Materials/effect":"Ru7D"}],"SFE/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bumpFragmentFunctions=void 0;var e=require("../../Materials/effect"),n="bumpFragmentFunctions",a="#ifdef BUMP\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=vTangentSpaceParams.x;\nbitangent*=vTangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\nmap=map*2.0-1.0;\n#ifdef NORMALXYSCALE\nmap=normalize(map*vec3(vBumpInfos.y,vBumpInfos.y,1.0));\n#endif\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=a;var t={name:n,shader:a};exports.bumpFragmentFunctions=t;
},{"../../Materials/effect":"Ru7D"}],"3IG7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clipPlaneFragmentDeclaration=void 0;var e=require("../../Materials/effect"),n="clipPlaneFragmentDeclaration",a="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif";e.Effect.IncludesShadersStore[n]=a;var i={name:n,shader:a};exports.clipPlaneFragmentDeclaration=i;
},{"../../Materials/effect":"Ru7D"}],"/goi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logDepthDeclaration=void 0;var e=require("../../Materials/effect"),t="logDepthDeclaration",r="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif";e.Effect.IncludesShadersStore[t]=r;var a={name:t,shader:r};exports.logDepthDeclaration=a;
},{"../../Materials/effect":"Ru7D"}],"D8oi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fogFragmentDeclaration=void 0;var n=require("../../Materials/effect"),o="fogFragmentDeclaration",e="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif";n.Effect.IncludesShadersStore[o]=e;var f={name:o,shader:e};exports.fogFragmentDeclaration=f;
},{"../../Materials/effect":"Ru7D"}],"1a3B":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clipPlaneFragment=void 0;var e=require("../../Materials/effect"),n="clipPlaneFragment",i="#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif";e.Effect.IncludesShadersStore[n]=i;var f={name:n,shader:i};exports.clipPlaneFragment=f;
},{"../../Materials/effect":"Ru7D"}],"UmUu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bumpFragment=void 0;var e=require("../../Materials/effect"),n="bumpFragment",a="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else\nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=a;var f={name:n,shader:a};exports.bumpFragment=f;
},{"../../Materials/effect":"Ru7D"}],"EveZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.depthPrePass=void 0;var e=require("../../Materials/effect"),r="depthPrePass",s="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif";e.Effect.IncludesShadersStore[r]=s;var t={name:r,shader:s};exports.depthPrePass=t;
},{"../../Materials/effect":"Ru7D"}],"bpJ4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lightFragment=void 0;var i=require("../../Materials/effect"),t="lightFragment",n="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))\n\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\nspotInfo=computeSpotLightingInfo(light{X}.vLightData);\n#ifdef LIGHT_FALLOFF_GLTF{X}\nspotInfo.attenuation=computeDistanceLightFalloff_GLTF(spotInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\nspotInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\nspotInfo.attenuation=computeDistanceLightFalloff_Physical(spotInfo.lightDistanceSquared);\nspotInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\nspotInfo.attenuation=computeDistanceLightFalloff_Standard(spotInfo.lightOffset,light{X}.vLightFalloff.x);\nspotInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\nspotInfo.attenuation=computeDistanceLightFalloff(spotInfo.lightOffset,spotInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\nspotInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\ninfo=computeSpotLighting(spotInfo,viewDirectionW,normalW,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(POINTLIGHT{X})\npointInfo=computePointLightingInfo(light{X}.vLightData);\n#ifdef LIGHT_FALLOFF_GLTF{X}\npointInfo.attenuation=computeDistanceLightFalloff_GLTF(pointInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npointInfo.attenuation=computeDistanceLightFalloff_Physical(pointInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npointInfo.attenuation=computeDistanceLightFalloff_Standard(pointInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npointInfo.attenuation=computeDistanceLightFalloff(pointInfo.lightOffset,pointInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\ninfo=computePointLighting(pointInfo,viewDirectionW,normalW,light{X}.vLightDiffuse.rgb,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#elif defined(DIRLIGHT{X})\ninfo=computeDirectionalLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCLOSEESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif\n#endif\n#endif";i.Effect.IncludesShadersStore[t]=n;var e={name:t,shader:n};exports.lightFragment=e;
},{"../../Materials/effect":"Ru7D"}],"lwja":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logDepthFragment=void 0;var e=require("../../Materials/effect"),t="logDepthFragment",r="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif";e.Effect.IncludesShadersStore[t]=r;var a={name:t,shader:r};exports.logDepthFragment=a;
},{"../../Materials/effect":"Ru7D"}],"2f5n":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fogFragment=void 0;var e=require("../../Materials/effect"),o="fogFragment",r="#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif";e.Effect.IncludesShadersStore[o]=r;var t={name:o,shader:r};exports.fogFragment=t;
},{"../../Materials/effect":"Ru7D"}],"3Ikc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultPixelShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/defaultFragmentDeclaration"),require("./ShadersInclude/defaultUboDeclaration"),require("./ShadersInclude/helperFunctions"),require("./ShadersInclude/lightFragmentDeclaration"),require("./ShadersInclude/lightUboDeclaration"),require("./ShadersInclude/lightsFragmentFunctions"),require("./ShadersInclude/shadowsFragmentFunctions"),require("./ShadersInclude/fresnelFunction"),require("./ShadersInclude/reflectionFunction"),require("./ShadersInclude/imageProcessingDeclaration"),require("./ShadersInclude/imageProcessingFunctions"),require("./ShadersInclude/bumpFragmentFunctions"),require("./ShadersInclude/clipPlaneFragmentDeclaration"),require("./ShadersInclude/logDepthDeclaration"),require("./ShadersInclude/fogFragmentDeclaration"),require("./ShadersInclude/clipPlaneFragment"),require("./ShadersInclude/bumpFragment"),require("./ShadersInclude/depthPrePass"),require("./ShadersInclude/lightFragment"),require("./ShadersInclude/logDepthFragment"),require("./ShadersInclude/fogFragment");var n="defaultPixelShader",i="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n";e.Effect.ShadersStore[n]=i;var r={name:n,shader:i};exports.defaultPixelShader=r;
},{"../Materials/effect":"Ru7D","./ShadersInclude/defaultFragmentDeclaration":"NGo8","./ShadersInclude/defaultUboDeclaration":"mFAo","./ShadersInclude/helperFunctions":"yU4e","./ShadersInclude/lightFragmentDeclaration":"eDit","./ShadersInclude/lightUboDeclaration":"qU/b","./ShadersInclude/lightsFragmentFunctions":"0E/H","./ShadersInclude/shadowsFragmentFunctions":"UheC","./ShadersInclude/fresnelFunction":"BFry","./ShadersInclude/reflectionFunction":"Ls+y","./ShadersInclude/imageProcessingDeclaration":"/fRP","./ShadersInclude/imageProcessingFunctions":"/UJT","./ShadersInclude/bumpFragmentFunctions":"SFE/","./ShadersInclude/clipPlaneFragmentDeclaration":"3IG7","./ShadersInclude/logDepthDeclaration":"/goi","./ShadersInclude/fogFragmentDeclaration":"D8oi","./ShadersInclude/clipPlaneFragment":"1a3B","./ShadersInclude/bumpFragment":"UmUu","./ShadersInclude/depthPrePass":"EveZ","./ShadersInclude/lightFragment":"bpJ4","./ShadersInclude/logDepthFragment":"lwja","./ShadersInclude/fogFragment":"2f5n"}],"+Uml":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultVertexDeclaration=void 0;var n=require("../../Materials/effect"),e="defaultVertexDeclaration",i="\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n";n.Effect.IncludesShadersStore[e]=i;var f={name:e,shader:i};exports.defaultVertexDeclaration=f;
},{"../../Materials/effect":"Ru7D"}],"jVUH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bumpVertexDeclaration=void 0;var e=require("../../Materials/effect"),r="bumpVertexDeclaration",n="#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#endif\n";e.Effect.IncludesShadersStore[r]=n;var t={name:r,shader:n};exports.bumpVertexDeclaration=t;
},{"../../Materials/effect":"Ru7D"}],"ftQJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clipPlaneVertexDeclaration=void 0;var e=require("../../Materials/effect"),n="clipPlaneVertexDeclaration",i="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif";e.Effect.IncludesShadersStore[n]=i;var a={name:n,shader:i};exports.clipPlaneVertexDeclaration=a;
},{"../../Materials/effect":"Ru7D"}],"rUWx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fogVertexDeclaration=void 0;var e=require("../../Materials/effect"),r="fogVertexDeclaration",t="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif";e.Effect.IncludesShadersStore[r]=t;var a={name:r,shader:t};exports.fogVertexDeclaration=a;
},{"../../Materials/effect":"Ru7D"}],"XVwt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bumpVertex=void 0;var e=require("../../Materials/effect"),n="bumpVertex",t="#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif";e.Effect.IncludesShadersStore[n]=t;var a={name:n,shader:t};exports.bumpVertex=a;
},{"../../Materials/effect":"Ru7D"}],"UKQU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clipPlaneVertex=void 0;var e=require("../../Materials/effect"),n="clipPlaneVertex",i="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif";e.Effect.IncludesShadersStore[n]=i;var l={name:n,shader:i};exports.clipPlaneVertex=l;
},{"../../Materials/effect":"Ru7D"}],"e4r3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fogVertex=void 0;var e=require("../../Materials/effect"),r="fogVertex",t="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif";e.Effect.IncludesShadersStore[r]=t;var o={name:r,shader:t};exports.fogVertex=o;
},{"../../Materials/effect":"Ru7D"}],"67Rd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shadowsVertex=void 0;var e=require("../../Materials/effect"),t="shadowsVertex",i="#ifdef SHADOWS\n#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif";e.Effect.IncludesShadersStore[t]=i;var r={name:t,shader:i};exports.shadowsVertex=r;
},{"../../Materials/effect":"Ru7D"}],"rlsI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pointCloudVertex=void 0;var e=require("../../Materials/effect"),t="pointCloudVertex",r="#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif";e.Effect.IncludesShadersStore[t]=r;var o={name:t,shader:r};exports.pointCloudVertex=o;
},{"../../Materials/effect":"Ru7D"}],"Dvgk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.logDepthVertex=void 0;var e=require("../../Materials/effect"),t="logDepthVertex",r="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif";e.Effect.IncludesShadersStore[t]=r;var o={name:t,shader:r};exports.logDepthVertex=o;
},{"../../Materials/effect":"Ru7D"}],"WUQl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultVertexShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/defaultVertexDeclaration"),require("./ShadersInclude/defaultUboDeclaration"),require("./ShadersInclude/helperFunctions"),require("./ShadersInclude/bonesDeclaration"),require("./ShadersInclude/instancesDeclaration"),require("./ShadersInclude/bumpVertexDeclaration"),require("./ShadersInclude/clipPlaneVertexDeclaration"),require("./ShadersInclude/fogVertexDeclaration"),require("./ShadersInclude/lightFragmentDeclaration"),require("./ShadersInclude/lightUboDeclaration"),require("./ShadersInclude/morphTargetsVertexGlobalDeclaration"),require("./ShadersInclude/morphTargetsVertexDeclaration"),require("./ShadersInclude/logDepthDeclaration"),require("./ShadersInclude/morphTargetsVertex"),require("./ShadersInclude/instancesVertex"),require("./ShadersInclude/bonesVertex"),require("./ShadersInclude/bumpVertex"),require("./ShadersInclude/clipPlaneVertex"),require("./ShadersInclude/fogVertex"),require("./ShadersInclude/shadowsVertex"),require("./ShadersInclude/pointCloudVertex"),require("./ShadersInclude/logDepthVertex");var n="defaultVertexShader",i="#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";e.Effect.ShadersStore[n]=i;var r={name:n,shader:i};exports.defaultVertexShader=r;
},{"../Materials/effect":"Ru7D","./ShadersInclude/defaultVertexDeclaration":"+Uml","./ShadersInclude/defaultUboDeclaration":"mFAo","./ShadersInclude/helperFunctions":"yU4e","./ShadersInclude/bonesDeclaration":"1TNa","./ShadersInclude/instancesDeclaration":"YHup","./ShadersInclude/bumpVertexDeclaration":"jVUH","./ShadersInclude/clipPlaneVertexDeclaration":"ftQJ","./ShadersInclude/fogVertexDeclaration":"rUWx","./ShadersInclude/lightFragmentDeclaration":"eDit","./ShadersInclude/lightUboDeclaration":"qU/b","./ShadersInclude/morphTargetsVertexGlobalDeclaration":"NDwH","./ShadersInclude/morphTargetsVertexDeclaration":"qccd","./ShadersInclude/logDepthDeclaration":"/goi","./ShadersInclude/morphTargetsVertex":"71sF","./ShadersInclude/instancesVertex":"yjPN","./ShadersInclude/bonesVertex":"60le","./ShadersInclude/bumpVertex":"XVwt","./ShadersInclude/clipPlaneVertex":"UKQU","./ShadersInclude/fogVertex":"e4r3","./ShadersInclude/shadowsVertex":"67Rd","./ShadersInclude/pointCloudVertex":"rlsI","./ShadersInclude/logDepthVertex":"Dvgk"}],"PbGh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StandardMaterial=exports.StandardMaterialDefines=void 0;var e=h(require("tslib")),r=require("../Misc/decorators"),t=require("../Misc/smartArray"),i=require("../scene"),s=require("../Maths/math"),a=require("../Meshes/buffer"),o=require("./imageProcessingConfiguration"),n=require("./effect"),u=require("../Materials/materialDefines"),l=require("./pushMaterial"),f=require("./materialHelper"),p=require("../Materials/Textures/texture"),_=require("../Misc/typeStore"),d=require("./materialFlags");require("../Shaders/default.fragment"),require("../Shaders/default.vertex");var c=require("../Engines/constants");function h(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};i.get||i.set?Object.defineProperty(r,t,i):r[t]=e[t]}return r.default=e,r}var m=function(r){function t(){var e=r.call(this)||this;return e.MAINUV1=!1,e.MAINUV2=!1,e.DIFFUSE=!1,e.DIFFUSEDIRECTUV=0,e.AMBIENT=!1,e.AMBIENTDIRECTUV=0,e.OPACITY=!1,e.OPACITYDIRECTUV=0,e.OPACITYRGB=!1,e.REFLECTION=!1,e.EMISSIVE=!1,e.EMISSIVEDIRECTUV=0,e.SPECULAR=!1,e.SPECULARDIRECTUV=0,e.BUMP=!1,e.BUMPDIRECTUV=0,e.PARALLAX=!1,e.PARALLAXOCCLUSION=!1,e.SPECULAROVERALPHA=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.ALPHATEST=!1,e.DEPTHPREPASS=!1,e.ALPHAFROMDIFFUSE=!1,e.POINTSIZE=!1,e.FOG=!1,e.SPECULARTERM=!1,e.DIFFUSEFRESNEL=!1,e.OPACITYFRESNEL=!1,e.REFLECTIONFRESNEL=!1,e.REFRACTIONFRESNEL=!1,e.EMISSIVEFRESNEL=!1,e.FRESNEL=!1,e.NORMAL=!1,e.UV1=!1,e.UV2=!1,e.VERTEXCOLOR=!1,e.VERTEXALPHA=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.INSTANCES=!1,e.GLOSSINESS=!1,e.ROUGHNESS=!1,e.EMISSIVEASILLUMINATION=!1,e.LINKEMISSIVEWITHDIFFUSE=!1,e.REFLECTIONFRESNELFROMSPECULAR=!1,e.LIGHTMAP=!1,e.LIGHTMAPDIRECTUV=0,e.OBJECTSPACE_NORMALMAP=!1,e.USELIGHTMAPASSHADOWMAP=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.LOGARITHMICDEPTH=!1,e.REFRACTION=!1,e.REFRACTIONMAP_3D=!1,e.REFLECTIONOVERALPHA=!1,e.TWOSIDEDLIGHTING=!1,e.SHADOWFLOAT=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.NUM_MORPH_INFLUENCERS=0,e.NONUNIFORMSCALING=!1,e.PREMULTIPLYALPHA=!1,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.IS_REFLECTION_LINEAR=!1,e.IS_REFRACTION_LINEAR=!1,e.EXPOSURE=!1,e.rebuild(),e}return e.__extends(t,r),t.prototype.setReflectionMode=function(e){for(var r=0,t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];r<t.length;r++){var i=t[r];this[i]=i===e}},t}(u.MaterialDefines);exports.StandardMaterialDefines=m;var T=function(u){function l(e,r){var i=u.call(this,e,r)||this;return i.ambientColor=new s.Color3(0,0,0),i.diffuseColor=new s.Color3(1,1,1),i.specularColor=new s.Color3(1,1,1),i.emissiveColor=new s.Color3(0,0,0),i.specularPower=64,i._useAlphaFromDiffuseTexture=!1,i._useEmissiveAsIllumination=!1,i._linkEmissiveWithDiffuse=!1,i._useSpecularOverAlpha=!1,i._useReflectionOverAlpha=!1,i._disableLighting=!1,i._useObjectSpaceNormalMap=!1,i._useParallax=!1,i._useParallaxOcclusion=!1,i.parallaxScaleBias=.05,i._roughness=0,i.indexOfRefraction=.98,i.invertRefractionY=!0,i.alphaCutOff=.4,i._useLightmapAsShadowmap=!1,i._useReflectionFresnelFromSpecular=!1,i._useGlossinessFromSpecularMapAlpha=!1,i._maxSimultaneousLights=4,i._invertNormalMapX=!1,i._invertNormalMapY=!1,i._twoSidedLighting=!1,i._renderTargets=new t.SmartArray(16),i._worldViewProjectionMatrix=s.Matrix.Zero(),i._globalAmbientColor=new s.Color3(0,0,0),i._attachImageProcessingConfiguration(null),i.getRenderTargetTextures=function(){return i._renderTargets.reset(),l.ReflectionTextureEnabled&&i._reflectionTexture&&i._reflectionTexture.isRenderTarget&&i._renderTargets.push(i._reflectionTexture),l.RefractionTextureEnabled&&i._refractionTexture&&i._refractionTexture.isRenderTarget&&i._renderTargets.push(i._refractionTexture),i._renderTargets},i}return e.__extends(l,u),Object.defineProperty(l.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),l.prototype._attachImageProcessingConfiguration=function(e){var r=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){r._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(l.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hasRenderTargetTextures",{get:function(){return!!(l.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(l.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),l.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(l.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),l.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},l.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},l.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},l.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},l.prototype.isReadyForSubMesh=function(e,r,t){if(void 0===t&&(t=!1),r.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;r._materialDefines||(r._materialDefines=new m);var i=this.getScene(),s=r._materialDefines;if(!this.checkReadyOnEveryCall&&r.effect&&s._renderId===i.getRenderId())return!0;var u=i.getEngine();if(s._needNormals=f.MaterialHelper.PrepareDefinesForLights(i,e,s,!0,this._maxSimultaneousLights,this._disableLighting),s._areTexturesDirty){if(s._needUVs=!1,s.MAINUV1=!1,s.MAINUV2=!1,i.texturesEnabled){if(this._diffuseTexture&&l.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;f.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,s,"DIFFUSE")}else s.DIFFUSE=!1;if(this._ambientTexture&&l.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;f.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,s,"AMBIENT")}else s.AMBIENT=!1;if(this._opacityTexture&&l.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;f.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,s,"OPACITY"),s.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else s.OPACITY=!1;if(this._reflectionTexture&&l.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(s._needNormals=!0,s.REFLECTION=!0,s.ROUGHNESS=this._roughness>0,s.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,s.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===p.Texture.INVCUBIC_MODE,s.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case p.Texture.EXPLICIT_MODE:s.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case p.Texture.PLANAR_MODE:s.setReflectionMode("REFLECTIONMAP_PLANAR");break;case p.Texture.PROJECTION_MODE:s.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case p.Texture.SKYBOX_MODE:s.setReflectionMode("REFLECTIONMAP_SKYBOX"),s.REFLECTIONMAP_SKYBOX_TRANSFORMED=!this._reflectionTexture.getReflectionTextureMatrix().isIdentity();break;case p.Texture.SPHERICAL_MODE:s.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case p.Texture.EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case p.Texture.FIXED_EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case p.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:s.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case p.Texture.CUBIC_MODE:case p.Texture.INVCUBIC_MODE:default:s.setReflectionMode("REFLECTIONMAP_CUBIC")}s.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else s.REFLECTION=!1;if(this._emissiveTexture&&l.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;f.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,s,"EMISSIVE")}else s.EMISSIVE=!1;if(this._lightmapTexture&&l.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;f.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,s,"LIGHTMAP"),s.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else s.LIGHTMAP=!1;if(this._specularTexture&&l.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;f.MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture,s,"SPECULAR"),s.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else s.SPECULAR=!1;if(i.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&l.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;f.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,s,"BUMP"),s.PARALLAX=this._useParallax,s.PARALLAXOCCLUSION=this._useParallaxOcclusion,s.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else s.BUMP=!1;if(this._refractionTexture&&l.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;s._needUVs=!0,s.REFRACTION=!0,s.REFRACTIONMAP_3D=this._refractionTexture.isCube}else s.REFRACTION=!1;s.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else s.DIFFUSE=!1,s.AMBIENT=!1,s.OPACITY=!1,s.REFLECTION=!1,s.EMISSIVE=!1,s.LIGHTMAP=!1,s.BUMP=!1,s.REFRACTION=!1;s.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),s.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,s.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,s.SPECULAROVERALPHA=this._useSpecularOverAlpha,s.PREMULTIPLYALPHA=this.alphaMode===c.Constants.ALPHA_PREMULTIPLIED||this.alphaMode===c.Constants.ALPHA_PREMULTIPLIED_PORTERDUFF}if(s._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(s),s.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,s.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(s._areFresnelDirty&&(l.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(s.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,s.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,s.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,s.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,s.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,s.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,s._needNormals=!0,s.FRESNEL=!0):s.FRESNEL=!1),f.MaterialHelper.PrepareDefinesForMisc(e,i,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),s),f.MaterialHelper.PrepareDefinesForAttributes(e,s,!0,!0,!0),f.MaterialHelper.PrepareDefinesForFrameBoundValues(i,u,s,t),s.isDirty){s.markAsProcessed();var _=new n.EffectFallbacks;s.REFLECTION&&_.addFallback(0,"REFLECTION"),s.SPECULAR&&_.addFallback(0,"SPECULAR"),s.BUMP&&_.addFallback(0,"BUMP"),s.PARALLAX&&_.addFallback(1,"PARALLAX"),s.PARALLAXOCCLUSION&&_.addFallback(0,"PARALLAXOCCLUSION"),s.SPECULAROVERALPHA&&_.addFallback(0,"SPECULAROVERALPHA"),s.FOG&&_.addFallback(1,"FOG"),s.POINTSIZE&&_.addFallback(0,"POINTSIZE"),s.LOGARITHMICDEPTH&&_.addFallback(0,"LOGARITHMICDEPTH"),f.MaterialHelper.HandleFallbacksForShadows(s,_,this._maxSimultaneousLights),s.SPECULARTERM&&_.addFallback(0,"SPECULARTERM"),s.DIFFUSEFRESNEL&&_.addFallback(1,"DIFFUSEFRESNEL"),s.OPACITYFRESNEL&&_.addFallback(2,"OPACITYFRESNEL"),s.REFLECTIONFRESNEL&&_.addFallback(3,"REFLECTIONFRESNEL"),s.EMISSIVEFRESNEL&&_.addFallback(4,"EMISSIVEFRESNEL"),s.FRESNEL&&_.addFallback(4,"FRESNEL");var d=[a.VertexBuffer.PositionKind];s.NORMAL&&d.push(a.VertexBuffer.NormalKind),s.UV1&&d.push(a.VertexBuffer.UVKind),s.UV2&&d.push(a.VertexBuffer.UV2Kind),s.VERTEXCOLOR&&d.push(a.VertexBuffer.ColorKind),f.MaterialHelper.PrepareAttributesForBones(d,e,s,_),f.MaterialHelper.PrepareAttributesForInstances(d,s),f.MaterialHelper.PrepareAttributesForMorphTargets(d,e,s);var h="default",T=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],E=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],x=["Material","Scene"];o.ImageProcessingConfiguration&&(o.ImageProcessingConfiguration.PrepareUniforms(T,s),o.ImageProcessingConfiguration.PrepareSamplers(E,s)),f.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:T,uniformBuffersNames:x,samplers:E,defines:s,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(h=this.customShaderNameResolve(h,T,x,E,s));var g=s.toString(),P=r.effect,A=i.getEngine().createEffect(h,{attributes:d,uniformsNames:T,uniformBuffersNames:x,samplers:E,defines:g,fallbacks:_,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:s.NUM_MORPH_INFLUENCERS}},u);A&&(this.allowShaderHotSwapping&&P&&!A.isReady()?(A=P,s.markAsUnprocessed()):(i.resetCachedMaterial(),r.setEffect(A,s),this.buildUniformLayout()))}return!(!r.effect||!r.effect.isReady())&&(s._renderId=i.getRenderId(),this._wasPreviouslyReady=!0,!0)},l.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("diffuseLeftColor",4),this._uniformBuffer.addUniform("diffuseRightColor",4),this._uniformBuffer.addUniform("opacityParts",4),this._uniformBuffer.addUniform("reflectionLeftColor",4),this._uniformBuffer.addUniform("reflectionRightColor",4),this._uniformBuffer.addUniform("refractionLeftColor",4),this._uniformBuffer.addUniform("refractionRightColor",4),this._uniformBuffer.addUniform("emissiveLeftColor",4),this._uniformBuffer.addUniform("emissiveRightColor",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",2),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vReflectionPosition",3),this._uniformBuffer.addUniform("vReflectionSize",3),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vSpecularInfos",2),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("specularMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vSpecularColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("vDiffuseColor",4),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},l.prototype.unbind=function(){if(this._activeEffect){var e=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),e=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),e=!0),e&&this._markAllSubMeshesAsTexturesDirty()}u.prototype.unbind.call(this)},l.prototype.bindForSubMesh=function(e,r,t){var a=this.getScene(),o=t._materialDefines;if(o){var n=t.effect;if(n){this._activeEffect=n,this.bindOnlyWorldMatrix(e),o.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var u=this._mustRebind(a,n,r.visibility);if(f.MaterialHelper.BindBonesParameters(r,n),u){if(this._uniformBuffer.bindToEffect(n,"Material"),this.bindViewProjection(n),!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(l.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._uniformBuffer.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._uniformBuffer.updateColor4("opacityParts",new s.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._uniformBuffer.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._uniformBuffer.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._uniformBuffer.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),a.texturesEnabled){if(this._diffuseTexture&&l.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),f.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse"),this._diffuseTexture.hasAlpha&&n.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&l.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),f.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&l.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),f.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),this._reflectionTexture&&l.ReflectionTextureEnabled&&(this._uniformBuffer.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),this._uniformBuffer.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var p=this._reflectionTexture;this._uniformBuffer.updateVector3("vReflectionPosition",p.boundingBoxPosition),this._uniformBuffer.updateVector3("vReflectionSize",p.boundingBoxSize)}if(this._emissiveTexture&&l.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),f.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&l.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),f.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),this._specularTexture&&l.SpecularTextureEnabled&&(this._uniformBuffer.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),f.MaterialHelper.BindTextureMatrix(this._specularTexture,this._uniformBuffer,"specular")),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&l.BumpTextureEnabled&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),f.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),a._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&l.RefractionTextureEnabled){var _=1;this._refractionTexture.isCube||(this._uniformBuffer.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(_=this._refractionTexture.depth)),this._uniformBuffer.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,_,this.invertRefractionY?-1:1)}}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),o.SPECULARTERM&&this._uniformBuffer.updateColor4("vSpecularColor",this.specularColor,this.specularPower),this._uniformBuffer.updateColor3("vEmissiveColor",l.EmissiveTextureEnabled?this.emissiveColor:s.Color3.BlackReadOnly),this._uniformBuffer.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha*r.visibility)}if(a.texturesEnabled&&(this._diffuseTexture&&l.DiffuseTextureEnabled&&n.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&l.AmbientTextureEnabled&&n.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&l.OpacityTextureEnabled&&n.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&l.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?n.setTexture("reflectionCubeSampler",this._reflectionTexture):n.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&l.EmissiveTextureEnabled&&n.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&l.LightmapTextureEnabled&&n.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&l.SpecularTextureEnabled&&n.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&l.BumpTextureEnabled&&n.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&l.RefractionTextureEnabled)){_=1;this._refractionTexture.isCube?n.setTexture("refractionCubeSampler",this._refractionTexture):n.setTexture("refraction2DSampler",this._refractionTexture)}f.MaterialHelper.BindClipPlane(n,a),a.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),f.MaterialHelper.BindEyePosition(n,a),n.setColor3("vAmbientColor",this._globalAmbientColor)}!u&&this.isFrozen||(a.lightsEnabled&&!this._disableLighting&&f.MaterialHelper.BindLights(a,r,n,o,this._maxSimultaneousLights),(a.fogEnabled&&r.applyFog&&a.fogMode!==i.Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(n),f.MaterialHelper.BindFogParameters(a,r,n),o.NUM_MORPH_INFLUENCERS&&f.MaterialHelper.BindMorphTargetParameters(r,n),f.MaterialHelper.BindLogDepth(o,n,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(r,this._activeEffect)}}},l.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},l.prototype.getActiveTextures=function(){var e=u.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},l.prototype.hasTexture=function(e){return!!u.prototype.hasTexture.call(this,e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))},l.prototype.dispose=function(e,r){r&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),u.prototype.dispose.call(this,e,r)},l.prototype.clone=function(e){var t=this,i=r.SerializationHelper.Clone(function(){return new l(e,t.getScene())},this);return i.name=e,i.id=e,i},l.prototype.serialize=function(){return r.SerializationHelper.Serialize(this)},l.Parse=function(e,t,i){return r.SerializationHelper.Parse(function(){return new l(e.name,t)},e,t,i)},Object.defineProperty(l,"DiffuseTextureEnabled",{get:function(){return d.MaterialFlags.DiffuseTextureEnabled},set:function(e){d.MaterialFlags.DiffuseTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"AmbientTextureEnabled",{get:function(){return d.MaterialFlags.AmbientTextureEnabled},set:function(e){d.MaterialFlags.AmbientTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"OpacityTextureEnabled",{get:function(){return d.MaterialFlags.OpacityTextureEnabled},set:function(e){d.MaterialFlags.OpacityTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ReflectionTextureEnabled",{get:function(){return d.MaterialFlags.ReflectionTextureEnabled},set:function(e){d.MaterialFlags.ReflectionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"EmissiveTextureEnabled",{get:function(){return d.MaterialFlags.EmissiveTextureEnabled},set:function(e){d.MaterialFlags.EmissiveTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"SpecularTextureEnabled",{get:function(){return d.MaterialFlags.SpecularTextureEnabled},set:function(e){d.MaterialFlags.SpecularTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"BumpTextureEnabled",{get:function(){return d.MaterialFlags.BumpTextureEnabled},set:function(e){d.MaterialFlags.BumpTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"LightmapTextureEnabled",{get:function(){return d.MaterialFlags.LightmapTextureEnabled},set:function(e){d.MaterialFlags.LightmapTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"RefractionTextureEnabled",{get:function(){return d.MaterialFlags.RefractionTextureEnabled},set:function(e){d.MaterialFlags.RefractionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"ColorGradingTextureEnabled",{get:function(){return d.MaterialFlags.ColorGradingTextureEnabled},set:function(e){d.MaterialFlags.ColorGradingTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"FresnelEnabled",{get:function(){return d.MaterialFlags.FresnelEnabled},set:function(e){d.MaterialFlags.FresnelEnabled=e},enumerable:!0,configurable:!0}),e.__decorate([(0,r.serializeAsTexture)("diffuseTexture")],l.prototype,"_diffuseTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],l.prototype,"diffuseTexture",void 0),e.__decorate([(0,r.serializeAsTexture)("ambientTexture")],l.prototype,"_ambientTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"ambientTexture",void 0),e.__decorate([(0,r.serializeAsTexture)("opacityTexture")],l.prototype,"_opacityTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],l.prototype,"opacityTexture",void 0),e.__decorate([(0,r.serializeAsTexture)("reflectionTexture")],l.prototype,"_reflectionTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"reflectionTexture",void 0),e.__decorate([(0,r.serializeAsTexture)("emissiveTexture")],l.prototype,"_emissiveTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"emissiveTexture",void 0),e.__decorate([(0,r.serializeAsTexture)("specularTexture")],l.prototype,"_specularTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"specularTexture",void 0),e.__decorate([(0,r.serializeAsTexture)("bumpTexture")],l.prototype,"_bumpTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"bumpTexture",void 0),e.__decorate([(0,r.serializeAsTexture)("lightmapTexture")],l.prototype,"_lightmapTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"lightmapTexture",void 0),e.__decorate([(0,r.serializeAsTexture)("refractionTexture")],l.prototype,"_refractionTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"refractionTexture",void 0),e.__decorate([(0,r.serializeAsColor3)("ambient")],l.prototype,"ambientColor",void 0),e.__decorate([(0,r.serializeAsColor3)("diffuse")],l.prototype,"diffuseColor",void 0),e.__decorate([(0,r.serializeAsColor3)("specular")],l.prototype,"specularColor",void 0),e.__decorate([(0,r.serializeAsColor3)("emissive")],l.prototype,"emissiveColor",void 0),e.__decorate([(0,r.serialize)()],l.prototype,"specularPower",void 0),e.__decorate([(0,r.serialize)("useAlphaFromDiffuseTexture")],l.prototype,"_useAlphaFromDiffuseTexture",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useAlphaFromDiffuseTexture",void 0),e.__decorate([(0,r.serialize)("useEmissiveAsIllumination")],l.prototype,"_useEmissiveAsIllumination",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useEmissiveAsIllumination",void 0),e.__decorate([(0,r.serialize)("linkEmissiveWithDiffuse")],l.prototype,"_linkEmissiveWithDiffuse",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"linkEmissiveWithDiffuse",void 0),e.__decorate([(0,r.serialize)("useSpecularOverAlpha")],l.prototype,"_useSpecularOverAlpha",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useSpecularOverAlpha",void 0),e.__decorate([(0,r.serialize)("useReflectionOverAlpha")],l.prototype,"_useReflectionOverAlpha",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useReflectionOverAlpha",void 0),e.__decorate([(0,r.serialize)("disableLighting")],l.prototype,"_disableLighting",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsLightsDirty")],l.prototype,"disableLighting",void 0),e.__decorate([(0,r.serialize)("useObjectSpaceNormalMap")],l.prototype,"_useObjectSpaceNormalMap",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useObjectSpaceNormalMap",void 0),e.__decorate([(0,r.serialize)("useParallax")],l.prototype,"_useParallax",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useParallax",void 0),e.__decorate([(0,r.serialize)("useParallaxOcclusion")],l.prototype,"_useParallaxOcclusion",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useParallaxOcclusion",void 0),e.__decorate([(0,r.serialize)()],l.prototype,"parallaxScaleBias",void 0),e.__decorate([(0,r.serialize)("roughness")],l.prototype,"_roughness",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"roughness",void 0),e.__decorate([(0,r.serialize)()],l.prototype,"indexOfRefraction",void 0),e.__decorate([(0,r.serialize)()],l.prototype,"invertRefractionY",void 0),e.__decorate([(0,r.serialize)()],l.prototype,"alphaCutOff",void 0),e.__decorate([(0,r.serialize)("useLightmapAsShadowmap")],l.prototype,"_useLightmapAsShadowmap",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useLightmapAsShadowmap",void 0),e.__decorate([(0,r.serializeAsFresnelParameters)("diffuseFresnelParameters")],l.prototype,"_diffuseFresnelParameters",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],l.prototype,"diffuseFresnelParameters",void 0),e.__decorate([(0,r.serializeAsFresnelParameters)("opacityFresnelParameters")],l.prototype,"_opacityFresnelParameters",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsFresnelAndMiscDirty")],l.prototype,"opacityFresnelParameters",void 0),e.__decorate([(0,r.serializeAsFresnelParameters)("reflectionFresnelParameters")],l.prototype,"_reflectionFresnelParameters",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],l.prototype,"reflectionFresnelParameters",void 0),e.__decorate([(0,r.serializeAsFresnelParameters)("refractionFresnelParameters")],l.prototype,"_refractionFresnelParameters",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],l.prototype,"refractionFresnelParameters",void 0),e.__decorate([(0,r.serializeAsFresnelParameters)("emissiveFresnelParameters")],l.prototype,"_emissiveFresnelParameters",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],l.prototype,"emissiveFresnelParameters",void 0),e.__decorate([(0,r.serialize)("useReflectionFresnelFromSpecular")],l.prototype,"_useReflectionFresnelFromSpecular",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsFresnelDirty")],l.prototype,"useReflectionFresnelFromSpecular",void 0),e.__decorate([(0,r.serialize)("useGlossinessFromSpecularMapAlpha")],l.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"useGlossinessFromSpecularMapAlpha",void 0),e.__decorate([(0,r.serialize)("maxSimultaneousLights")],l.prototype,"_maxSimultaneousLights",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsLightsDirty")],l.prototype,"maxSimultaneousLights",void 0),e.__decorate([(0,r.serialize)("invertNormalMapX")],l.prototype,"_invertNormalMapX",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"invertNormalMapX",void 0),e.__decorate([(0,r.serialize)("invertNormalMapY")],l.prototype,"_invertNormalMapY",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"invertNormalMapY",void 0),e.__decorate([(0,r.serialize)("twoSidedLighting")],l.prototype,"_twoSidedLighting",void 0),e.__decorate([(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],l.prototype,"twoSidedLighting",void 0),e.__decorate([(0,r.serialize)()],l.prototype,"useLogarithmicDepth",null),l}(l.PushMaterial);exports.StandardMaterial=T,_._TypeStore.RegisteredTypes["BABYLON.StandardMaterial"]=T,i.Scene.DefaultMaterialFactory=function(e){return new T("default material",e)};
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Misc/smartArray":"vK5Y","../scene":"FKAx","../Maths/math":"Iizi","../Meshes/buffer":"YHhW","./imageProcessingConfiguration":"Ik3r","./effect":"Ru7D","../Materials/materialDefines":"2sZs","./pushMaterial":"6Ul+","./materialHelper":"DR7Q","../Materials/Textures/texture":"KNsj","../Misc/typeStore":"WgxS","./materialFlags":"5KcB","../Shaders/default.fragment":"3Ikc","../Shaders/default.vertex":"WUQl","../Engines/constants":"vn8z"}],"5aEd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CubeTexture=void 0;var e=s(require("tslib")),t=require("../../Misc/decorators"),r=require("../../Misc/tools"),i=require("../../Maths/math"),n=require("../../Materials/Textures/baseTexture"),o=require("../../Materials/Textures/texture"),a=require("../../Animations/animation"),u=require("../../Engines/constants");function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var l=function(n){function s(e,t,a,s,l,d,p,_,c,x,f,h,g){void 0===a&&(a=null),void 0===s&&(s=!1),void 0===l&&(l=null),void 0===d&&(d=null),void 0===p&&(p=null),void 0===_&&(_=u.Constants.TEXTUREFORMAT_RGBA),void 0===c&&(c=!1),void 0===x&&(x=null),void 0===f&&(f=!1),void 0===h&&(h=.8),void 0===g&&(g=0);var y=n.call(this,t)||this;if(y.boundingBoxPosition=i.Vector3.Zero(),y._rotationY=0,y._prefiltered=!1,y.name=e,y.url=e,y._noMipmap=s,y.hasAlpha=!1,y._format=_,y.isCube=!0,y._textureMatrix=i.Matrix.Identity(),y._createPolynomials=f,y.coordinatesMode=o.Texture.CUBIC_MODE,!e&&!l)return y;var m=e.lastIndexOf("."),b=x||(m>-1?e.substring(m).toLowerCase():""),v=".dds"===b,T=".env"===b;if(T?(y.gammaSpace=!1,y._prefiltered=!1):(y._prefiltered=c,c&&(y.gammaSpace=!1)),y._texture=y._getFromCache(e,s),!l&&(T||v||a||(a=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),l=[],a))for(var A=0;A<a.length;A++)l.push(e+a[A]);return y._files=l,y._texture?d&&(y._texture.isReady?r.Tools.SetImmediate(function(){return d()}):y._texture.onLoadedObservable.add(d)):t.useDelayedTextureLoading?y.delayLoadState=u.Constants.DELAYLOADSTATE_NOTLOADED:y._texture=c?t.getEngine().createPrefilteredCubeTexture(e,t,h,g,d,p,_,x,y._createPolynomials):t.getEngine().createCubeTexture(e,t,l,s,d,p,y._format,x,!1,h,g),y}return e.__extends(s,n),Object.defineProperty(s.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(u.Constants.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(i.Matrix.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),s.CreateFromImages=function(e,t,r){var i="";return e.forEach(function(e){return i+=e}),new s(i,t,null,r,e)},s.CreateFromPrefilteredData=function(e,t,r,i){return void 0===r&&(r=null),void 0===i&&(i=!0),new s(e,t,null,!1,null,null,null,void 0,!0,r,i)},s.prototype.getClassName=function(){return"CubeTexture"},s.prototype.updateURL=function(e,t,r){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(u.Constants.MATERIAL_TextureDirtyFlag)),this.url=e,this.delayLoadState=u.Constants.DELAYLOADSTATE_NOTLOADED,this._prefiltered=!1,r&&(this._delayedOnLoad=r),this.delayLoad(t)},s.prototype.delayLoad=function(e){if(this.delayLoadState===u.Constants.DELAYLOADSTATE_NOTLOADED){var t=this.getScene();t&&(this.delayLoadState=u.Constants.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=t.getEngine().createPrefilteredCubeTexture(this.url,t,this.lodGenerationScale,this.lodGenerationOffset,this._delayedOnLoad,void 0,this._format,void 0,this._createPolynomials):this._texture=t.getEngine().createCubeTexture(this.url,t,this._files,this._noMipmap,this._delayedOnLoad,void 0,this._format,e)))}},s.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},s.prototype.setReflectionTextureMatrix=function(e){var t=this;e.updateFlag!==this._textureMatrix.updateFlag&&(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(u.Constants.MATERIAL_TextureDirtyFlag,function(e){return-1!==e.getActiveTextures().indexOf(t)}),this._textureMatrix=e)},s.Parse=function(e,r,n){var o=t.SerializationHelper.Parse(function(){var t=!1;return e.prefiltered&&(t=e.prefiltered),new s(n+e.name,r,e.extensions,!1,null,null,null,void 0,t)},e,r);if(e.boundingBoxPosition&&(o.boundingBoxPosition=i.Vector3.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(o.boundingBoxSize=i.Vector3.FromArray(e.boundingBoxSize)),e.animations)for(var u=0;u<e.animations.length;u++){var l=e.animations[u];o.animations.push(a.Animation.Parse(l))}return o},s.prototype.clone=function(){var e=this,r=this.getScene(),i=0,n=t.SerializationHelper.Clone(function(){if(!r)return e;var t=new s(e.url,r,e._extensions,e._noMipmap,e._files);return i=t.uniqueId,t},this);return n.uniqueId=i,n},e.__decorate([(0,t.serialize)("rotationY")],s.prototype,"rotationY",null),s}(n.BaseTexture);exports.CubeTexture=l,o.Texture._CubeTextureParser=l.Parse;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Misc/tools":"RkuS","../../Maths/math":"Iizi","../../Materials/Textures/baseTexture":"K2LE","../../Materials/Textures/texture":"KNsj","../../Animations/animation":"8SP4","../../Engines/constants":"vn8z"}],"tpk9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneLoader=exports.SceneLoaderProgressEvent=void 0;var e=require("../Misc/tools"),n=require("../Misc/observable"),o=require("../Misc/filesInputStore"),r=require("../scene"),i=require("../Engines/engine"),t=require("../Engines/engineStore"),a=require("../Misc/logger"),l=require("../Engines/constants"),s=require("./sceneLoaderFlags"),u=function(){function e(e,n,o){this.lengthComputable=e,this.loaded=n,this.total=o}return e.FromProgressEvent=function(n){return new e(n.lengthComputable,n.loaded,n.total)},e}();exports.SceneLoaderProgressEvent=u;var c=function(){function c(){}return Object.defineProperty(c,"ForceFullSceneLoadingForIncremental",{get:function(){return s.SceneLoaderFlags.ForceFullSceneLoadingForIncremental},set:function(e){s.SceneLoaderFlags.ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ShowLoadingScreen",{get:function(){return s.SceneLoaderFlags.ShowLoadingScreen},set:function(e){s.SceneLoaderFlags.ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(c,"loggingLevel",{get:function(){return s.SceneLoaderFlags.loggingLevel},set:function(e){s.SceneLoaderFlags.loggingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(c,"CleanBoneMatrixWeights",{get:function(){return s.SceneLoaderFlags.CleanBoneMatrixWeights},set:function(e){s.SceneLoaderFlags.CleanBoneMatrixWeights=e},enumerable:!0,configurable:!0}),c._getDefaultPlugin=function(){return c._registeredPlugins[".babylon"]},c._getPluginForExtension=function(e){var n=c._registeredPlugins[e];return n||(a.Logger.Warn("Unable to find a plugin to load "+e+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),c._getDefaultPlugin())},c._getPluginForDirectLoad=function(e){for(var n in c._registeredPlugins){var o=c._registeredPlugins[n].plugin;if(o.canDirectLoad&&o.canDirectLoad(e))return c._registeredPlugins[n]}return c._getDefaultPlugin()},c._getPluginForFilename=function(e){var n=e.indexOf("?");-1!==n&&(e=e.substring(0,n));var o=e.lastIndexOf("."),r=e.substring(o,e.length).toLowerCase();return c._getPluginForExtension(r)},c._getDirectLoad=function(e){return"data:"===e.substr(0,5)?e.substr(5):null},c._loadData=function(n,r,t,a,l,s,d){var g,f=c._getDirectLoad(n.name),v=d?c._getPluginForExtension(d):f?c._getPluginForDirectLoad(n.name):c._getPluginForFilename(n.name);g=v.plugin.createPlugin?v.plugin.createPlugin():v.plugin;var L,m=v.isBinary;c.OnPluginActivatedObservable.notifyObservers(g);var p=function(e,n){r.isDisposed?l("Scene has been disposed"):(r.offlineProvider=L,t(g,e,n))},E=null,P=!1,b=g.onDisposeObservable;b&&b.add(function(){P=!0,E&&(E.abort(),E=null),s()});var S=function(){P||(E=e.Tools.LoadFile(n.url,p,a?function(e){a(u.FromProgressEvent(e))}:void 0,L,m,function(e,n){l("Failed to load scene."+(n?" "+n.message:""),n)}))};if(f)return p(f),g;var _=n.file||o.FilesInputStore.FilesToLoad[n.name.toLowerCase()];if(-1===n.rootUrl.indexOf("file:")||-1!==n.rootUrl.indexOf("file:")&&!_){var h=r.getEngine(),F=h.enableOfflineSupport;if(F){for(var y=!1,A=0,C=r.disableOfflineSupportExceptionRules;A<C.length;A++){if(C[A].test(n.url)){y=!0;break}}F=!y}F&&i.Engine.OfflineProviderFactory?L=i.Engine.OfflineProviderFactory(n.url,S,h.disableManifestCheck):S()}else _?E=e.Tools.ReadFile(_,p,a,m):l("Unable to find file named "+n.name);return g},c._getFileInfo=function(n,o){var r,i,t=null;if(o)if(o.lastModified){var a=o;r=n+a.name,i=a.name,t=a}else{var l=o;if("/"===l.substr(0,1))return e.Tools.Error("Wrong sceneFilename parameter"),null;r=n+l,i=l}else r=n,i=e.Tools.GetFilename(n),n=e.Tools.GetFolderPath(n);return{url:r,rootUrl:n,name:i,file:t}},c.GetPluginForExtension=function(e){return c._getPluginForExtension(e).plugin},c.IsPluginForExtensionAvailable=function(e){return!!c._registeredPlugins[e]},c.RegisterPlugin=function(e){if("string"==typeof e.extensions){var n=e.extensions;c._registeredPlugins[n.toLowerCase()]={plugin:e,isBinary:!1}}else{var o=e.extensions;Object.keys(o).forEach(function(n){c._registeredPlugins[n.toLowerCase()]={plugin:e,isBinary:o[n].isBinary}})}},c.ImportMesh=function(e,n,o,r,i,l,s,u){if(void 0===o&&(o=""),void 0===r&&(r=t.EngineStore.LastCreatedScene),void 0===i&&(i=null),void 0===l&&(l=null),void 0===s&&(s=null),void 0===u&&(u=null),!r)return a.Logger.Error("No scene available to import mesh to"),null;var d=c._getFileInfo(n,o);if(!d)return null;var g={};r._addPendingData(g);var f=function(){r._removePendingData(g)},v=function(e,n){var o="Unable to import meshes from "+d.url+": "+e;s?s(r,o,n):a.Logger.Error(o),f()},L=l?function(e){try{l(e)}catch(n){v("Error in onProgress callback",n)}}:void 0,m=function(e,n,o,t){if(r.importedMeshesFiles.push(d.url),i)try{i(e,n,o,t)}catch(a){v("Error in onSuccess callback",a)}r._removePendingData(g)};return c._loadData(d,r,function(n,o,i){if(n.rewriteRootURL&&(d.rootUrl=n.rewriteRootURL(d.rootUrl,i)),n.importMesh){var t=n,a=new Array,l=new Array,s=new Array;if(!t.importMesh(e,r,o,d.rootUrl,a,l,s,v))return;r.loadingPluginName=n.name,m(a,l,s,[])}else{n.importMeshAsync(e,r,o,d.rootUrl,L,d.name).then(function(e){r.loadingPluginName=n.name,m(e.meshes,e.particleSystems,e.skeletons,e.animationGroups)}).catch(function(e){v(e.message,e)})}},L,v,f,u)},c.ImportMeshAsync=function(e,n,o,r,i,a){return void 0===o&&(o=""),void 0===r&&(r=t.EngineStore.LastCreatedScene),void 0===i&&(i=null),void 0===a&&(a=null),new Promise(function(t,l){c.ImportMesh(e,n,o,r,function(e,n,o,r){t({meshes:e,particleSystems:n,skeletons:o,animationGroups:r})},i,function(e,n,o){l(o||new Error(n))},a)})},c.Load=function(n,o,i,a,l,s,u){return void 0===o&&(o=""),void 0===i&&(i=t.EngineStore.LastCreatedEngine),void 0===a&&(a=null),void 0===l&&(l=null),void 0===s&&(s=null),void 0===u&&(u=null),i?c.Append(n,o,new r.Scene(i),a,l,s,u):(e.Tools.Error("No engine available"),null)},c.LoadAsync=function(e,n,o,r,i){return void 0===n&&(n=""),void 0===o&&(o=t.EngineStore.LastCreatedEngine),void 0===r&&(r=null),void 0===i&&(i=null),new Promise(function(t,a){c.Load(e,n,o,function(e){t(e)},r,function(e,n,o){a(o||new Error(n))},i)})},c.Append=function(e,n,o,r,i,l,s){if(void 0===n&&(n=""),void 0===o&&(o=t.EngineStore.LastCreatedScene),void 0===r&&(r=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===s&&(s=null),!o)return a.Logger.Error("No scene available to append to"),null;var u=c._getFileInfo(e,n);if(!u)return null;c.ShowLoadingScreen&&o.getEngine().displayLoadingUI();var d={};o._addPendingData(d);var g=function(){o._removePendingData(d),o.getEngine().hideLoadingUI()},f=function(e,n){var r="Unable to load from "+u.url+(e?": "+e:"");l?l(o,r,n):a.Logger.Error(r),g()},v=i?function(e){try{i(e)}catch(n){f("Error in onProgress callback",n)}}:void 0,L=function(){if(r)try{r(o)}catch(e){f("Error in onSuccess callback",e)}o._removePendingData(d)};return c._loadData(u,o,function(e,n){if(e.load){if(!e.load(o,n,u.rootUrl,f))return;o.loadingPluginName=e.name,L()}else{e.loadAsync(o,n,u.rootUrl,v,u.name).then(function(){o.loadingPluginName=e.name,L()}).catch(function(e){f(e.message,e)})}c.ShowLoadingScreen&&o.executeWhenReady(function(){o.getEngine().hideLoadingUI()})},v,f,g,s)},c.AppendAsync=function(e,n,o,r,i){return void 0===n&&(n=""),void 0===o&&(o=t.EngineStore.LastCreatedScene),void 0===r&&(r=null),void 0===i&&(i=null),new Promise(function(t,a){c.Append(e,n,o,function(e){t(e)},r,function(e,n,o){a(o||new Error(n))},i)})},c.LoadAssetContainer=function(e,n,o,r,i,l,s){if(void 0===n&&(n=""),void 0===o&&(o=t.EngineStore.LastCreatedScene),void 0===r&&(r=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===s&&(s=null),!o)return a.Logger.Error("No scene available to load asset container to"),null;var u=c._getFileInfo(e,n);if(!u)return null;var d={};o._addPendingData(d);var g=function(){o._removePendingData(d)},f=function(e,n){var r="Unable to load assets from "+u.url+(e?": "+e:"");l?l(o,r,n):a.Logger.Error(r),g()},v=i?function(e){try{i(e)}catch(n){f("Error in onProgress callback",n)}}:void 0,L=function(e){if(r)try{r(e)}catch(n){f("Error in onSuccess callback",n)}o._removePendingData(d)};return c._loadData(u,o,function(e,n){if(e.loadAssetContainer){var r=e.loadAssetContainer(o,n,u.rootUrl,f);if(!r)return;o.loadingPluginName=e.name,L(r)}else if(e.loadAssetContainerAsync){e.loadAssetContainerAsync(o,n,u.rootUrl,v,u.name).then(function(n){o.loadingPluginName=e.name,L(n)}).catch(function(e){f(e.message,e)})}else f("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");c.ShowLoadingScreen&&o.executeWhenReady(function(){o.getEngine().hideLoadingUI()})},v,f,g,s)},c.LoadAssetContainerAsync=function(e,n,o,r,i){return void 0===n&&(n=""),void 0===o&&(o=t.EngineStore.LastCreatedScene),void 0===r&&(r=null),void 0===i&&(i=null),new Promise(function(t,a){c.LoadAssetContainer(e,n,o,function(e){t(e)},r,function(e,n,o){a(o||new Error(n))},i)})},c.NO_LOGGING=l.Constants.SCENELOADER_NO_LOGGING,c.MINIMAL_LOGGING=l.Constants.SCENELOADER_MINIMAL_LOGGING,c.SUMMARY_LOGGING=l.Constants.SCENELOADER_SUMMARY_LOGGING,c.DETAILED_LOGGING=l.Constants.SCENELOADER_DETAILED_LOGGING,c.OnPluginActivatedObservable=new n.Observable,c._registeredPlugins={},c}();exports.SceneLoader=c;
},{"../Misc/tools":"RkuS","../Misc/observable":"gtkL","../Misc/filesInputStore":"RWWY","../scene":"FKAx","../Engines/engine":"Z5lb","../Engines/engineStore":"n+VE","../Misc/logger":"Fvml","../Engines/constants":"vn8z","./sceneLoaderFlags":"Gju8"}],"bzVh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebVRController=void 0;var e=a(require("tslib")),t=require("../../Misc/observable"),n=require("./poseEnabledController");function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};a.get||a.set?Object.defineProperty(t,n,a):t[n]=e[n]}return t.default=e,t}var s=function(n){function a(e){var a=n.call(this,e)||this;return a.onTriggerStateChangedObservable=new t.Observable,a.onMainButtonStateChangedObservable=new t.Observable,a.onSecondaryButtonStateChangedObservable=new t.Observable,a.onPadStateChangedObservable=new t.Observable,a.onPadValuesChangedObservable=new t.Observable,a.pad={x:0,y:0},a._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},a._buttons=new Array(e.buttons.length),a.hand=e.hand,a}return e.__extends(a,n),a.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(a.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),a.prototype.update=function(){n.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._setButtonValue(this.browserGamepad.buttons[e],this._buttons[e],e);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},a.prototype._setButtonValue=function(e,t,n){e||(e={pressed:!1,touched:!1,value:0}),t?(this._checkChanges(e,t),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,n,e),this._handleButtonChange(n,e,this._changes)),this._buttons[n].pressed=e.pressed,this._buttons[n].touched=e.touched,this._buttons[n].value=e.value<1e-8?0:e.value):this._buttons[n]={pressed:e.pressed,touched:e.touched,value:e.value}},a.prototype._checkChanges=function(e,t){return this._changes.pressChanged=e.pressed!==t.pressed,this._changes.touchChanged=e.touched!==t.touched,this._changes.valueChanged=e.value!==t.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},a.prototype.dispose=function(){n.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},a}(n.PoseEnabledController);exports.WebVRController=s;
},{"tslib":"vCxL","../../Misc/observable":"gtkL","./poseEnabledController":"seX3"}],"hYzo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GenericController=void 0;var e=n(require("tslib")),r=require("../../Loading/sceneLoader"),t=require("./webVRController"),o=require("./poseEnabledController");function n(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};o.get||o.set?Object.defineProperty(r,t,o):r[t]=e[t]}return r.default=e,r}var l=function(t){function o(e){return t.call(this,e)||this}return e.__extends(o,t),o.prototype.initControllerMesh=function(e,t){var n=this;r.SceneLoader.ImportMesh("",o.MODEL_BASE_URL,o.MODEL_FILENAME,e,function(e){n._defaultModel=e[1],n.attachToMesh(n._defaultModel),t&&t(n._defaultModel)})},o.prototype._handleButtonChange=function(e,r,t){console.log("Button id: "+e+"state: "),console.dir(r)},o.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",o.MODEL_FILENAME="generic.babylon",o}(t.WebVRController);exports.GenericController=l,o.PoseEnabledControllerHelper._DefaultControllerFactory=function(e){return new l(e)};
},{"tslib":"vCxL","../../Loading/sceneLoader":"tpk9","./webVRController":"bzVh","./poseEnabledController":"seX3"}],"J4Nk":[function(require,module,exports) {
"use strict";var r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable;function n(r){if(null==r)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function o(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de","5"===Object.getOwnPropertyNames(r)[0])return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(r){return t[r]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(r){n[r]=r}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(o){return!1}}module.exports=o()?Object.assign:function(o,c){for(var a,i,s=n(o),f=1;f<arguments.length;f++){for(var u in a=Object(arguments[f]))t.call(a,u)&&(s[u]=a[u]);if(r){i=r(a);for(var b=0;b<i.length;b++)e.call(a,i[b])&&(s[i[b]]=a[i[b]])}}return s};
},{}],"lp9P":[function(require,module,exports) {
"use strict";var e=require("object-assign"),s=t(e);function t(e){return e&&e.__esModule?e:{default:e}}Object.assign||(Object.assign=s.default);
},{"object-assign":"J4Nk"}],"/lqD":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3],n=16;if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!e.performance||!e.performance.now){var t=Date.now();e.performance||(e.performance={}),e.performance.now=function(){return Date.now()-t}}for(var a=Date.now(),r=["ms","moz","webkit","o"],o=0;o<r.length&&!e.requestAnimationFrame;++o){var i=r[o];e.requestAnimationFrame=e[i+"RequestAnimationFrame"],e.cancelAnimationFrame=e[i+"CancelAnimationFrame"]||e[i+"CancelRequestAnimationFrame"]}e.requestAnimationFrame||(e.requestAnimationFrame=function(e){if("function"!=typeof e)throw new TypeError(e+"is not a function");var t=Date.now(),r=n+a-t;return r<0&&(r=0),a=t,setTimeout(function(){a=Date.now(),e(performance.now())},r)}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){return clearTimeout(e)});
},{}],"XgiD":[function(require,module,exports) {
"use strict";Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1});
},{}],"qjkZ":[function(require,module,exports) {
"use strict";Number.isInteger||(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e});
},{}],"bPsC":[function(require,module,exports) {
"use strict";require("./Object.assign"),require("./requestAnimationFrame"),require("./Math.sign"),require("./Number.isInteger"),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array);
},{"./Object.assign":"lp9P","./requestAnimationFrame":"/lqD","./Math.sign":"XgiD","./Number.isInteger":"qjkZ"}],"YEQi":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var E=exports.VERSION="4.8.7",R=exports.PI_2=2*Math.PI,I=exports.RAD_TO_DEG=180/Math.PI,N=exports.DEG_TO_RAD=Math.PI/180,A=exports.RENDERER_TYPE={UNKNOWN:0,WEBGL:1,CANVAS:2},O=exports.BLEND_MODES={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19},L=exports.DRAW_MODES={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},T=exports.SCALE_MODES={LINEAR:0,NEAREST:1},_=exports.WRAP_MODES={CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},t=exports.GC_MODES={AUTO:0,MANUAL:1},s=exports.URL_FILE_EXTENSION=/\.(\w{3,4})(?:$|\?|#)/i,D=exports.DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i,S=exports.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e=exports.SHAPES={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},M=exports.PRECISION={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"},p=exports.TRANSFORM_MODE={STATIC:0,DYNAMIC:1},P=exports.TEXT_GRADIENT={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},r=exports.UPDATE_PRIORITY={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50};
},{}],"TceE":[function(require,module,exports) {
"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var n=function(){function n(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,n),this.x=o,this.y=i}return n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copy=function(t){this.set(t.x,t.y)},n.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},n.prototype.set=function(t,n){this.x=t||0,this.y=n||(0!==n?this.x:0)},n}();exports.default=n;
},{}],"aG0R":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}();function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var e=function(){function e(t,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;i(this,e),this._x=s,this._y=o,this.cb=t,this.scope=n}return e.prototype.clone=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new e(t||this.cb,i||this.scope,this._x,this._y)},e.prototype.set=function(t,i){var e=t||0,n=i||(0!==i?e:0);this._x===e&&this._y===n||(this._x=e,this._y=n,this.cb.call(this.scope))},e.prototype.copy=function(t){this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope))},e.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},t(e,[{key:"x",get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}},{key:"y",get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}]),e}();exports.default=e;
},{}],"dh7x":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,i){for(var s=0;s<i.length;s++){var h=i[s];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}return function(i,s,h){return s&&t(i.prototype,s),h&&t(i,h),i}}(),i=require("./Point"),s=r(i),h=require("../const");function r(t){return t&&t.__esModule?t:{default:t}}function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var e=function(){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;n(this,i),this.a=t,this.b=s,this.c=h,this.d=r,this.tx=e,this.ty=a,this.array=null}return i.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},i.prototype.set=function(t,i,s,h,r,n){return this.a=t,this.b=i,this.c=s,this.d=h,this.tx=r,this.ty=n,this},i.prototype.toArray=function(t,i){this.array||(this.array=new Float32Array(9));var s=i||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s},i.prototype.apply=function(t,i){i=i||new s.default;var h=t.x,r=t.y;return i.x=this.a*h+this.c*r+this.tx,i.y=this.b*h+this.d*r+this.ty,i},i.prototype.applyInverse=function(t,i){i=i||new s.default;var h=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return i.x=this.d*h*r+-this.c*h*n+(this.ty*this.c-this.tx*this.d)*h,i.y=this.a*h*n+-this.b*h*r+(-this.ty*this.a+this.tx*this.b)*h,i},i.prototype.translate=function(t,i){return this.tx+=t,this.ty+=i,this},i.prototype.scale=function(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this},i.prototype.rotate=function(t){var i=Math.cos(t),s=Math.sin(t),h=this.a,r=this.c,n=this.tx;return this.a=h*i-this.b*s,this.b=h*s+this.b*i,this.c=r*i-this.d*s,this.d=r*s+this.d*i,this.tx=n*i-this.ty*s,this.ty=n*s+this.ty*i,this},i.prototype.append=function(t){var i=this.a,s=this.b,h=this.c,r=this.d;return this.a=t.a*i+t.b*h,this.b=t.a*s+t.b*r,this.c=t.c*i+t.d*h,this.d=t.c*s+t.d*r,this.tx=t.tx*i+t.ty*h+this.tx,this.ty=t.tx*s+t.ty*r+this.ty,this},i.prototype.setTransform=function(t,i,s,h,r,n,e,a,o){return this.a=Math.cos(e+o)*r,this.b=Math.sin(e+o)*r,this.c=-Math.sin(e-a)*n,this.d=Math.cos(e-a)*n,this.tx=t-(s*this.a+h*this.c),this.ty=i-(s*this.b+h*this.d),this},i.prototype.prepend=function(t){var i=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var s=this.a,h=this.c;this.a=s*t.a+this.b*t.c,this.b=s*t.b+this.b*t.d,this.c=h*t.a+this.d*t.c,this.d=h*t.b+this.d*t.d}return this.tx=i*t.a+this.ty*t.c+t.tx,this.ty=i*t.b+this.ty*t.d+t.ty,this},i.prototype.decompose=function(t){var i=this.a,s=this.b,r=this.c,n=this.d,e=-Math.atan2(-r,n),a=Math.atan2(s,i),o=Math.abs(e+a);return o<1e-5||Math.abs(h.PI_2-o)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=e,t.skew.y=a),t.scale.x=Math.sqrt(i*i+s*s),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx,t.position.y=this.ty,t},i.prototype.invert=function(){var t=this.a,i=this.b,s=this.c,h=this.d,r=this.tx,n=t*h-i*s;return this.a=h/n,this.b=-i/n,this.c=-s/n,this.d=t/n,this.tx=(s*this.ty-h*r)/n,this.ty=-(t*this.ty-i*r)/n,this},i.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},i.prototype.clone=function(){var t=new i;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},i.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t(i,null,[{key:"IDENTITY",get:function(){return new i}},{key:"TEMP_MATRIX",get:function(){return new i}}]),i}();exports.default=e;
},{"./Point":"TceE","../const":"YEQi"}],"PGIZ":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var n=require("./Matrix"),t=r(n);function r(n){return n&&n.__esModule?n:{default:n}}var u=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],e=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],a=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],i=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],o=[],f=[];function v(n){return n<0?-1:n>0?1:0}function c(){for(var n=0;n<16;n++){var r=[];f.push(r);for(var c=0;c<16;c++)for(var s=v(u[n]*u[c]+a[n]*e[c]),d=v(e[n]*u[c]+i[n]*e[c]),h=v(u[n]*a[c]+a[n]*i[c]),p=v(e[n]*a[c]+i[n]*i[c]),M=0;M<16;M++)if(u[M]===s&&e[M]===d&&a[M]===h&&i[M]===p){r.push(M);break}}for(var R=0;R<16;R++){var l=new t.default;l.set(u[R],e[R],a[R],i[R],0,0),o.push(l)}}c();var s={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(n){return u[n]},uY:function(n){return e[n]},vX:function(n){return a[n]},vY:function(n){return i[n]},inv:function(n){return 8&n?15&n:7&-n},add:function(n,t){return f[n][t]},sub:function(n,t){return f[n][s.inv(t)]},rotate180:function(n){return 4^n},isVertical:function(n){return 2==(3&n)},byDirection:function(n,t){return 2*Math.abs(n)<=Math.abs(t)?t>=0?s.S:s.N:2*Math.abs(t)<=Math.abs(n)?n>0?s.E:s.W:t>0?n>0?s.SE:s.SW:n>0?s.NE:s.NW},matrixAppendRotationInv:function(n,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=o[s.inv(t)];e.tx=r,e.ty=u,n.append(e)}};exports.default=s;
},{"./Matrix":"dh7x"}],"MxpT":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,i){for(var h=0;h<i.length;h++){var e=i[h];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,h,e){return h&&t(i.prototype,h),e&&t(i,e),i}}(),i=require("../../const");function h(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;h(this,e),this.x=Number(t),this.y=Number(n),this.width=Number(s),this.height=Number(o),this.type=i.SHAPES.RECT}return e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.prototype.contains=function(t,i){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height)},e.prototype.pad=function(t,i){t=t||0,i=i||(0!==i?t:0),this.x-=t,this.y-=i,this.width+=2*t,this.height+=2*i},e.prototype.fit=function(t){var i=Math.max(this.x,t.x),h=Math.min(this.x+this.width,t.x+t.width),e=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);this.x=i,this.width=Math.max(h-i,0),this.y=e,this.height=Math.max(n-e,0)},e.prototype.enlarge=function(t){var i=Math.min(this.x,t.x),h=Math.max(this.x+this.width,t.x+t.width),e=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);this.x=i,this.width=h-i,this.y=e,this.height=n-e},e.prototype.ceil=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001,h=Math.ceil((this.x+this.width-i)*t)/t,e=Math.ceil((this.y+this.height-i)*t)/t;this.x=Math.floor((this.x+i)*t)/t,this.y=Math.floor((this.y+i)*t)/t,this.width=h-this.x,this.height=e-this.y},t(e,[{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"EMPTY",get:function(){return new e(0,0,0,0)}}]),e}();exports.default=e;
},{"../../const":"YEQi"}],"8SKy":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("./Rectangle"),i=r(t),s=require("../../const");function r(t){return t&&t.__esModule?t:{default:t}}function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var e=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.x=i,this.y=r,this.radius=e,this.type=s.SHAPES.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,i){if(this.radius<=0)return!1;var s=this.radius*this.radius,r=this.x-t,n=this.y-i;return(r*=r)+(n*=n)<=s},t.prototype.getBounds=function(){return new i.default(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t}();exports.default=e;
},{"./Rectangle":"MxpT","../../const":"YEQi"}],"TKYo":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("./Rectangle"),i=e(t),h=require("../../const");function e(t){return t&&t.__esModule?t:{default:t}}function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;n(this,t),this.x=i,this.y=e,this.width=s,this.height=o,this.type=h.SHAPES.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,i){if(this.width<=0||this.height<=0)return!1;var h=(t-this.x)/this.width,e=(i-this.y)/this.height;return(h*=h)+(e*=e)<=1},t.prototype.getBounds=function(){return new i.default(this.x-this.width,this.y-this.height,this.width,this.height)},t}();exports.default=s;
},{"./Rectangle":"MxpT","../../const":"YEQi"}],"vamC":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../Point"),n=i(t),o=require("../../const");function i(t){return t&&t.__esModule?t:{default:t}}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(){for(var i=arguments.length,s=Array(i),e=0;e<i;e++)s[e]=arguments[e];if(r(this,t),Array.isArray(s[0])&&(s=s[0]),s[0]instanceof n.default){for(var a=[],u=0,p=s.length;u<p;u++)a.push(s[u].x,s[u].y);s=a}this.closed=!0,this.points=s,this.type=o.SHAPES.POLY}return t.prototype.clone=function(){return new t(this.points.slice())},t.prototype.close=function(){var t=this.points;t[0]===t[t.length-2]&&t[1]===t[t.length-1]||t.push(t[0],t[1])},t.prototype.contains=function(t,n){for(var o=!1,i=this.points.length/2,r=0,s=i-1;r<i;s=r++){var e=this.points[2*r],a=this.points[2*r+1],u=this.points[2*s],p=this.points[2*s+1];a>n!=p>n&&t<(n-a)/(p-a)*(u-e)+e&&(o=!o)}return o},t}();exports.default=s;
},{"../Point":"TceE","../../const":"YEQi"}],"p/wO":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var i=require("../../const");function t(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var h=function(){function h(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;t(this,h),this.x=s,this.y=r,this.width=e,this.height=n,this.radius=u,this.type=i.SHAPES.RREC}return h.prototype.clone=function(){return new h(this.x,this.y,this.width,this.height,this.radius)},h.prototype.contains=function(i,t){if(this.width<=0||this.height<=0)return!1;if(i>=this.x&&i<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){if(t>=this.y+this.radius&&t<=this.y+this.height-this.radius||i>=this.x+this.radius&&i<=this.x+this.width-this.radius)return!0;var h=i-(this.x+this.radius),s=t-(this.y+this.radius),r=this.radius*this.radius;if(h*h+s*s<=r)return!0;if((h=i-(this.x+this.width-this.radius))*h+s*s<=r)return!0;if(h*h+(s=t-(this.y+this.height-this.radius))*s<=r)return!0;if((h=i-(this.x+this.radius))*h+s*s<=r)return!0}return!1},h}();exports.default=h;
},{"../../const":"YEQi"}],"e3iB":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./Point");Object.defineProperty(exports,"Point",{enumerable:!0,get:function(){return f(e).default}});var r=require("./ObservablePoint");Object.defineProperty(exports,"ObservablePoint",{enumerable:!0,get:function(){return f(r).default}});var t=require("./Matrix");Object.defineProperty(exports,"Matrix",{enumerable:!0,get:function(){return f(t).default}});var n=require("./GroupD8");Object.defineProperty(exports,"GroupD8",{enumerable:!0,get:function(){return f(n).default}});var u=require("./shapes/Circle");Object.defineProperty(exports,"Circle",{enumerable:!0,get:function(){return f(u).default}});var o=require("./shapes/Ellipse");Object.defineProperty(exports,"Ellipse",{enumerable:!0,get:function(){return f(o).default}});var a=require("./shapes/Polygon");Object.defineProperty(exports,"Polygon",{enumerable:!0,get:function(){return f(a).default}});var i=require("./shapes/Rectangle");Object.defineProperty(exports,"Rectangle",{enumerable:!0,get:function(){return f(i).default}});var l=require("./shapes/RoundedRectangle");function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"RoundedRectangle",{enumerable:!0,get:function(){return f(l).default}});
},{"./Point":"TceE","./ObservablePoint":"aG0R","./Matrix":"dh7x","./GroupD8":"PGIZ","./shapes/Circle":"8SKy","./shapes/Ellipse":"TKYo","./shapes/Polygon":"vamC","./shapes/Rectangle":"MxpT","./shapes/RoundedRectangle":"p/wO"}],"yTo9":[function(require,module,exports) {
var e=function(e,r){var t=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);if(!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");return t};module.exports=e;
},{}],"FtW/":[function(require,module,exports) {
var t=function(t,r,e){var a;if(e){var i=e.tempAttribState,b=e.attribState;for(a=0;a<i.length;a++)i[a]=!1;for(a=0;a<r.length;a++)i[r[a].attribute.location]=!0;for(a=0;a<b.length;a++)b[a]!==i[a]&&(b[a]=i[a],e.attribState[a]?t.enableVertexAttribArray(a):t.disableVertexAttribArray(a))}else for(a=0;a<r.length;a++){var l=r[a];t.enableVertexAttribArray(l.attribute.location)}};module.exports=t;
},{}],"aBLe":[function(require,module,exports) {

var t=new ArrayBuffer(0),e=function(e,r,i,f){this.gl=e,this.buffer=e.createBuffer(),this.type=r||e.ARRAY_BUFFER,this.drawType=f||e.STATIC_DRAW,this.data=t,i&&this.upload(i),this._updateID=0};e.prototype.upload=function(t,e,r){r||this.bind();var i=this.gl;t=t||this.data,e=e||0,this.data.byteLength>=t.byteLength?i.bufferSubData(this.type,e,t):i.bufferData(this.type,t,this.drawType),this.data=t},e.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},e.createVertexBuffer=function(t,r,i){return new e(t,t.ARRAY_BUFFER,r,i)},e.createIndexBuffer=function(t,r,i){return new e(t,t.ELEMENT_ARRAY_BUFFER,r,i)},e.create=function(t,r,i,f){return new e(t,r,i,f)},e.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},module.exports=e;
},{}],"l5aM":[function(require,module,exports) {
var t=function(t,i,e,r,a){this.gl=t,this.texture=t.createTexture(),this.mipmap=!1,this.premultiplyAlpha=!1,this.width=i||-1,this.height=e||-1,this.format=r||t.RGBA,this.type=a||t.UNSIGNED_BYTE};t.prototype.upload=function(t){this.bind();var i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var e=t.videoWidth||t.width,r=t.videoHeight||t.height;r!==this.height||e!==this.width?i.texImage2D(i.TEXTURE_2D,0,this.format,this.format,this.type,t):i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.format,this.type,t),this.width=e,this.height=r};var i=!1;t.prototype.uploadData=function(t,e,r){this.bind();var a=this.gl;if(t instanceof Float32Array){if(!i){if(!a.getExtension("OES_texture_float"))throw new Error("floating point textures not available");i=!0}this.type=a.FLOAT}else this.type=this.type||a.UNSIGNED_BYTE;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e!==this.width||r!==this.height?a.texImage2D(a.TEXTURE_2D,0,this.format,e,r,0,this.format,this.type,t||null):a.texSubImage2D(a.TEXTURE_2D,0,0,0,e,r,this.format,this.type,t||null),this.width=e,this.height=r},t.prototype.bind=function(t){var i=this.gl;void 0!==t&&i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,this.texture)},t.prototype.unbind=function(){var t=this.gl;t.bindTexture(t.TEXTURE_2D,null)},t.prototype.minFilter=function(t){var i=this.gl;this.bind(),this.mipmap?i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t?i.LINEAR:i.NEAREST)},t.prototype.magFilter=function(t){var i=this.gl;this.bind(),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t?i.LINEAR:i.NEAREST)},t.prototype.enableMipmap=function(){var t=this.gl;this.bind(),this.mipmap=!0,t.generateMipmap(t.TEXTURE_2D)},t.prototype.enableLinearScaling=function(){this.minFilter(!0),this.magFilter(!0)},t.prototype.enableNearestScaling=function(){this.minFilter(!1),this.magFilter(!1)},t.prototype.enableWrapClamp=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)},t.prototype.enableWrapRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)},t.prototype.enableWrapMirrorRepeat=function(){var t=this.gl;this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)},t.prototype.destroy=function(){this.gl.deleteTexture(this.texture)},t.fromSource=function(i,e,r){var a=new t(i);return a.premultiplyAlpha=r||!1,a.upload(e),a},t.fromData=function(i,e,r,a){var E=new t(i);return E.uploadData(e,r,a),E},module.exports=t;
},{}],"rtye":[function(require,module,exports) {
var e=require("./GLTexture"),t=function(e,t,r){this.gl=e,this.framebuffer=e.createFramebuffer(),this.stencil=null,this.texture=null,this.width=t||100,this.height=r||100};t.prototype.enableTexture=function(t){var r=this.gl;this.texture=t||new e(r),this.texture.bind(),this.bind(),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture.texture,0)},t.prototype.enableStencil=function(){if(!this.stencil){var e=this.gl;this.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencil),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height)}},t.prototype.clear=function(e,t,r,i){this.bind();var n=this.gl;n.clearColor(e,t,r,i),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)},t.prototype.bind=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer)},t.prototype.unbind=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},t.prototype.resize=function(e,t){var r=this.gl;this.width=e,this.height=t,this.texture&&this.texture.uploadData(null,e,t),this.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,this.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e,t))},t.prototype.destroy=function(){var e=this.gl;this.texture&&this.texture.destroy(),e.deleteFramebuffer(this.framebuffer),this.gl=null,this.stencil=null,this.texture=null},t.createRGBA=function(r,i,n,u){var a=e.fromData(r,null,i,n);a.enableNearestScaling(),a.enableWrapClamp();var l=new t(r,i,n);return l.enableTexture(a),l.unbind(),l},t.createFloat32=function(r,i,n,u){var a=new e.fromData(r,u,i,n);a.enableNearestScaling(),a.enableWrapClamp();var l=new t(r,i,n);return l.enableTexture(a),l.unbind(),l},module.exports=t;
},{"./GLTexture":"l5aM"}],"x48B":[function(require,module,exports) {
var r=function(r,o,a,t){var g=e(r,r.VERTEX_SHADER,o),n=e(r,r.FRAGMENT_SHADER,a),l=r.createProgram();if(r.attachShader(l,g),r.attachShader(l,n),t)for(var S in t)r.bindAttribLocation(l,t[S],S);return r.linkProgram(l),r.getProgramParameter(l,r.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",r.getProgramParameter(l,r.VALIDATE_STATUS)),console.error("gl.getError()",r.getError()),""!==r.getProgramInfoLog(l)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(l)),r.deleteProgram(l),l=null),r.deleteShader(g),r.deleteShader(n),l},e=function(r,e,o){var a=r.createShader(e);return r.shaderSource(a,o),r.compileShader(a),r.getShaderParameter(a,r.COMPILE_STATUS)?a:(console.log(r.getShaderInfoLog(a)),null)};module.exports=r;
},{}],"3hrJ":[function(require,module,exports) {
var e=function(e,v){if(!O){var _=Object.keys(T);O={};for(var L=0;L<_.length;++L){var c=_[L];O[e[c]]=T[c]}}return O[v]},O=null,T={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};module.exports=e;
},{}],"KK7d":[function(require,module,exports) {
var e=function(e){return c[e]},c={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};module.exports=e;
},{}],"LN7j":[function(require,module,exports) {
var e=require("./mapType"),t=require("./mapSize"),r=function(r,o){for(var a={},n=r.getProgramParameter(o,r.ACTIVE_ATTRIBUTES),m=0;m<n;m++){var p=r.getActiveAttrib(o,m),A=e(r,p.type);a[p.name]={type:A,size:t(A),location:r.getAttribLocation(o,p.name),pointer:i}}return a},i=function(e,t,r,i){gl.vertexAttribPointer(this.location,this.size,e||gl.FLOAT,t||!1,r||0,i||0)};module.exports=r;
},{"./mapType":"3hrJ","./mapSize":"KK7d"}],"7Hmw":[function(require,module,exports) {
var r=function(r,a){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*a);case"vec3":return new Float32Array(3*a);case"vec4":return new Float32Array(4*a);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*a);case"ivec3":return new Int32Array(3*a);case"ivec4":return new Int32Array(4*a);case"bool":return!1;case"bvec2":return e(2*a);case"bvec3":return e(3*a);case"bvec4":return e(4*a);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},e=function(r){for(var e=new Array(r),a=0;a<e.length;a++)e[a]=!1;return e};module.exports=r;
},{}],"sq5Z":[function(require,module,exports) {
var e=require("./mapType"),r=require("./defaultValue"),a=function(a,t){for(var i={},o=a.getProgramParameter(t,a.ACTIVE_UNIFORMS),n=0;n<o;n++){var u=a.getActiveUniform(t,n),m=u.name.replace(/\[.*?\]/,""),l=e(a,u.type);i[m]={type:l,size:u.size,location:a.getUniformLocation(t,m),value:r(l,u.size)}}return i};module.exports=a;
},{"./mapType":"3hrJ","./defaultValue":"7Hmw"}],"F9WP":[function(require,module,exports) {
var n=function(n,r){return"precision"!==n.substring(0,9)?"precision "+r+" float;\n"+n:n};module.exports=n;
},{}],"lval":[function(require,module,exports) {
var n=function(n,f){var o={data:{}};o.gl=n;for(var c=Object.keys(f),r=0;r<c.length;r++){var e=c[r],v=e.split("."),m=v[v.length-1],a=u(v,o),l=f[e];a.data[m]=l,a.gl=n,Object.defineProperty(a,m,{get:i(m),set:t(m,l)})}return o},i=function(n){return function(){return this.data[n].value}},f={float:function(n,i,f){n.uniform1f(i,f)},vec2:function(n,i,f){n.uniform2f(i,f[0],f[1])},vec3:function(n,i,f){n.uniform3f(i,f[0],f[1],f[2])},vec4:function(n,i,f){n.uniform4f(i,f[0],f[1],f[2],f[3])},int:function(n,i,f){n.uniform1i(i,f)},ivec2:function(n,i,f){n.uniform2i(i,f[0],f[1])},ivec3:function(n,i,f){n.uniform3i(i,f[0],f[1],f[2])},ivec4:function(n,i,f){n.uniform4i(i,f[0],f[1],f[2],f[3])},bool:function(n,i,f){n.uniform1i(i,f)},bvec2:function(n,i,f){n.uniform2i(i,f[0],f[1])},bvec3:function(n,i,f){n.uniform3i(i,f[0],f[1],f[2])},bvec4:function(n,i,f){n.uniform4i(i,f[0],f[1],f[2],f[3])},mat2:function(n,i,f){n.uniformMatrix2fv(i,!1,f)},mat3:function(n,i,f){n.uniformMatrix3fv(i,!1,f)},mat4:function(n,i,f){n.uniformMatrix4fv(i,!1,f)},sampler2D:function(n,i,f){n.uniform1i(i,f)}},o={float:function(n,i,f){n.uniform1fv(i,f)},vec2:function(n,i,f){n.uniform2fv(i,f)},vec3:function(n,i,f){n.uniform3fv(i,f)},vec4:function(n,i,f){n.uniform4fv(i,f)},int:function(n,i,f){n.uniform1iv(i,f)},ivec2:function(n,i,f){n.uniform2iv(i,f)},ivec3:function(n,i,f){n.uniform3iv(i,f)},ivec4:function(n,i,f){n.uniform4iv(i,f)},bool:function(n,i,f){n.uniform1iv(i,f)},bvec2:function(n,i,f){n.uniform2iv(i,f)},bvec3:function(n,i,f){n.uniform3iv(i,f)},bvec4:function(n,i,f){n.uniform4iv(i,f)},sampler2D:function(n,i,f){n.uniform1iv(i,f)}};function t(n,i){return function(t){this.data[n].value=t;var u=this.data[n].location;1===i.size?f[i.type](this.gl,u,t):o[i.type](this.gl,u,t)}}function u(n,i){for(var f=i,o=0;o<n.length-1;o++){var t=f[n[o]]||{data:{}};f[n[o]]=t,f=t}return f}module.exports=n;
},{}],"VwmF":[function(require,module,exports) {
var r=require("./shader/compileProgram"),t=require("./shader/extractAttributes"),e=require("./shader/extractUniforms"),i=require("./shader/setPrecision"),s=require("./shader/generateUniformAccessObject"),o=function(o,a,u,h,n){this.gl=o,h&&(a=i(a,h),u=i(u,h)),this.program=r(o,a,u,n),this.attributes=t(o,this.program),this.uniformData=e(o,this.program),this.uniforms=s(o,this.uniformData)};o.prototype.bind=function(){return this.gl.useProgram(this.program),this},o.prototype.destroy=function(){this.attributes=null,this.uniformData=null,this.uniforms=null,this.gl.deleteProgram(this.program)},module.exports=o;
},{"./shader/compileProgram":"x48B","./shader/extractAttributes":"LN7j","./shader/extractUniforms":"sq5Z","./shader/setPrecision":"F9WP","./shader/generateUniformAccessObject":"lval"}],"iM49":[function(require,module,exports) {
var t=require("./setVertexAttribArrays");function e(t,i){if(this.nativeVaoExtension=null,e.FORCE_NATIVE||(this.nativeVaoExtension=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object")),this.nativeState=i,this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var r=t.getParameter(t.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:new Array(r),attribState:new Array(r)}}this.gl=t,this.attributes=[],this.indexBuffer=null,this.dirty=!1}e.prototype.constructor=e,module.exports=e,e.FORCE_NATIVE=!1,e.prototype.bind=function(){if(this.nativeVao){if(this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.dirty)return this.dirty=!1,this.activate(),this;this.indexBuffer&&this.indexBuffer.bind()}else this.activate();return this},e.prototype.unbind=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(null),this},e.prototype.activate=function(){for(var e=this.gl,i=null,r=0;r<this.attributes.length;r++){var n=this.attributes[r];i!==n.buffer&&(n.buffer.bind(),i=n.buffer),e.vertexAttribPointer(n.attribute.location,n.attribute.size,n.type||e.FLOAT,n.normalized||!1,n.stride||0,n.start||0)}return t(e,this.attributes,this.nativeState),this.indexBuffer&&this.indexBuffer.bind(),this},e.prototype.addAttribute=function(t,e,i,r,n,a){return this.attributes.push({buffer:t,attribute:e,location:e.location,type:i||this.gl.FLOAT,normalized:r||!1,stride:n||0,start:a||0}),this.dirty=!0,this},e.prototype.addIndex=function(t){return this.indexBuffer=t,this.dirty=!0,this},e.prototype.clear=function(){return this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.attributes.length=0,this.indexBuffer=null,this},e.prototype.draw=function(t,e,i){var r=this.gl;return this.indexBuffer?r.drawElements(t,e||this.indexBuffer.data.length,r.UNSIGNED_SHORT,2*(i||0)):r.drawArrays(t,i,e||this.getSize()),this},e.prototype.destroy=function(){this.gl=null,this.indexBuffer=null,this.attributes=null,this.nativeState=null,this.nativeVao&&this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao),this.nativeVaoExtension=null,this.nativeVao=null},e.prototype.getSize=function(){var t=this.attributes[0];return t.buffer.data.length/(t.stride/4||t.attribute.size)};
},{"./setVertexAttribArrays":"FtW/"}],"5ZOS":[function(require,module,exports) {
module.exports={compileProgram:require("./compileProgram"),defaultValue:require("./defaultValue"),extractAttributes:require("./extractAttributes"),extractUniforms:require("./extractUniforms"),generateUniformAccessObject:require("./generateUniformAccessObject"),setPrecision:require("./setPrecision"),mapSize:require("./mapSize"),mapType:require("./mapType")};
},{"./compileProgram":"x48B","./defaultValue":"7Hmw","./extractAttributes":"LN7j","./extractUniforms":"sq5Z","./generateUniformAccessObject":"lval","./setPrecision":"F9WP","./mapSize":"KK7d","./mapType":"3hrJ"}],"PJsv":[function(require,module,exports) {
var e={createContext:require("./createContext"),setVertexAttribArrays:require("./setVertexAttribArrays"),GLBuffer:require("./GLBuffer"),GLFramebuffer:require("./GLFramebuffer"),GLShader:require("./GLShader"),GLTexture:require("./GLTexture"),VertexArrayObject:require("./VertexArrayObject"),shader:require("./shader")};"undefined"!=typeof module&&module.exports&&(module.exports=e),"undefined"!=typeof window&&(window.PIXI=window.PIXI||{},window.PIXI.glCore=e);
},{"./createContext":"yTo9","./setVertexAttribArrays":"FtW/","./GLBuffer":"aBLe","./GLFramebuffer":"rtye","./GLShader":"VwmF","./GLTexture":"l5aM","./VertexArrayObject":"iM49","./shader":"5ZOS"}],"Me0q":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var i=require("../math");function t(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var m=function(){function m(){t(this,m),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null}return m.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},m.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},m.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?i.Rectangle.EMPTY:((t=t||new i.Rectangle(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},m.prototype.addPoint=function(i){this.minX=Math.min(this.minX,i.x),this.maxX=Math.max(this.maxX,i.x),this.minY=Math.min(this.minY,i.y),this.maxY=Math.max(this.maxY,i.y)},m.prototype.addQuad=function(i){var t=this.minX,m=this.minY,n=this.maxX,a=this.maxY,s=i[0],h=i[1];t=s<t?s:t,m=h<m?h:m,n=s>n?s:n,a=h>a?h:a,t=(s=i[2])<t?s:t,m=(h=i[3])<m?h:m,n=s>n?s:n,a=h>a?h:a,t=(s=i[4])<t?s:t,m=(h=i[5])<m?h:m,n=s>n?s:n,a=h>a?h:a,t=(s=i[6])<t?s:t,m=(h=i[7])<m?h:m,n=s>n?s:n,a=h>a?h:a,this.minX=t,this.minY=m,this.maxX=n,this.maxY=a},m.prototype.addFrame=function(i,t,m,n,a){var s=i.worldTransform,h=s.a,x=s.b,Y=s.c,X=s.d,o=s.tx,r=s.ty,e=this.minX,d=this.minY,u=this.maxX,c=this.maxY,p=h*t+Y*m+o,f=x*t+X*m+r;e=p<e?p:e,d=f<d?f:d,u=p>u?p:u,c=f>c?f:c,e=(p=h*n+Y*m+o)<e?p:e,d=(f=x*n+X*m+r)<d?f:d,u=p>u?p:u,c=f>c?f:c,e=(p=h*t+Y*a+o)<e?p:e,d=(f=x*t+X*a+r)<d?f:d,u=p>u?p:u,c=f>c?f:c,e=(p=h*n+Y*a+o)<e?p:e,d=(f=x*n+X*a+r)<d?f:d,u=p>u?p:u,c=f>c?f:c,this.minX=e,this.minY=d,this.maxX=u,this.maxY=c},m.prototype.addVertices=function(i,t,m,n){for(var a=i.worldTransform,s=a.a,h=a.b,x=a.c,Y=a.d,X=a.tx,o=a.ty,r=this.minX,e=this.minY,d=this.maxX,u=this.maxY,c=m;c<n;c+=2){var p=t[c],f=t[c+1],y=s*p+x*f+X,l=Y*f+h*p+o;r=y<r?y:r,e=l<e?l:e,d=y>d?y:d,u=l>u?l:u}this.minX=r,this.minY=e,this.maxX=d,this.maxY=u},m.prototype.addBounds=function(i){var t=this.minX,m=this.minY,n=this.maxX,a=this.maxY;this.minX=i.minX<t?i.minX:t,this.minY=i.minY<m?i.minY:m,this.maxX=i.maxX>n?i.maxX:n,this.maxY=i.maxY>a?i.maxY:a},m.prototype.addBoundsMask=function(i,t){var m=i.minX>t.minX?i.minX:t.minX,n=i.minY>t.minY?i.minY:t.minY,a=i.maxX<t.maxX?i.maxX:t.maxX,s=i.maxY<t.maxY?i.maxY:t.maxY;if(m<=a&&n<=s){var h=this.minX,x=this.minY,Y=this.maxX,X=this.maxY;this.minX=m<h?m:h,this.minY=n<x?n:x,this.maxX=a>Y?a:Y,this.maxY=s>X?s:X}},m.prototype.addBoundsArea=function(i,t){var m=i.minX>t.x?i.minX:t.x,n=i.minY>t.y?i.minY:t.y,a=i.maxX<t.x+t.width?i.maxX:t.x+t.width,s=i.maxY<t.y+t.height?i.maxY:t.y+t.height;if(m<=a&&n<=s){var h=this.minX,x=this.minY,Y=this.maxX,X=this.maxY;this.minX=m<h?m:h,this.minY=n<x?n:x,this.maxX=a>Y?a:Y,this.maxY=s>X?s:X}},m}();exports.default=m;
},{"../math":"e3iB"}],"2JJl":[function(require,module,exports) {
"use strict";var e=Object.prototype.hasOwnProperty,t="~";function n(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(t=!1)),r.prototype.eventNames=function(){var n,s,r=[];if(0===this._eventsCount)return r;for(s in n=this._events)e.call(n,s)&&r.push(t?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(n)):r},r.prototype.listeners=function(e,n){var s=t?t+e:e,r=this._events[s];if(n)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,c=new Array(i);o<i;o++)c[o]=r[o].fn;return c},r.prototype.emit=function(e,n,s,r,o,i){var c=t?t+e:e;if(!this._events[c])return!1;var h,v,f=this._events[c],a=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),a){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,n),!0;case 3:return f.fn.call(f.context,n,s),!0;case 4:return f.fn.call(f.context,n,s,r),!0;case 5:return f.fn.call(f.context,n,s,r,o),!0;case 6:return f.fn.call(f.context,n,s,r,o,i),!0}for(v=1,h=new Array(a-1);v<a;v++)h[v-1]=arguments[v];f.fn.apply(f.context,h)}else{var u,l=f.length;for(v=0;v<l;v++)switch(f[v].once&&this.removeListener(e,f[v].fn,void 0,!0),a){case 1:f[v].fn.call(f[v].context);break;case 2:f[v].fn.call(f[v].context,n);break;case 3:f[v].fn.call(f[v].context,n,s);break;case 4:f[v].fn.call(f[v].context,n,s,r);break;default:if(!h)for(u=1,h=new Array(a-1);u<a;u++)h[u-1]=arguments[u];f[v].fn.apply(f[v].context,h)}}return!0},r.prototype.on=function(e,n,r){var o=new s(n,r||this),i=t?t+e:e;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):(this._events[i]=o,this._eventsCount++),this},r.prototype.once=function(e,n,r){var o=new s(n,r||this,!0),i=t?t+e:e;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):(this._events[i]=o,this._eventsCount++),this},r.prototype.removeListener=function(e,s,r,o){var i=t?t+e:e;if(!this._events[i])return this;if(!s)return 0==--this._eventsCount?this._events=new n:delete this._events[i],this;var c=this._events[i];if(c.fn)c.fn!==s||o&&!c.once||r&&c.context!==r||(0==--this._eventsCount?this._events=new n:delete this._events[i]);else{for(var h=0,v=[],f=c.length;h<f;h++)(c[h].fn!==s||o&&!c[h].once||r&&c[h].context!==r)&&v.push(c[h]);v.length?this._events[i]=1===v.length?v[0]:v:0==--this._eventsCount?this._events=new n:delete this._events[i]}return this},r.prototype.removeAllListeners=function(e){var s;return e?(s=t?t+e:e,this._events[s]&&(0==--this._eventsCount?this._events=new n:delete this._events[s])):(this._events=new n,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=t,r.EventEmitter=r,"undefined"!=typeof module&&(module.exports=r);
},{}],"nSZq":[function(require,module,exports) {
var define;
var e;!function(i){var o=/iPhone/i,d=/iPod/i,n=/iPad/i,t=/\bAndroid(?:.+)Mobile\b/i,r=/Android/i,a=/\bAndroid(?:.+)SD4930UR\b/i,p=/\bAndroid(?:.+)(?:KF[A-Z]{2,4})\b/i,l=/Windows Phone/i,b=/\bWindows(?:.+)ARM\b/i,f=/BlackBerry/i,u=/BB10/i,c=/Opera Mini/i,s=/\b(CriOS|Chrome)(?:.+)Mobile/i,v=/\Mobile(?:.+)Firefox\b/i;function h(e,i){return e.test(i)}function w(e){var i=e||("undefined"!=typeof navigator?navigator.userAgent:""),w=i.split("[FBAN");void 0!==w[1]&&(i=w[0]),void 0!==(w=i.split("Twitter"))[1]&&(i=w[0]);var m={apple:{phone:h(o,i)&&!h(l,i),ipod:h(d,i),tablet:!h(o,i)&&h(n,i)&&!h(l,i),device:(h(o,i)||h(d,i)||h(n,i))&&!h(l,i)},amazon:{phone:h(a,i),tablet:!h(a,i)&&h(p,i),device:h(a,i)||h(p,i)},android:{phone:!h(l,i)&&h(a,i)||!h(l,i)&&h(t,i),tablet:!h(l,i)&&!h(a,i)&&!h(t,i)&&(h(p,i)||h(r,i)),device:!h(l,i)&&(h(a,i)||h(p,i)||h(t,i)||h(r,i))},windows:{phone:h(l,i),tablet:h(b,i),device:h(l,i)||h(b,i)},other:{blackberry:h(f,i),blackberry10:h(u,i),opera:h(c,i),firefox:h(v,i),chrome:h(s,i),device:h(f,i)||h(u,i)||h(c,i)||h(v,i)||h(s,i)}};return m.any=m.apple.device||m.android.device||m.windows.device||m.other.device,m.phone=m.apple.phone||m.android.phone||m.windows.phone,m.tablet=m.apple.tablet||m.android.tablet||m.windows.tablet,m}"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=w:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=w():"function"==typeof e&&e.amd?e([],i.isMobile=w()):i.isMobile=w()}(this);
},{}],"4eqS":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=r;var e=require("ismobilejs"),t=u(e);function u(e){return e&&e.__esModule?e:{default:e}}function r(e){return t.default.tablet||t.default.phone?4:e}
},{"ismobilejs":"nSZq"}],"JVKT":[function(require,module,exports) {
"use strict";function t(){return!(!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform))}exports.__esModule=!0,exports.default=t;
},{}],"tMVT":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./utils/maxRecommendedTextures"),E=R(e),_=require("./utils/canUploadSameBuffer"),r=R(_);function R(e){return e&&e.__esModule?e:{default:e}}exports.default={TARGET_FPMS:.06,MIPMAP_TEXTURES:!0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(0,E.default)(32),SPRITE_BATCH_SIZE:4096,RETINA_PREFIX:/@([0-9\.]+)x/,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1,width:800,height:600,legacy:!1},TRANSFORM_MODE:0,GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:0,SCALE_MODE:0,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:"mediump",CAN_UPLOAD_SAME_BUFFER:(0,r.default)(),MESH_CANVAS_PADDING:0};
},{"./utils/maxRecommendedTextures":"4eqS","./utils/canUploadSameBuffer":"JVKT"}],"Pszr":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../math");function r(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}var o=function(){function o(){r(this,o),this.worldTransform=new t.Matrix,this.localTransform=new t.Matrix,this._worldID=0,this._parentID=0}return o.prototype.updateLocalTransform=function(){},o.prototype.updateTransform=function(t){var r=t.worldTransform,o=this.worldTransform,a=this.localTransform;o.a=a.a*r.a+a.b*r.c,o.b=a.a*r.b+a.b*r.d,o.c=a.c*r.a+a.d*r.c,o.d=a.c*r.b+a.d*r.d,o.tx=a.tx*r.a+a.ty*r.c+r.tx,o.ty=a.tx*r.b+a.ty*r.d+r.ty,this._worldID++},o}();exports.default=o,o.prototype.updateWorldTransform=o.prototype.updateTransform,o.IDENTITY=new o;
},{"../math":"e3iB"}],"pc4T":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,o){for(var i=0;i<o.length;i++){var e=o[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(o,i,e){return i&&t(o.prototype,i),e&&t(o,e),o}}(),o=require("../math"),i=require("./TransformBase"),e=s(i);function s(t){return t&&t.__esModule?t:{default:t}}function n(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function r(t,o){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?t:o}function a(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);t.prototype=Object.create(o&&o.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(t,o):t.__proto__=o)}var c=function(i){function e(){n(this,e);var t=r(this,i.call(this));return t.position=new o.ObservablePoint(t.onChange,t,0,0),t.scale=new o.ObservablePoint(t.onChange,t,1,1),t.pivot=new o.ObservablePoint(t.onChange,t,0,0),t.skew=new o.ObservablePoint(t.updateSkew,t,0,0),t._rotation=0,t._cx=1,t._sx=0,t._cy=0,t._sy=1,t._localID=0,t._currentLocalID=0,t}return a(e,i),e.prototype.onChange=function(){this._localID++},e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x),this._localID++},e.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale._x,t.b=this._sx*this.scale._x,t.c=this._cy*this.scale._y,t.d=this._sy*this.scale._y,t.tx=this.position._x-(this.pivot._x*t.a+this.pivot._y*t.c),t.ty=this.position._y-(this.pivot._x*t.b+this.pivot._y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},e.prototype.updateTransform=function(t){var o=this.localTransform;if(this._localID!==this._currentLocalID&&(o.a=this._cx*this.scale._x,o.b=this._sx*this.scale._x,o.c=this._cy*this.scale._y,o.d=this._sy*this.scale._y,o.tx=this.position._x-(this.pivot._x*o.a+this.pivot._y*o.c),o.ty=this.position._y-(this.pivot._x*o.b+this.pivot._y*o.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var i=t.worldTransform,e=this.worldTransform;e.a=o.a*i.a+o.b*i.c,e.b=o.a*i.b+o.b*i.d,e.c=o.c*i.a+o.d*i.c,e.d=o.c*i.b+o.d*i.d,e.tx=o.tx*i.a+o.ty*i.c+i.tx,e.ty=o.tx*i.b+o.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}},e.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},t(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}}]),e}(e.default);exports.default=c;
},{"../math":"e3iB","./TransformBase":"Pszr"}],"ThH+":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,i){for(var o=0;o<i.length;o++){var e=i[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,o,e){return o&&t(i.prototype,o),e&&t(i,e),i}}(),i=require("../math"),o=require("./TransformBase"),e=s(o);function s(t){return t&&t.__esModule?t:{default:t}}function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function r(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function a(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}var c=function(o){function e(){n(this,e);var t=r(this,o.call(this));return t.position=new i.Point(0,0),t.scale=new i.Point(1,1),t.skew=new i.ObservablePoint(t.updateSkew,t,0,0),t.pivot=new i.Point(0,0),t._rotation=0,t._cx=1,t._sx=0,t._cy=0,t._sy=1,t}return a(e,o),e.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x)},e.prototype.updateLocalTransform=function(){var t=this.localTransform;t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d)},e.prototype.updateTransform=function(t){var i=this.localTransform;i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d);var o=t.worldTransform,e=this.worldTransform;e.a=i.a*o.a+i.b*o.c,e.b=i.a*o.b+i.b*o.d,e.c=i.c*o.a+i.d*o.c,e.d=i.c*o.b+i.d*o.d,e.tx=i.tx*o.a+i.ty*o.c+o.tx,e.ty=i.tx*o.b+i.ty*o.d+o.ty,this._worldID++},e.prototype.setFromMatrix=function(t){t.decompose(this)},t(e,[{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.updateSkew()}}]),e}(e.default);exports.default=c;
},{"../math":"e3iB","./TransformBase":"Pszr"}],"rGF6":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),e=require("eventemitter3"),r=c(e),n=require("../const"),s=require("../settings"),i=c(s),o=require("./TransformStatic"),a=c(o),l=require("./Transform"),u=c(l),h=require("./Bounds"),p=c(h),f=require("../math");function c(t){return t&&t.__esModule?t:{default:t}}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _=function(e){function r(){d(this,r);var t=m(this,e.call(this)),s=i.default.TRANSFORM_MODE===n.TRANSFORM_MODE.STATIC?a.default:u.default;return t.tempDisplayObjectParent=null,t.transform=new s,t.alpha=1,t.visible=!0,t.renderable=!0,t.parent=null,t.worldAlpha=1,t.filterArea=null,t._filters=null,t._enabledFilters=null,t._bounds=new p.default,t._boundsID=0,t._lastBoundsID=-1,t._boundsRect=null,t._localBoundsRect=null,t._mask=null,t._destroyed=!1,t}return y(r,e),r.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},r.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},r.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&this.calculateBounds(),e||(this._boundsRect||(this._boundsRect=new f.Rectangle),e=this._boundsRect),this._bounds.getRectangle(e)},r.prototype.getLocalBounds=function(t){var e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new f.Rectangle),t=this._localBoundsRect);var n=this.getBounds(!1,t);return this.parent=r,this.transform=e,n},r.prototype.toGlobal=function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},r.prototype.toLocal=function(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)},r.prototype.renderWebGL=function(t){},r.prototype.renderCanvas=function(t){},r.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},r.prototype.setTransform=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=s,this.skew.x=i,this.skew.y=o,this.pivot.x=a,this.pivot.y=l,this},r.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},t(r,[{key:"_tempDisplayObjectParent",get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new r),this.tempDisplayObjectParent}},{key:"x",get:function(){return this.position.x},set:function(t){this.transform.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.transform.position.y=t}},{key:"worldTransform",get:function(){return this.transform.worldTransform}},{key:"localTransform",get:function(){return this.transform.localTransform}},{key:"position",get:function(){return this.transform.position},set:function(t){this.transform.position.copy(t)}},{key:"scale",get:function(){return this.transform.scale},set:function(t){this.transform.scale.copy(t)}},{key:"pivot",get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copy(t)}},{key:"skew",get:function(){return this.transform.skew},set:function(t){this.transform.skew.copy(t)}},{key:"rotation",get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t}},{key:"worldVisible",get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}},{key:"mask",get:function(){return this._mask},set:function(t){this._mask&&(this._mask.renderable=!0,this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.renderable=!1,this._mask.isMask=!0)}},{key:"filters",get:function(){return this._filters&&this._filters.slice()},set:function(t){this._filters=t&&t.slice()}}]),r}(r.default);exports.default=_,_.prototype.displayObjectUpdateTransform=_.prototype.updateTransform;
},{"eventemitter3":"2JJl","../const":"YEQi","../settings":"tMVT","./TransformStatic":"pc4T","./Transform":"ThH+","./Bounds":"Me0q","../math":"e3iB"}],"Mag4":[function(require,module,exports) {
"use strict";function i(i){i.__plugins={},i.registerPlugin=function(n,s){i.__plugins[n]=s},i.prototype.initPlugins=function(){for(var n in this.plugins=this.plugins||{},i.__plugins)this.plugins[n]=new i.__plugins[n](this)},i.prototype.destroyPlugins=function(){for(var i in this.plugins)this.plugins[i].destroy(),this.plugins[i]=null;this.plugins=null}}exports.__esModule=!0,exports.default={mixin:function(n){i(n)}};
},{}],"hJHU":[function(require,module,exports) {
"use strict";function e(e,r){if(e&&r)for(var t=Object.keys(r),n=0;n<t.length;++n){var o=t[n];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))}}exports.__esModule=!0,exports.mixin=e,exports.delayMixin=t,exports.performMixins=n;var r=[];function t(e,t){r.push(e,t)}function n(){for(var t=0;t<r.length;t+=2)e(r[t],r[t+1]);r.length=0}
},{}],"n9cH":[function(require,module,exports) {
"use strict";module.exports=function(t,e,r){var n,o=t.length;if(!(e>=o||0===r)){var f=o-(r=e+r>o?o-e:r);for(n=e;n<f;++n)t[n]=t[n+r];t.length=f}};
},{}],"UALW":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=E;var D=require("../const");function E(){for(var E=[],N=[],M=0;M<32;M++)E[M]=M,N[M]=M;E[D.BLEND_MODES.NORMAL_NPM]=D.BLEND_MODES.NORMAL,E[D.BLEND_MODES.ADD_NPM]=D.BLEND_MODES.ADD,E[D.BLEND_MODES.SCREEN_NPM]=D.BLEND_MODES.SCREEN,N[D.BLEND_MODES.NORMAL]=D.BLEND_MODES.NORMAL_NPM,N[D.BLEND_MODES.ADD]=D.BLEND_MODES.ADD_NPM,N[D.BLEND_MODES.SCREEN]=D.BLEND_MODES.SCREEN_NPM;var _=[];return _.push(N),_.push(E),_}
},{"../const":"YEQi"}],"vwhv":[function(require,module,exports) {
"use strict";function e(e,t,x){x=x||2;var i,u,v,y,o,p,l,a=t&&t.length,h=a?t[0]*x:e.length,s=n(e,0,h,x,!0),c=[];if(!s||s.next===s.prev)return c;if(a&&(s=f(e,t,s,x)),e.length>80*x){i=v=e[0],u=y=e[1];for(var Z=x;Z<h;Z+=x)(o=e[Z])<i&&(i=o),(p=e[Z+1])<u&&(u=p),o>v&&(v=o),p>y&&(y=p);l=0!==(l=Math.max(v-i,y-u))?1/l:0}return r(s,c,x,i,u,l),c}function n(e,n,t,r,x){var i,u;if(x===A(e,n,t,r)>0)for(i=n;i<t;i+=r)u=k(i,e[i],e[i+1],u);else for(i=t-r;i>=n;i-=r)u=k(i,e[i],e[i+1],u);return u&&g(u,u.next)&&(j(u),u=u.next),u}function t(e,n){if(!e)return e;n||(n=e);var t,r=e;do{if(t=!1,r.steiner||!g(r,r.next)&&0!==d(r.prev,r,r.next))r=r.next;else{if(j(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function r(e,n,f,y,o,p,a){if(e){!a&&p&&l(e,y,o,p);for(var h,s,c=e;e.prev!==e.next;)if(h=e.prev,s=e.next,p?i(e,y,o,p):x(e))n.push(h.i/f),n.push(e.i/f),n.push(s.i/f),j(e),e=s.next,c=s.next;else if((e=s)===c){a?1===a?r(e=u(e,n,f),n,f,y,o,p,2):2===a&&v(e,n,f,y,o,p):r(t(e),n,f,y,o,p,1);break}}}function x(e){var n=e.prev,t=e,r=e.next;if(d(n,t,r)>=0)return!1;for(var x=e.next.next;x!==e.prev;){if(c(n.x,n.y,t.x,t.y,r.x,r.y,x.x,x.y)&&d(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function i(e,n,t,r){var x=e.prev,i=e,u=e.next;if(d(x,i,u)>=0)return!1;for(var v=x.x<i.x?x.x<u.x?x.x:u.x:i.x<u.x?i.x:u.x,f=x.y<i.y?x.y<u.y?x.y:u.y:i.y<u.y?i.y:u.y,y=x.x>i.x?x.x>u.x?x.x:u.x:i.x>u.x?i.x:u.x,o=x.y>i.y?x.y>u.y?x.y:u.y:i.y>u.y?i.y:u.y,p=h(v,f,n,t,r),l=h(y,o,n,t,r),a=e.prevZ,s=e.nextZ;a&&a.z>=p&&s&&s.z<=l;){if(a!==e.prev&&a!==e.next&&c(x.x,x.y,i.x,i.y,u.x,u.y,a.x,a.y)&&d(a.prev,a,a.next)>=0)return!1;if(a=a.prevZ,s!==e.prev&&s!==e.next&&c(x.x,x.y,i.x,i.y,u.x,u.y,s.x,s.y)&&d(s.prev,s,s.next)>=0)return!1;s=s.nextZ}for(;a&&a.z>=p;){if(a!==e.prev&&a!==e.next&&c(x.x,x.y,i.x,i.y,u.x,u.y,a.x,a.y)&&d(a.prev,a,a.next)>=0)return!1;a=a.prevZ}for(;s&&s.z<=l;){if(s!==e.prev&&s!==e.next&&c(x.x,x.y,i.x,i.y,u.x,u.y,s.x,s.y)&&d(s.prev,s,s.next)>=0)return!1;s=s.nextZ}return!0}function u(e,n,t){var r=e;do{var x=r.prev,i=r.next.next;!g(x,i)&&w(x,r,r.next,i)&&b(x,i)&&b(i,x)&&(n.push(x.i/t),n.push(r.i/t),n.push(i.i/t),j(r),j(r.next),r=e=i),r=r.next}while(r!==e);return r}function v(e,n,x,i,u,v){var f=e;do{for(var y=f.next.next;y!==f.prev;){if(f.i!==y.i&&Z(f,y)){var o=m(f,y);return f=t(f,f.next),o=t(o,o.next),r(f,n,x,i,u,v),void r(o,n,x,i,u,v)}y=y.next}f=f.next}while(f!==e)}function f(e,r,x,i){var u,v,f,p=[];for(u=0,v=r.length;u<v;u++)(f=n(e,r[u]*i,u<v-1?r[u+1]*i:e.length,i,!1))===f.next&&(f.steiner=!0),p.push(s(f));for(p.sort(y),u=0;u<p.length;u++)o(p[u],x),x=t(x,x.next);return x}function y(e,n){return e.x-n.x}function o(e,n){if(n=p(e,n)){var r=m(n,e);t(r,r.next)}}function p(e,n){var t,r=n,x=e.x,i=e.y,u=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var v=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(v<=x&&v>u){if(u=v,v===x){if(i===r.y)return r;if(i===r.next.y)return r.next}t=r.x<r.next.x?r:r.next}}r=r.next}while(r!==n);if(!t)return null;if(x===u)return t.prev;var f,y=t,o=t.x,p=t.y,l=1/0;for(r=t.next;r!==y;)x>=r.x&&r.x>=o&&x!==r.x&&c(i<p?x:u,i,o,p,i<p?u:x,i,r.x,r.y)&&((f=Math.abs(i-r.y)/(x-r.x))<l||f===l&&r.x>t.x)&&b(r,e)&&(t=r,l=f),r=r.next;return t}function l(e,n,t,r){var x=e;do{null===x.z&&(x.z=h(x.x,x.y,n,t,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,a(x)}function a(e){var n,t,r,x,i,u,v,f,y=1;do{for(t=e,e=null,i=null,u=0;t;){for(u++,r=t,v=0,n=0;n<y&&(v++,r=r.nextZ);n++);for(f=y;v>0||f>0&&r;)0!==v&&(0===f||!r||t.z<=r.z)?(x=t,t=t.nextZ,v--):(x=r,r=r.nextZ,f--),i?i.nextZ=x:e=x,x.prevZ=i,i=x;t=r}i.nextZ=null,y*=2}while(u>1);return e}function h(e,n,t,r,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-t)*x)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-r)*x)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function s(e){var n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function c(e,n,t,r,x,i,u,v){return(x-u)*(n-v)-(e-u)*(i-v)>=0&&(e-u)*(r-v)-(t-u)*(n-v)>=0&&(t-u)*(i-v)-(x-u)*(r-v)>=0}function Z(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!z(e,n)&&b(e,n)&&b(n,e)&&M(e,n)}function d(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function g(e,n){return e.x===n.x&&e.y===n.y}function w(e,n,t,r){return!!(g(e,n)&&g(t,r)||g(e,r)&&g(t,n))||d(e,n,t)>0!=d(e,n,r)>0&&d(t,r,e)>0!=d(t,r,n)>0}function z(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&w(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}function b(e,n){return d(e.prev,e,e.next)<0?d(e,n,e.next)>=0&&d(e,e.prev,n)>=0:d(e,n,e.prev)<0||d(e,e.next,n)<0}function M(e,n){var t=e,r=!1,x=(e.x+n.x)/2,i=(e.y+n.y)/2;do{t.y>i!=t.next.y>i&&t.next.y!==t.y&&x<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==e);return r}function m(e,n){var t=new q(e.i,e.x,e.y),r=new q(n.i,n.x,n.y),x=e.next,i=n.prev;return e.next=n,n.prev=e,t.next=x,x.prev=t,r.next=t,t.prev=r,i.next=r,r.prev=i,r}function k(e,n,t,r){var x=new q(e,n,t);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function j(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function q(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,n,t,r){for(var x=0,i=n,u=t-r;i<t;i+=r)x+=(e[u]-e[i])*(e[i+1]+e[u+1]),u=i;return x}module.exports=e,module.exports.default=e,e.deviation=function(e,n,t,r){var x=n&&n.length,i=x?n[0]*t:e.length,u=Math.abs(A(e,0,i,t));if(x)for(var v=0,f=n.length;v<f;v++){var y=n[v]*t,o=v<f-1?n[v+1]*t:e.length;u-=Math.abs(A(e,y,o,t))}var p=0;for(v=0;v<r.length;v+=3){var l=r[v]*t,a=r[v+1]*t,h=r[v+2]*t;p+=Math.abs((e[l]-e[h])*(e[a+1]-e[l+1])-(e[l]-e[a])*(e[h+1]-e[l+1]))}return 0===u&&0===p?0:Math.abs((p-u)/u)},e.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},r=0,x=0;x<e.length;x++){for(var i=0;i<e[x].length;i++)for(var u=0;u<n;u++)t.vertices.push(e[x][i][u]);x>0&&(r+=e[x-1].length,t.holes.push(r))}return t};
},{}],"dDI1":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.premultiplyBlendMode=exports.BaseTextureCache=exports.TextureCache=exports.earcut=exports.mixins=exports.pluginTarget=exports.EventEmitter=exports.removeItems=exports.isMobile=void 0,exports.uid=y,exports.hex2rgb=C,exports.hex2string=T,exports.rgb2hex=E,exports.getResolutionOfUrl=_,exports.decomposeDataUri=M,exports.getUrlFileExtension=I,exports.getSvgSize=L,exports.skipHello=S,exports.sayHello=k,exports.isWebGLSupported=R,exports.sign=q,exports.destroyTextureCache=j,exports.clearTextureCache=A,exports.correctBlendMode=P,exports.premultiplyTint=N,exports.premultiplyRgba=U,exports.premultiplyTintToRgba=G;var e=require("../const"),r=require("../settings"),t=b(r),o=require("eventemitter3"),n=b(o),i=require("./pluginTarget"),a=b(i),u=require("./mixin"),s=m(u),p=require("ismobilejs"),c=m(p),l=require("remove-array-items"),d=b(l),x=require("./mapPremultipliedBlendModes"),f=b(x),g=require("earcut"),v=b(g);function m(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function b(e){return e&&e.__esModule?e:{default:e}}var w=0,h=!1;function y(){return++w}function C(e,r){return(r=r||[])[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,r}function T(e){return e=e.toString(16),"#"+(e="000000".substr(0,6-e.length)+e)}function E(e){return(255*e[0]<<16)+(255*e[1]<<8)+(255*e[2]|0)}function _(e,r){var o=t.default.RETINA_PREFIX.exec(e);return o?parseFloat(o[1]):void 0!==r?r:1}function M(r){var t=e.DATA_URI.exec(r);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function I(r){var t=e.URL_FILE_EXTENSION.exec(r);if(t)return t[1].toLowerCase()}function L(r){var t=e.SVG_SIZE.exec(r),o={};return t&&(o[t[1]]=Math.round(parseFloat(t[3])),o[t[5]]=Math.round(parseFloat(t[7]))),o}function S(){h=!0}function k(r){if(!h){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var t=["\n %c %c %c PixiJS "+e.VERSION+" - ✰ "+r+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,t)}else window.console&&window.console.log("PixiJS "+e.VERSION+" - "+r+" - http://www.pixijs.com/");h=!0}}function R(){var e={stencil:!0,failIfMajorPerformanceCaveat:!0};try{if(!window.WebGLRenderingContext)return!1;var r=document.createElement("canvas"),t=r.getContext("webgl",e)||r.getContext("experimental-webgl",e),o=!(!t||!t.getContextAttributes().stencil);if(t){var n=t.getExtension("WEBGL_lose_context");n&&n.loseContext()}return t=null,o}catch(i){return!1}}function q(e){return 0===e?0:e<0?-1:1}exports.isMobile=c,exports.removeItems=d.default,exports.EventEmitter=n.default,exports.pluginTarget=a.default,exports.mixins=s,exports.earcut=v.default;var O=exports.TextureCache=Object.create(null),F=exports.BaseTextureCache=Object.create(null);function j(){var e=void 0;for(e in O)O[e].destroy();for(e in F)F[e].destroy()}function A(){var e=void 0;for(e in O)delete O[e];for(e in F)delete F[e]}var B=exports.premultiplyBlendMode=(0,f.default)();function P(e,r){return B[r?1:0][e]}function N(e,r){if(1===r)return(255*r<<24)+e;if(0===r)return 0;var t=e>>16&255,o=e>>8&255,n=255&e;return(255*r<<24)+((t=t*r+.5|0)<<16)+((o=o*r+.5|0)<<8)+(n=n*r+.5|0)}function U(e,r,t,o){return t=t||new Float32Array(4),o||void 0===o?(t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r):(t[0]=e[0],t[1]=e[1],t[2]=e[2]),t[3]=r,t}function G(e,r,t,o){return(t=t||new Float32Array(4))[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,(o||void 0===o)&&(t[0]*=r,t[1]*=r,t[2]*=r),t[3]=r,t}
},{"../const":"YEQi","../settings":"tMVT","eventemitter3":"2JJl","./pluginTarget":"Mag4","./mixin":"hJHU","ismobilejs":"nSZq","remove-array-items":"n9cH","./mapPremultipliedBlendModes":"UALW","earcut":"vwhv"}],"OzBO":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t=require("../utils"),r=require("./DisplayObject"),n=i(r);function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(r){function n(){s(this,n);var e=h(this,r.call(this));return e.children=[],e}return o(n,r),n.prototype.onChildrenChange=function(){},n.prototype.addChild=function(e){var t=arguments.length;if(t>1)for(var r=0;r<t;r++)this.addChild(arguments[r]);else e.parent&&e.parent.removeChild(e),e.parent=this,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),e.emit("added",this);return e},n.prototype.addChildAt=function(e,t){if(t<0||t>this.children.length)throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length);return e.parent&&e.parent.removeChild(e),e.parent=this,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),e},n.prototype.swapChildren=function(e,t){if(e!==t){var r=this.getChildIndex(e),n=this.getChildIndex(t);this.children[r]=t,this.children[n]=e,this.onChildrenChange(r<n?r:n)}},n.prototype.getChildIndex=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t},n.prototype.setChildIndex=function(e,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(e);(0,t.removeItems)(this.children,n,1),this.children.splice(r,0,e),this.onChildrenChange(r)},n.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Index ("+e+") does not exist.");return this.children[e]},n.prototype.removeChild=function(e){var r=arguments.length;if(r>1)for(var n=0;n<r;n++)this.removeChild(arguments[n]);else{var i=this.children.indexOf(e);if(-1===i)return null;e.parent=null,e.transform._parentID=-1,(0,t.removeItems)(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this)}return e},n.prototype.removeChildAt=function(e){var r=this.getChildAt(e);return r.parent=null,r.transform._parentID=-1,(0,t.removeItems)(this.children,e,1),this._boundsID++,this.onChildrenChange(e),r.emit("removed",this),r},n.prototype.removeChildren=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1],r=e,n="number"==typeof t?t:this.children.length,i=n-r,s=void 0;if(i>0&&i<=n){s=this.children.splice(r,i);for(var h=0;h<s.length;++h)s[h].parent=null,s[h].transform&&(s[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(var o=0;o<s.length;++o)s[o].emit("removed",this);return s}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},n.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var e=0,t=this.children.length;e<t;++e){var r=this.children[e];r.visible&&r.updateTransform()}},n.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var e=0;e<this.children.length;e++){var t=this.children[e];t.visible&&t.renderable&&(t.calculateBounds(),t._mask?(t._mask.calculateBounds(),this._bounds.addBoundsMask(t._bounds,t._mask._bounds)):t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds))}this._lastBoundsID=this._boundsID},n.prototype._calculateBounds=function(){},n.prototype.renderWebGL=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this._filters)this.renderAdvancedWebGL(e);else{this._renderWebGL(e);for(var t=0,r=this.children.length;t<r;++t)this.children[t].renderWebGL(e)}},n.prototype.renderAdvancedWebGL=function(e){e.flush();var t=this._filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var n=0;n<t.length;n++)t[n].enabled&&this._enabledFilters.push(t[n]);this._enabledFilters.length&&e.filterManager.pushFilter(this,this._enabledFilters)}r&&e.maskManager.pushMask(this,this._mask),this._renderWebGL(e);for(var i=0,s=this.children.length;i<s;i++)this.children[i].renderWebGL(e);e.flush(),r&&e.maskManager.popMask(this,this._mask),t&&this._enabledFilters&&this._enabledFilters.length&&e.filterManager.popFilter()},n.prototype._renderWebGL=function(e){},n.prototype._renderCanvas=function(e){},n.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&e.maskManager.pushMask(this._mask),this._renderCanvas(e);for(var t=0,r=this.children.length;t<r;++t)this.children[t].renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},n.prototype.destroy=function(e){r.prototype.destroy.call(this);var t="boolean"==typeof e?e:e&&e.children,n=this.removeChildren(0,this.children.length);if(t)for(var i=0;i<n.length;++i)n[i].destroy(e)},e(n,[{key:"width",get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}},{key:"height",get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}}]),n}(n.default);exports.default=l,l.prototype.containerUpdateTransform=l.prototype.updateTransform;
},{"../utils":"dDI1","./DisplayObject":"rGF6"}],"/oWq":[function(require,module,exports) {
var global = arguments[3];
var define;
var o,e=arguments[3];!function(n){var r="object"==typeof exports&&exports&&!exports.nodeType&&exports,t="object"==typeof module&&module&&!module.nodeType&&module,u="object"==typeof e&&e;u.global!==u&&u.window!==u&&u.self!==u||(n=u);var i,f,c=2147483647,l=36,s=1,p=26,a=38,d=700,h=72,v=128,g="-",w=/^xn--/,x=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},C=l-s,b=Math.floor,j=String.fromCharCode;function A(o){throw new RangeError(m[o])}function I(o,e){for(var n=o.length,r=[];n--;)r[n]=e(o[n]);return r}function E(o,e){var n=o.split("@"),r="";return n.length>1&&(r=n[0]+"@",o=n[1]),r+I((o=o.replace(y,".")).split("."),e).join(".")}function F(o){for(var e,n,r=[],t=0,u=o.length;t<u;)(e=o.charCodeAt(t++))>=55296&&e<=56319&&t<u?56320==(64512&(n=o.charCodeAt(t++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),t--):r.push(e);return r}function O(o){return I(o,function(o){var e="";return o>65535&&(e+=j((o-=65536)>>>10&1023|55296),o=56320|1023&o),e+=j(o)}).join("")}function S(o,e){return o+22+75*(o<26)-((0!=e)<<5)}function T(o,e,n){var r=0;for(o=n?b(o/d):o>>1,o+=b(o/e);o>C*p>>1;r+=l)o=b(o/C);return b(r+(C+1)*o/(o+a))}function L(o){var e,n,r,t,u,i,f,a,d,w,x,y=[],m=o.length,C=0,j=v,I=h;for((n=o.lastIndexOf(g))<0&&(n=0),r=0;r<n;++r)o.charCodeAt(r)>=128&&A("not-basic"),y.push(o.charCodeAt(r));for(t=n>0?n+1:0;t<m;){for(u=C,i=1,f=l;t>=m&&A("invalid-input"),((a=(x=o.charCodeAt(t++))-48<10?x-22:x-65<26?x-65:x-97<26?x-97:l)>=l||a>b((c-C)/i))&&A("overflow"),C+=a*i,!(a<(d=f<=I?s:f>=I+p?p:f-I));f+=l)i>b(c/(w=l-d))&&A("overflow"),i*=w;I=T(C-u,e=y.length+1,0==u),b(C/e)>c-j&&A("overflow"),j+=b(C/e),C%=e,y.splice(C++,0,j)}return O(y)}function M(o){var e,n,r,t,u,i,f,a,d,w,x,y,m,C,I,E=[];for(y=(o=F(o)).length,e=v,n=0,u=h,i=0;i<y;++i)(x=o[i])<128&&E.push(j(x));for(r=t=E.length,t&&E.push(g);r<y;){for(f=c,i=0;i<y;++i)(x=o[i])>=e&&x<f&&(f=x);for(f-e>b((c-n)/(m=r+1))&&A("overflow"),n+=(f-e)*m,e=f,i=0;i<y;++i)if((x=o[i])<e&&++n>c&&A("overflow"),x==e){for(a=n,d=l;!(a<(w=d<=u?s:d>=u+p?p:d-u));d+=l)I=a-w,C=l-w,E.push(j(S(w+I%C,0))),a=b(I/C);E.push(j(S(a,0))),u=T(n,m,r==t),n=0,++r}++n,++e}return E.join("")}if(i={version:"1.4.1",ucs2:{decode:F,encode:O},decode:L,encode:M,toASCII:function(o){return E(o,function(o){return x.test(o)?"xn--"+M(o):o})},toUnicode:function(o){return E(o,function(o){return w.test(o)?L(o.slice(4).toLowerCase()):o})}},"function"==typeof o&&"object"==typeof o.amd&&o.amd)o("punycode",function(){return i});else if(r&&t)if(module.exports==r)t.exports=i;else for(f in i)i.hasOwnProperty(f)&&(r[f]=i[f]);else n.punycode=i}(this);
},{}],"5YsI":[function(require,module,exports) {
"use strict";module.exports={isString:function(n){return"string"==typeof n},isObject:function(n){return"object"==typeof n&&null!==n},isNull:function(n){return null===n},isNullOrUndefined:function(n){return null==n}};
},{}],"J6GP":[function(require,module,exports) {
"use strict";function r(r,e){return Object.prototype.hasOwnProperty.call(r,e)}module.exports=function(t,n,o,a){n=n||"&",o=o||"=";var s={};if("string"!=typeof t||0===t.length)return s;var p=/\+/g;t=t.split(n);var u=1e3;a&&"number"==typeof a.maxKeys&&(u=a.maxKeys);var c=t.length;u>0&&c>u&&(c=u);for(var i=0;i<c;++i){var y,l,f,v,b=t[i].replace(p,"%20"),d=b.indexOf(o);d>=0?(y=b.substr(0,d),l=b.substr(d+1)):(y=b,l=""),f=decodeURIComponent(y),v=decodeURIComponent(l),r(s,f)?e(s[f])?s[f].push(v):s[f]=[s[f],v]:s[f]=v}return s};var e=Array.isArray||function(r){return"[object Array]"===Object.prototype.toString.call(r)};
},{}],"bvhO":[function(require,module,exports) {
"use strict";var n=function(n){switch(typeof n){case"string":return n;case"boolean":return n?"true":"false";case"number":return isFinite(n)?n:"";default:return""}};module.exports=function(o,u,c,a){return u=u||"&",c=c||"=",null===o&&(o=void 0),"object"==typeof o?r(t(o),function(t){var a=encodeURIComponent(n(t))+c;return e(o[t])?r(o[t],function(e){return a+encodeURIComponent(n(e))}).join(u):a+encodeURIComponent(n(o[t]))}).join(u):a?encodeURIComponent(n(a))+c+encodeURIComponent(n(o)):""};var e=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};function r(n,e){if(n.map)return n.map(e);for(var r=[],t=0;t<n.length;t++)r.push(e(n[t],t));return r}var t=Object.keys||function(n){var e=[];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.push(r);return e};
},{}],"+00f":[function(require,module,exports) {
"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode");
},{"./decode":"J6GP","./encode":"bvhO"}],"Mej7":[function(require,module,exports) {
"use strict";var t=require("punycode"),s=require("./util");function h(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.parse=b,exports.resolve=O,exports.resolveObject=d,exports.format=q,exports.Url=h;var e=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,r=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,o=["<",">",'"',"`"," ","\r","\n","\t"],n=["{","}","|","\\","^","`"].concat(o),i=["'"].concat(n),l=["%","/","?",";","#"].concat(i),p=["/","?","#"],c=255,u=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=require("querystring");function b(t,e,a){if(t&&s.isObject(t)&&t instanceof h)return t;var r=new h;return r.parse(t,e,a),r}function q(t){return s.isString(t)&&(t=b(t)),t instanceof h?t.format():h.prototype.format.call(t)}function O(t,s){return b(t,!1,!0).resolve(s)}function d(t,s){return t?b(t,!1,!0).resolveObject(s):s}h.prototype.parse=function(h,a,o){if(!s.isString(h))throw new TypeError("Parameter 'url' must be a string, not "+typeof h);var n=h.indexOf("?"),b=-1!==n&&n<h.indexOf("#")?"?":"#",q=h.split(b);q[0]=q[0].replace(/\\/g,"/");var O=h=q.join(b);if(O=O.trim(),!o&&1===h.split("#").length){var d=r.exec(O);if(d)return this.path=O,this.href=O,this.pathname=d[1],d[2]?(this.search=d[2],this.query=a?y.parse(this.search.substr(1)):this.search.substr(1)):a&&(this.search="",this.query={}),this}var j=e.exec(O);if(j){var x=(j=j[0]).toLowerCase();this.protocol=x,O=O.substr(j.length)}if(o||j||O.match(/^\/\/[^@\/]+@[^@\/]+/)){var A="//"===O.substr(0,2);!A||j&&v[j]||(O=O.substr(2),this.slashes=!0)}if(!v[j]&&(A||j&&!g[j])){for(var C,I,w=-1,U=0;U<p.length;U++){-1!==(k=O.indexOf(p[U]))&&(-1===w||k<w)&&(w=k)}-1!==(I=-1===w?O.lastIndexOf("@"):O.lastIndexOf("@",w))&&(C=O.slice(0,I),O=O.slice(I+1),this.auth=decodeURIComponent(C)),w=-1;for(U=0;U<l.length;U++){var k;-1!==(k=O.indexOf(l[U]))&&(-1===w||k<w)&&(w=k)}-1===w&&(w=O.length),this.host=O.slice(0,w),O=O.slice(w),this.parseHost(),this.hostname=this.hostname||"";var N="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!N)for(var R=this.hostname.split(/\./),S=(U=0,R.length);U<S;U++){var $=R[U];if($&&!$.match(u)){for(var z="",H=0,L=$.length;H<L;H++)$.charCodeAt(H)>127?z+="x":z+=$[H];if(!z.match(u)){var Z=R.slice(0,U),_=R.slice(U+1),E=$.match(f);E&&(Z.push(E[1]),_.unshift(E[2])),_.length&&(O="/"+_.join(".")+O),this.hostname=Z.join(".");break}}}this.hostname.length>c?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=t.toASCII(this.hostname));var P=this.port?":"+this.port:"",T=this.hostname||"";this.host=T+P,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==O[0]&&(O="/"+O))}if(!m[x])for(U=0,S=i.length;U<S;U++){var B=i[U];if(-1!==O.indexOf(B)){var D=encodeURIComponent(B);D===B&&(D=escape(B)),O=O.split(B).join(D)}}var F=O.indexOf("#");-1!==F&&(this.hash=O.substr(F),O=O.slice(0,F));var G=O.indexOf("?");if(-1!==G?(this.search=O.substr(G),this.query=O.substr(G+1),a&&(this.query=y.parse(this.query)),O=O.slice(0,G)):a&&(this.search="",this.query={}),O&&(this.pathname=O),g[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){P=this.pathname||"";var J=this.search||"";this.path=P+J}return this.href=this.format(),this},h.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var h=this.protocol||"",e=this.pathname||"",a=this.hash||"",r=!1,o="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(o=y.stringify(this.query));var n=this.search||o&&"?"+o||"";return h&&":"!==h.substr(-1)&&(h+=":"),this.slashes||(!h||g[h])&&!1!==r?(r="//"+(r||""),e&&"/"!==e.charAt(0)&&(e="/"+e)):r||(r=""),a&&"#"!==a.charAt(0)&&(a="#"+a),n&&"?"!==n.charAt(0)&&(n="?"+n),h+r+(e=e.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(n=n.replace("#","%23"))+a},h.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},h.prototype.resolveObject=function(t){if(s.isString(t)){var e=new h;e.parse(t,!1,!0),t=e}for(var a=new h,r=Object.keys(this),o=0;o<r.length;o++){var n=r[o];a[n]=this[n]}if(a.hash=t.hash,""===t.href)return a.href=a.format(),a;if(t.slashes&&!t.protocol){for(var i=Object.keys(t),l=0;l<i.length;l++){var p=i[l];"protocol"!==p&&(a[p]=t[p])}return g[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(t.protocol&&t.protocol!==a.protocol){if(!g[t.protocol]){for(var c=Object.keys(t),u=0;u<c.length;u++){var f=c[u];a[f]=t[f]}return a.href=a.format(),a}if(a.protocol=t.protocol,t.host||v[t.protocol])a.pathname=t.pathname;else{for(var m=(t.pathname||"").split("/");m.length&&!(t.host=m.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),a.pathname=m.join("/")}if(a.search=t.search,a.query=t.query,a.host=t.host||"",a.auth=t.auth,a.hostname=t.hostname||t.host,a.port=t.port,a.pathname||a.search){var y=a.pathname||"",b=a.search||"";a.path=y+b}return a.slashes=a.slashes||t.slashes,a.href=a.format(),a}var q=a.pathname&&"/"===a.pathname.charAt(0),O=t.host||t.pathname&&"/"===t.pathname.charAt(0),d=O||q||a.host&&t.pathname,j=d,x=a.pathname&&a.pathname.split("/")||[],A=(m=t.pathname&&t.pathname.split("/")||[],a.protocol&&!g[a.protocol]);if(A&&(a.hostname="",a.port=null,a.host&&(""===x[0]?x[0]=a.host:x.unshift(a.host)),a.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===m[0]?m[0]=t.host:m.unshift(t.host)),t.host=null),d=d&&(""===m[0]||""===x[0])),O)a.host=t.host||""===t.host?t.host:a.host,a.hostname=t.hostname||""===t.hostname?t.hostname:a.hostname,a.search=t.search,a.query=t.query,x=m;else if(m.length)x||(x=[]),x.pop(),x=x.concat(m),a.search=t.search,a.query=t.query;else if(!s.isNullOrUndefined(t.search)){if(A)a.hostname=a.host=x.shift(),(k=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=k.shift(),a.host=a.hostname=k.shift());return a.search=t.search,a.query=t.query,s.isNull(a.pathname)&&s.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a}if(!x.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var C=x.slice(-1)[0],I=(a.host||t.host||x.length>1)&&("."===C||".."===C)||""===C,w=0,U=x.length;U>=0;U--)"."===(C=x[U])?x.splice(U,1):".."===C?(x.splice(U,1),w++):w&&(x.splice(U,1),w--);if(!d&&!j)for(;w--;w)x.unshift("..");!d||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),I&&"/"!==x.join("/").substr(-1)&&x.push("");var k,N=""===x[0]||x[0]&&"/"===x[0].charAt(0);A&&(a.hostname=a.host=N?"":x.length?x.shift():"",(k=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=k.shift(),a.host=a.hostname=k.shift()));return(d=d||a.host&&x.length)&&!N&&x.unshift(""),x.length?a.pathname=x.join("/"):(a.pathname=null,a.path=null),s.isNull(a.pathname)&&s.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=t.auth||a.auth,a.slashes=a.slashes||t.slashes,a.href=a.format(),a},h.prototype.parseHost=function(){var t=this.host,s=a.exec(t);s&&(":"!==(s=s[0])&&(this.port=s.substr(1)),t=t.substr(0,t.length-s.length)),t&&(this.hostname=t)};
},{"punycode":"/oWq","./util":"5YsI","querystring":"+00f"}],"f1vj":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=n;var o=require("url"),e=t(o);function t(o){return o&&o.__esModule?o:{default:o}}var r=void 0;function n(o){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location;if(0===o.indexOf("data:"))return"";t=t||window.location,r||(r=document.createElement("a")),r.href=o;var n=!(o=e.default.parse(r.href)).port&&""===t.port||o.port===t.port;return o.hostname===t.hostname&&n&&o.protocol===t.protocol?"":"anonymous"}
},{"url":"Mej7"}],"gXRl":[function(require,module,exports) {
"use strict";var r=32;function n(r){var n=32;return(r&=-r)&&n--,65535&r&&(n-=16),16711935&r&&(n-=8),252645135&r&&(n-=4),858993459&r&&(n-=2),1431655765&r&&(n-=1),n}exports.INT_BITS=r,exports.INT_MAX=2147483647,exports.INT_MIN=-1<<r-1,exports.sign=function(r){return(r>0)-(r<0)},exports.abs=function(n){var t=n>>r-1;return(n^t)-t},exports.min=function(r,n){return n^(r^n)&-(r<n)},exports.max=function(r,n){return r^(r^n)&-(r<n)},exports.isPow2=function(r){return!(r&r-1||!r)},exports.log2=function(r){var n,t;return n=(r>65535)<<4,n|=t=((r>>>=n)>255)<<3,n|=t=((r>>>=t)>15)<<2,(n|=t=((r>>>=t)>3)<<1)|(r>>>=t)>>1},exports.log10=function(r){return r>=1e9?9:r>=1e8?8:r>=1e7?7:r>=1e6?6:r>=1e5?5:r>=1e4?4:r>=1e3?3:r>=100?2:r>=10?1:0},exports.popCount=function(r){return 16843009*((r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)>>>24},exports.countTrailingZeros=n,exports.nextPow2=function(r){return r+=0===r,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,(r|=r>>>16)+1},exports.prevPow2=function(r){return r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,(r|=r>>>16)-(r>>>1)},exports.parity=function(r){return r^=r>>>16,r^=r>>>8,r^=r>>>4,27030>>>(r&=15)&1};var t=new Array(256);!function(r){for(var n=0;n<256;++n){var t=n,e=n,o=7;for(t>>>=1;t;t>>>=1)e<<=1,e|=1&t,--o;r[n]=e<<o&255}}(t),exports.reverse=function(r){return t[255&r]<<24|t[r>>>8&255]<<16|t[r>>>16&255]<<8|t[r>>>24&255]},exports.interleave2=function(r,n){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r&=65535)|r<<8))|r<<4))|r<<2))|r<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n&=65535)|n<<8))|n<<4))|n<<2))|n<<1))<<1},exports.deinterleave2=function(r,n){return(r=65535&((r=16711935&((r=252645135&((r=858993459&((r=r>>>n&1431655765)|r>>>1))|r>>>2))|r>>>4))|r>>>16))<<16>>16},exports.interleave3=function(r,n,t){return r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2),(r|=(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<1)|(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<2},exports.deinterleave3=function(r,n){return(r=1023&((r=4278190335&((r=251719695&((r=3272356035&((r=r>>>n&1227133513)|r>>>2))|r>>>4))|r>>>8))|r>>>16))<<22>>22},exports.nextCombination=function(r){var t=r|r-1;return t+1|(~t&-~t)-1>>>n(r)+1};
},{}],"ce6K":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../utils"),t=require("../settings"),i=h(t),r=require("eventemitter3"),o=h(r),s=require("../utils/determineCrossOrigin"),a=h(s),n=require("bit-twiddle"),u=h(n);function h(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=function(t){function r(o,s,a){d(this,r);var n=l(this,t.call(this));return n.uid=(0,e.uid)(),n.touched=0,n.resolution=a||i.default.RESOLUTION,n.width=100,n.height=100,n.realWidth=100,n.realHeight=100,n.scaleMode=void 0!==s?s:i.default.SCALE_MODE,n.hasLoaded=!1,n.isLoading=!1,n.source=null,n.origSource=null,n.imageType=null,n.sourceScale=1,n.premultipliedAlpha=!0,n.imageUrl=null,n.isPowerOfTwo=!1,n.mipmap=i.default.MIPMAP_TEXTURES,n.wrapMode=i.default.WRAP_MODE,n._glTextures={},n._enabled=0,n._virtalBoundId=-1,n._destroyed=!1,n.textureCacheIds=[],o&&n.loadSource(o),n}return c(r,t),r.prototype.update=function(){"svg"!==this.imageType&&(this.realWidth=this.source.naturalWidth||this.source.videoWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height,this._updateDimensions()),this.emit("update",this)},r.prototype._updateDimensions=function(){this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=u.default.isPow2(this.realWidth)&&u.default.isPow2(this.realHeight)},r.prototype.loadSource=function(e){var t=this.isLoading;this.hasLoaded=!1,this.isLoading=!1,t&&this.source&&(this.source.onload=null,this.source.onerror=null);var i=!this.source;if(this.source=e,(e.src&&e.complete||e.getContext)&&e.width&&e.height)this._updateImageType(),"svg"===this.imageType?this._loadSvgSource():this._sourceLoaded(),i&&this.emit("loaded",this);else if(!e.getContext){this.isLoading=!0;var r=this;if(e.onload=function(){r._updateImageType(),e.onload=null,e.onerror=null,r.isLoading&&(r.isLoading=!1,r._sourceLoaded(),"svg"!==r.imageType?r.emit("loaded",r):r._loadSvgSource())},e.onerror=function(){e.onload=null,e.onerror=null,r.isLoading&&(r.isLoading=!1,r.emit("error",r))},e.complete&&e.src){if(e.onload=null,e.onerror=null,"svg"===r.imageType)return void r._loadSvgSource();this.isLoading=!1,e.width&&e.height?(this._sourceLoaded(),t&&this.emit("loaded",this)):t&&this.emit("error",this)}}},r.prototype._updateImageType=function(){if(this.imageUrl){var t=(0,e.decomposeDataUri)(this.imageUrl),i=void 0;if(t&&"image"===t.mediaType){var r=t.subType.split("+")[0];if(!(i=(0,e.getUrlFileExtension)("."+r)))throw new Error("Invalid image type in data URI.")}else(i=(0,e.getUrlFileExtension)(this.imageUrl))||(i="png");this.imageType=i}},r.prototype._loadSvgSource=function(){if("svg"===this.imageType){var t=(0,e.decomposeDataUri)(this.imageUrl);t?this._loadSvgSourceUsingDataUri(t):this._loadSvgSourceUsingXhr()}},r.prototype._loadSvgSourceUsingDataUri=function(e){var t=void 0;if("base64"===e.encoding){if(!atob)throw new Error("Your browser doesn't support base64 conversions.");t=atob(e.data)}else t=e.data;this._loadSvgSourceUsingString(t)},r.prototype._loadSvgSourceUsingXhr=function(){var e=this,t=new XMLHttpRequest;t.onload=function(){if(t.readyState!==t.DONE||200!==t.status)throw new Error("Failed to load SVG using XHR.");e._loadSvgSourceUsingString(t.response)},t.onerror=function(){return e.emit("error",e)},t.open("GET",this.imageUrl,!0),t.send()},r.prototype._loadSvgSourceUsingString=function(t){var i=(0,e.getSvgSize)(t),o=i.width,s=i.height;if(!o||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");this.realWidth=Math.round(o*this.sourceScale),this.realHeight=Math.round(s*this.sourceScale),this._updateDimensions();var a=document.createElement("canvas");a.width=this.realWidth,a.height=this.realHeight,a._pixiId="canvas_"+(0,e.uid)(),a.getContext("2d").drawImage(this.source,0,0,o,s,0,0,this.realWidth,this.realHeight),this.origSource=this.source,this.source=a,r.addToCache(this,a._pixiId),this.isLoading=!1,this._sourceLoaded(),this.emit("loaded",this)},r.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},r.prototype.destroy=function(){this.imageUrl&&(delete e.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")),this.source=null,this.dispose(),r.removeFromCache(this),this.textureCacheIds=null,this._destroyed=!0},r.prototype.dispose=function(){this.emit("dispose",this)},r.prototype.updateSourceImage=function(e){this.source.src=e,this.loadSource(this.source)},r.fromImage=function(t,i,o,s){var n=e.BaseTextureCache[t];if(!n){var u=new Image;void 0===i&&0!==t.indexOf("data:")?u.crossOrigin=(0,a.default)(t):i&&(u.crossOrigin="string"==typeof i?i:"anonymous"),(n=new r(u,o)).imageUrl=t,s&&(n.sourceScale=s),n.resolution=(0,e.getResolutionOfUrl)(t),u.src=t,r.addToCache(n,t)}return n},r.fromCanvas=function(t,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas";t._pixiId||(t._pixiId=o+"_"+(0,e.uid)());var s=e.BaseTextureCache[t._pixiId];return s||(s=new r(t,i),r.addToCache(s,t._pixiId)),s},r.from=function(t,i,o){if("string"==typeof t)return r.fromImage(t,void 0,i,o);if(t instanceof HTMLImageElement){var s=t.src,a=e.BaseTextureCache[s];return a||((a=new r(t,i)).imageUrl=s,o&&(a.sourceScale=o),a.resolution=(0,e.getResolutionOfUrl)(s),r.addToCache(a,s)),a}return t instanceof HTMLCanvasElement?r.fromCanvas(t,i):t},r.addToCache=function(t,i){i&&(-1===t.textureCacheIds.indexOf(i)&&t.textureCacheIds.push(i),e.BaseTextureCache[i]&&console.warn("BaseTexture added to the cache with an id ["+i+"] that already had an entry"),e.BaseTextureCache[i]=t)},r.removeFromCache=function(t){if("string"==typeof t){var i=e.BaseTextureCache[t];if(i){var r=i.textureCacheIds.indexOf(t);return r>-1&&i.textureCacheIds.splice(r,1),delete e.BaseTextureCache[t],i}}else if(t&&t.textureCacheIds){for(var o=0;o<t.textureCacheIds.length;++o)delete e.BaseTextureCache[t.textureCacheIds[o]];return t.textureCacheIds.length=0,t}return null},r}(o.default);exports.default=g;
},{"../utils":"dDI1","../settings":"tMVT","eventemitter3":"2JJl","../utils/determineCrossOrigin":"f1vj","bit-twiddle":"gXRl"}],"3ilc":[function(require,module,exports) {
"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var n=function(){function n(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t(this,n),this.fn=i,this.context=e,this.priority=s,this.once=o,this.next=null,this.previous=null,this._destroyed=!1}return n.prototype.match=function(t,n){return n=n||null,this.fn===t&&this.context===n},n.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var n=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),n},n.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},n.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var n=this.next;return this.next=t?null:n,this.previous=null,n},n}();exports.default=n;
},{}],"nuOJ":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),e=require("../settings"),i=a(e),s=require("../const"),n=require("./TickerListener"),r=a(n);function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var d=function(){function e(){var t=this;o(this,e),this._head=new r.default(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/i.default.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return e.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},e.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},e.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},e.prototype.add=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.UPDATE_PRIORITY.NORMAL;return this._addListener(new r.default(t,e,i))},e.prototype.addOnce=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.UPDATE_PRIORITY.NORMAL;return this._addListener(new r.default(t,e,i,!0))},e.prototype._addListener=function(t){var e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this},e.prototype.remove=function(t,e){for(var i=this._head.next;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},e.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},e.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},e.prototype.destroy=function(){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null},e.prototype.update=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now(),e=void 0;if(t>this.lastTime){(e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),this.deltaTime=e*i.default.TARGET_FPMS*this.speed;for(var s=this._head,n=s.next;n;)n=n.emit(this.deltaTime);s.next||this._cancelIfNeeded()}else this.deltaTime=this.elapsedMS=0;this.lastTime=t},t(e,[{key:"FPS",get:function(){return 1e3/this.elapsedMS}},{key:"minFPS",get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(Math.max(0,t)/1e3,i.default.TARGET_FPMS);this._maxElapsedMS=1/e}}]),e}();exports.default=d;
},{"../settings":"tMVT","../const":"YEQi","./TickerListener":"3ilc"}],"5u59":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.Ticker=exports.shared=void 0;var e=require("./Ticker"),r=t(e);function t(e){return e&&e.__esModule?e:{default:e}}var o=new r.default;o.autoStart=!0,o.destroy=function(){},exports.shared=o,exports.Ticker=r.default;
},{"./Ticker":"nuOJ"}],"U1Rh":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),e=require("./BaseTexture"),i=u(e),r=require("../utils"),o=require("../ticker"),a=require("../const"),n=require("../utils/determineCrossOrigin"),s=u(n);function u(t){return t&&t.__esModule?t:{default:t}}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(e){function n(t,i){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(d(this,n),!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0);var o=h(this,e.call(this,t,i));return o.width=t.videoWidth,o.height=t.videoHeight,o._autoUpdate=!0,o._isAutoUpdating=!1,o.autoPlay=r,o.update=o.update.bind(o),o._onCanPlay=o._onCanPlay.bind(o),t.addEventListener("play",o._onPlayStart.bind(o)),t.addEventListener("pause",o._onPlayStop.bind(o)),o.hasLoaded=!1,o.__loaded=!1,o._isSourceReady()?o._onCanPlay():(t.addEventListener("canplay",o._onCanPlay),t.addEventListener("canplaythrough",o._onCanPlay)),o}return p(n,e),n.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},n.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},n.prototype._onPlayStart=function(){this.hasLoaded||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(o.shared.add(this.update,this,a.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0)},n.prototype._onPlayStop=function(){this._isAutoUpdating&&(o.shared.remove(this.update,this),this._isAutoUpdating=!1)},n.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.emit("loaded",this)),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.source.play())},n.prototype.destroy=function(){this._isAutoUpdating&&o.shared.remove(this.update,this),this.source&&this.source._pixiId&&(i.default.removeFromCache(this.source._pixiId),delete this.source._pixiId,this.source.pause(),this.source.src="",this.source.load()),e.prototype.destroy.call(this)},n.fromVideo=function(t,e,o){t._pixiId||(t._pixiId="video_"+(0,r.uid)());var a=r.BaseTextureCache[t._pixiId];return a||(a=new n(t,e,o),i.default.addToCache(a,t._pixiId)),a},n.fromUrl=function(t,e,i,r){var o=document.createElement("video");o.setAttribute("webkit-playsinline",""),o.setAttribute("playsinline","");var a=Array.isArray(t)?t[0].src||t[0]:t.src||t;if(void 0===i&&0!==a.indexOf("data:")?o.crossOrigin=(0,s.default)(a):i&&(o.crossOrigin="string"==typeof i?i:"anonymous"),Array.isArray(t))for(var u=0;u<t.length;++u)o.appendChild(l(t[u].src||t[u],t[u].mime));else o.appendChild(l(a,t.mime));return o.load(),n.fromVideo(o,e,r)},t(n,[{key:"autoUpdate",get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isAutoUpdating?(o.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(o.shared.add(this.update,this,a.UPDATE_PRIORITY.HIGH),this._isAutoUpdating=!0))}}]),n}(i.default);function l(t,e){if(!e){var i=t.split("?").shift().toLowerCase();e="video/"+i.substr(i.lastIndexOf(".")+1)}var r=document.createElement("source");return r.src=t,r.type=e,r}exports.default=c,c.fromUrls=c.fromUrl;
},{"./BaseTexture":"ce6K","../utils":"dDI1","../ticker":"5u59","../const":"YEQi","../utils/determineCrossOrigin":"f1vj"}],"sUm+":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../math/GroupD8"),i=h(t);function h(t){return t&&t.__esModule?t:{default:t}}function s(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var u=function(){function t(){s(this,t),this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsUint32=new Uint32Array(4)}return t.prototype.set=function(t,h,s){var u=h.width,a=h.height;if(s){var e=t.width/2/u,d=t.height/2/a,n=t.x/u+e,r=t.y/a+d;s=i.default.add(s,i.default.NW),this.x0=n+e*i.default.uX(s),this.y0=r+d*i.default.uY(s),s=i.default.add(s,2),this.x1=n+e*i.default.uX(s),this.y1=r+d*i.default.uY(s),s=i.default.add(s,2),this.x2=n+e*i.default.uX(s),this.y2=r+d*i.default.uY(s),s=i.default.add(s,2),this.x3=n+e*i.default.uX(s),this.y3=r+d*i.default.uY(s)}else this.x0=t.x/u,this.y0=t.y/a,this.x1=(t.x+t.width)/u,this.y1=t.y/a,this.x2=(t.x+t.width)/u,this.y2=(t.y+t.height)/a,this.x3=t.x/u,this.y3=(t.y+t.height)/a;this.uvsUint32[0]=(65535&Math.round(65535*this.y0))<<16|65535&Math.round(65535*this.x0),this.uvsUint32[1]=(65535&Math.round(65535*this.y1))<<16|65535&Math.round(65535*this.x1),this.uvsUint32[2]=(65535&Math.round(65535*this.y2))<<16|65535&Math.round(65535*this.x2),this.uvsUint32[3]=(65535&Math.round(65535*this.y3))<<16|65535&Math.round(65535*this.x3)},t}();exports.default=u;
},{"../math/GroupD8":"PGIZ"}],"xUki":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),t=require("./BaseTexture"),r=l(t),a=require("./VideoBaseTexture"),n=l(a),i=require("./TextureUvs"),o=l(i),u=require("eventemitter3"),s=l(u),h=require("../math"),f=require("../utils"),d=require("../settings"),c=l(d);function l(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var p=function(t){function a(e,r,n,i,o,u){m(this,a);var s=x(this,t.call(this));if(s.noFrame=!1,r||(s.noFrame=!0,r=new h.Rectangle(0,0,1,1)),e instanceof a&&(e=e.baseTexture),s.baseTexture=e,s._frame=r,s.trim=i,s.valid=!1,s.requiresUpdate=!1,s._uvs=null,s.orig=n||r,s._rotate=Number(o||0),!0===o)s._rotate=2;else if(s._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return e.hasLoaded?(s.noFrame&&(r=new h.Rectangle(0,0,e.width,e.height),e.on("update",s.onBaseTextureUpdated,s)),s.frame=r):e.once("loaded",s.onBaseTextureLoaded,s),s.defaultAnchor=u?new h.Point(u.x,u.y):new h.Point(0,0),s._updateID=0,s.transform=null,s.textureCacheIds=[],s}return T(a,t),a.prototype.update=function(){this.baseTexture.update()},a.prototype.onBaseTextureLoaded=function(e){this._updateID++,this.noFrame?this.frame=new h.Rectangle(0,0,e.width,e.height):this.frame=this._frame,this.baseTexture.on("update",this.onBaseTextureUpdated,this),this.emit("update",this)},a.prototype.onBaseTextureUpdated=function(e){this._updateID++,this._frame.width=e.width,this._frame.height=e.height,this.emit("update",this)},a.prototype.destroy=function(e){this.baseTexture&&(e&&(f.TextureCache[this.baseTexture.imageUrl]&&a.removeFromCache(this.baseTexture.imageUrl),this.baseTexture.destroy()),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,a.removeFromCache(this),this.textureCacheIds=null},a.prototype.clone=function(){return new a(this.baseTexture,this.frame,this.orig,this.trim,this.rotate,this.defaultAnchor)},a.prototype._updateUvs=function(){this._uvs||(this._uvs=new o.default),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},a.fromImage=function(e,t,n,i){var o=f.TextureCache[e];return o||(o=new a(r.default.fromImage(e,t,n,i)),a.addToCache(o,e)),o},a.fromFrame=function(e){var t=f.TextureCache[e];if(!t)throw new Error('The frameId "'+e+'" does not exist in the texture cache');return t},a.fromCanvas=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"canvas";return new a(r.default.fromCanvas(e,t,n))},a.fromVideo=function(e,t,r,i){return"string"==typeof e?a.fromVideoUrl(e,t,r,i):new a(n.default.fromVideo(e,t,i))},a.fromVideoUrl=function(e,t,r,i){return new a(n.default.fromUrl(e,t,r,i))},a.from=function(e){if("string"==typeof e){var t=f.TextureCache[e];return t||(null!==e.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)?a.fromVideoUrl(e):a.fromImage(e))}return e instanceof HTMLImageElement?new a(r.default.from(e)):e instanceof HTMLCanvasElement?a.fromCanvas(e,c.default.SCALE_MODE,"HTMLCanvasElement"):e instanceof HTMLVideoElement?a.fromVideo(e):e instanceof r.default?new a(e):e},a.fromLoader=function(e,t,n){var i=new r.default(e,void 0,(0,f.getResolutionOfUrl)(t)),o=new a(i);return i.imageUrl=t,n||(n=t),r.default.addToCache(o.baseTexture,n),a.addToCache(o,n),n!==t&&(r.default.addToCache(o.baseTexture,t),a.addToCache(o,t)),o},a.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),f.TextureCache[t]&&console.warn("Texture added to the cache with an id ["+t+"] that already had an entry"),f.TextureCache[t]=e)},a.removeFromCache=function(e){if("string"==typeof e){var t=f.TextureCache[e];if(t){var r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete f.TextureCache[e],t}}else if(e&&e.textureCacheIds){for(var a=0;a<e.textureCacheIds.length;++a)f.TextureCache[e.textureCacheIds[a]]===e&&delete f.TextureCache[e.textureCacheIds[a]];return e.textureCacheIds.length=0,e}return null},e(a,[{key:"frame",get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1;var t=e.x,r=e.y,a=e.width,n=e.height,i=t+a>this.baseTexture.width,o=r+n>this.baseTexture.height;if(i||o){var u=i&&o?"and":"or",s="X: "+t+" + "+a+" = "+(t+a)+" > "+this.baseTexture.width,h="Y: "+r+" + "+n+" = "+(r+n)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+s+" "+u+" "+h)}this.valid=a&&n&&this.baseTexture.hasLoaded,this.trim||this.rotate||(this.orig=e),this.valid&&this._updateUvs()}},{key:"rotate",get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this._updateUvs()}},{key:"width",get:function(){return this.orig.width}},{key:"height",get:function(){return this.orig.height}}]),a}(s.default);function v(){var e=document.createElement("canvas");e.width=10,e.height=10;var t=e.getContext("2d");return t.fillStyle="white",t.fillRect(0,0,10,10),new p(new r.default(e))}function w(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}exports.default=p,p.EMPTY=new p(new r.default),w(p.EMPTY),w(p.EMPTY.baseTexture),p.WHITE=v(),w(p.WHITE),w(p.WHITE.baseTexture);
},{"./BaseTexture":"ce6K","./VideoBaseTexture":"U1Rh","./TextureUvs":"sUm+","eventemitter3":"2JJl","../math":"e3iB","../utils":"dDI1","../settings":"tMVT"}],"oWLW":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),e=require("../math"),r=require("../utils"),i=require("../const"),n=require("../textures/Texture"),s=a(n),h=require("../display/Container"),o=a(h);function a(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=new e.Point,d=function(n){function h(t){u(this,h);var r=c(this,n.call(this));return r._anchor=new e.ObservablePoint(r._onAnchorUpdate,r,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=i.BLEND_MODES.NORMAL,r.shader=null,r.cachedTint=16777215,r.texture=t||s.default.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.pluginName="sprite",r}return _(h,n),h.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this.cachedTint=16777215,this._width&&(this.scale.x=(0,r.sign)(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=(0,r.sign)(this.scale.y)*this._height/this._texture.orig.height)},h.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},h.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID||this._textureID!==this._texture._updateID){this._transformID=this.transform._worldID,this._textureID=this._texture._updateID;var t=this._texture,e=this.transform.worldTransform,r=e.a,i=e.b,n=e.c,s=e.d,h=e.tx,o=e.ty,a=this.vertexData,u=t.trim,c=t.orig,_=this._anchor,l=0,d=0,f=0,x=0;u?(l=(d=u.x-_._x*c.width)+u.width,f=(x=u.y-_._y*c.height)+u.height):(l=(d=-_._x*c.width)+c.width,f=(x=-_._y*c.height)+c.height),a[0]=r*d+n*x+h,a[1]=s*x+i*d+o,a[2]=r*l+n*x+h,a[3]=s*x+i*l+o,a[4]=r*l+n*f+h,a[5]=s*f+i*l+o,a[6]=r*d+n*f+h,a[7]=s*f+i*d+o}},h.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,e=this.vertexTrimmedData,r=t.orig,i=this._anchor,n=this.transform.worldTransform,s=n.a,h=n.b,o=n.c,a=n.d,u=n.tx,c=n.ty,_=-i._x*r.width,l=_+r.width,d=-i._y*r.height,f=d+r.height;e[0]=s*_+o*d+u,e[1]=a*d+h*_+c,e[2]=s*l+o*d+u,e[3]=a*d+h*l+c,e[4]=s*l+o*f+u,e[5]=a*f+h*l+c,e[6]=s*_+o*f+u,e[7]=a*f+h*_+c},h.prototype._renderWebGL=function(t){this.calculateVertices(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},h.prototype._renderCanvas=function(t){t.plugins[this.pluginName].render(this)},h.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},h.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new e.Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):n.prototype.getLocalBounds.call(this,t)},h.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,l);var e=this._texture.orig.width,r=this._texture.orig.height,i=-e*this.anchor.x,n=0;return l.x>=i&&l.x<i+e&&(n=-r*this.anchor.y,l.y>=n&&l.y<n+r)},h.prototype.destroy=function(t){if(n.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t&&t.texture){var e="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!e)}this._texture=null,this.shader=null},h.from=function(t){return new h(s.default.from(t))},h.fromFrame=function(t){var e=r.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return new h(e)},h.fromImage=function(t,e,r){return new h(s.default.fromImage(t,e,r))},t(h,[{key:"width",get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var e=(0,r.sign)(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}},{key:"height",get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var e=(0,r.sign)(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}},{key:"anchor",get:function(){return this._anchor},set:function(t){this._anchor.copy(t)}},{key:"tint",get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t||s.default.EMPTY,this.cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}]),h}(o.default);exports.default=d;
},{"../math":"e3iB","../utils":"dDI1","../const":"YEQi","../textures/Texture":"xUki","../display/Container":"OzBO"}],"8ODW":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("./BaseTexture"),e=o(t),i=require("../settings"),r=o(i);function o(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=function(t){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,h=arguments[2],l=arguments[3];n(this,e);var a=s(this,t.call(this,null,h));return a.resolution=l||r.default.RESOLUTION,a.width=Math.ceil(i),a.height=Math.ceil(o),a.realWidth=a.width*a.resolution,a.realHeight=a.height*a.resolution,a.scaleMode=void 0!==h?h:r.default.SCALE_MODE,a.hasLoaded=!0,a._glRenderTargets={},a._canvasRenderTarget=null,a.valid=!1,a}return h(e,t),e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.valid&&this.emit("update",this))},e.prototype.destroy=function(){t.prototype.destroy.call(this,!0),this.renderer=null},e}(e.default);exports.default=l;
},{"./BaseTexture":"ce6K","../settings":"tMVT"}],"Jb0W":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./BaseRenderTexture"),t=i(e),r=require("./Texture"),n=i(r);function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(e){function r(n,i){o(this,r);var u=null;if(!(n instanceof t.default)){var s=arguments[1],c=arguments[2],l=arguments[3],f=arguments[4];console.warn("Please use RenderTexture.create("+s+", "+c+") instead of the ctor directly."),u=arguments[0],i=null,n=new t.default(s,c,l,f)}var h=a(this,e.call(this,n,i));return h.legacyRenderer=u,h.valid=!0,h._updateUvs(),h}return u(r,e),r.prototype.resize=function(e,t,r){e=Math.ceil(e),t=Math.ceil(t),this.valid=e>0&&t>0,this._frame.width=this.orig.width=e,this._frame.height=this.orig.height=t,r||this.baseTexture.resize(e,t),this._updateUvs()},r.create=function(e,n,i,o){return new r(new t.default(e,n,i,o))},r}(n.default);exports.default=s;
},{"./BaseRenderTexture":"8ODW","./Texture":"xUki"}],"Hz2Z":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t=require("../utils"),r=require("../math"),n=require("../const"),i=require("../settings"),o=d(i),s=require("../display/Container"),u=d(s),a=require("../textures/RenderTexture"),l=d(a),h=require("eventemitter3"),c=d(h);function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var b=new r.Matrix,w=function(i){function s(e,a,l,h){f(this,s);var c=p(this,i.call(this));return(0,t.sayHello)(e),"number"==typeof a&&(a=Object.assign({width:a,height:l||o.default.RENDER_OPTIONS.height},h)),a=Object.assign({},o.default.RENDER_OPTIONS,a),c.options=a,c.type=n.RENDERER_TYPE.UNKNOWN,c.screen=new r.Rectangle(0,0,a.width,a.height),c.view=a.view||document.createElement("canvas"),c.resolution=a.resolution||o.default.RESOLUTION,c.transparent=a.transparent,c.autoResize=a.autoResize||!1,c.blendModes=null,c.preserveDrawingBuffer=a.preserveDrawingBuffer,c.clearBeforeRender=a.clearBeforeRender,c.roundPixels=a.roundPixels,c._backgroundColor=0,c._backgroundColorRgba=[0,0,0,0],c._backgroundColorString="#000000",c.backgroundColor=a.backgroundColor||c._backgroundColor,c._tempDisplayObjectParent=new u.default,c._lastObjectRendered=c._tempDisplayObjectParent,c}return g(s,i),s.prototype.resize=function(e,t){this.screen.width=e,this.screen.height=t,this.view.width=e*this.resolution,this.view.height=t*this.resolution,this.autoResize&&(this.view.style.width=e+"px",this.view.style.height=t+"px")},s.prototype.generateTexture=function(e,t,r,n){n=n||e.getLocalBounds();var i=l.default.create(0|n.width,0|n.height,t,r);return b.tx=-n.x,b.ty=-n.y,this.render(e,i,!1,b,!!e.parent),i},s.prototype.destroy=function(e){e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=n.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},e(s,[{key:"width",get:function(){return this.view.width}},{key:"height",get:function(){return this.view.height}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=(0,t.hex2string)(e),(0,t.hex2rgb)(e,this._backgroundColorRgba)}}]),s}(c.default);exports.default=w;
},{"../utils":"dDI1","../math":"e3iB","../const":"YEQi","../settings":"tMVT","../display/Container":"OzBO","../textures/RenderTexture":"Jb0W","eventemitter3":"2JJl"}],"FydA":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../../const");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function r(e){t(this,r),this.renderer=e}return r.prototype.pushMask=function(e){var t=this.renderer;t.context.save();var r=e.alpha,o=e.transform.worldTransform,a=t.resolution;t.context.setTransform(o.a*a,o.b*a,o.c*a,o.d*a,o.tx*a,o.ty*a),e._texture||(this.renderGraphicsShape(e),t.context.clip()),e.worldAlpha=r},r.prototype.renderGraphicsShape=function(t){var r=this.renderer.context,o=t.graphicsData.length;if(0!==o){r.beginPath();for(var a=0;a<o;a++){var i=t.graphicsData[a],n=i.shape;if(i.type===e.SHAPES.POLY){var s=n.points,h=i.holes,l=void 0,c=void 0;r.moveTo(s[0],s[1]);for(var v=2;v<s.length;v+=2)r.lineTo(s[v],s[v+1]);if(s[0]===s[s.length-2]&&s[1]===s[s.length-1]&&r.closePath(),h.length>0){l=0;for(var p=0;p<s.length;p+=2)l+=s[p]*s[p+3]-s[p+1]*s[p+2];for(var u=0;u<h.length;u++){s=h[u].points,c=0;for(var f=0;f<s.length;f+=2)c+=s[f]*s[f+3]-s[f+1]*s[f+2];if(r.moveTo(s[0],s[1]),c*l<0)for(var d=2;d<s.length;d+=2)r.lineTo(s[d],s[d+1]);else for(var T=s.length-2;T>=2;T-=2)r.lineTo(s[T],s[T+1])}}}else if(i.type===e.SHAPES.RECT)r.rect(n.x,n.y,n.width,n.height),r.closePath();else if(i.type===e.SHAPES.CIRC)r.arc(n.x,n.y,n.radius,0,2*Math.PI),r.closePath();else if(i.type===e.SHAPES.ELIP){var g=2*n.width,y=2*n.height,P=n.x-g/2,x=n.y-y/2,C=g/2*.5522848,S=y/2*.5522848,E=P+g,m=x+y,w=P+g/2,b=x+y/2;r.moveTo(P,b),r.bezierCurveTo(P,b-S,w-C,x,w,x),r.bezierCurveTo(w+C,x,E,b-S,E,b),r.bezierCurveTo(E,b+S,w+C,m,w,m),r.bezierCurveTo(w-C,m,P,b+S,P,b),r.closePath()}else if(i.type===e.SHAPES.RREC){var A=n.x,M=n.y,q=n.width,H=n.height,z=n.radius,R=Math.min(q,H)/2|0;z=z>R?R:z,r.moveTo(A,M+z),r.lineTo(A,M+H-z),r.quadraticCurveTo(A,M+H,A+z,M+H),r.lineTo(A+q-z,M+H),r.quadraticCurveTo(A+q,M+H,A+q,M+H-z),r.lineTo(A+q,M+z),r.quadraticCurveTo(A+q,M,A+q-z,M),r.lineTo(A+z,M),r.quadraticCurveTo(A,M,A,M+z),r.closePath()}}}},r.prototype.popMask=function(e){e.context.restore(),e.invalidateBlendMode()},r.prototype.destroy=function(){},r}();exports.default=r;
},{"../../../const":"YEQi"}],"khQn":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),e=require("../../../settings"),n=i(e);function i(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t,i,o){s(this,e),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=o||n.default.RESOLUTION,this.resize(t,i)}return e.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},e.prototype.destroy=function(){this.context=null,this.canvas=null},t(e,[{key:"width",get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},{key:"height",get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}]),e}();exports.default=o;
},{"../../../settings":"tMVT"}],"StZv":[function(require,module,exports) {
"use strict";function e(e){var t=document.createElement("canvas");t.width=6,t.height=1;var a=t.getContext("2d");return a.fillStyle=e,a.fillRect(0,0,6,1),t}function t(){if("undefined"==typeof document)return!1;var t=e("#ff00ff"),a=e("#ffff00"),r=document.createElement("canvas");r.width=6,r.height=1;var n=r.getContext("2d");n.globalCompositeOperation="multiply",n.drawImage(t,0,0),n.drawImage(a,2,0);var f=n.getImageData(2,0,1,1);if(!f)return!1;var i=f.data;return 255===i[0]&&0===i[1]&&0===i[2]}exports.__esModule=!0,exports.default=t;
},{}],"pZ9z":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=L;var E=require("../../../const"),D=require("./canUseNewCanvasBlendModes"),e=O(D);function O(E){return E&&E.__esModule?E:{default:E}}function L(){var D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,e.default)()?(D[E.BLEND_MODES.NORMAL]="source-over",D[E.BLEND_MODES.ADD]="lighter",D[E.BLEND_MODES.MULTIPLY]="multiply",D[E.BLEND_MODES.SCREEN]="screen",D[E.BLEND_MODES.OVERLAY]="overlay",D[E.BLEND_MODES.DARKEN]="darken",D[E.BLEND_MODES.LIGHTEN]="lighten",D[E.BLEND_MODES.COLOR_DODGE]="color-dodge",D[E.BLEND_MODES.COLOR_BURN]="color-burn",D[E.BLEND_MODES.HARD_LIGHT]="hard-light",D[E.BLEND_MODES.SOFT_LIGHT]="soft-light",D[E.BLEND_MODES.DIFFERENCE]="difference",D[E.BLEND_MODES.EXCLUSION]="exclusion",D[E.BLEND_MODES.HUE]="hue",D[E.BLEND_MODES.SATURATION]="saturate",D[E.BLEND_MODES.COLOR]="color",D[E.BLEND_MODES.LUMINOSITY]="luminosity"):(D[E.BLEND_MODES.NORMAL]="source-over",D[E.BLEND_MODES.ADD]="lighter",D[E.BLEND_MODES.MULTIPLY]="source-over",D[E.BLEND_MODES.SCREEN]="source-over",D[E.BLEND_MODES.OVERLAY]="source-over",D[E.BLEND_MODES.DARKEN]="source-over",D[E.BLEND_MODES.LIGHTEN]="source-over",D[E.BLEND_MODES.COLOR_DODGE]="source-over",D[E.BLEND_MODES.COLOR_BURN]="source-over",D[E.BLEND_MODES.HARD_LIGHT]="source-over",D[E.BLEND_MODES.SOFT_LIGHT]="source-over",D[E.BLEND_MODES.DIFFERENCE]="source-over",D[E.BLEND_MODES.EXCLUSION]="source-over",D[E.BLEND_MODES.HUE]="source-over",D[E.BLEND_MODES.SATURATION]="source-over",D[E.BLEND_MODES.COLOR]="source-over",D[E.BLEND_MODES.LUMINOSITY]="source-over"),D[E.BLEND_MODES.NORMAL_NPM]=D[E.BLEND_MODES.NORMAL],D[E.BLEND_MODES.ADD_NPM]=D[E.BLEND_MODES.ADD],D[E.BLEND_MODES.SCREEN_NPM]=D[E.BLEND_MODES.SCREEN],D}
},{"../../../const":"YEQi","./canUseNewCanvasBlendModes":"StZv"}],"GzOR":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../SystemRenderer"),e=p(t),o=require("./utils/CanvasMaskManager"),n=p(o),r=require("./utils/CanvasRenderTarget"),i=p(r),s=require("./utils/mapCanvasBlendModesToPixi"),a=p(s),l=require("../../utils"),h=require("../../const"),d=require("../../settings"),c=p(d);function p(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=function(t){function e(o,r,i){u(this,e);var s=g(this,t.call(this,"Canvas",o,r,i));return s.type=h.RENDERER_TYPE.CANVAS,s.rootContext=s.view.getContext("2d",{alpha:s.transparent}),s.context=s.rootContext,s.refresh=!0,s.maskManager=new n.default(s),s.smoothProperty="imageSmoothingEnabled",s.rootContext.imageSmoothingEnabled||(s.rootContext.webkitImageSmoothingEnabled?s.smoothProperty="webkitImageSmoothingEnabled":s.rootContext.mozImageSmoothingEnabled?s.smoothProperty="mozImageSmoothingEnabled":s.rootContext.oImageSmoothingEnabled?s.smoothProperty="oImageSmoothingEnabled":s.rootContext.msImageSmoothingEnabled&&(s.smoothProperty="msImageSmoothingEnabled")),s.initPlugins(),s.blendModes=(0,a.default)(),s._activeBlendMode=null,s.renderingToScreen=!1,s.resize(s.options.width,s.options.height),s}return m(e,t),e.prototype.render=function(t,e,o,n,r){if(this.view){this.renderingToScreen=!e,this.emit("prerender");var s=this.resolution;e?((e=e.baseTexture||e)._canvasRenderTarget||(e._canvasRenderTarget=new i.default(e.width,e.height,e.resolution),e.source=e._canvasRenderTarget.canvas,e.valid=!0),this.context=e._canvasRenderTarget.context,this.resolution=e._canvasRenderTarget.resolution):this.context=this.rootContext;var a=this.context;if(e||(this._lastObjectRendered=t),!r){var l=t.parent,d=this._tempDisplayObjectParent.transform.worldTransform;n?(n.copy(d),this._tempDisplayObjectParent.transform._worldID=-1):d.identity(),t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=l}a.save(),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this._activeBlendMode=h.BLEND_MODES.NORMAL,a.globalCompositeOperation=this.blendModes[h.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(a.fillStyle="black",a.clear()),(void 0!==o?o:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?a.clearRect(0,0,this.width,this.height):(a.fillStyle=this._backgroundColorString,a.fillRect(0,0,this.width,this.height)));var c=this.context;this.context=a,t.renderCanvas(this),this.context=c,a.restore(),this.resolution=s,this.emit("postrender")}},e.prototype.clear=function(t){var e=this.context;t=t||this._backgroundColorString,!this.transparent&&t?(e.fillStyle=t,e.fillRect(0,0,this.width,this.height)):e.clearRect(0,0,this.width,this.height)},e.prototype.setBlendMode=function(t){this._activeBlendMode!==t&&(this._activeBlendMode=t,this.context.globalCompositeOperation=this.blendModes[t])},e.prototype.destroy=function(e){this.destroyPlugins(),t.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},e.prototype.resize=function(e,o){t.prototype.resize.call(this,e,o),this.smoothProperty&&(this.rootContext[this.smoothProperty]=c.default.SCALE_MODE===h.SCALE_MODES.LINEAR)},e.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},e}(e.default);exports.default=f,l.pluginTarget.mixin(f);
},{"../SystemRenderer":"Hz2Z","./utils/CanvasMaskManager":"FydA","./utils/CanvasRenderTarget":"khQn","./utils/mapCanvasBlendModesToPixi":"pZ9z","../../utils":"dDI1","../../const":"YEQi","../../settings":"tMVT"}],"xwA8":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../../utils"),e=require("../../renderers/canvas/utils/canUseNewCanvasBlendModes"),i=a(e);function a(t){return t&&t.__esModule?t:{default:t}}var h={getTintedTexture:function(t,e){var i=t._texture,a="#"+("00000"+(0|(e=h.roundColor(e))).toString(16)).substr(-6);i.tintCache=i.tintCache||{};var r=i.tintCache[a],n=void 0;if(r){if(r.tintId===i._updateID)return i.tintCache[a];n=i.tintCache[a]}else n=h.canvas||document.createElement("canvas");if(h.tintMethod(i,e,n),n.tintId=i._updateID,h.convertTintToImage){var o=new Image;o.src=n.toDataURL(),i.tintCache[a]=o}else i.tintCache[a]=n,h.canvas=null;return n},tintWithMultiply:function(t,e,i){var a=i.getContext("2d"),h=t._frame.clone(),r=t.baseTexture.resolution;h.x*=r,h.y*=r,h.width*=r,h.height*=r,i.width=Math.ceil(h.width),i.height=Math.ceil(h.height),a.save(),a.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),a.fillRect(0,0,h.width,h.height),a.globalCompositeOperation="multiply",a.drawImage(t.baseTexture.source,h.x,h.y,h.width,h.height,0,0,h.width,h.height),a.globalCompositeOperation="destination-atop",a.drawImage(t.baseTexture.source,h.x,h.y,h.width,h.height,0,0,h.width,h.height),a.restore()},tintWithOverlay:function(t,e,i){var a=i.getContext("2d"),h=t._frame.clone(),r=t.baseTexture.resolution;h.x*=r,h.y*=r,h.width*=r,h.height*=r,i.width=Math.ceil(h.width),i.height=Math.ceil(h.height),a.save(),a.globalCompositeOperation="copy",a.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),a.fillRect(0,0,h.width,h.height),a.globalCompositeOperation="destination-atop",a.drawImage(t.baseTexture.source,h.x,h.y,h.width,h.height,0,0,h.width,h.height),a.restore()},tintWithPerPixel:function(e,i,a){var h=a.getContext("2d"),r=e._frame.clone(),n=e.baseTexture.resolution;r.x*=n,r.y*=n,r.width*=n,r.height*=n,a.width=Math.ceil(r.width),a.height=Math.ceil(r.height),h.save(),h.globalCompositeOperation="copy",h.drawImage(e.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),h.restore();for(var o=(0,t.hex2rgb)(i),l=o[0],s=o[1],u=o[2],d=h.getImageData(0,0,r.width,r.height),c=d.data,g=0;g<c.length;g+=4)c[g+0]*=l,c[g+1]*=s,c[g+2]*=u;h.putImageData(d,0,0)},roundColor:function(e){var i=h.cacheStepsPerColorChannel,a=(0,t.hex2rgb)(e);return a[0]=Math.min(255,a[0]/i*i),a[1]=Math.min(255,a[1]/i*i),a[2]=Math.min(255,a[2]/i*i),(0,t.rgb2hex)(a)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:(0,i.default)(),tintMethod:0};h.tintMethod=h.canUseMultiply?h.tintWithMultiply:h.tintWithPerPixel,exports.default=h;
},{"../../utils":"dDI1","../../renderers/canvas/utils/canUseNewCanvasBlendModes":"StZv"}],"3rZB":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../../renderers/canvas/CanvasRenderer"),e=a(t),r=require("../../const"),o=require("../../math"),n=require("./CanvasTinter"),i=a(n);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=new o.Matrix,d=function(){function t(e){s(this,t),this.renderer=e}return t.prototype.render=function(t){var e=t._texture,n=this.renderer,a=e._frame.width,s=e._frame.height,d=t.transform.worldTransform,l=0,c=0;if(!(e.orig.width<=0||e.orig.height<=0)&&e.baseTexture.source&&(n.setBlendMode(t.blendMode),e.valid)){n.context.globalAlpha=t.worldAlpha;var h=e.baseTexture.scaleMode===r.SCALE_MODES.LINEAR;n.smoothProperty&&n.context[n.smoothProperty]!==h&&(n.context[n.smoothProperty]=h),e.trim?(l=e.trim.width/2+e.trim.x-t.anchor.x*e.orig.width,c=e.trim.height/2+e.trim.y-t.anchor.y*e.orig.height):(l=(.5-t.anchor.x)*e.orig.width,c=(.5-t.anchor.y)*e.orig.height),e.rotate&&(d.copy(u),d=u,o.GroupD8.matrixAppendRotationInv(d,e.rotate,l,c),l=0,c=0),l-=a/2,c-=s/2,n.roundPixels?(n.context.setTransform(d.a,d.b,d.c,d.d,d.tx*n.resolution|0,d.ty*n.resolution|0),l|=0,c|=0):n.context.setTransform(d.a,d.b,d.c,d.d,d.tx*n.resolution,d.ty*n.resolution);var x=e.baseTexture.resolution;16777215!==t.tint?(t.cachedTint===t.tint&&t.tintedTexture.tintId===t._texture._updateID||(t.cachedTint=t.tint,t.tintedTexture=i.default.getTintedTexture(t,t.tint)),n.context.drawImage(t.tintedTexture,0,0,a*x,s*x,l*n.resolution,c*n.resolution,a*n.resolution,s*n.resolution)):n.context.drawImage(e.baseTexture.source,e._frame.x*x,e._frame.y*x,a*x,s*x,l*n.resolution,c*n.resolution,a*n.resolution,s*n.resolution)}},t.prototype.destroy=function(){this.renderer=null},t}();exports.default=d,e.default.registerPlugin("sprite",d);
},{"../../renderers/canvas/CanvasRenderer":"GzOR","../../const":"YEQi","../../math":"e3iB","./CanvasTinter":"xwA8"}],"ClQe":[function(require,module,exports) {
"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var n=function(){function n(e){t(this,n),this.renderer=e,this.renderer.on("context",this.onContextChange,this)}return n.prototype.onContextChange=function(){},n.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null},n}();exports.default=n;
},{}],"oXPp":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../managers/WebGLManager"),e=o(t);function o(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=function(t){function e(){return n(this,e),r(this,t.apply(this,arguments))}return u(e,t),e.prototype.start=function(){},e.prototype.stop=function(){this.flush()},e.prototype.flush=function(){},e.prototype.render=function(t){},e}(e.default);exports.default=i;
},{"../managers/WebGLManager":"ClQe"}],"s0lT":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=i;var e=require("pixi-gl-core"),r=t(e);function t(e){return e&&e.__esModule?e:{default:e}}var a=r.default.shader.defaultValue;function i(e,r,t){var a=u(e,t),i=u(r,t);return Object.assign(a,i)}function u(e){for(var r=new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"),t={},i=void 0,u=e.replace(/\s+/g," ").split(/\s*;\s*/),l=0;l<u.length;l++){var n=u[l].trim();if(n.indexOf("uniform")>-1){var s=n.split(" "),f=s[1],o=s[2],p=1;o.indexOf("[")>-1&&(i=o.split(/\[|]/),o=i[0],p*=Number(i[1])),o.match(r)||(t[o]={value:a(f,p),name:o,type:f})}}return t}
},{"pixi-gl-core":"PJsv"}],"AVkB":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(r,t,i){return t&&e(r.prototype,t),i&&e(r,i),r}}(),r=require("./extractUniformsFromSrc"),t=u(r),i=require("../../../utils"),o=require("../../../const"),n=require("../../../settings"),a=u(n);function u(e){return e&&e.__esModule?e:{default:e}}function s(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var l={},c=function(){function r(e,n,u){for(var c in s(this,r),this.vertexSrc=e||r.defaultVertexSrc,this.fragmentSrc=n||r.defaultFragmentSrc,this._blendMode=o.BLEND_MODES.NORMAL,this.uniformData=u||(0,t.default)(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler"),this.uniforms={},this.uniformData)this.uniforms[c]=this.uniformData[c].value,this.uniformData[c].type&&(this.uniformData[c].type=this.uniformData[c].type.toLowerCase());this.glShaders={},l[this.vertexSrc+this.fragmentSrc]||(l[this.vertexSrc+this.fragmentSrc]=(0,i.uid)()),this.glShaderKey=l[this.vertexSrc+this.fragmentSrc],this.padding=4,this.resolution=a.default.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0}return r.prototype.apply=function(e,r,t,i,o){e.applyFilter(this,r,t,i)},e(r,[{key:"blendMode",get:function(){return this._blendMode},set:function(e){this._blendMode=e}}],[{key:"defaultVertexSrc",get:function(){return["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 projectionMatrix;","uniform mat3 filterMatrix;","varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;","   vTextureCoord = aTextureCoord ;","}"].join("\n")}},{key:"defaultFragmentSrc",get:function(){return["varying vec2 vTextureCoord;","varying vec2 vFilterCoord;","uniform sampler2D uSampler;","uniform sampler2D filterSampler;","void main(void){","   vec4 masky = texture2D(filterSampler, vFilterCoord);","   vec4 sample = texture2D(uSampler, vTextureCoord);","   vec4 color;","   if(mod(vFilterCoord.x, 1.0) > 0.5)","   {","     color = vec4(1.0, 0.0, 0.0, 1.0);","   }","   else","   {","     color = vec4(0.0, 1.0, 0.0, 1.0);","   }","   gl_FragColor = mix(sample, masky, 0.5);","   gl_FragColor *= sample.a;","}"].join("\n")}}]),r}();exports.default=c;
},{"./extractUniformsFromSrc":"s0lT","../../../utils":"dDI1","../../../const":"YEQi","../../../settings":"tMVT"}],"pBGv":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"UUq2":[function(require,module,exports) {
var process = require("process");
var r=require("process");function t(r,t){for(var e=0,n=r.length-1;n>=0;n--){var s=r[n];"."===s?r.splice(n,1):".."===s?(r.splice(n,1),e++):e&&(r.splice(n,1),e--)}if(t)for(;e--;e)r.unshift("..");return r}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,n=function(r){return e.exec(r).slice(1)};function s(r,t){if(r.filter)return r.filter(t);for(var e=[],n=0;n<r.length;n++)t(r[n],n,r)&&e.push(r[n]);return e}exports.resolve=function(){for(var e="",n=!1,o=arguments.length-1;o>=-1&&!n;o--){var i=o>=0?arguments[o]:r.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(e=i+"/"+e,n="/"===i.charAt(0))}return(n?"/":"")+(e=t(s(e.split("/"),function(r){return!!r}),!n).join("/"))||"."},exports.normalize=function(r){var e=exports.isAbsolute(r),n="/"===o(r,-1);return(r=t(s(r.split("/"),function(r){return!!r}),!e).join("/"))||e||(r="."),r&&n&&(r+="/"),(e?"/":"")+r},exports.isAbsolute=function(r){return"/"===r.charAt(0)},exports.join=function(){var r=Array.prototype.slice.call(arguments,0);return exports.normalize(s(r,function(r,t){if("string"!=typeof r)throw new TypeError("Arguments to path.join must be strings");return r}).join("/"))},exports.relative=function(r,t){function e(r){for(var t=0;t<r.length&&""===r[t];t++);for(var e=r.length-1;e>=0&&""===r[e];e--);return t>e?[]:r.slice(t,e-t+1)}r=exports.resolve(r).substr(1),t=exports.resolve(t).substr(1);for(var n=e(r.split("/")),s=e(t.split("/")),o=Math.min(n.length,s.length),i=o,u=0;u<o;u++)if(n[u]!==s[u]){i=u;break}var l=[];for(u=i;u<n.length;u++)l.push("..");return(l=l.concat(s.slice(i))).join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(r){var t=n(r),e=t[0],s=t[1];return e||s?(s&&(s=s.substr(0,s.length-1)),e+s):"."},exports.basename=function(r,t){var e=n(r)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e},exports.extname=function(r){return n(r)[3]};var o="b"==="ab".substr(-1)?function(r,t,e){return r.substr(t,e)}:function(r,t,e){return t<0&&(t=r.length+t),r.substr(t,e)};
},{"process":"pBGv"}],"vusc":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),e=require("../math/Matrix"),r=a(e);function a(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=new r.default,n=function(){function e(t,a){i(this,e),this._texture=t,this.mapCoord=new r.default,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._lastTextureID=-1,this.clampOffset=0,this.clampMargin=void 0===a?.5:a}return e.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var r=this.mapCoord,a=0;a<t.length;a+=2){var i=t[a],u=t[a+1];e[a]=i*r.a+u*r.c+r.tx,e[a+1]=i*r.b+u*r.d+r.ty}return e},e.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._lastTextureID===e._updateID)return!1;this._lastTextureID=e._updateID;var r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var a=e.orig,i=e.trim;i&&(u.set(a.width/i.width,0,0,a.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(u));var n=e.baseTexture,s=this.uClampFrame,h=this.clampMargin/n.resolution,o=this.clampOffset;return s[0]=(e._frame.x+h+o)/n.width,s[1]=(e._frame.y+h+o)/n.height,s[2]=(e._frame.x+e._frame.width-h+o)/n.width,s[3]=(e._frame.y+e._frame.height-h+o)/n.height,this.uClampOffset[0]=o/n.realWidth,this.uClampOffset[1]=o/n.realHeight,!0},t(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._lastTextureID=-1}}]),e}();exports.default=n;
},{"../math/Matrix":"dh7x"}],"VuLC":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var r=require("../Filter"),e=i(r),t=require("../../../../math"),n=require("path"),o=require("../../../../textures/TextureMatrix"),a=i(o);function i(r){return r&&r.__esModule?r:{default:r}}function s(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function u(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?r:e}function p(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)}var l=function(r){function e(n){s(this,e);var o=new t.Matrix,a=u(this,r.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));return n.renderable=!1,a.maskSprite=n,a.maskMatrix=o,a}return p(e,r),e.prototype.apply=function(r,e,t,n){var o=this.maskSprite,i=this.maskSprite.texture;i.valid&&(i.transform||(i.transform=new a.default(i,0)),i.transform.update(),this.uniforms.mask=i,this.uniforms.otherMatrix=r.calculateSpriteMatrix(this.maskMatrix,o).prepend(i.transform.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=i.transform.uClampFrame,r.applyFilter(this,e,t,n))},e}(e.default);exports.default=l;
},{"../Filter":"AVkB","../../../../math":"e3iB","path":"UUq2","../../../../textures/TextureMatrix":"vusc"}],"OOwQ":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./WebGLManager"),t=i(e),r=require("../filters/spriteMask/SpriteMaskFilter"),s=i(r);function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(e){function t(r){n(this,t);var s=a(this,e.call(this,r));return s.scissor=!1,s.scissorData=null,s.scissorRenderTarget=null,s.enableScissor=!0,s.alphaMaskPool=[],s.alphaMaskIndex=0,s}return o(t,e),t.prototype.pushMask=function(e,t){if(t.texture)this.pushSpriteMask(e,t);else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencilManager.stencilMaskStack.length&&t.isFastRect()){var r=t.worldTransform,s=Math.atan2(r.b,r.a);(s=Math.round(s*(180/Math.PI)))%90?this.pushStencilMask(t):this.pushScissorMask(e,t)}else this.pushStencilMask(t)},t.prototype.popMask=function(e,t){t.texture?this.popSpriteMask(e,t):this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length?this.popScissorMask(e,t):this.popStencilMask(e,t)},t.prototype.pushSpriteMask=function(e,t){var r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new s.default(t)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=t;var i=e.filterArea;e.filterArea=t.getBounds(!0),this.renderer.filterManager.pushFilter(e,r),e.filterArea=i,this.alphaMaskIndex++},t.prototype.popSpriteMask=function(){this.renderer.filterManager.popFilter(),this.alphaMaskIndex--},t.prototype.pushStencilMask=function(e){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.pushStencil(e)},t.prototype.popStencilMask=function(){this.renderer.currentRenderer.stop(),this.renderer.stencilManager.popStencil()},t.prototype.pushScissorMask=function(e,t){t.renderable=!0;var r=this.renderer._activeRenderTarget,s=t.getBounds();s.fit(r.size),t.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var i=this.renderer.resolution;this.renderer.gl.scissor(s.x*i,(r.root?r.size.height-s.y-s.height:s.y)*i,s.width*i,s.height*i),this.scissorRenderTarget=r,this.scissorData=t,this.scissor=!0},t.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var e=this.renderer.gl;e.disable(e.SCISSOR_TEST)},t}(t.default);exports.default=l;
},{"./WebGLManager":"ClQe","../filters/spriteMask/SpriteMaskFilter":"VuLC"}],"juli":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./WebGLManager"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=function(e){function r(t){n(this,r);var i=s(this,e.call(this,t));return i.stencilMaskStack=null,i}return i(r,e),r.prototype.setMaskStack=function(e){this.stencilMaskStack=e;var t=this.renderer.gl;0===e.length?t.disable(t.STENCIL_TEST):t.enable(t.STENCIL_TEST)},r.prototype.pushStencil=function(e){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.renderer._activeRenderTarget.attachStencilBuffer();var t=this.renderer.gl,r=this.stencilMaskStack.length;0===r&&t.enable(t.STENCIL_TEST),this.stencilMaskStack.push(e),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.EQUAL,r,this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.INCR),this.renderer.plugins.graphics.render(e),this._useCurrent()},r.prototype.popStencil=function(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var e=this.renderer.gl,t=this.stencilMaskStack.pop();0===this.stencilMaskStack.length?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),this.renderer.plugins.graphics.render(t),this._useCurrent())},r.prototype._useCurrent=function(){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},r.prototype._getBitwiseMask=function(){return(1<<this.stencilMaskStack.length)-1},r.prototype.destroy=function(){t.default.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},r}(t.default);exports.default=c;
},{"./WebGLManager":"ClQe"}],"Xw9x":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../../../math"),e=require("../../../const"),i=require("../../../settings"),r=a(i),s=require("pixi-gl-core");function a(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var h=function(){function i(a,h,o,f,u,l){n(this,i),this.gl=a,this.frameBuffer=null,this.texture=null,this.clearColor=[0,0,0,0],this.size=new t.Rectangle(0,0,1,1),this.resolution=u||r.default.RESOLUTION,this.projectionMatrix=new t.Matrix,this.transform=null,this.frame=null,this.defaultFrame=new t.Rectangle,this.destinationFrame=null,this.sourceFrame=null,this.stencilBuffer=null,this.stencilMaskStack=[],this.filterData=null,this.filterPoolKey="",this.scaleMode=void 0!==f?f:r.default.SCALE_MODE,this.root=l||!1,this.root?(this.frameBuffer=new s.GLFramebuffer(a,100,100),this.frameBuffer.framebuffer=null):(this.frameBuffer=s.GLFramebuffer.createRGBA(a,100,100),this.scaleMode===e.SCALE_MODES.NEAREST?this.frameBuffer.texture.enableNearestScaling():this.frameBuffer.texture.enableLinearScaling(),this.texture=this.frameBuffer.texture),this.setFrame(),this.resize(h,o)}return i.prototype.clear=function(t){var e=t||this.clearColor;this.frameBuffer.clear(e[0],e[1],e[2],e[3])},i.prototype.attachStencilBuffer=function(){this.root||this.frameBuffer.enableStencil()},i.prototype.setFrame=function(t,e){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||this.destinationFrame},i.prototype.activate=function(){var t=this.gl;this.frameBuffer.bind(),this.calculateProjection(this.destinationFrame,this.sourceFrame),this.transform&&this.projectionMatrix.append(this.transform),this.destinationFrame!==this.sourceFrame?(t.enable(t.SCISSOR_TEST),t.scissor(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)):t.disable(t.SCISSOR_TEST),t.viewport(0|this.destinationFrame.x,0|this.destinationFrame.y,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)},i.prototype.calculateProjection=function(t,e){var i=this.projectionMatrix;e=e||t,i.identity(),this.root?(i.a=1/t.width*2,i.d=-1/t.height*2,i.tx=-1-e.x*i.a,i.ty=1-e.y*i.d):(i.a=1/t.width*2,i.d=1/t.height*2,i.tx=-1-e.x*i.a,i.ty=-1-e.y*i.d)},i.prototype.resize=function(t,e){if(t|=0,e|=0,this.size.width!==t||this.size.height!==e){this.size.width=t,this.size.height=e,this.defaultFrame.width=t,this.defaultFrame.height=e,this.frameBuffer.resize(t*this.resolution,e*this.resolution);var i=this.frame||this.size;this.calculateProjection(i)}},i.prototype.destroy=function(){this.frameBuffer.stencil&&this.gl.deleteRenderbuffer(this.frameBuffer.stencil),this.frameBuffer.destroy(),this.frameBuffer=null,this.texture=null},i}();exports.default=h;
},{"../../../math":"e3iB","../../../const":"YEQi","../../../settings":"tMVT","pixi-gl-core":"PJsv"}],"DI0o":[function(require,module,exports) {
"use strict";function r(r){for(var e=6*r,t=new Uint16Array(e),n=0,o=0;n<e;n+=6,o+=4)t[n+0]=o+0,t[n+1]=o+1,t[n+2]=o+2,t[n+3]=o+0,t[n+4]=o+2,t[n+5]=o+3;return t}exports.__esModule=!0,exports.default=r;
},{}],"tknA":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("pixi-gl-core"),e=r(t),i=require("../../../utils/createIndicesForQuads"),s=r(i);function r(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=function(){function t(i,r){h(this,t),this.gl=i,this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.interleaved=new Float32Array(16);for(var u=0;u<4;u++)this.interleaved[4*u]=this.vertices[2*u],this.interleaved[4*u+1]=this.vertices[2*u+1],this.interleaved[4*u+2]=this.uvs[2*u],this.interleaved[4*u+3]=this.uvs[2*u+1];this.indices=(0,s.default)(1),this.vertexBuffer=e.default.GLBuffer.createVertexBuffer(i,this.interleaved,i.STATIC_DRAW),this.indexBuffer=e.default.GLBuffer.createIndexBuffer(i,this.indices,i.STATIC_DRAW),this.vao=new e.default.VertexArrayObject(i,r)}return t.prototype.initVao=function(t){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,t.attributes.aVertexPosition,this.gl.FLOAT,!1,16,0).addAttribute(this.vertexBuffer,t.attributes.aTextureCoord,this.gl.FLOAT,!1,16,8)},t.prototype.map=function(t,e){var i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this},t.prototype.upload=function(){for(var t=0;t<4;t++)this.interleaved[4*t]=this.vertices[2*t],this.interleaved[4*t+1]=this.vertices[2*t+1],this.interleaved[4*t+2]=this.uvs[2*t],this.interleaved[4*t+3]=this.uvs[2*t+1];return this.vertexBuffer.upload(this.interleaved),this},t.prototype.destroy=function(){var t=this.gl;t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer)},t}();exports.default=u;
},{"pixi-gl-core":"PJsv","../../../utils/createIndicesForQuads":"DI0o"}],"wBQE":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("pixi-gl-core"),t=require("./settings"),r=n(t);function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(e instanceof Array){if("precision"!==e[0].substring(0,9)){var r=e.slice(0);return r.unshift("precision "+t+" float;"),r}}else if("precision"!==e.trim().substring(0,9))return"precision "+t+" float;\n"+e;return e}var f=function(e){function t(n,u,f,c,a){return o(this,t),i(this,e.call(this,n,s(u,a||r.default.PRECISION_VERTEX),s(f,a||r.default.PRECISION_FRAGMENT),void 0,c))}return u(t,e),t}(e.GLShader);exports.default=f;
},{"pixi-gl-core":"PJsv","./settings":"tMVT"}],"O70i":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.calculateScreenSpaceMatrix=e,exports.calculateNormalizedScreenSpaceMatrix=r,exports.calculateSpriteMatrix=a;var t=require("../../../math");function e(t,e,r){var a=t.identity();return a.translate(e.x/r.width,e.y/r.height),a.scale(r.width,r.height),a}function r(t,e,r){var a=t.identity();a.translate(e.x/r.width,e.y/r.height);var i=r.width/e.width,h=r.height/e.height;return a.scale(i,h),a}function a(e,r,a,i){var h=i._texture.orig,n=e.set(a.width,0,0,a.height,r.x,r.y),c=i.worldTransform.copy(t.Matrix.TEMP_MATRIX);return c.invert(),n.prepend(c),n.scale(1/h.width,1/h.height),n.translate(i.anchor.x,i.anchor.y),n}
},{"../../../math":"e3iB"}],"S5Wx":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./WebGLManager"),r=g(e),t=require("../utils/RenderTarget"),i=g(t),a=require("../utils/Quad"),n=g(a),s=require("../../../math"),o=require("../../../Shader"),l=g(o),h=require("../filters/filterTransforms"),d=c(h),u=require("bit-twiddle"),f=g(u);function c(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function g(e){return e&&e.__esModule?e:{default:e}}function p(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function T(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function m(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var v=function(){function e(){m(this,e),this.renderTarget=null,this.target=null,this.resolution=1,this.sourceFrame=new s.Rectangle,this.destinationFrame=new s.Rectangle,this.filters=[]}return e.prototype.clear=function(){this.filters=null,this.target=null,this.renderTarget=null},e}(),y="screen",x=function(e){function r(t){m(this,r);var i=p(this,e.call(this,t));return i.gl=i.renderer.gl,i.quad=new n.default(i.gl,t.state.attribState),i.shaderCache={},i.pool={},i.filterData=null,i.managedFilters=[],i.renderer.on("prerender",i.onPrerender,i),i._screenWidth=t.view.width,i._screenHeight=t.view.height,i}return T(r,e),r.prototype.pushFilter=function(e,r){var t=this.renderer,i=this.filterData;if(!i){i=this.renderer._activeRenderTarget.filterStack;var a=new v;a.sourceFrame=a.destinationFrame=this.renderer._activeRenderTarget.size,a.renderTarget=t._activeRenderTarget,this.renderer._activeRenderTarget.filterData=i={index:0,stack:[a]},this.filterData=i}var n=i.stack[++i.index],s=i.stack[0].destinationFrame;n||(n=i.stack[i.index]=new v);var o=e.filterArea&&0===e.filterArea.x&&0===e.filterArea.y&&e.filterArea.width===t.screen.width&&e.filterArea.height===t.screen.height,l=r[0].resolution,h=0|r[0].padding,d=o?t.screen:e.filterArea||e.getBounds(!0),u=n.sourceFrame,f=n.destinationFrame;u.x=(d.x*l|0)/l,u.y=(d.y*l|0)/l,u.width=(d.width*l|0)/l,u.height=(d.height*l|0)/l,o||(i.stack[0].renderTarget.transform||r[0].autoFit&&u.fit(s),u.pad(h)),f.width=u.width,f.height=u.height;var c=this.getPotRenderTarget(t.gl,u.width,u.height,l);n.target=e,n.filters=r,n.resolution=l,n.renderTarget=c,c.setFrame(f,u),t.bindRenderTarget(c),c.clear()},r.prototype.popFilter=function(){var e=this.filterData,r=e.stack[e.index-1],t=e.stack[e.index];this.quad.map(t.renderTarget.size,t.sourceFrame).upload();var i=t.filters;if(1===i.length)i[0].apply(this,t.renderTarget,r.renderTarget,!1,t),this.freePotRenderTarget(t.renderTarget);else{var a=t.renderTarget,n=this.getPotRenderTarget(this.renderer.gl,t.sourceFrame.width,t.sourceFrame.height,t.resolution);n.setFrame(t.destinationFrame,t.sourceFrame),n.clear();var s=0;for(s=0;s<i.length-1;++s){i[s].apply(this,a,n,!0,t);var o=a;a=n,n=o}i[s].apply(this,a,r.renderTarget,!1,t),this.freePotRenderTarget(a),this.freePotRenderTarget(n)}t.clear(),e.index--,0===e.index&&(this.filterData=null)},r.prototype.applyFilter=function(e,r,t,i){var a=this.renderer,n=a.gl,s=e.glShaders[a.CONTEXT_UID];s||(e.glShaderKey?(s=this.shaderCache[e.glShaderKey])||(s=new l.default(this.gl,e.vertexSrc,e.fragmentSrc),e.glShaders[a.CONTEXT_UID]=this.shaderCache[e.glShaderKey]=s,this.managedFilters.push(e)):(s=e.glShaders[a.CONTEXT_UID]=new l.default(this.gl,e.vertexSrc,e.fragmentSrc),this.managedFilters.push(e)),a.bindVao(null),this.quad.initVao(s)),a.bindVao(this.quad.vao),a.bindRenderTarget(t),i&&(n.disable(n.SCISSOR_TEST),a.clear(),n.enable(n.SCISSOR_TEST)),t===a.maskManager.scissorRenderTarget&&a.maskManager.pushScissorMask(null,a.maskManager.scissorData),a.bindShader(s);var o=this.renderer.emptyTextures[0];this.renderer.boundTextures[0]=o,this.syncUniforms(s,e),a.state.setBlendMode(e.blendMode),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r.texture.texture),this.quad.vao.draw(this.renderer.gl.TRIANGLES,6,0),n.bindTexture(n.TEXTURE_2D,o._glTextures[this.renderer.CONTEXT_UID].texture)},r.prototype.syncUniforms=function(e,r){var t=r.uniformData,i=r.uniforms,a=1,n=void 0;if(e.uniforms.filterArea){n=this.filterData.stack[this.filterData.index];var s=e.uniforms.filterArea;s[0]=n.renderTarget.size.width,s[1]=n.renderTarget.size.height,s[2]=n.sourceFrame.x,s[3]=n.sourceFrame.y,e.uniforms.filterArea=s}if(e.uniforms.filterClamp){n=n||this.filterData.stack[this.filterData.index];var o=e.uniforms.filterClamp;o[0]=0,o[1]=0,o[2]=(n.sourceFrame.width-1)/n.renderTarget.size.width,o[3]=(n.sourceFrame.height-1)/n.renderTarget.size.height,e.uniforms.filterClamp=o}for(var l in t)if(e.uniforms.data[l]){var h=t[l].type;if("sampler2d"===h&&0!==i[l]){if(i[l].baseTexture)e.uniforms[l]=this.renderer.bindTexture(i[l].baseTexture,a);else{e.uniforms[l]=a;var d=this.renderer.gl;this.renderer.boundTextures[a]=this.renderer.emptyTextures[a],d.activeTexture(d.TEXTURE0+a),i[l].texture.bind()}a++}else if("mat3"===h)void 0!==i[l].a?e.uniforms[l]=i[l].toArray(!0):e.uniforms[l]=i[l];else if("vec2"===h)if(void 0!==i[l].x){var u=e.uniforms[l]||new Float32Array(2);u[0]=i[l].x,u[1]=i[l].y,e.uniforms[l]=u}else e.uniforms[l]=i[l];else"float"===h?e.uniforms.data[l].value!==t[l]&&(e.uniforms[l]=i[l]):e.uniforms[l]=i[l]}},r.prototype.getRenderTarget=function(e,r){var t=this.filterData.stack[this.filterData.index],i=this.getPotRenderTarget(this.renderer.gl,t.sourceFrame.width,t.sourceFrame.height,r||t.resolution);return i.setFrame(t.destinationFrame,t.sourceFrame),i},r.prototype.returnRenderTarget=function(e){this.freePotRenderTarget(e)},r.prototype.calculateScreenSpaceMatrix=function(e){var r=this.filterData.stack[this.filterData.index];return d.calculateScreenSpaceMatrix(e,r.sourceFrame,r.renderTarget.size)},r.prototype.calculateNormalizedScreenSpaceMatrix=function(e){var r=this.filterData.stack[this.filterData.index];return d.calculateNormalizedScreenSpaceMatrix(e,r.sourceFrame,r.renderTarget.size,r.destinationFrame)},r.prototype.calculateSpriteMatrix=function(e,r){var t=this.filterData.stack[this.filterData.index];return d.calculateSpriteMatrix(e,t.sourceFrame,t.renderTarget.size,r)},r.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.renderer,t=this.managedFilters;r.off("prerender",this.onPrerender,this);for(var i=0;i<t.length;i++)e||t[i].glShaders[r.CONTEXT_UID].destroy(),delete t[i].glShaders[r.CONTEXT_UID];this.shaderCache={},e?this.pool={}:this.emptyPool()},r.prototype.getPotRenderTarget=function(e,r,t,a){var n=y;t*=a,(r*=a)===this._screenWidth&&t===this._screenHeight||(n=(65535&(r=f.default.nextPow2(r)))<<16|65535&(t=f.default.nextPow2(t))),this.pool[n]||(this.pool[n]=[]);var s=this.pool[n].pop();if(!s){var o=this.renderer.boundTextures[0];e.activeTexture(e.TEXTURE0),s=new i.default(e,r,t,null,1),e.bindTexture(e.TEXTURE_2D,o._glTextures[this.renderer.CONTEXT_UID].texture)}return s.resolution=a,s.defaultFrame.width=s.size.width=r/a,s.defaultFrame.height=s.size.height=t/a,s.filterPoolKey=n,s},r.prototype.emptyPool=function(){for(var e in this.pool){var r=this.pool[e];if(r)for(var t=0;t<r.length;t++)r[t].destroy(!0)}this.pool={}},r.prototype.freePotRenderTarget=function(e){this.pool[e.filterPoolKey].push(e)},r.prototype.onPrerender=function(){if(this._screenWidth!==this.renderer.view.width||this._screenHeight!==this.renderer.view.height){this._screenWidth=this.renderer.view.width,this._screenHeight=this.renderer.view.height;var e=this.pool[y];if(e)for(var r=0;r<e.length;r++)e[r].destroy(!0);this.pool[y]=[]}},r}(r.default);exports.default=x;
},{"./WebGLManager":"ClQe","../utils/RenderTarget":"Xw9x","../utils/Quad":"tknA","../../../math":"e3iB","../../../Shader":"wBQE","../filters/filterTransforms":"O70i","bit-twiddle":"gXRl"}],"+UA8":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("pixi-gl-core"),r=require("../../const"),t=require("./utils/RenderTarget"),s=a(t),i=require("../../utils");function a(e){return e&&e.__esModule?e:{default:e}}function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var u=function(){function t(e){n(this,t),this.renderer=e,this.gl=e.gl,this._managedTextures=[]}return t.prototype.bindTexture=function(){},t.prototype.getTexture=function(){},t.prototype.updateTexture=function(t,i){var a=this.gl,n=!!t._glRenderTargets;if(!t.hasLoaded)return null;var u=this.renderer.boundTextures;if(void 0===i){i=0;for(var d=0;d<u.length;++d)if(u[d]===t){i=d;break}}u[i]=t,a.activeTexture(a.TEXTURE0+i);var o=t._glTextures[this.renderer.CONTEXT_UID];if(o)n?t._glRenderTargets[this.renderer.CONTEXT_UID].resize(t.width,t.height):o.upload(t.source);else{if(n){var l=new s.default(this.gl,t.width,t.height,t.scaleMode,t.resolution);l.resize(t.width,t.height),t._glRenderTargets[this.renderer.CONTEXT_UID]=l,o=l.texture,this.renderer._activeRenderTarget.root||this.renderer._activeRenderTarget.frameBuffer.bind()}else(o=new e.GLTexture(this.gl,null,null,null,null)).bind(i),o.premultiplyAlpha=!0,o.upload(t.source);t._glTextures[this.renderer.CONTEXT_UID]=o,t.on("update",this.updateTexture,this),t.on("dispose",this.destroyTexture,this),this._managedTextures.push(t),t.isPowerOfTwo?(t.mipmap&&o.enableMipmap(),t.wrapMode===r.WRAP_MODES.CLAMP?o.enableWrapClamp():t.wrapMode===r.WRAP_MODES.REPEAT?o.enableWrapRepeat():o.enableWrapMirrorRepeat()):o.enableWrapClamp(),t.scaleMode===r.SCALE_MODES.NEAREST?o.enableNearestScaling():o.enableLinearScaling()}return o},t.prototype.destroyTexture=function(e,r){if((e=e.baseTexture||e).hasLoaded){var t=this.renderer,s=t.CONTEXT_UID,a=e._glTextures,n=e._glRenderTargets;if(a[s]&&(t.unbindTexture(e),a[s].destroy(),e.off("update",this.updateTexture,this),e.off("dispose",this.destroyTexture,this),delete a[s],!r)){var u=this._managedTextures.indexOf(e);-1!==u&&(0,i.removeItems)(this._managedTextures,u,1)}n&&n[s]&&(t._activeRenderTarget===n[s]&&t.bindRenderTarget(t.rootRenderTarget),n[s].destroy(),delete n[s])}},t.prototype.removeAll=function(){for(var e=0;e<this._managedTextures.length;++e){var r=this._managedTextures[e];r._glTextures[this.renderer.CONTEXT_UID]&&delete r._glTextures[this.renderer.CONTEXT_UID]}},t.prototype.destroy=function(){for(var e=0;e<this._managedTextures.length;++e){var r=this._managedTextures[e];this.destroyTexture(r,!0),r.off("update",this.updateTexture,this),r.off("dispose",this.destroyTexture,this)}this._managedTextures=null},t}();exports.default=u;
},{"pixi-gl-core":"PJsv","../../const":"YEQi","./utils/RenderTarget":"Xw9x","../../utils":"dDI1"}],"qM/P":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../../const"),e=require("../../settings"),r=n(e);function n(t){return t&&t.__esModule?t:{default:t}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(t){u(this,e),this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=r.default.GC_MAX_IDLE,this.checkCountMax=r.default.GC_MAX_CHECK_COUNT,this.mode=r.default.GC_MODE}return e.prototype.update=function(){this.count++,this.mode!==t.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},e.prototype.run=function(){for(var t=this.renderer.textureManager,e=t._managedTextures,r=!1,n=0;n<e.length;n++){var u=e[n];!u._glRenderTargets&&this.count-u.touched>this.maxIdle&&(t.destroyTexture(u,!0),e[n]=null,r=!0)}if(r){for(var o=0,s=0;s<e.length;s++)null!==e[s]&&(e[o++]=e[s]);e.length=o}},e.prototype.unload=function(t){var e=this.renderer.textureManager;t._texture&&t._texture._glRenderTargets&&e.destroyTexture(t._texture,!0);for(var r=t.children.length-1;r>=0;r--)this.unload(t.children[r])},e}();exports.default=o;
},{"../../const":"YEQi","../../settings":"tMVT"}],"KoUQ":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=N;var _=require("../../../const");function N(N){var E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return E[_.BLEND_MODES.NORMAL]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.ADD]=[N.ONE,N.DST_ALPHA],E[_.BLEND_MODES.MULTIPLY]=[N.DST_COLOR,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.SCREEN]=[N.ONE,N.ONE_MINUS_SRC_COLOR],E[_.BLEND_MODES.OVERLAY]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.DARKEN]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.LIGHTEN]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.COLOR_DODGE]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.COLOR_BURN]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.HARD_LIGHT]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.SOFT_LIGHT]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.DIFFERENCE]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.EXCLUSION]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.HUE]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.SATURATION]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.COLOR]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.LUMINOSITY]=[N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.NORMAL_NPM]=[N.SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA,N.ONE,N.ONE_MINUS_SRC_ALPHA],E[_.BLEND_MODES.ADD_NPM]=[N.SRC_ALPHA,N.DST_ALPHA,N.ONE,N.DST_ALPHA],E[_.BLEND_MODES.SCREEN_NPM]=[N.SRC_ALPHA,N.ONE_MINUS_SRC_COLOR,N.ONE,N.ONE_MINUS_SRC_COLOR],E}
},{"../../../const":"YEQi"}],"TVBW":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("./utils/mapWebGLBlendModesToPixi"),e=i(t);function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=0,r=1,n=2,h=3,o=4,l=function(){function t(i){a(this,t),this.activeState=new Uint8Array(16),this.defaultState=new Uint8Array(16),this.defaultState[0]=1,this.stackIndex=0,this.stack=[],this.gl=i,this.maxAttribs=i.getParameter(i.MAX_VERTEX_ATTRIBS),this.attribState={tempAttribState:new Array(this.maxAttribs),attribState:new Array(this.maxAttribs)},this.blendModes=(0,e.default)(i),this.nativeVaoExtension=i.getExtension("OES_vertex_array_object")||i.getExtension("MOZ_OES_vertex_array_object")||i.getExtension("WEBKIT_OES_vertex_array_object")}return t.prototype.push=function(){var t=this.stack[this.stackIndex];t||(t=this.stack[this.stackIndex]=new Uint8Array(16)),++this.stackIndex;for(var e=0;e<this.activeState.length;e++)t[e]=this.activeState[e]},t.prototype.pop=function(){var t=this.stack[--this.stackIndex];this.setState(t)},t.prototype.setState=function(t){this.setBlend(t[s]),this.setDepthTest(t[r]),this.setFrontFace(t[n]),this.setCullFace(t[h]),this.setBlendMode(t[o])},t.prototype.setBlend=function(t){t=t?1:0,this.activeState[s]!==t&&(this.activeState[s]=t,this.gl[t?"enable":"disable"](this.gl.BLEND))},t.prototype.setBlendMode=function(t){if(t!==this.activeState[o]){this.activeState[o]=t;var e=this.blendModes[t];2===e.length?this.gl.blendFunc(e[0],e[1]):this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3])}},t.prototype.setDepthTest=function(t){t=t?1:0,this.activeState[r]!==t&&(this.activeState[r]=t,this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST))},t.prototype.setCullFace=function(t){t=t?1:0,this.activeState[h]!==t&&(this.activeState[h]=t,this.gl[t?"enable":"disable"](this.gl.CULL_FACE))},t.prototype.setFrontFace=function(t){t=t?1:0,this.activeState[n]!==t&&(this.activeState[n]=t,this.gl.frontFace(this.gl[t?"CW":"CCW"]))},t.prototype.resetAttributes=function(){for(var t=0;t<this.attribState.tempAttribState.length;t++)this.attribState.tempAttribState[t]=0;for(var e=0;e<this.attribState.attribState.length;e++)this.attribState.attribState[e]=0;for(var i=1;i<this.maxAttribs;i++)this.gl.disableVertexAttribArray(i)},t.prototype.resetToDefault=function(){this.nativeVaoExtension&&this.nativeVaoExtension.bindVertexArrayOES(null),this.resetAttributes();for(var t=0;t<this.activeState.length;++t)this.activeState[t]=32;this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.setState(this.defaultState)},t}();exports.default=l;
},{"./utils/mapWebGLBlendModesToPixi":"KoUQ"}],"p4CC":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=I;var E=require("../../../const");function I(I){var R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return R[E.DRAW_MODES.POINTS]=I.POINTS,R[E.DRAW_MODES.LINES]=I.LINES,R[E.DRAW_MODES.LINE_LOOP]=I.LINE_LOOP,R[E.DRAW_MODES.LINE_STRIP]=I.LINE_STRIP,R[E.DRAW_MODES.TRIANGLES]=I.TRIANGLES,R[E.DRAW_MODES.TRIANGLE_STRIP]=I.TRIANGLE_STRIP,R[E.DRAW_MODES.TRIANGLE_FAN]=I.TRIANGLE_FAN,R}
},{"../../../const":"YEQi"}],"b6AE":[function(require,module,exports) {
"use strict";function e(e){e.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}exports.__esModule=!0,exports.default=e;
},{}],"i77b":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../SystemRenderer"),t=L(e),r=require("./managers/MaskManager"),n=L(r),i=require("./managers/StencilManager"),s=L(i),o=require("./managers/FilterManager"),a=L(o),u=require("./utils/RenderTarget"),h=L(u),l=require("./utils/ObjectRenderer"),d=L(l),c=require("./TextureManager"),x=L(c),T=require("../../textures/BaseTexture"),p=L(T),g=require("./TextureGarbageCollector"),f=L(g),_=require("./WebGLState"),b=L(_),v=require("./utils/mapWebGLDrawModesToPixi"),R=L(v),y=require("./utils/validateContext"),E=L(y),m=require("../../utils"),w=require("pixi-gl-core"),M=L(w),C=require("../../const");function L(e){return e&&e.__esModule?e:{default:e}}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var j=0,U=function(e){function r(t,i,o){O(this,r);var a=D(this,e.call(this,"WebGL",t,i,o));return a.legacy=a.options.legacy,a.legacy&&(M.default.VertexArrayObject.FORCE_NATIVE=!0),a.type=C.RENDERER_TYPE.WEBGL,a.handleContextLost=a.handleContextLost.bind(a),a.handleContextRestored=a.handleContextRestored.bind(a),a.view.addEventListener("webglcontextlost",a.handleContextLost,!1),a.view.addEventListener("webglcontextrestored",a.handleContextRestored,!1),a._contextOptions={alpha:a.transparent,antialias:a.options.antialias,premultipliedAlpha:a.transparent&&"notMultiplied"!==a.transparent,stencil:!0,preserveDrawingBuffer:a.options.preserveDrawingBuffer,powerPreference:a.options.powerPreference},a._backgroundColorRgba[3]=a.transparent?0:1,a.maskManager=new n.default(a),a.stencilManager=new s.default(a),a.emptyRenderer=new d.default(a),a.currentRenderer=a.emptyRenderer,a.textureManager=null,a.filterManager=null,a.initPlugins(),a.options.context&&(0,E.default)(a.options.context),a.gl=a.options.context||M.default.createContext(a.view,a._contextOptions),a.CONTEXT_UID=j++,a.state=new b.default(a.gl),a.renderingToScreen=!0,a.boundTextures=null,a._activeShader=null,a._activeVao=null,a._activeRenderTarget=null,a._initContext(),a.drawModes=(0,R.default)(a.gl),a._nextTextureLocation=0,a.setBlendMode(0),a}return S(r,e),r.prototype._initContext=function(){var e=this.gl;e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext();var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this._activeShader=null,this._activeVao=null,this.boundTextures=new Array(t),this.emptyTextures=new Array(t),this._unknownBoundTextures=!1,this.textureManager=new x.default(this),this.filterManager=new a.default(this),this.textureGC=new f.default(this),this.state.resetToDefault(),this.rootRenderTarget=new h.default(e,this.width,this.height,null,this.resolution,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget);var r=new M.default.GLTexture.fromData(e,null,1,1),n={_glTextures:{}};n._glTextures[this.CONTEXT_UID]={};for(var i=0;i<t;i++){var s=new p.default;s._glTextures[this.CONTEXT_UID]=r,this.boundTextures[i]=n,this.emptyTextures[i]=s,this.bindTexture(null,i)}this.emit("context",e),this.resize(this.screen.width,this.screen.height)},r.prototype.render=function(e,t,r,n,i){if(this.renderingToScreen=!t,this.emit("prerender"),this.gl&&!this.gl.isContextLost()){if(this._nextTextureLocation=0,t||(this._lastObjectRendered=e),!i){var s=e.parent;e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=s}this.bindRenderTexture(t,n),this.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this._activeRenderTarget.clear(),e.renderWebGL(this),this.currentRenderer.flush(),this.textureGC.update(),this.emit("postrender")}},r.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},r.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},r.prototype.resize=function(e,r){t.default.prototype.resize.call(this,e,r),this.rootRenderTarget.resize(e,r),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))},r.prototype.setBlendMode=function(e){this.state.setBlendMode(e)},r.prototype.clear=function(e){this._activeRenderTarget.clear(e)},r.prototype.setTransform=function(e){this._activeRenderTarget.transform=e},r.prototype.clearRenderTexture=function(e,t){var r=e.baseTexture._glRenderTargets[this.CONTEXT_UID];return r&&r.clear(t),this},r.prototype.bindRenderTexture=function(e,t){var r=void 0;if(e){var n=e.baseTexture;n._glRenderTargets[this.CONTEXT_UID]||this.textureManager.updateTexture(n,0),this.unbindTexture(n),(r=n._glRenderTargets[this.CONTEXT_UID]).setFrame(e.frame)}else r=this.rootRenderTarget;return r.transform=t,this.bindRenderTarget(r),this},r.prototype.bindRenderTarget=function(e){return e!==this._activeRenderTarget&&(this._activeRenderTarget=e,e.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=e.projectionMatrix.toArray(!0)),this.stencilManager.setMaskStack(e.stencilMaskStack)),this},r.prototype.bindShader=function(e,t){return this._activeShader!==e&&(this._activeShader=e,e.bind(),!1!==t&&(e.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0))),this},r.prototype.bindTexture=function(e,t,r){if((e=(e=e||this.emptyTextures[t]).baseTexture||e).touched=this.textureGC.count,r)t=t||0;else{for(var n=0;n<this.boundTextures.length;n++)if(this.boundTextures[n]===e)return n;void 0===t&&(this._nextTextureLocation++,this._nextTextureLocation%=this.boundTextures.length,t=this.boundTextures.length-this._nextTextureLocation-1)}var i=this.gl,s=e._glTextures[this.CONTEXT_UID];return s?(this.boundTextures[t]=e,i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,s.texture)):this.textureManager.updateTexture(e,t),t},r.prototype.unbindTexture=function(e){var t=this.gl;if(e=e.baseTexture||e,this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<this.boundTextures.length;r++)this.boundTextures[r]===this.emptyTextures[r]&&(t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,this.emptyTextures[r]._glTextures[this.CONTEXT_UID].texture))}for(var n=0;n<this.boundTextures.length;n++)this.boundTextures[n]===e&&(this.boundTextures[n]=this.emptyTextures[n],t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,this.emptyTextures[n]._glTextures[this.CONTEXT_UID].texture));return this},r.prototype.createVao=function(){return new M.default.VertexArrayObject(this.gl,this.state.attribState)},r.prototype.bindVao=function(e){return this._activeVao===e?this:(e?e.bind():this._activeVao&&this._activeVao.unbind(),this._activeVao=e,this)},r.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer),this.bindVao(null),this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget,this._unknownBoundTextures=!0;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.emptyTextures[e];return this.rootRenderTarget.activate(),this.state.resetToDefault(),this},r.prototype.handleContextLost=function(e){e.preventDefault()},r.prototype.handleContextRestored=function(){this.textureManager.removeAll(),this.filterManager.destroy(!0),this._initContext()},r.prototype.destroy=function(t){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.textureManager.destroy(),e.prototype.destroy.call(this,t),this.uid=0,this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.maskManager=null,this.filterManager=null,this.textureManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null},r}(t.default);exports.default=U,m.pluginTarget.mixin(U);
},{"../SystemRenderer":"Hz2Z","./managers/MaskManager":"OOwQ","./managers/StencilManager":"juli","./managers/FilterManager":"S5Wx","./utils/RenderTarget":"Xw9x","./utils/ObjectRenderer":"oXPp","./TextureManager":"+UA8","../../textures/BaseTexture":"ce6K","./TextureGarbageCollector":"qM/P","./WebGLState":"TVBW","./utils/mapWebGLDrawModesToPixi":"p4CC","./utils/validateContext":"b6AE","../../utils":"dDI1","pixi-gl-core":"PJsv","../../const":"YEQi"}],"fst5":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=a;var r=require("../../Shader"),e=n(r),o=require("path");function n(r){return r&&r.__esModule?r:{default:r}}var t=["varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureId;","uniform sampler2D uSamplers[%count%];","void main(void){","vec4 color;","%forloop%","gl_FragColor = color * vColor;","}"].join("\n");function a(r,o){var n=t;n=(n=n.replace(/%count%/gi,o)).replace(/%forloop%/gi,i(o));for(var a=new e.default(r,"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n",n),u=[],v=0;v<o;v++)u[v]=v;return a.bind(),a.uniforms.uSamplers=u,a}function i(r){var e="";e+="\n",e+="\n";for(var o=0;o<r;o++)o>0&&(e+="\nelse "),o<r-1&&(e+="if(vTextureId < "+o+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+o+"], vTextureCoord);",e+="\n}";return e+="\n",e+="\n"}
},{"../../Shader":"wBQE","path":"UUq2"}],"GkaI":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=a;var e=require("pixi-gl-core"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var o=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function a(e,r){var a=!r;if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");if(a){var i=document.createElement("canvas");i.width=1,i.height=1,r=t.default.createContext(i)}for(var l=r.createShader(r.FRAGMENT_SHADER);;){var s=o.replace(/%forloop%/gi,n(e));if(r.shaderSource(l,s),r.compileShader(l),r.getShaderParameter(l,r.COMPILE_STATUS))break;e=e/2|0}return a&&r.getExtension("WEBGL_lose_context")&&r.getExtension("WEBGL_lose_context").loseContext(),e}function n(e){for(var t="",r=0;r<e;++r)r>0&&(t+="\nelse "),r<e-1&&(t+="if(test == "+r+".0){}");return t}
},{"pixi-gl-core":"PJsv"}],"llp6":[function(require,module,exports) {

"use strict";function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var i=function(){function i(s){t(this,i),this.vertices=new ArrayBuffer(s),this.float32View=new Float32Array(this.vertices),this.uint32View=new Uint32Array(this.vertices)}return i.prototype.destroy=function(){this.vertices=null,this.positions=null,this.uvs=null,this.colors=null},i}();exports.default=i;
},{}],"lQAb":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../renderers/webgl/utils/ObjectRenderer"),t=T(e),r=require("../../renderers/webgl/WebGLRenderer"),i=T(r),s=require("../../utils/createIndicesForQuads"),n=T(s),u=require("./generateMultiTextureShader"),d=T(u),o=require("../../renderers/webgl/utils/checkMaxIfStatmentsInShader"),a=T(o),h=require("./BatchBuffer"),l=T(h),f=require("../../settings"),v=T(f),x=require("../../utils"),p=require("pixi-gl-core"),c=T(p),_=require("bit-twiddle"),b=T(_);function T(e){return e&&e.__esModule?e:{default:e}}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var A=0,E=0,I=function(e){function t(r){B(this,t);var i=S(this,e.call(this,r));i.vertSize=5,i.vertByteSize=4*i.vertSize,i.size=v.default.SPRITE_BATCH_SIZE,i.buffers=[];for(var s=1;s<=b.default.nextPow2(i.size);s*=2)i.buffers.push(new l.default(4*s*i.vertByteSize));i.indices=(0,n.default)(i.size),i.shader=null,i.currentIndex=0,i.groups=[];for(var u=0;u<i.size;u++)i.groups[u]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};return i.sprites=[],i.vertexBuffers=[],i.vaos=[],i.vaoMax=2,i.vertexCount=0,i.renderer.on("prerender",i.onPrerender,i),i}return y(t,e),t.prototype.onContextChange=function(){var e=this.renderer.gl;this.renderer.legacy?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),v.default.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=(0,a.default)(this.MAX_TEXTURES,e)),this.shader=(0,d.default)(e,this.MAX_TEXTURES),this.indexBuffer=c.default.GLBuffer.createIndexBuffer(e,this.indices,e.STATIC_DRAW),this.renderer.bindVao(null);for(var t=this.shader.attributes,r=0;r<this.vaoMax;r++){var i=this.vertexBuffers[r]=c.default.GLBuffer.createVertexBuffer(e,null,e.STREAM_DRAW),s=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(i,t.aVertexPosition,e.FLOAT,!1,this.vertByteSize,0).addAttribute(i,t.aTextureCoord,e.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(i,t.aColor,e.UNSIGNED_BYTE,!0,this.vertByteSize,12);t.aTextureId&&s.addAttribute(i,t.aTextureId,e.FLOAT,!1,this.vertByteSize,16),this.vaos[r]=s}this.vao=this.vaos[0],this.currentBlendMode=99999,this.boundTextures=new Array(this.MAX_TEXTURES)},t.prototype.onPrerender=function(){this.vertexCount=0},t.prototype.render=function(e){this.currentIndex>=this.size&&this.flush(),e._texture._uvs&&(this.sprites[this.currentIndex++]=e)},t.prototype.flush=function(){if(0!==this.currentIndex){var e=this.renderer.gl,t=this.MAX_TEXTURES,r=b.default.nextPow2(this.currentIndex),i=b.default.log2(r),s=this.buffers[i],n=this.sprites,u=this.groups,d=s.float32View,o=s.uint32View,a=this.boundTextures,h=this.renderer.boundTextures,l=this.renderer.textureGC.count,f=0,p=void 0,_=void 0,T=1,B=0,S=u[0],y=void 0,I=void 0,M=x.premultiplyBlendMode[n[0]._texture.baseTexture.premultipliedAlpha?1:0][n[0].blendMode];S.textureCount=0,S.start=0,S.blend=M,A++;var C=void 0;for(C=0;C<t;++C){var R=h[C];R._enabled!==A?(a[C]=R,R._virtalBoundId=C,R._enabled=A):a[C]=this.renderer.emptyTextures[C]}for(A++,C=0;C<this.currentIndex;++C){var z=n[C];n[C]=null,p=z._texture.baseTexture;var U=x.premultiplyBlendMode[Number(p.premultipliedAlpha)][z.blendMode];if(M!==U&&(M=U,_=null,B=t,A++),_!==p&&(_=p,p._enabled!==A)){if(B===t&&(A++,S.size=C-S.start,B=0,(S=u[T++]).blend=M,S.textureCount=0,S.start=C),p.touched=l,-1===p._virtalBoundId)for(var g=0;g<t;++g){var w=(g+E)%t,X=a[w];if(X._enabled!==A){E++,X._virtalBoundId=-1,p._virtalBoundId=w,a[w]=p;break}}p._enabled=A,S.textureCount++,S.ids[B]=p._virtalBoundId,S.textures[B++]=p}if(y=z.vertexData,I=z._texture._uvs.uvsUint32,this.renderer.roundPixels){var P=this.renderer.resolution;d[f]=(y[0]*P|0)/P,d[f+1]=(y[1]*P|0)/P,d[f+5]=(y[2]*P|0)/P,d[f+6]=(y[3]*P|0)/P,d[f+10]=(y[4]*P|0)/P,d[f+11]=(y[5]*P|0)/P,d[f+15]=(y[6]*P|0)/P,d[f+16]=(y[7]*P|0)/P}else d[f]=y[0],d[f+1]=y[1],d[f+5]=y[2],d[f+6]=y[3],d[f+10]=y[4],d[f+11]=y[5],d[f+15]=y[6],d[f+16]=y[7];o[f+2]=I[0],o[f+7]=I[1],o[f+12]=I[2],o[f+17]=I[3];var m=Math.min(z.worldAlpha,1),N=m<1&&p.premultipliedAlpha?(0,x.premultiplyTint)(z._tintRGB,m):z._tintRGB+(255*m<<24);o[f+3]=o[f+8]=o[f+13]=o[f+18]=N,d[f+4]=d[f+9]=d[f+14]=d[f+19]=p._virtalBoundId,f+=20}if(S.size=C-S.start,v.default.CAN_UPLOAD_SAME_BUFFER)this.vertexBuffers[this.vertexCount].upload(s.vertices,0,!0);else{if(this.vaoMax<=this.vertexCount){this.vaoMax++;var O=this.shader.attributes,G=this.vertexBuffers[this.vertexCount]=c.default.GLBuffer.createVertexBuffer(e,null,e.STREAM_DRAW),D=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(G,O.aVertexPosition,e.FLOAT,!1,this.vertByteSize,0).addAttribute(G,O.aTextureCoord,e.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(G,O.aColor,e.UNSIGNED_BYTE,!0,this.vertByteSize,12);O.aTextureId&&D.addAttribute(G,O.aTextureId,e.FLOAT,!1,this.vertByteSize,16),this.vaos[this.vertexCount]=D}this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].upload(s.vertices,0,!1),this.vertexCount++}for(C=0;C<t;++C)h[C]._virtalBoundId=-1;for(C=0;C<T;++C){for(var L=u[C],V=L.textureCount,q=0;q<V;q++)_=L.textures[q],h[L.ids[q]]!==_&&this.renderer.bindTexture(_,L.ids[q],!0),_._virtalBoundId=-1;this.renderer.state.setBlendMode(L.blend),e.drawElements(e.TRIANGLES,6*L.size,e.UNSIGNED_SHORT,6*L.start*2)}this.currentIndex=0}},t.prototype.start=function(){this.renderer.bindShader(this.shader),v.default.CAN_UPLOAD_SAME_BUFFER&&(this.renderer.bindVao(this.vaos[this.vertexCount]),this.vertexBuffers[this.vertexCount].bind())},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var t=0;t<this.vaoMax;t++)this.vertexBuffers[t]&&this.vertexBuffers[t].destroy(),this.vaos[t]&&this.vaos[t].destroy();this.indexBuffer&&this.indexBuffer.destroy(),this.renderer.off("prerender",this.onPrerender,this),e.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.vertexBuffers=null,this.vaos=null,this.indexBuffer=null,this.indices=null,this.sprites=null;for(var r=0;r<this.buffers.length;++r)this.buffers[r].destroy()},t}(t.default);exports.default=I,i.default.registerPlugin("sprite",I);
},{"../../renderers/webgl/utils/ObjectRenderer":"oXPp","../../renderers/webgl/WebGLRenderer":"i77b","../../utils/createIndicesForQuads":"DI0o","./generateMultiTextureShader":"fst5","../../renderers/webgl/utils/checkMaxIfStatmentsInShader":"GkaI","./BatchBuffer":"llp6","../../settings":"tMVT","../../utils":"dDI1","pixi-gl-core":"PJsv","bit-twiddle":"gXRl"}],"gZse":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),i=require("../const"),e=require("../utils");function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var r={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:i.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},s=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],o=function(){function i(t){n(this,i),this.styleID=0,this.reset(),f(this,t,t)}return i.prototype.clone=function(){var t={};return f(t,this,r),new i(t)},i.prototype.reset=function(){f(this,r,r)},i.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,i=this.fontFamily;Array.isArray(this.fontFamily)||(i=this.fontFamily.split(","));for(var e=i.length-1;e>=0;e--){var n=i[e].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&s.indexOf(n)<0&&(n='"'+n+'"'),i[e]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+i.join(",")},t(i,[{key:"align",get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)}},{key:"breakWords",get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}},{key:"dropShadow",get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}},{key:"dropShadowAlpha",get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}},{key:"dropShadowAngle",get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}},{key:"dropShadowBlur",get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}},{key:"dropShadowColor",get:function(){return this._dropShadowColor},set:function(t){var i=a(t);this._dropShadowColor!==i&&(this._dropShadowColor=i,this.styleID++)}},{key:"dropShadowDistance",get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}},{key:"fill",get:function(){return this._fill},set:function(t){var i=a(t);this._fill!==i&&(this._fill=i,this.styleID++)}},{key:"fillGradientType",get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}},{key:"fillGradientStops",get:function(){return this._fillGradientStops},set:function(t){l(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}},{key:"fontStyle",get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}},{key:"fontVariant",get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}},{key:"letterSpacing",get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}},{key:"leading",get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}},{key:"padding",get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)}},{key:"stroke",get:function(){return this._stroke},set:function(t){var i=a(t);this._stroke!==i&&(this._stroke=i,this.styleID++)}},{key:"strokeThickness",get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}},{key:"textBaseline",get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}},{key:"trim",get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)}},{key:"whiteSpace",get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}},{key:"wordWrap",get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}},{key:"wordWrapWidth",get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}}]),i}();function h(t){return"number"==typeof t?(0,e.hex2string)(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function a(t){if(Array.isArray(t)){for(var i=0;i<t.length;++i)t[i]=h(t[i]);return t}return h(t)}function l(t,i){if(!Array.isArray(t)||!Array.isArray(i))return!1;if(t.length!==i.length)return!1;for(var e=0;e<t.length;++e)if(t[e]!==i[e])return!1;return!0}function f(t,i,e){for(var n in e)Array.isArray(i[n])?t[n]=i[n].slice():t[n]=i[n]}exports.default=o;
},{"../const":"YEQi","../utils":"dDI1"}],"nMdc":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var t=function(){function t(n,r,a,i,o,s,l,c,h){e(this,t),this.text=n,this.style=r,this.width=a,this.height=i,this.lines=o,this.lineWidths=s,this.lineHeight=l,this.maxLineWidth=c,this.fontProperties=h}return t.measureText=function(e,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t._canvas;r=null==r?n.wordWrap:r;var i=n.toFontString(),o=t.measureFont(i),s=a.getContext("2d");s.font=i;for(var l=(r?t.wordWrap(e,n,a):e).split(/(?:\r\n|\r|\n)/),c=new Array(l.length),h=0,f=0;f<l.length;f++){var d=s.measureText(l[f]).width+(l[f].length-1)*n.letterSpacing;c[f]=d,h=Math.max(h,d)}var g=h+n.strokeThickness;n.dropShadow&&(g+=n.dropShadowDistance);var u=n.lineHeight||o.fontSize+n.strokeThickness,v=Math.max(u,o.fontSize+n.strokeThickness)+(l.length-1)*(u+n.leading);return n.dropShadow&&(v+=n.dropShadowDistance),new t(e,n,g,v,l,c,u+n.leading,h,o)},t.wordWrap=function(e,n){for(var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:t._canvas).getContext("2d"),a=0,i="",o="",s={},l=n.letterSpacing,c=n.whiteSpace,h=t.collapseSpaces(c),f=t.collapseNewlines(c),d=!h,g=n.wordWrapWidth+l,u=t.tokenize(e),v=0;v<u.length;v++){var p=u[v];if(t.isNewline(p)){if(!f){o+=t.addLine(i),d=!h,i="",a=0;continue}p=" "}if(h){var S=t.isBreakingSpace(p),k=t.isBreakingSpace(i[i.length-1]);if(S&&k)continue}var w=t.getFromCache(p,l,s,r);if(w>g)if(""!==i&&(o+=t.addLine(i),i="",a=0),t.canBreakWords(p,n.breakWords))for(var _=p.split(""),L=0;L<_.length;L++){for(var m=_[L],x=1;_[L+x];){var B=_[L+x],E=m[m.length-1];if(t.canBreakChars(E,B,p,L,n.breakWords))break;m+=B,x++}L+=m.length-1;var T=t.getFromCache(m,l,s,r);T+a>g&&(o+=t.addLine(i),d=!1,i="",a=0),i+=m,a+=T}else{i.length>0&&(o+=t.addLine(i),i="",a=0);var I=v===u.length-1;o+=t.addLine(p,!I),d=!1,i="",a=0}else w+a>g&&(d=!1,o+=t.addLine(i),i="",a=0),(i.length>0||!t.isBreakingSpace(p)||d)&&(i+=p,a+=w)}return o+=t.addLine(i,!1)},t.addLine=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e=t.trimRight(e),e=n?e+"\n":e},t.getFromCache=function(e,t,n,r){var a=n[e];if(void 0===a){var i=e.length*t;a=r.measureText(e).width+i,n[e]=a}return a},t.collapseSpaces=function(e){return"normal"===e||"pre-line"===e},t.collapseNewlines=function(e){return"normal"===e},t.trimRight=function(e){if("string"!=typeof e)return"";for(var n=e.length-1;n>=0;n--){var r=e[n];if(!t.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},t.isNewline=function(e){return"string"==typeof e&&t._newlines.indexOf(e.charCodeAt(0))>=0},t.isBreakingSpace=function(e){return"string"==typeof e&&t._breakingSpaces.indexOf(e.charCodeAt(0))>=0},t.tokenize=function(e){var n=[],r="";if("string"!=typeof e)return n;for(var a=0;a<e.length;a++){var i=e[a];t.isBreakingSpace(i)||t.isNewline(i)?(""!==r&&(n.push(r),r=""),n.push(i)):r+=i}return""!==r&&n.push(r),n},t.canBreakWords=function(e,t){return t},t.canBreakChars=function(e,t,n,r,a){return!0},t.measureFont=function(e){if(t._fonts[e])return t._fonts[e];var n={},r=t._canvas,a=t._context;a.font=e;var i=t.METRICS_STRING+t.BASELINE_SYMBOL,o=Math.ceil(a.measureText(i).width),s=Math.ceil(a.measureText(t.BASELINE_SYMBOL).width),l=2*s;s=s*t.BASELINE_MULTIPLIER|0,r.width=o,r.height=l,a.fillStyle="#f00",a.fillRect(0,0,o,l),a.font=e,a.textBaseline="alphabetic",a.fillStyle="#000",a.fillText(i,0,s);var c=a.getImageData(0,0,o,l).data,h=c.length,f=4*o,d=0,g=0,u=!1;for(d=0;d<s;++d){for(var v=0;v<f;v+=4)if(255!==c[g+v]){u=!0;break}if(u)break;g+=f}for(n.ascent=s-d,g=h-f,u=!1,d=l;d>s;--d){for(var p=0;p<f;p+=4)if(255!==c[g+p]){u=!0;break}if(u)break;g-=f}return n.descent=d-s,n.fontSize=n.ascent+n.descent,t._fonts[e]=n,n},t.clearMetrics=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e?delete t._fonts[e]:t._fonts={}},t}();exports.default=t;var n=document.createElement("canvas");n.width=n.height=10,t._canvas=n,t._context=n.getContext("2d"),t._fonts={},t.METRICS_STRING="|Éq",t.BASELINE_SYMBOL="M",t.BASELINE_MULTIPLIER=1.4,t._newlines=[10,13],t._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];
},{}],"dt3n":[function(require,module,exports) {
"use strict";function t(t){var l=t.width,o=t.height,e=t.getContext("2d"),i=e.getImageData(0,0,l,o).data,n=i.length,u={top:null,left:null,right:null,bottom:null},g=null,h=void 0,r=void 0,a=void 0;for(h=0;h<n;h+=4)0!==i[h+3]&&(r=h/4%l,a=~~(h/4/l),null===u.top&&(u.top=a),null===u.left?u.left=r:r<u.left&&(u.left=r),null===u.right?u.right=r+1:u.right<r&&(u.right=r+1),null===u.bottom?u.bottom=a:u.bottom<a&&(u.bottom=a));return null!==u.top&&(l=u.right-u.left,o=u.bottom-u.top+1,g=e.getImageData(u.left,u.top,l,o)),{height:o,width:l,data:g}}exports.__esModule=!0,exports.default=t;
},{}],"sdh2":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),e=require("../sprites/Sprite"),i=y(e),r=require("../textures/Texture"),s=y(r),n=require("../math"),o=require("../utils"),a=require("../const"),h=require("../settings"),l=y(h),u=require("./TextStyle"),d=y(u),c=require("./TextMetrics"),p=y(c),f=require("../utils/trimCanvas"),g=y(f);function y(t){return t&&t.__esModule?t:{default:t}}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function w(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var v={texture:!0,children:!1,baseTexture:!0},S=function(e){function i(t,r,o){x(this,i),(o=o||document.createElement("canvas")).width=3,o.height=3;var a=s.default.fromCanvas(o,l.default.SCALE_MODE,"text");a.orig=new n.Rectangle,a.trim=new n.Rectangle;var h=_(this,e.call(this,a));return s.default.addToCache(h._texture,h._texture.baseTexture.textureCacheIds[0]),h.canvas=o,h.context=h.canvas.getContext("2d"),h.resolution=l.default.RESOLUTION,h._text=null,h._style=null,h._styleListener=null,h._font="",h.text=t,h.style=r,h.localStyleID=-1,h}return w(i,e),i.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var i=this.context,r=p.default.measureText(this._text,this._style,this._style.wordWrap,this.canvas),s=r.width,n=r.height,o=r.lines,a=r.lineHeight,h=r.lineWidths,l=r.maxLineWidth,u=r.fontProperties;this.canvas.width=Math.ceil((Math.max(1,s)+2*e.padding)*this.resolution),this.canvas.height=Math.ceil((Math.max(1,n)+2*e.padding)*this.resolution),i.scale(this.resolution,this.resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.strokeStyle=e.stroke,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;var d=void 0,c=void 0;if(e.dropShadow){i.fillStyle=e.dropShadowColor,i.globalAlpha=e.dropShadowAlpha,i.shadowBlur=e.dropShadowBlur,e.dropShadowBlur>0&&(i.shadowColor=e.dropShadowColor);for(var f=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,g=Math.sin(e.dropShadowAngle)*e.dropShadowDistance,y=0;y<o.length;y++)d=e.strokeThickness/2,c=e.strokeThickness/2+y*a+u.ascent,"right"===e.align?d+=l-h[y]:"center"===e.align&&(d+=(l-h[y])/2),e.fill&&(this.drawLetterSpacing(o[y],d+f+e.padding,c+g+e.padding),e.stroke&&e.strokeThickness&&(i.strokeStyle=e.dropShadowColor,this.drawLetterSpacing(o[y],d+f+e.padding,c+g+e.padding,!0),i.strokeStyle=e.stroke))}i.shadowBlur=0,i.globalAlpha=1,i.fillStyle=this._generateFillStyle(e,o);for(var x=0;x<o.length;x++)d=e.strokeThickness/2,c=e.strokeThickness/2+x*a+u.ascent,"right"===e.align?d+=l-h[x]:"center"===e.align&&(d+=(l-h[x])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[x],d+e.padding,c+e.padding,!0),e.fill&&this.drawLetterSpacing(o[x],d+e.padding,c+e.padding);this.updateTexture()}},i.prototype.drawLetterSpacing=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this._style.letterSpacing;if(0!==s)for(var n=String.prototype.split.call(t,""),o=e,a=0,h="";a<t.length;)h=n[a++],r?this.context.strokeText(h,o,i):this.context.fillText(h,o,i),o+=this.context.measureText(h).width+s;else r?this.context.strokeText(t,e,i):this.context.fillText(t,e,i)},i.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=(0,g.default)(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var i=this._texture,r=this._style,s=r.trim?0:r.padding,n=i.baseTexture;n.hasLoaded=!0,n.resolution=this.resolution,n.realWidth=t.width,n.realHeight=t.height,n.width=t.width/this.resolution,n.height=t.height/this.resolution,i.trim.width=i._frame.width=t.width/this.resolution,i.trim.height=i._frame.height=t.height/this.resolution,i.trim.x=-s,i.trim.y=-s,i.orig.width=i._frame.width-2*s,i.orig.height=i._frame.height-2*s,this._onTextureUpdate(),n.emit("update",n),this.dirty=!1},i.prototype.renderWebGL=function(t){this.resolution!==t.resolution&&(this.resolution=t.resolution,this.dirty=!0),this.updateText(!0),e.prototype.renderWebGL.call(this,t)},i.prototype._renderCanvas=function(t){this.resolution!==t.resolution&&(this.resolution=t.resolution,this.dirty=!0),this.updateText(!0),e.prototype._renderCanvas.call(this,t)},i.prototype.getLocalBounds=function(t){return this.updateText(!0),e.prototype.getLocalBounds.call(this,t)},i.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},i.prototype._onStyleChange=function(){this.dirty=!0},i.prototype._generateFillStyle=function(t,e){if(!Array.isArray(t.fill))return t.fill;if(navigator.isCocoonJS)return t.fill[0];var i=void 0,r=void 0,s=void 0,n=void 0,o=this.canvas.width/this.resolution,h=this.canvas.height/this.resolution,l=t.fill.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var d=l.length+1,c=1;c<d;++c)u.push(c/d);if(l.unshift(t.fill[0]),u.unshift(0),l.push(t.fill[t.fill.length-1]),u.push(1),t.fillGradientType===a.TEXT_GRADIENT.LINEAR_VERTICAL){i=this.context.createLinearGradient(o/2,0,o/2,h),r=(l.length+1)*e.length,s=0;for(var p=0;p<e.length;p++){s+=1;for(var f=0;f<l.length;f++)n="number"==typeof u[f]?u[f]/e.length+p/e.length:s/r,i.addColorStop(n,l[f]),s++}}else{i=this.context.createLinearGradient(0,h/2,o,h/2),r=l.length+1,s=1;for(var g=0;g<l.length;g++)n="number"==typeof u[g]?u[g]:s/r,i.addColorStop(n,l[g]),s++}return i},i.prototype.destroy=function(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},v,t),e.prototype.destroy.call(this,t),this.context=null,this.canvas=null,this._style=null},t(i,[{key:"width",get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var e=(0,o.sign)(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}},{key:"height",get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var e=(0,o.sign)(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}},{key:"style",get:function(){return this._style},set:function(t){(t=t||{})instanceof d.default?this._style=t:this._style=new d.default(t),this.localStyleID=-1,this.dirty=!0}},{key:"text",get:function(){return this._text},set:function(t){t=String(""===t||null==t?" ":t),this._text!==t&&(this._text=t,this.dirty=!0)}}]),i}(i.default);exports.default=S;
},{"../sprites/Sprite":"oWLW","../textures/Texture":"xUki","../math":"e3iB","../utils":"dDI1","../const":"YEQi","../settings":"tMVT","./TextStyle":"gZse","./TextMetrics":"nMdc","../utils/trimCanvas":"dt3n"}],"i0q3":[function(require,module,exports) {
"use strict";function i(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var t=function(){function t(l,s,n,e,h,o,r,a,p){i(this,t),this.lineWidth=l,this.lineAlignment=p,this.nativeLines=r,this.lineColor=s,this.lineAlpha=n,this._lineTint=s,this.fillColor=e,this.fillAlpha=h,this._fillTint=e,this.fill=o,this.holes=[],this.shape=a,this.type=a.type}return t.prototype.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.nativeLines,this.shape,this.lineAlignment)},t.prototype.addHole=function(i){this.holes.push(i)},t.prototype.destroy=function(){this.shape=null,this.holes=null},t}();exports.default=t;
},{}],"AHbX":[function(require,module,exports) {
"use strict";function e(e,r,t,s,u,o,n,p,a){var d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[],f=0,h=0,i=0,l=0,v=0;d.push(e,r);for(var c=1,x=0;c<=a;++c)i=(h=(f=1-(x=c/a))*f)*f,v=(l=x*x)*x,d.push(i*e+3*h*x*t+3*f*l*u+v*n,i*r+3*h*x*s+3*f*l*o+v*p);return d}exports.__esModule=!0,exports.default=e;
},{}],"f5iX":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../display/Container"),e=_(t),i=require("../textures/RenderTexture"),r=_(i),n=require("../textures/Texture"),s=_(n),h=require("./GraphicsData"),a=_(h),o=require("../sprites/Sprite"),l=_(o),p=require("../math"),u=require("../utils"),c=require("../const"),d=require("../display/Bounds"),f=_(d),g=require("./utils/bezierCurveTo"),y=_(g),v=require("../renderers/canvas/CanvasRenderer"),P=_(v);function _(t){return t&&t.__esModule?t:{default:t}}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function b(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var R=void 0,C=new p.Matrix,S=new p.Point,D=new Float32Array(4),M=new Float32Array(4),A=function(t){function e(){var i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];m(this,e);var r=w(this,t.call(this));return r.fillAlpha=1,r.lineWidth=0,r.nativeLines=i,r.lineColor=0,r.lineAlignment=.5,r.graphicsData=[],r.tint=16777215,r._prevTint=16777215,r.blendMode=c.BLEND_MODES.NORMAL,r.currentPath=null,r._webGL={},r.isMask=!1,r.boundsPadding=0,r._localBounds=new f.default,r.dirty=0,r.fastRectDirty=-1,r.clearDirty=0,r.boundsDirty=-1,r.cachedSpriteDirty=!1,r._spriteRect=null,r._fastRect=!1,r._prevRectTint=null,r._prevRectFillColor=null,r}return b(e,t),e.prototype.clone=function(){var t=new e;t.renderable=this.renderable,t.fillAlpha=this.fillAlpha,t.lineWidth=this.lineWidth,t.lineColor=this.lineColor,t.lineAlignment=this.lineAlignment,t.tint=this.tint,t.blendMode=this.blendMode,t.isMask=this.isMask,t.boundsPadding=this.boundsPadding,t.dirty=0,t.cachedSpriteDirty=this.cachedSpriteDirty;for(var i=0;i<this.graphicsData.length;++i)t.graphicsData.push(this.graphicsData[i].clone());return t.currentPath=t.graphicsData[t.graphicsData.length-1],t.updateLocalBounds(),t},e.prototype._quadraticCurveLength=function(t,e,i,r,n,s){var h=t-2*i+n,a=e-2*r+s,o=2*i-2*t,l=2*r-2*e,p=4*(h*h+a*a),u=4*(h*o+a*l),c=o*o+l*l,d=2*Math.sqrt(p+u+c),f=Math.sqrt(p),g=2*p*f,y=2*Math.sqrt(c),v=u/f;return(g*d+f*u*(d-y)+(4*c*p-u*u)*Math.log((2*f+v+d)/(v+y)))/(4*g)},e.prototype._bezierCurveLength=function(t,e,i,r,n,s,h,a){for(var o=0,l=0,p=0,u=0,c=0,d=0,f=0,g=0,y=0,v=0,P=0,_=t,m=e,w=1;w<=10;++w)v=_-(g=(f=(d=(c=1-(l=w/10))*c)*c)*t+3*d*l*i+3*c*(p=l*l)*n+(u=p*l)*h),P=m-(y=f*e+3*d*l*r+3*c*p*s+u*a),_=g,m=y,o+=Math.sqrt(v*v+P*P);return o},e.prototype._segmentsCount=function(t){var i=Math.ceil(t/e.CURVES.maxLength);return i<e.CURVES.minSegments?i=e.CURVES.minSegments:i>e.CURVES.maxSegments&&(i=e.CURVES.maxSegments),i},e.prototype.lineStyle=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;if(this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.lineAlignment=r,this.currentPath)if(this.currentPath.shape.points.length){var n=new p.Polygon(this.currentPath.shape.points.slice(-2));n.closed=!1,this.drawShape(n)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha,this.currentPath.lineAlignment=this.lineAlignment;return this},e.prototype.moveTo=function(t,e){var i=new p.Polygon([t,e]);return i.closed=!1,this.drawShape(i),this},e.prototype.lineTo=function(t,e){var i=this.currentPath.shape.points,r=i[i.length-2],n=i[i.length-1];return r===t&&n===e||(i.push(t,e),this.dirty++),this},e.prototype.quadraticCurveTo=function(t,i,r,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s=this.currentPath.shape.points,h=0,a=0;0===s.length&&this.moveTo(0,0);for(var o=s[s.length-2],l=s[s.length-1],p=e.CURVES.adaptive?this._segmentsCount(this._quadraticCurveLength(o,l,t,i,r,n)):20,u=1;u<=p;++u){var c=u/p;h=o+(t-o)*c,a=l+(i-l)*c,s.push(h+(t+(r-t)*c-h)*c,a+(i+(n-i)*c-a)*c)}return this.dirty++,this},e.prototype.bezierCurveTo=function(t,i,r,n,s,h){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var a=this.currentPath.shape.points,o=a[a.length-2],l=a[a.length-1];a.length-=2;var p=e.CURVES.adaptive?this._segmentsCount(this._bezierCurveLength(o,l,t,i,r,n,s,h)):20;return(0,y.default)(o,l,t,i,r,n,s,h,p,a),this.dirty++,this},e.prototype.arcTo=function(t,e,i,r,n){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var s=this.currentPath.shape.points,h=s[s.length-2],a=s[s.length-1]-e,o=h-t,l=r-e,p=i-t,u=Math.abs(a*p-o*l);if(u<1e-8||0===n)s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e);else{var c=a*a+o*o,d=l*l+p*p,f=a*l+o*p,g=n*Math.sqrt(c)/u,y=n*Math.sqrt(d)/u,v=g*f/c,P=y*f/d,_=g*p+y*o,m=g*l+y*a,w=o*(y+v),b=a*(y+v),R=p*(g+P),C=l*(g+P),S=Math.atan2(b-m,w-_),D=Math.atan2(C-m,R-_);this.arc(_+t,m+e,n,S,D,o*l>p*a)}return this.dirty++,this},e.prototype.arc=function(t,i,r,n,s){var h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(n===s)return this;!h&&s<=n?s+=c.PI_2:h&&n<=s&&(n+=c.PI_2);var a=s-n,o=e.CURVES.adaptive?this._segmentsCount(Math.abs(a)*r):40*Math.ceil(Math.abs(a)/c.PI_2);if(0===a)return this;var l=t+Math.cos(n)*r,p=i+Math.sin(n)*r,u=this.currentPath?this.currentPath.shape.points:null;if(u){var d=Math.abs(u[u.length-2]-l),f=Math.abs(u[u.length-1]-p);d<.001&&f<.001||u.push(l,p)}else this.moveTo(l,p),u=this.currentPath.shape.points;for(var g=a/(2*o),y=2*g,v=Math.cos(g),P=Math.sin(g),_=o-1,m=_%1/_,w=0;w<=_;++w){var b=g+n+y*(w+m*w),R=Math.cos(b),C=-Math.sin(b);u.push((v*R+P*C)*r+t,(v*-C+P*R)*r+i)}return this.dirty++,this},e.prototype.beginFill=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.filling=!0,this.fillColor=t,this.fillAlpha=e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},e.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},e.prototype.drawRect=function(t,e,i,r){return this.drawShape(new p.Rectangle(t,e,i,r)),this},e.prototype.drawRoundedRect=function(t,e,i,r,n){return this.drawShape(new p.RoundedRectangle(t,e,i,r,n)),this},e.prototype.drawCircle=function(t,e,i){return this.drawShape(new p.Circle(t,e,i)),this},e.prototype.drawEllipse=function(t,e,i,r){return this.drawShape(new p.Ellipse(t,e,i,r)),this},e.prototype.drawPolygon=function(t){var e=t,i=!0;if(e instanceof p.Polygon&&(i=e.closed,e=e.points),!Array.isArray(e)){e=new Array(arguments.length);for(var r=0;r<e.length;++r)e[r]=arguments[r]}var n=new p.Polygon(e);return n.closed=i,this.drawShape(n),this},e.prototype.drawStar=function(t,e,i,r,n){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;n=n||r/2;for(var h=-1*Math.PI/2+s,a=2*i,o=c.PI_2/a,l=[],p=0;p<a;p++){var u=p%2?n:r,d=p*o+h;l.push(t+u*Math.cos(d),e+u*Math.sin(d))}return this.drawPolygon(l)},e.prototype.clear=function(){return(this.lineWidth||this.filling||this.graphicsData.length>0)&&(this.lineWidth=0,this.lineAlignment=.5,this.filling=!1,this.boundsDirty=-1,this.canvasTintDirty=-1,this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this._spriteRect=null,this},e.prototype.isFastRect=function(){return 1===this.graphicsData.length&&this.graphicsData[0].shape.type===c.SHAPES.RECT&&!this.graphicsData[0].lineWidth},e.prototype._renderWebGL=function(t){this.dirty!==this.fastRectDirty&&(this.fastRectDirty=this.dirty,this._fastRect=this.isFastRect()),this._fastRect?this._renderSpriteRect(t):(t.setObjectRenderer(t.plugins.graphics),t.plugins.graphics.render(this))},e.prototype._renderSpriteRect=function(t){var e=this.graphicsData[0].shape;this._spriteRect||(this._spriteRect=new l.default(new s.default(s.default.WHITE)));var i=this._spriteRect,r=this.graphicsData[0].fillColor;if(16777215===this.tint)i.tint=r;else if(this.tint!==this._prevRectTint||r!==this._prevRectFillColor){var n=D,h=M;(0,u.hex2rgb)(r,n),(0,u.hex2rgb)(this.tint,h),n[0]*=h[0],n[1]*=h[1],n[2]*=h[2],i.tint=(0,u.rgb2hex)(n),this._prevRectTint=this.tint,this._prevRectFillColor=r}i.alpha=this.graphicsData[0].fillAlpha,i.worldAlpha=this.worldAlpha*i.alpha,i.blendMode=this.blendMode,i._texture._frame.width=e.width,i._texture._frame.height=e.height,i.transform.worldTransform=this.transform.worldTransform,i.anchor.set(-e.x/e.width,-e.y/e.height),i._onAnchorUpdate(),i._renderWebGL(t)},e.prototype._renderCanvas=function(t){!0!==this.isMask&&t.plugins.graphics.render(this)},e.prototype._calculateBounds=function(){this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.updateLocalBounds(),this.cachedSpriteDirty=!0);var t=this._localBounds;this._bounds.addFrame(this.transform,t.minX,t.minY,t.maxX,t.maxY)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,S);for(var e=this.graphicsData,i=0;i<e.length;++i){var r=e[i];if(r.fill&&(r.shape&&r.shape.contains(S.x,S.y))){if(r.holes)for(var n=0;n<r.holes.length;n++){if(r.holes[n].contains(S.x,S.y))return!1}return!0}}return!1},e.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,i=1/0,r=-1/0;if(this.graphicsData.length)for(var n=0,s=0,h=0,a=0,o=0,l=0;l<this.graphicsData.length;l++){var p=this.graphicsData[l],u=p.type,d=p.lineWidth*p.lineAlignment;if(n=p.shape,u===c.SHAPES.RECT||u===c.SHAPES.RREC)s=n.x-d,h=n.y-d,t=s<t?s:t,e=s+(a=n.width+2*d)>e?s+a:e,i=h<i?h:i,r=h+(o=n.height+2*d)>r?h+o:r;else if(u===c.SHAPES.CIRC)s=n.x,h=n.y,t=s-(a=n.radius+d)<t?s-a:t,e=s+a>e?s+a:e,i=h-(o=n.radius+d)<i?h-o:i,r=h+o>r?h+o:r;else if(u===c.SHAPES.ELIP)s=n.x,h=n.y,t=s-(a=n.width+d)<t?s-a:t,e=s+a>e?s+a:e,i=h-(o=n.height+d)<i?h-o:i,r=h+o>r?h+o:r;else for(var f=n.points,g=0,y=0,v=0,P=0,_=0,m=0,w=0,b=0,R=0;R+2<f.length;R+=2)s=f[R],h=f[R+1],g=f[R+2],y=f[R+3],v=Math.abs(g-s),P=Math.abs(y-h),o=2*d,(a=Math.sqrt(v*v+P*P))<1e-9||(t=(w=(g+s)/2)-(_=(o/a*P+v)/2)<t?w-_:t,e=w+_>e?w+_:e,i=(b=(y+h)/2)-(m=(o/a*v+P)/2)<i?b-m:i,r=b+m>r?b+m:r)}else t=0,e=0,i=0,r=0;var C=this.boundsPadding;this._localBounds.minX=t-C,this._localBounds.maxX=e+C,this._localBounds.minY=i-C,this._localBounds.maxY=r+C},e.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var e=new a.default(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,this.nativeLines,t,this.lineAlignment);return this.graphicsData.push(e),e.type===c.SHAPES.POLY&&(e.shape.closed=e.shape.closed,this.currentPath=e),this.dirty++,e},e.prototype.generateCanvasTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=this.getLocalBounds(),n=r.default.create(i.width,i.height,t,e);R||(R=new P.default),this.transform.updateLocalTransform(),this.transform.localTransform.copy(C),C.invert(),C.tx-=i.x,C.ty-=i.y,R.render(this,n,!0,C);var h=s.default.fromCanvas(n.baseTexture._canvasRenderTarget.canvas,t,"graphics");return h.baseTexture.resolution=e,h.baseTexture.update(),h},e.prototype.closePath=function(){var t=this.currentPath;return t&&t.shape&&t.shape.close(),this},e.prototype.addHole=function(){var t=this.graphicsData.pop();return this.currentPath=this.graphicsData[this.graphicsData.length-1],this.currentPath.addHole(t.shape),this.currentPath=null,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();for(var r in this._webGL)for(var n=0;n<this._webGL[r].data.length;++n)this._webGL[r].data[n].destroy();this._spriteRect&&this._spriteRect.destroy(),this.graphicsData=null,this.currentPath=null,this._webGL=null,this._localBounds=null},e}(e.default);exports.default=A,A._SPRITE_TEXTURE=null,A.CURVES={adaptive:!1,maxLength:10,minSegments:8,maxSegments:2048};
},{"../display/Container":"OzBO","../textures/RenderTexture":"Jb0W","../textures/Texture":"xUki","./GraphicsData":"i0q3","../sprites/Sprite":"oWLW","../math":"e3iB","../utils":"dDI1","../const":"YEQi","../display/Bounds":"Me0q","./utils/bezierCurveTo":"AHbX","../renderers/canvas/CanvasRenderer":"GzOR"}],"3MQf":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("pixi-gl-core"),i=e(t);function e(t){return t&&t.__esModule?t:{default:t}}function s(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(e,n,r){s(this,t),this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=i.default.GLBuffer.createVertexBuffer(e),this.indexBuffer=i.default.GLBuffer.createIndexBuffer(e),this.dirty=!0,this.nativeLines=!1,this.glPoints=null,this.glIndices=null,this.shader=n,this.vao=new i.default.VertexArrayObject(e,r).addIndex(this.indexBuffer).addAttribute(this.buffer,n.attributes.aVertexPosition,e.FLOAT,!1,24,0).addAttribute(this.buffer,n.attributes.aColor,e.FLOAT,!1,24,8)}return t.prototype.reset=function(){this.points.length=0,this.indices.length=0},t.prototype.upload=function(){this.glPoints=new Float32Array(this.points),this.buffer.upload(this.glPoints),this.glIndices=new Uint16Array(this.indices),this.indexBuffer.upload(this.glIndices),this.dirty=!1},t.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.vao.destroy(),this.buffer.destroy(),this.indexBuffer.destroy(),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null},t}();exports.default=n;
},{"pixi-gl-core":"PJsv"}],"udb+":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../../../Shader"),o=e(t);function e(t){return t&&t.__esModule?t:{default:t}}function r(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function n(t,o){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?t:o}function i(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);t.prototype=Object.create(o&&o.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(t,o):t.__proto__=o)}var a=function(t){function o(e){return r(this,o),n(this,t.call(this,e,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n")))}return i(o,t),o}(o.default);exports.default=a;
},{"../../../Shader":"wBQE"}],"MEjA":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=function(h,s,n){h.nativeLines?e(h,n):t(h,s)};var h=require("../../../math"),s=require("../../../utils");function t(t,e){var n=t.points;if(0!==n.length){var p=new h.Point(n[0],n[1]),u=new h.Point(n[n.length-2],n[n.length-1]);if(p.x===u.x&&p.y===u.y){(n=n.slice()).pop(),n.pop();var i=(u=new h.Point(n[n.length-2],n[n.length-1])).x+.5*(p.x-u.x),r=u.y+.5*(p.y-u.y);n.unshift(i,r),n.push(i,r)}var l=e.points,a=e.indices,o=n.length/2,v=n.length,g=l.length/6,f=t.lineWidth/2,x=(0,s.hex2rgb)(t.lineColor),q=t.lineAlpha,M=x[0]*q,c=x[1]*q,y=x[2]*q,d=n[0],b=n[1],w=n[2],A=n[3],P=0,m=0,C=-(b-A),_=d-w,L=0,W=0,j=0,k=0,z=Math.sqrt(C*C+_*_);C/=z,_/=z,C*=f,_*=f;var B=t.lineAlignment,D=2*(1-B),E=2*B;l.push(d-C*D,b-_*D,M,c,y,q),l.push(d+C*E,b+_*E,M,c,y,q);for(var F=1;F<o-1;++F){d=n[2*(F-1)],b=n[2*(F-1)+1],w=n[2*F],A=n[2*F+1],P=n[2*(F+1)],m=n[2*(F+1)+1],C=-(b-A),_=d-w,C/=z=Math.sqrt(C*C+_*_),_/=z,C*=f,_*=f,L=-(A-m),W=w-P,L/=z=Math.sqrt(L*L+W*W),W/=z;var G=-_+b-(-_+A),H=-C+w-(-C+d),I=(-C+d)*(-_+A)-(-C+w)*(-_+b),J=-(W*=f)+m-(-W+A),K=-(L*=f)+w-(-L+P),N=(-L+P)*(-W+A)-(-L+w)*(-W+m),O=G*K-J*H;if(Math.abs(O)<.1)O+=10.1,l.push(w-C*D,A-_*D,M,c,y,q),l.push(w+C*E,A+_*E,M,c,y,q);else{var Q=(H*N-K*I)/O,R=(J*I-G*N)/O;(Q-w)*(Q-w)+(R-A)*(R-A)>196*f*f?(j=C-L,k=_-W,j/=z=Math.sqrt(j*j+k*k),k/=z,j*=f,k*=f,l.push(w-j*D,A-k*D),l.push(M,c,y,q),l.push(w+j*E,A+k*E),l.push(M,c,y,q),l.push(w-j*E*D,A-k*D),l.push(M,c,y,q),v++):(l.push(w+(Q-w)*D,A+(R-A)*D),l.push(M,c,y,q),l.push(w-(Q-w)*E,A-(R-A)*E),l.push(M,c,y,q))}}d=n[2*(o-2)],b=n[2*(o-2)+1],w=n[2*(o-1)],C=-(b-(A=n[2*(o-1)+1])),_=d-w,C/=z=Math.sqrt(C*C+_*_),_/=z,C*=f,_*=f,l.push(w-C*D,A-_*D),l.push(M,c,y,q),l.push(w+C*E,A+_*E),l.push(M,c,y,q),a.push(g);for(var S=0;S<v;++S)a.push(g++);a.push(g-1)}}function e(h,t){var e=0,n=h.points;if(0!==n.length){var p=t.points,u=n.length/2,i=(0,s.hex2rgb)(h.lineColor),r=h.lineAlpha,l=i[0]*r,a=i[1]*r,o=i[2]*r;for(e=1;e<u;e++){var v=n[2*(e-1)],g=n[2*(e-1)+1],f=n[2*e],x=n[2*e+1];p.push(v,g),p.push(l,a,o,r),p.push(f,x),p.push(l,a,o,r)}}}
},{"../../../math":"e3iB","../../../utils":"dDI1"}],"EYtC":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=s;var e=require("./buildLine"),t=u(e),r=require("../../../utils"),l=require("earcut"),i=u(l);function u(e){return e&&e.__esModule?e:{default:e}}function s(e,l,u){e.points=e.shape.points.slice();var s=e.points;if(e.fill&&s.length>=6){for(var n=[],h=e.holes,o=0;o<h.length;o++){var p=h[o];n.push(s.length/2),s=s.concat(p.points)}var a=l.points,f=l.indices,d=s.length/2,c=(0,r.hex2rgb)(e.fillColor),g=e.fillAlpha,v=c[0]*g,_=c[1]*g,q=c[2]*g,x=(0,i.default)(s,n,2);if(!x)return;for(var b=a.length/6,M=0;M<x.length;M+=3)f.push(x[M]+b),f.push(x[M]+b),f.push(x[M+1]+b),f.push(x[M+2]+b),f.push(x[M+2]+b);for(var A=0;A<d;A++)a.push(s[2*A],s[2*A+1],v,_,q,g)}e.lineWidth>0&&(0,t.default)(e,l,u)}
},{"./buildLine":"MEjA","../../../utils":"dDI1","earcut":"vwhv"}],"raNh":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=t;var i=require("./buildLine"),e=u(i),s=require("../../../utils");function u(i){return i&&i.__esModule?i:{default:i}}function t(i,u,t){var h=i.shape,l=h.x,p=h.y,r=h.width,n=h.height;if(i.fill){var o=(0,s.hex2rgb)(i.fillColor),f=i.fillAlpha,a=o[0]*f,d=o[1]*f,c=o[2]*f,v=u.points,x=u.indices,_=v.length/6;v.push(l,p),v.push(a,d,c,f),v.push(l+r,p),v.push(a,d,c,f),v.push(l,p+n),v.push(a,d,c,f),v.push(l+r,p+n),v.push(a,d,c,f),x.push(_,_,_+1,_+2,_+3,_+3)}if(i.lineWidth){var g=i.points;i.points=[l,p,l+r,p,l+r,p+n,l,p+n,l,p],(0,e.default)(i,u,t),i.points=g}}
},{"./buildLine":"MEjA","../../../utils":"dDI1"}],"BGVx":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=n;var e=require("earcut"),u=l(e),i=require("./buildLine"),r=l(i),t=require("../../../utils");function l(e){return e&&e.__esModule?e:{default:e}}function n(e,i,l){var n=e.shape,s=n.x,o=n.y,f=n.width,p=n.height,a=n.radius,d=[];if(d.push(s+a,o),h(s+f-a,o,s+f,o,s+f,o+a,d),h(s+f,o+p-a,s+f,o+p,s+f-a,o+p,d),h(s+a,o+p,s,o+p,s,o+p-a,d),h(s,o+a,s,o,s+a+1e-10,o,d),e.fill){for(var c=(0,t.hex2rgb)(e.fillColor),v=e.fillAlpha,g=c[0]*v,x=c[1]*v,_=c[2]*v,q=i.points,b=i.indices,M=q.length/6,w=(0,u.default)(d,null,2),y=0,A=w.length;y<A;y+=3)b.push(w[y]+M),b.push(w[y]+M),b.push(w[y+1]+M),b.push(w[y+2]+M),b.push(w[y+2]+M);for(var C=0,L=d.length;C<L;C++)q.push(d[C],d[++C],g,x,_,v)}if(e.lineWidth){var W=e.points;e.points=d,(0,r.default)(e,i,l),e.points=W}}function s(e,u,i){return e+(u-e)*i}function h(e,u,i,r,t,l){for(var n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],h=0,o=0,f=0,p=0,a=0,d=0,c=0,v=0;c<=20;++c)h=s(e,i,v=c/20),o=s(u,r,v),f=s(i,t,v),p=s(r,l,v),a=s(h,f,v),d=s(o,p,v),n.push(a,d);return n}
},{"earcut":"vwhv","./buildLine":"MEjA","../../../utils":"dDI1"}],"gTSb":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=o;var i=require("./buildLine"),t=h(i),s=require("../../../const"),r=require("../../../utils");function h(i){return i&&i.__esModule?i:{default:i}}function o(i,h,o){var e=i.shape,a=e.x,u=e.y,n=void 0,p=void 0;if(i.type===s.SHAPES.CIRC?(n=e.radius,p=e.radius):(n=e.width,p=e.height),0!==n&&0!==p){var l=Math.floor(30*Math.sqrt(e.radius))||Math.floor(15*Math.sqrt(e.width+e.height)),d=2*Math.PI/l;if(i.fill){var f=(0,r.hex2rgb)(i.fillColor),M=i.fillAlpha,v=f[0]*M,c=f[1]*M,q=f[2]*M,g=h.points,x=h.indices,_=g.length/6;x.push(_);for(var C=0;C<l+1;C++)g.push(a,u,v,c,q,M),g.push(a+Math.sin(d*C)*n,u+Math.cos(d*C)*p,v,c,q,M),x.push(_++,_++);x.push(_-1)}if(i.lineWidth){var b=i.points;i.points=[];for(var w=0;w<l;w++)i.points.push(a+Math.sin(d*-w)*n,u+Math.cos(d*-w)*p);i.points.push(i.points[0],i.points[1]),(0,t.default)(i,h,o),i.points=b}}}
},{"./buildLine":"MEjA","../../../const":"YEQi","../../../utils":"dDI1"}],"tXzk":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../utils"),t=require("../../const"),r=require("../../renderers/webgl/utils/ObjectRenderer"),a=v(r),i=require("../../renderers/webgl/WebGLRenderer"),n=v(i),o=require("./WebGLGraphicsData"),s=v(o),l=require("./shaders/PrimitiveShader"),d=v(l),u=require("./utils/buildPoly"),h=v(u),p=require("./utils/buildRectangle"),c=v(p),f=require("./utils/buildRoundedRectangle"),g=v(f),y=require("./utils/buildCircle"),b=v(y);function v(e){return e&&e.__esModule?e:{default:e}}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var T=function(r){function i(e){D(this,i);var t=S(this,r.call(this,e));return t.graphicsDataPool=[],t.primitiveShader=null,t.gl=e.gl,t.CONTEXT_UID=0,t}return E(i,r),i.prototype.onContextChange=function(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.primitiveShader=new d.default(this.gl)},i.prototype.destroy=function(){a.default.prototype.destroy.call(this);for(var e=0;e<this.graphicsDataPool.length;++e)this.graphicsDataPool[e].destroy();this.graphicsDataPool=null},i.prototype.render=function(t){var r=this.renderer,a=r.gl,i=void 0,n=t._webGL[this.CONTEXT_UID];n&&t.dirty===n.dirty||(this.updateGraphics(t),n=t._webGL[this.CONTEXT_UID]);var o=this.primitiveShader;r.bindShader(o),r.state.setBlendMode(t.blendMode);for(var s=0,l=n.data.length;s<l;s++){var d=(i=n.data[s]).shader;r.bindShader(d),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.tint=(0,e.hex2rgb)(t.tint),d.uniforms.alpha=t.worldAlpha,r.bindVao(i.vao),i.nativeLines?a.drawArrays(a.LINES,0,i.points.length/6):i.vao.draw(a.TRIANGLE_STRIP,i.indices.length)}},i.prototype.updateGraphics=function(e){var r=this.renderer.gl,a=e._webGL[this.CONTEXT_UID];if(a||(a=e._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:r,clearDirty:-1,dirty:-1}),a.dirty=e.dirty,e.clearDirty!==a.clearDirty){a.clearDirty=e.clearDirty;for(var i=0;i<a.data.length;i++)this.graphicsDataPool.push(a.data[i]);a.data.length=0,a.lastIndex=0}for(var n=void 0,o=void 0,s=a.lastIndex;s<e.graphicsData.length;s++){var l=e.graphicsData[s];n=this.getWebGLData(a,0),l.nativeLines&&l.lineWidth&&(o=this.getWebGLData(a,0,!0),a.lastIndex++),l.type===t.SHAPES.POLY&&(0,h.default)(l,n,o),l.type===t.SHAPES.RECT?(0,c.default)(l,n,o):l.type===t.SHAPES.CIRC||l.type===t.SHAPES.ELIP?(0,b.default)(l,n,o):l.type===t.SHAPES.RREC&&(0,g.default)(l,n,o),a.lastIndex++}this.renderer.bindVao(null);for(var d=0;d<a.data.length;d++)(n=a.data[d]).dirty&&n.upload()},i.prototype.getWebGLData=function(e,t,r){var a=e.data[e.data.length-1];return(!a||a.nativeLines!==r||a.points.length>32e4)&&((a=this.graphicsDataPool.pop()||new s.default(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState)).nativeLines=r,a.reset(t),e.data.push(a)),a.dirty=!0,a},i}(a.default);exports.default=T,n.default.registerPlugin("graphics",T);
},{"../../utils":"dDI1","../../const":"YEQi","../../renderers/webgl/utils/ObjectRenderer":"oXPp","../../renderers/webgl/WebGLRenderer":"i77b","./WebGLGraphicsData":"3MQf","./shaders/PrimitiveShader":"udb+","./utils/buildPoly":"EYtC","./utils/buildRectangle":"raNh","./utils/buildRoundedRectangle":"BGVx","./utils/buildCircle":"gTSb"}],"bG99":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../../renderers/canvas/CanvasRenderer"),l=i(t),e=require("../../const");function i(t){return t&&t.__esModule?t:{default:t}}function r(t,l){if(!(t instanceof l))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(l){r(this,t),this.renderer=l}return t.prototype.render=function(t){var l=this.renderer,i=l.context,r=t.worldAlpha,o=t.transform.worldTransform,a=l.resolution;i.setTransform(o.a*a,o.b*a,o.c*a,o.d*a,o.tx*a,o.ty*a),t.canvasTintDirty===t.dirty&&t._prevTint===t.tint||this.updateGraphicsTint(t),l.setBlendMode(t.blendMode);for(var n=0;n<t.graphicsData.length;n++){var s=t.graphicsData[n],h=s.shape,f=s._fillTint,p=s._lineTint;if(i.lineWidth=s.lineWidth,s.type===e.SHAPES.POLY){i.beginPath();var u=h.points,g=s.holes,d=void 0,c=void 0;i.moveTo(u[0],u[1]);for(var v=2;v<u.length;v+=2)i.lineTo(u[v],u[v+1]);if(h.closed&&i.closePath(),g.length>0){d=0;for(var T=0;T<u.length;T+=2)d+=u[T]*u[T+3]-u[T+1]*u[T+2];for(var y=0;y<g.length;y++){u=g[y].points,c=0;for(var b=0;b<u.length;b+=2)c+=u[b]*u[b+3]-u[b+1]*u[b+2];if(i.moveTo(u[0],u[1]),c*d<0)for(var S=2;S<u.length;S+=2)i.lineTo(u[S],u[S+1]);else for(var A=u.length-2;A>=2;A-=2)i.lineTo(u[A],u[A+1]);g[y].closed&&i.closePath()}}s.fill&&(i.globalAlpha=s.fillAlpha*r,i.fillStyle="#"+("00000"+(0|f).toString(16)).substr(-6),i.fill()),s.lineWidth&&(i.globalAlpha=s.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.stroke())}else if(s.type===e.SHAPES.RECT)(s.fillColor||0===s.fillColor)&&(i.globalAlpha=s.fillAlpha*r,i.fillStyle="#"+("00000"+(0|f).toString(16)).substr(-6),i.fillRect(h.x,h.y,h.width,h.height)),s.lineWidth&&(i.globalAlpha=s.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.strokeRect(h.x,h.y,h.width,h.height));else if(s.type===e.SHAPES.CIRC)i.beginPath(),i.arc(h.x,h.y,h.radius,0,2*Math.PI),i.closePath(),s.fill&&(i.globalAlpha=s.fillAlpha*r,i.fillStyle="#"+("00000"+(0|f).toString(16)).substr(-6),i.fill()),s.lineWidth&&(i.globalAlpha=s.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.stroke());else if(s.type===e.SHAPES.ELIP){var C=2*h.width,P=2*h.height,k=h.x-C/2,_=h.y-P/2;i.beginPath();var m=C/2*.5522848,x=P/2*.5522848,E=k+C,w=_+P,R=k+C/2,W=_+P/2;i.moveTo(k,W),i.bezierCurveTo(k,W-x,R-m,_,R,_),i.bezierCurveTo(R+m,_,E,W-x,E,W),i.bezierCurveTo(E,W+x,R+m,w,R,w),i.bezierCurveTo(R-m,w,k,W+x,k,W),i.closePath(),s.fill&&(i.globalAlpha=s.fillAlpha*r,i.fillStyle="#"+("00000"+(0|f).toString(16)).substr(-6),i.fill()),s.lineWidth&&(i.globalAlpha=s.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.stroke())}else if(s.type===e.SHAPES.RREC){var q=h.x,D=h.y,M=h.width,H=h.height,z=h.radius,I=Math.min(M,H)/2|0;z=z>I?I:z,i.beginPath(),i.moveTo(q,D+z),i.lineTo(q,D+H-z),i.quadraticCurveTo(q,D+H,q+z,D+H),i.lineTo(q+M-z,D+H),i.quadraticCurveTo(q+M,D+H,q+M,D+H-z),i.lineTo(q+M,D+z),i.quadraticCurveTo(q+M,D,q+M-z,D),i.lineTo(q+z,D),i.quadraticCurveTo(q,D,q,D+z),i.closePath(),(s.fillColor||0===s.fillColor)&&(i.globalAlpha=s.fillAlpha*r,i.fillStyle="#"+("00000"+(0|f).toString(16)).substr(-6),i.fill()),s.lineWidth&&(i.globalAlpha=s.lineAlpha*r,i.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),i.stroke())}}},t.prototype.updateGraphicsTint=function(t){t._prevTint=t.tint,t.canvasTintDirty=t.dirty;for(var l=(t.tint>>16&255)/255,e=(t.tint>>8&255)/255,i=(255&t.tint)/255,r=0;r<t.graphicsData.length;++r){var o=t.graphicsData[r],a=0|o.fillColor,n=0|o.lineColor;o._fillTint=((a>>16&255)/255*l*255<<16)+((a>>8&255)/255*e*255<<8)+(255&a)/255*i*255,o._lineTint=((n>>16&255)/255*l*255<<16)+((n>>8&255)/255*e*255<<8)+(255&n)/255*i*255}},t.prototype.renderPolygon=function(t,l,e){e.moveTo(t[0],t[1]);for(var i=1;i<t.length/2;++i)e.lineTo(t[2*i],t[2*i+1]);l&&e.closePath()},t.prototype.destroy=function(){this.renderer=null},t}();exports.default=o,l.default.registerPlugin("graphics",o);
},{"../../renderers/canvas/CanvasRenderer":"GzOR","../../const":"YEQi"}],"hX4Q":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,s,r){return s&&t(e.prototype,s),r&&t(e,r),e}}(),e=require("../"),s=require("../utils");function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function o(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;r(this,o),this.baseTexture=t,this.textures={},this.animations={},this.data=e,this.resolution=this._updateResolution(s||this.baseTexture.imageUrl),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return t(o,null,[{key:"BATCH_SIZE",get:function(){return 1e3}}]),o.prototype._updateResolution=function(t){var e=this.data.meta.scale,r=(0,s.getResolutionOfUrl)(t,null);return null===r&&(r=void 0!==e?parseFloat(e):1),1!==r&&(this.baseTexture.resolution=r,this.baseTexture.update()),r},o.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=o.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},o.prototype._processFrames=function(t){for(var s=t,r=o.BATCH_SIZE,i=this.baseTexture.sourceScale;s-t<r&&s<this._frameKeys.length;){var a=this._frameKeys[s],n=this._frames[a],h=n.frame;if(h){var l=null,u=null,c=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,f=new e.Rectangle(0,0,Math.floor(c.w*i)/this.resolution,Math.floor(c.h*i)/this.resolution);l=n.rotated?new e.Rectangle(Math.floor(h.x*i)/this.resolution,Math.floor(h.y*i)/this.resolution,Math.floor(h.h*i)/this.resolution,Math.floor(h.w*i)/this.resolution):new e.Rectangle(Math.floor(h.x*i)/this.resolution,Math.floor(h.y*i)/this.resolution,Math.floor(h.w*i)/this.resolution,Math.floor(h.h*i)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(u=new e.Rectangle(Math.floor(n.spriteSourceSize.x*i)/this.resolution,Math.floor(n.spriteSourceSize.y*i)/this.resolution,Math.floor(h.w*i)/this.resolution,Math.floor(h.h*i)/this.resolution)),this.textures[a]=new e.Texture(this.baseTexture,l,f,u,n.rotated?2:0,n.anchor),e.Texture.addToCache(this.textures[a],a)}s++}},o.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];var s=t[e],r=Array.isArray(s),o=0;for(s=r?s:s[Symbol.iterator]();;){var i;if(r){if(o>=s.length)break;i=s[o++]}else{if((o=s.next()).done)break;i=o.value}var a=i;this.animations[e].push(this.textures[a])}}},o.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},o.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*o.BATCH_SIZE),this._batchIndex++,setTimeout(function(){t._batchIndex*o.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())},0)},o.prototype.destroy=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},o}();exports.default=o;
},{"../":"RjZD","../utils":"dDI1"}],"DqsF":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.autoDetectRenderer=d;var e=require("./utils"),r=s(e),t=require("./renderers/canvas/CanvasRenderer"),n=o(t),u=require("./renderers/webgl/WebGLRenderer"),a=o(u);function o(e){return e&&e.__esModule?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function d(e,t,u,o){var s=e&&e.forceCanvas;return void 0!==o&&(s=o),!s&&r.isWebGLSupported()?new a.default(e,t,u):new n.default(e,t,u)}
},{"./utils":"dDI1","./renderers/canvas/CanvasRenderer":"GzOR","./renderers/webgl/WebGLRenderer":"i77b"}],"Y4lo":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),t=require("./autoDetectRenderer"),r=require("./display/Container"),i=u(r),n=require("./ticker"),s=require("./settings"),o=u(s),a=require("./const");function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var h=function(){function r(e,s,a,u,h){c(this,r),"number"==typeof e&&(e=Object.assign({width:e,height:s||o.default.RENDER_OPTIONS.height,forceCanvas:!!u,sharedTicker:!!h},a)),this._options=e=Object.assign({autoStart:!0,sharedTicker:!1,forceCanvas:!1,sharedLoader:!1},e),this.renderer=(0,t.autoDetectRenderer)(e),this.stage=new i.default,this._ticker=null,this.ticker=e.sharedTicker?n.shared:new n.Ticker,e.autoStart&&this.start()}return r.prototype.render=function(){this.renderer.render(this.stage)},r.prototype.stop=function(){this._ticker.stop()},r.prototype.start=function(){this._ticker.start()},r.prototype.destroy=function(e,t){if(this._ticker){var r=this._ticker;this.ticker=null,r.destroy()}this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null,this._options=null},e(r,[{key:"ticker",set:function(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,a.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}},{key:"view",get:function(){return this.renderer.view}},{key:"screen",get:function(){return this.renderer.screen}}]),r}();exports.default=h;
},{"./autoDetectRenderer":"DqsF","./display/Container":"OzBO","./ticker":"5u59","./settings":"tMVT","./const":"YEQi"}],"RjZD":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.autoDetectRenderer=exports.Application=exports.Filter=exports.SpriteMaskFilter=exports.Quad=exports.RenderTarget=exports.ObjectRenderer=exports.WebGLManager=exports.Shader=exports.CanvasRenderTarget=exports.TextureUvs=exports.VideoBaseTexture=exports.BaseRenderTexture=exports.RenderTexture=exports.BaseTexture=exports.TextureMatrix=exports.Texture=exports.Spritesheet=exports.CanvasGraphicsRenderer=exports.GraphicsRenderer=exports.GraphicsData=exports.Graphics=exports.TextMetrics=exports.TextStyle=exports.Text=exports.SpriteRenderer=exports.CanvasTinter=exports.CanvasSpriteRenderer=exports.Sprite=exports.TransformBase=exports.TransformStatic=exports.Transform=exports.Container=exports.DisplayObject=exports.Bounds=exports.glCore=exports.WebGLRenderer=exports.CanvasRenderer=exports.ticker=exports.utils=exports.settings=void 0;var e=require("./const");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}})});var r=require("./math");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return r[e]}})});var t=require("pixi-gl-core");Object.defineProperty(exports,"glCore",{enumerable:!0,get:function(){return N(t).default}});var n=require("./display/Bounds");Object.defineProperty(exports,"Bounds",{enumerable:!0,get:function(){return N(n).default}});var u=require("./display/DisplayObject");Object.defineProperty(exports,"DisplayObject",{enumerable:!0,get:function(){return N(u).default}});var a=require("./display/Container");Object.defineProperty(exports,"Container",{enumerable:!0,get:function(){return N(a).default}});var i=require("./display/Transform");Object.defineProperty(exports,"Transform",{enumerable:!0,get:function(){return N(i).default}});var s=require("./display/TransformStatic");Object.defineProperty(exports,"TransformStatic",{enumerable:!0,get:function(){return N(s).default}});var o=require("./display/TransformBase");Object.defineProperty(exports,"TransformBase",{enumerable:!0,get:function(){return N(o).default}});var p=require("./sprites/Sprite");Object.defineProperty(exports,"Sprite",{enumerable:!0,get:function(){return N(p).default}});var d=require("./sprites/canvas/CanvasSpriteRenderer");Object.defineProperty(exports,"CanvasSpriteRenderer",{enumerable:!0,get:function(){return N(d).default}});var f=require("./sprites/canvas/CanvasTinter");Object.defineProperty(exports,"CanvasTinter",{enumerable:!0,get:function(){return N(f).default}});var c=require("./sprites/webgl/SpriteRenderer");Object.defineProperty(exports,"SpriteRenderer",{enumerable:!0,get:function(){return N(c).default}});var l=require("./text/Text");Object.defineProperty(exports,"Text",{enumerable:!0,get:function(){return N(l).default}});var x=require("./text/TextStyle");Object.defineProperty(exports,"TextStyle",{enumerable:!0,get:function(){return N(x).default}});var b=require("./text/TextMetrics");Object.defineProperty(exports,"TextMetrics",{enumerable:!0,get:function(){return N(b).default}});var g=require("./graphics/Graphics");Object.defineProperty(exports,"Graphics",{enumerable:!0,get:function(){return N(g).default}});var v=require("./graphics/GraphicsData");Object.defineProperty(exports,"GraphicsData",{enumerable:!0,get:function(){return N(v).default}});var y=require("./graphics/webgl/GraphicsRenderer");Object.defineProperty(exports,"GraphicsRenderer",{enumerable:!0,get:function(){return N(y).default}});var m=require("./graphics/canvas/CanvasGraphicsRenderer");Object.defineProperty(exports,"CanvasGraphicsRenderer",{enumerable:!0,get:function(){return N(m).default}});var O=require("./textures/Spritesheet");Object.defineProperty(exports,"Spritesheet",{enumerable:!0,get:function(){return N(O).default}});var T=require("./textures/Texture");Object.defineProperty(exports,"Texture",{enumerable:!0,get:function(){return N(T).default}});var j=require("./textures/TextureMatrix");Object.defineProperty(exports,"TextureMatrix",{enumerable:!0,get:function(){return N(j).default}});var q=require("./textures/BaseTexture");Object.defineProperty(exports,"BaseTexture",{enumerable:!0,get:function(){return N(q).default}});var P=require("./textures/RenderTexture");Object.defineProperty(exports,"RenderTexture",{enumerable:!0,get:function(){return N(P).default}});var R=require("./textures/BaseRenderTexture");Object.defineProperty(exports,"BaseRenderTexture",{enumerable:!0,get:function(){return N(R).default}});var h=require("./textures/VideoBaseTexture");Object.defineProperty(exports,"VideoBaseTexture",{enumerable:!0,get:function(){return N(h).default}});var S=require("./textures/TextureUvs");Object.defineProperty(exports,"TextureUvs",{enumerable:!0,get:function(){return N(S).default}});var C=require("./renderers/canvas/utils/CanvasRenderTarget");Object.defineProperty(exports,"CanvasRenderTarget",{enumerable:!0,get:function(){return N(C).default}});var G=require("./Shader");Object.defineProperty(exports,"Shader",{enumerable:!0,get:function(){return N(G).default}});var M=require("./renderers/webgl/managers/WebGLManager");Object.defineProperty(exports,"WebGLManager",{enumerable:!0,get:function(){return N(M).default}});var B=require("./renderers/webgl/utils/ObjectRenderer");Object.defineProperty(exports,"ObjectRenderer",{enumerable:!0,get:function(){return N(B).default}});var w=require("./renderers/webgl/utils/RenderTarget");Object.defineProperty(exports,"RenderTarget",{enumerable:!0,get:function(){return N(w).default}});var D=require("./renderers/webgl/utils/Quad");Object.defineProperty(exports,"Quad",{enumerable:!0,get:function(){return N(D).default}});var _=require("./renderers/webgl/filters/spriteMask/SpriteMaskFilter");Object.defineProperty(exports,"SpriteMaskFilter",{enumerable:!0,get:function(){return N(_).default}});var k=require("./renderers/webgl/filters/Filter");Object.defineProperty(exports,"Filter",{enumerable:!0,get:function(){return N(k).default}});var F=require("./Application");Object.defineProperty(exports,"Application",{enumerable:!0,get:function(){return N(F).default}});var L=require("./autoDetectRenderer");Object.defineProperty(exports,"autoDetectRenderer",{enumerable:!0,get:function(){return L.autoDetectRenderer}});var W=require("./utils"),A=K(W),Q=require("./ticker"),U=K(Q),V=require("./settings"),E=N(V),z=require("./renderers/canvas/CanvasRenderer"),H=N(z),I=require("./renderers/webgl/WebGLRenderer"),J=N(I);function K(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function N(e){return e&&e.__esModule?e:{default:e}}exports.settings=E.default,exports.utils=A,exports.ticker=U,exports.CanvasRenderer=H.default,exports.WebGLRenderer=J.default;
},{"./const":"YEQi","./math":"e3iB","pixi-gl-core":"PJsv","./display/Bounds":"Me0q","./display/DisplayObject":"rGF6","./display/Container":"OzBO","./display/Transform":"ThH+","./display/TransformStatic":"pc4T","./display/TransformBase":"Pszr","./sprites/Sprite":"oWLW","./sprites/canvas/CanvasSpriteRenderer":"3rZB","./sprites/canvas/CanvasTinter":"xwA8","./sprites/webgl/SpriteRenderer":"lQAb","./text/Text":"sdh2","./text/TextStyle":"gZse","./text/TextMetrics":"nMdc","./graphics/Graphics":"f5iX","./graphics/GraphicsData":"i0q3","./graphics/webgl/GraphicsRenderer":"tXzk","./graphics/canvas/CanvasGraphicsRenderer":"bG99","./textures/Spritesheet":"hX4Q","./textures/Texture":"xUki","./textures/TextureMatrix":"vusc","./textures/BaseTexture":"ce6K","./textures/RenderTexture":"Jb0W","./textures/BaseRenderTexture":"8ODW","./textures/VideoBaseTexture":"U1Rh","./textures/TextureUvs":"sUm+","./renderers/canvas/utils/CanvasRenderTarget":"khQn","./Shader":"wBQE","./renderers/webgl/managers/WebGLManager":"ClQe","./renderers/webgl/utils/ObjectRenderer":"oXPp","./renderers/webgl/utils/RenderTarget":"Xw9x","./renderers/webgl/utils/Quad":"tknA","./renderers/webgl/filters/spriteMask/SpriteMaskFilter":"VuLC","./renderers/webgl/filters/Filter":"AVkB","./Application":"Y4lo","./autoDetectRenderer":"DqsF","./utils":"dDI1","./ticker":"5u59","./settings":"tMVT","./renderers/canvas/CanvasRenderer":"GzOR","./renderers/webgl/WebGLRenderer":"i77b"}],"+E8Q":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=r;var e={};function t(t){if(!e[t]){var r=(new Error).stack;void 0===r?console.warn("Deprecation Warning: ",t):(r=r.split("\n").splice(3).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t),console.warn(r),console.groupEnd()):(console.warn("Deprecation Warning: ",t),console.warn(r))),e[t]=!0}}function r(e){var r=e.mesh,n=e.particles,s=e.extras,a=e.filters,o=e.prepare,i=e.loaders,u=e.interaction;Object.defineProperties(e,{SpriteBatch:{get:function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")}},AssetLoader:{get:function(){throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.")}},Stage:{get:function(){return t("You do not need to use a PIXI Stage any more, you can simply render any container."),e.Container}},DisplayObjectContainer:{get:function(){return t("DisplayObjectContainer has been shortened to Container, please use Container from now on."),e.Container}},Strip:{get:function(){return t("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),r.Mesh}},Rope:{get:function(){return t("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),r.Rope}},ParticleContainer:{get:function(){return t("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."),n.ParticleContainer}},MovieClip:{get:function(){return t("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."),s.AnimatedSprite}},TilingSprite:{get:function(){return t("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),s.TilingSprite}},BitmapText:{get:function(){return t("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),s.BitmapText}},blendModes:{get:function(){return t("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),e.BLEND_MODES}},scaleModes:{get:function(){return t("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),e.SCALE_MODES}},BaseTextureCache:{get:function(){return t("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),e.utils.BaseTextureCache}},TextureCache:{get:function(){return t("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),e.utils.TextureCache}},math:{get:function(){return t("The math namespace is deprecated, please access members already accessible on PIXI."),e}},AbstractFilter:{get:function(){return t("AstractFilter has been renamed to Filter, please use PIXI.Filter"),e.Filter}},TransformManual:{get:function(){return t("TransformManual has been renamed to TransformBase, please update your pixi-spine"),e.TransformBase}},TARGET_FPMS:{get:function(){return t("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),e.settings.TARGET_FPMS},set:function(r){t("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"),e.settings.TARGET_FPMS=r}},FILTER_RESOLUTION:{get:function(){return t("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),e.settings.FILTER_RESOLUTION},set:function(r){t("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"),e.settings.FILTER_RESOLUTION=r}},RESOLUTION:{get:function(){return t("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),e.settings.RESOLUTION},set:function(r){t("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"),e.settings.RESOLUTION=r}},MIPMAP_TEXTURES:{get:function(){return t("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),e.settings.MIPMAP_TEXTURES},set:function(r){t("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"),e.settings.MIPMAP_TEXTURES=r}},SPRITE_BATCH_SIZE:{get:function(){return t("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),e.settings.SPRITE_BATCH_SIZE},set:function(r){t("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"),e.settings.SPRITE_BATCH_SIZE=r}},SPRITE_MAX_TEXTURES:{get:function(){return t("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),e.settings.SPRITE_MAX_TEXTURES},set:function(r){t("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"),e.settings.SPRITE_MAX_TEXTURES=r}},RETINA_PREFIX:{get:function(){return t("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),e.settings.RETINA_PREFIX},set:function(r){t("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"),e.settings.RETINA_PREFIX=r}},DEFAULT_RENDER_OPTIONS:{get:function(){return t("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"),e.settings.RENDER_OPTIONS}}});for(var p=[{parent:"TRANSFORM_MODE",target:"TRANSFORM_MODE"},{parent:"GC_MODES",target:"GC_MODE"},{parent:"WRAP_MODES",target:"WRAP_MODE"},{parent:"SCALE_MODES",target:"SCALE_MODE"},{parent:"PRECISION",target:"PRECISION_FRAGMENT"}],c=function(r){var n=p[r];Object.defineProperty(e[n.parent],"DEFAULT",{get:function(){return t("PIXI."+n.parent+".DEFAULT has been deprecated, please use PIXI.settings."+n.target),e.settings[n.target]},set:function(r){t("PIXI."+n.parent+".DEFAULT has been deprecated, please use PIXI.settings."+n.target),e.settings[n.target]=r}})},l=0;l<p.length;l++)c(l);Object.defineProperties(e.settings,{PRECISION:{get:function(){return t("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),e.settings.PRECISION_FRAGMENT},set:function(r){t("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"),e.settings.PRECISION_FRAGMENT=r}}}),s.AnimatedSprite&&Object.defineProperties(s,{MovieClip:{get:function(){return t("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."),s.AnimatedSprite}}}),s&&Object.defineProperties(s,{TextureTransform:{get:function(){return t("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."),e.TextureMatrix}}}),e.DisplayObject.prototype.generateTexture=function(e,r,n){return t("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"),e.generateTexture(this,r,n)},e.Graphics.prototype.generateTexture=function(e,r){return t("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"),this.generateCanvasTexture(e,r)},e.GroupD8.isSwapWidthHeight=function(r){return t("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"),e.GroupD8.isVertical(r)},e.RenderTexture.prototype.render=function(e,r,n,s){this.legacyRenderer.render(e,this,n,r,!s),t("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")},e.RenderTexture.prototype.getImage=function(e){return t("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"),this.legacyRenderer.extract.image(e)},e.RenderTexture.prototype.getBase64=function(e){return t("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"),this.legacyRenderer.extract.base64(e)},e.RenderTexture.prototype.getCanvas=function(e){return t("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"),this.legacyRenderer.extract.canvas(e)},e.RenderTexture.prototype.getPixels=function(e){return t("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"),this.legacyRenderer.pixels(e)},e.Sprite.prototype.setTexture=function(e){this.texture=e,t("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},s.BitmapText&&(s.BitmapText.prototype.setText=function(e){this.text=e,t("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")}),e.Text.prototype.setText=function(e){this.text=e,t("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},e.Text.calculateFontProperties=function(r){return t("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"),e.TextMetrics.measureFont(r)},Object.defineProperties(e.Text,{fontPropertiesCache:{get:function(){return t("Text.fontPropertiesCache is deprecated"),e.TextMetrics._fonts}},fontPropertiesCanvas:{get:function(){return t("Text.fontPropertiesCanvas is deprecated"),e.TextMetrics._canvas}},fontPropertiesContext:{get:function(){return t("Text.fontPropertiesContext is deprecated"),e.TextMetrics._context}}}),e.Text.prototype.setStyle=function(e){this.style=e,t("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},e.Text.prototype.determineFontProperties=function(r){return t("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"),e.TextMetrics.measureFont(r)},e.Text.getFontStyle=function(r){return t("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"),(r=r||{})instanceof e.TextStyle||(r=new e.TextStyle(r)),r.toFontString()},Object.defineProperties(e.TextStyle.prototype,{font:{get:function(){t("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on");var e="number"==typeof this._fontSize?this._fontSize+"px":this._fontSize;return this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+e+" "+this._fontFamily},set:function(e){t("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"),e.indexOf("italic")>1?this._fontStyle="italic":e.indexOf("oblique")>-1?this._fontStyle="oblique":this._fontStyle="normal",e.indexOf("small-caps")>-1?this._fontVariant="small-caps":this._fontVariant="normal";var r=e.split(" "),n=-1;this._fontSize=26;for(var s=0;s<r.length;++s)if(r[s].match(/(px|pt|em|%)/)){n=s,this._fontSize=r[s];break}this._fontWeight="normal";for(var a=0;a<n;++a)if(r[a].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=r[a];break}if(n>-1&&n<r.length-1){this._fontFamily="";for(var o=n+1;o<r.length;++o)this._fontFamily+=r[o]+" ";this._fontFamily=this._fontFamily.slice(0,-1)}else this._fontFamily="Arial";this.styleID++}}}),e.Texture.prototype.setFrame=function(e){this.frame=e,t("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;")},e.Texture.addTextureToCache=function(r,n){e.Texture.addToCache(r,n),t("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.")},e.Texture.removeTextureFromCache=function(r){return t("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"),e.BaseTexture.removeFromCache(r),e.Texture.removeFromCache(r)},Object.defineProperties(a,{AbstractFilter:{get:function(){return t("AstractFilter has been renamed to Filter, please use PIXI.Filter"),e.AbstractFilter}},SpriteMaskFilter:{get:function(){return t("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),e.SpriteMaskFilter}},VoidFilter:{get:function(){return t("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"),a.AlphaFilter}}}),e.utils.uuid=function(){return t("utils.uuid() is deprecated, please use utils.uid() from now on."),e.utils.uid()},e.utils.canUseNewCanvasBlendModes=function(){return t("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"),e.CanvasTinter.canUseMultiply};var d=!0;if(Object.defineProperty(e.utils,"_saidHello",{set:function(e){e&&(t("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"),this.skipHello()),d=e},get:function(){return d}}),o.BasePrepare&&(o.BasePrepare.prototype.register=function(e,r){return t("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"),e&&this.registerFindHook(e),r&&this.registerUploadHook(r),this}),o.canvas&&Object.defineProperty(o.canvas,"UPLOADS_PER_FRAME",{set:function(){t("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return t("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}}),o.webgl&&Object.defineProperty(o.webgl,"UPLOADS_PER_FRAME",{set:function(){t("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer")},get:function(){return t("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"),NaN}}),i.Loader){var T=i.Resource,f=i.Loader;Object.defineProperties(T.prototype,{isJson:{get:function(){return t("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."),this.type===T.TYPE.JSON}},isXml:{get:function(){return t("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."),this.type===T.TYPE.XML}},isImage:{get:function(){return t("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."),this.type===T.TYPE.IMAGE}},isAudio:{get:function(){return t("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."),this.type===T.TYPE.AUDIO}},isVideo:{get:function(){return t("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."),this.type===T.TYPE.VIDEO}}}),Object.defineProperties(f.prototype,{before:{get:function(){return t("The before() method is deprecated, please use pre()."),this.pre}},after:{get:function(){return t("The after() method is deprecated, please use use()."),this.use}}})}u.interactiveTarget&&Object.defineProperty(u.interactiveTarget,"defaultCursor",{set:function(e){t("Property defaultCursor has been replaced with 'cursor'. "),this.cursor=e},get:function(){return t("Property defaultCursor has been replaced with 'cursor'. "),this.cursor}}),u.InteractionManager&&(Object.defineProperty(u.InteractionManager,"defaultCursorStyle",{set:function(e){t("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default=e},get:function(){return t("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "),this.cursorStyles.default}}),Object.defineProperty(u.InteractionManager,"currentCursorStyle",{set:function(e){t("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode=e},get:function(){return t("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."),this.currentCursorMode}}))}
},{}],"2kJT":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1};
},{}],"lTmO":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../core"),t=l(e),i=require("ismobilejs"),s=o(i),n=require("./accessibleTarget"),r=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.utils.mixins.delayMixin(t.DisplayObject.prototype,r.default);var d=9,c=100,h=0,u=0,p=2,v=1,b=-1e3,y=-1e3,f=2,g=function(){function e(t){a(this,e),!s.default.tablet&&!s.default.phone||navigator.isCocoonJS||this.createTouchHook();var i=document.createElement("div");i.style.width=c+"px",i.style.height=c+"px",i.style.position="absolute",i.style.top=h+"px",i.style.left=u+"px",i.style.zIndex=p,this.div=i,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessabillity=!1,window.addEventListener("keydown",this._onKeyDown,!1)}return e.prototype.createTouchHook=function(){var e=this,t=document.createElement("button");t.style.width=v+"px",t.style.height=v+"px",t.style.position="absolute",t.style.top=b+"px",t.style.left=y+"px",t.style.zIndex=f,t.style.backgroundColor="#FF0000",t.title="HOOK DIV",t.addEventListener("focus",function(){e.isMobileAccessabillity=!0,e.activate(),document.body.removeChild(t)}),document.body.appendChild(t)},e.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},e.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessabillity&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},e.prototype.updateAccessibleObjects=function(e){if(e.visible){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);for(var t=e.children,i=0;i<t.length;i++)this.updateAccessibleObjects(t[i])}},e.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),i=e.width/this.renderer.width,s=e.height/this.renderer.height,n=this.div;n.style.left=e.left+"px",n.style.top=e.top+"px",n.style.width=this.renderer.width+"px",n.style.height=this.renderer.height+"px";for(var r=0;r<this.children.length;r++){var o=this.children[r];if(o.renderId!==this.renderId)o._accessibleActive=!1,t.utils.removeItems(this.children,r,1),this.div.removeChild(o._accessibleDiv),this.pool.push(o._accessibleDiv),o._accessibleDiv=null,r--,0===this.children.length&&this.deactivate();else{n=o._accessibleDiv;var l=o.hitArea,a=o.worldTransform;o.hitArea?(n.style.left=(a.tx+l.x*a.a)*i+"px",n.style.top=(a.ty+l.y*a.d)*s+"px",n.style.width=l.width*a.a*i+"px",n.style.height=l.height*a.d*s+"px"):(l=o.getBounds(),this.capHitArea(l),n.style.left=l.x*i+"px",n.style.top=l.y*s+"px",n.style.width=l.width*i+"px",n.style.height=l.height*s+"px",n.title!==o.accessibleTitle&&null!==o.accessibleTitle&&(n.title=o.accessibleTitle),n.getAttribute("aria-label")!==o.accessibleHint&&null!==o.accessibleHint&&n.setAttribute("aria-label",o.accessibleHint))}}this.renderId++}},e.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.renderer.width&&(e.width=this.renderer.width-e.x),e.y+e.height>this.renderer.height&&(e.height=this.renderer.height-e.y)},e.prototype.addChild=function(e){var t=this.pool.pop();t||((t=document.createElement("button")).style.width=c+"px",t.style.height=c+"px",t.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=p,t.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:e.accessibleHint&&null!==e.accessibleHint||(t.title="displayObject "+e.tabIndex),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},e.prototype._onClick=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"click",t.eventData)},e.prototype._onFocus=function(e){e.target.getAttribute("aria-live","off")||e.target.setAttribute("aria-live","assertive");var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseover",t.eventData)},e.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live","off")||e.target.setAttribute("aria-live","polite");var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseout",t.eventData)},e.prototype._onKeyDown=function(e){e.keyCode===d&&this.activate()},e.prototype._onMouseMove=function(e){0===e.movementX&&0===e.movementY||this.deactivate()},e.prototype.destroy=function(){this.div=null;for(var e=0;e<this.children.length;e++)this.children[e].div=null;window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},e}();exports.default=g,t.WebGLRenderer.registerPlugin("accessibility",g),t.CanvasRenderer.registerPlugin("accessibility",g);
},{"../core":"RjZD","ismobilejs":"nSZq","./accessibleTarget":"2kJT"}],"l7H0":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./accessibleTarget");Object.defineProperty(exports,"accessibleTarget",{enumerable:!0,get:function(){return t(e).default}});var r=require("./AccessibilityManager");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"AccessibilityManager",{enumerable:!0,get:function(){return t(r).default}});
},{"./accessibleTarget":"2kJT","./AccessibilityManager":"lTmO"}],"rjpc":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../core"),r=t(e);function t(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var i=new r.Rectangle,a=4,o=function(){function e(r){n(this,e),this.renderer=r,r.extract=this}return e.prototype.image=function(e){var r=new Image;return r.src=this.base64(e),r},e.prototype.base64=function(e){return this.canvas(e).toDataURL()},e.prototype.canvas=function(e){var t=this.renderer,n=void 0,o=void 0,s=void 0,d=!1,u=void 0,h=!1;e&&(e instanceof r.RenderTexture?u=e:(u=this.renderer.generateTexture(e),h=!0)),u?(o=(n=u.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,s=u.frame,d=!1):(o=(n=this.renderer.rootRenderTarget).resolution,d=!0,(s=i).width=n.size.width,s.height=n.size.height);var c=s.width*o,l=s.height*o,g=new r.CanvasRenderTarget(c,l,1);if(n){t.bindRenderTarget(n);var v=new Uint8Array(a*c*l),f=t.gl;f.readPixels(s.x*o,s.y*o,c,l,f.RGBA,f.UNSIGNED_BYTE,v);var x=g.context.getImageData(0,0,c,l);x.data.set(v),g.context.putImageData(x,0,0),d&&(g.context.scale(1,-1),g.context.drawImage(g.canvas,0,-l))}return h&&u.destroy(!0),g.canvas},e.prototype.pixels=function(e){var t=this.renderer,n=void 0,o=void 0,s=void 0,d=void 0,u=!1;e&&(e instanceof r.RenderTexture?d=e:(d=this.renderer.generateTexture(e),u=!0)),d?(o=(n=d.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID]).resolution,s=d.frame):(o=(n=this.renderer.rootRenderTarget).resolution,(s=i).width=n.size.width,s.height=n.size.height);var h=s.width*o,c=s.height*o,l=new Uint8Array(a*h*c);if(n){t.bindRenderTarget(n);var g=t.gl;g.readPixels(s.x*o,s.y*o,h,c,g.RGBA,g.UNSIGNED_BYTE,l)}return u&&d.destroy(!0),l},e.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},e}();exports.default=o,r.WebGLRenderer.registerPlugin("extract",o);
},{"../../core":"RjZD"}],"QFWM":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../core"),t=r(e);function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=new t.Rectangle,o=function(){function e(t){n(this,e),this.renderer=t,t.extract=this}return e.prototype.image=function(e){var t=new Image;return t.src=this.base64(e),t},e.prototype.base64=function(e){return this.canvas(e).toDataURL()},e.prototype.canvas=function(e){var r=this.renderer,n=void 0,o=void 0,i=void 0,s=void 0;e&&(s=e instanceof t.RenderTexture?e:r.generateTexture(e)),s?(n=s.baseTexture._canvasRenderTarget.context,o=s.baseTexture._canvasRenderTarget.resolution,i=s.frame):(n=r.rootContext,o=r.resolution,(i=a).width=this.renderer.width,i.height=this.renderer.height);var u=i.width*o,d=i.height*o,c=new t.CanvasRenderTarget(u,d,1),h=n.getImageData(i.x*o,i.y*o,u,d);return c.context.putImageData(h,0,0),c.canvas},e.prototype.pixels=function(e){var r=this.renderer,n=void 0,o=void 0,i=void 0,s=void 0;return e&&(s=e instanceof t.RenderTexture?e:r.generateTexture(e)),s?(n=s.baseTexture._canvasRenderTarget.context,o=s.baseTexture._canvasRenderTarget.resolution,i=s.frame):(n=r.rootContext,(i=a).width=r.width,i.height=r.height),n.getImageData(0,0,i.width*o,i.height*o).data},e.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},e}();exports.default=o,t.CanvasRenderer.registerPlugin("extract",o);
},{"../../core":"RjZD"}],"jvu7":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./webgl/WebGLExtract");Object.defineProperty(exports,"webgl",{enumerable:!0,get:function(){return t(e).default}});var r=require("./canvas/CanvasExtract");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"canvas",{enumerable:!0,get:function(){return t(r).default}});
},{"./webgl/WebGLExtract":"rjpc","./canvas/CanvasExtract":"QFWM"}],"Qekk":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),e=require("../core"),r=n(e);function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(e){function n(t,s){i(this,n);var u=o(this,e.call(this,t[0]instanceof r.Texture?t[0]:t[0].texture));return u._textures=null,u._durations=null,u.textures=t,u._autoUpdate=!1!==s,u.animationSpeed=1,u.loop=!0,u.updateAnchor=!1,u.onComplete=null,u.onFrameChange=null,u.onLoop=null,u._currentTime=0,u.playing=!1,u}return s(n,e),n.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&r.ticker.shared.remove(this.update,this))},n.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&r.ticker.shared.add(this.update,this,r.UPDATE_PRIORITY.HIGH))},n.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},n.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},n.prototype.update=function(t){var e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){var n=this._currentTime%1*this._durations[this.currentFrame];for(n+=e/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r?this.onLoop():this.animationSpeed<0&&this.currentFrame>r&&this.onLoop()),this.updateTexture())},n.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this.cachedTint=16777215,this.updateAnchor&&this._anchor.copy(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame)},n.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},n.fromFrames=function(t){for(var e=[],i=0;i<t.length;++i)e.push(r.Texture.fromFrame(t[i]));return new n(e)},n.fromImages=function(t){for(var e=[],i=0;i<t.length;++i)e.push(r.Texture.fromImage(t[i]));return new n(e)},t(n,[{key:"totalFrames",get:function(){return this._textures.length}},{key:"textures",get:function(){return this._textures},set:function(t){if(t[0]instanceof r.Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this.gotoAndStop(0),this.updateTexture()}},{key:"currentFrame",get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}}]),n}(r.Sprite);exports.default=u;
},{"../core":"RjZD"}],"+ghv":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),e=require("../core"),i=s(e),r=require("../core/sprites/canvas/CanvasTinter"),n=o(r);function o(t){return t&&t.__esModule?t:{default:t}}function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=new i.Point,l=function(e){function r(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;h(this,r);var s=a(this,e.call(this,t));return s.tileTransform=new i.TransformStatic,s._width=n,s._height=o,s._canvasPattern=null,s.uvTransform=t.transform||new i.TextureMatrix(t),s.pluginName="tilingSprite",s.uvRespectAnchor=!1,s}return u(r,e),r.prototype._onTextureUpdate=function(){this.uvTransform&&(this.uvTransform.texture=this._texture),this.cachedTint=16777215},r.prototype._renderWebGL=function(t){var e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvTransform.update(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},r.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.hasLoaded){var r=t.context,o=this.worldTransform,s=t.resolution,h=2===e.rotate,a=e.baseTexture,u=a.resolution,c=this.tilePosition.x/this.tileScale.x%e.orig.width*u,l=this.tilePosition.y/this.tileScale.y%e.orig.height*u;if(this._textureID!==this._texture._updateID||this.cachedTint!==this.tint){this._textureID=this._texture._updateID;var f=new i.CanvasRenderTarget(e.orig.width,e.orig.height,u);if(16777215!==this.tint)this.tintedTexture=n.default.getTintedTexture(this,this.tint),f.context.drawImage(this.tintedTexture,0,0);else{var d=e._frame.x*u,_=e._frame.y*u,p=e._frame.width*u,m=e._frame.height*u,g=(e.trim?e.trim.width:e.orig.width)*u,y=(e.trim?e.trim.height:e.orig.height)*u,x=(e.trim?e.trim.x:0)*u,v=(e.trim?e.trim.y:0)*u;h?(f.context.rotate(-Math.PI/2),f.context.translate(-y,0),f.context.drawImage(a.source,d,_,p,m,-v,x,y,g)):f.context.drawImage(a.source,d,_,p,m,x,v,g,y)}this.cachedTint=this.tint,this._canvasPattern=f.context.createPattern(f.canvas,"repeat")}r.globalAlpha=this.worldAlpha,r.setTransform(o.a*s,o.b*s,o.c*s,o.d*s,o.tx*s,o.ty*s),t.setBlendMode(this.blendMode),r.fillStyle=this._canvasPattern,r.scale(this.tileScale.x/u,this.tileScale.y/u);var w=this.anchor.x*-this._width*u,T=this.anchor.y*-this._height*u;this.uvRespectAnchor?(r.translate(c,l),r.fillRect(-c+w,-l+T,this._width/this.tileScale.x*u,this._height/this.tileScale.y*u)):(r.translate(c+w,l+T),r.fillRect(-c,-l,this._width/this.tileScale.x*u,this._height/this.tileScale.y*u))}},r.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,i,r)},r.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new i.Rectangle),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},r.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,c);var e=this._width,i=this._height,r=-e*this.anchor._x;if(c.x>=r&&c.x<r+e){var n=-i*this.anchor._y;if(c.y>=n&&c.y<n+i)return!0}return!1},r.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.tileTransform=null,this.uvTransform=null},r.from=function(t,e,n){return new r(i.Texture.from(t),e,n)},r.fromFrame=function(t,e,n){var o=i.utils.TextureCache[t];if(!o)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new r(o,e,n)},r.fromImage=function(t,e,n,o,s){return new r(i.Texture.fromImage(t,o,s),e,n)},t(r,[{key:"clampMargin",get:function(){return this.uvTransform.clampMargin},set:function(t){this.uvTransform.clampMargin=t,this.uvTransform.update(!0)}},{key:"tileScale",get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copy(t)}},{key:"tilePosition",get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copy(t)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t}}]),r}(i.Sprite);exports.default=l;
},{"../core":"RjZD","../core/sprites/canvas/CanvasTinter":"xwA8"}],"PpCh":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var r=require("../../core"),e=t(r),o=require("../../core/const"),n=require("path");function t(r){if(r&&r.__esModule)return r;var e={};if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e.default=r,e}function a(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function i(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?r:e}function u(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)}var l=new e.Matrix,s=function(r){function n(e){a(this,n);var o=i(this,r.call(this,e));return o.shader=null,o.simpleShader=null,o.quad=null,o}return u(n,r),n.prototype.onContextChange=function(){var r=this.renderer.gl;this.shader=new e.Shader(r,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"),this.simpleShader=new e.Shader(r,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"),this.renderer.bindVao(null),this.quad=new e.Quad(r,this.renderer.state.attribState),this.quad.initVao(this.shader)},n.prototype.render=function(r){var n=this.renderer,t=this.quad;n.bindVao(t.vao);var a=t.vertices;a[0]=a[6]=r._width*-r.anchor.x,a[1]=a[3]=r._height*-r.anchor.y,a[2]=a[4]=r._width*(1-r.anchor.x),a[5]=a[7]=r._height*(1-r.anchor.y),r.uvRespectAnchor&&((a=t.uvs)[0]=a[6]=-r.anchor.x,a[1]=a[3]=-r.anchor.y,a[2]=a[4]=1-r.anchor.x,a[5]=a[7]=1-r.anchor.y),t.upload();var i=r._texture,u=i.baseTexture,s=r.tileTransform.localTransform,d=r.uvTransform,c=u.isPowerOfTwo&&i.frame.width===u.width&&i.frame.height===u.height;c&&(u._glTextures[n.CONTEXT_UID]?c=u.wrapMode!==o.WRAP_MODES.CLAMP:u.wrapMode===o.WRAP_MODES.CLAMP&&(u.wrapMode=o.WRAP_MODES.REPEAT));var m=c?this.simpleShader:this.shader;n.bindShader(m);var p=i.width,f=i.height,h=r._width,v=r._height;l.set(s.a*p/h,s.b*p/v,s.c*f/h,s.d*f/v,s.tx/h,s.ty/v),l.invert(),c?l.prepend(d.mapCoord):(m.uniforms.uMapCoord=d.mapCoord.toArray(!0),m.uniforms.uClampFrame=d.uClampFrame,m.uniforms.uClampOffset=d.uClampOffset),m.uniforms.uTransform=l.toArray(!0),m.uniforms.uColor=e.utils.premultiplyTintToRgba(r.tint,r.worldAlpha,m.uniforms.uColor,u.premultipliedAlpha),m.uniforms.translationMatrix=r.transform.worldTransform.toArray(!0),m.uniforms.uSampler=n.bindTexture(i),n.setBlendMode(e.utils.correctBlendMode(r.blendMode,u.premultipliedAlpha)),t.vao.draw(this.renderer.gl.TRIANGLES,6,0)},n}(e.ObjectRenderer);exports.default=s,e.WebGLRenderer.registerPlugin("tilingSprite",s);
},{"../../core":"RjZD","../../core/const":"YEQi","path":"UUq2"}],"qyFb":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),e=require("../core"),n=u(e),i=require("../core/math/ObservablePoint"),r=h(i),s=require("../core/utils"),a=require("../core/settings"),o=h(a);function h(t){return t&&t.__esModule?t:{default:t}}function u(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=function(e){function i(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(this,i);var s=l(this,e.call(this));return s._textWidth=0,s._textHeight=0,s._glyphs=[],s._font={tint:void 0!==n.tint?n.tint:16777215,align:n.align||"left",name:null,size:0},s.font=n.font,s._text=t,s._maxWidth=0,s._maxLineHeight=0,s._letterSpacing=0,s._anchor=new r.default(function(){s.dirty=!0},s,0,0),s.dirty=!1,s.updateText(),s}return g(i,e),i.prototype.updateText=function(){for(var t=i.fonts[this._font.name],e=this._font.size/t.size,r=new n.Point,s=[],a=[],o=this.text.replace(/(?:\r\n|\r)/g,"\n"),h=o.length,u=this._maxWidth*t.size/this._font.size,f=null,l=0,g=0,c=0,p=-1,y=0,x=0,_=0,d=0;d<h;d++){var m=o.charCodeAt(d),v=o.charAt(d);if(/(?:\s)/.test(v)&&(p=d,y=l),"\r"!==v&&"\n"!==v){var b=t.chars[m];b&&(f&&b.kerning[f]&&(r.x+=b.kerning[f]),s.push({texture:b.texture,line:c,charCode:m,position:new n.Point(r.x+b.xOffset+this._letterSpacing/2,r.y+b.yOffset)}),r.x+=b.xAdvance+this._letterSpacing,l=r.x,_=Math.max(_,b.yOffset+b.texture.height),f=m,-1!==p&&u>0&&r.x>u&&(++x,n.utils.removeItems(s,1+p-x,1+d-p),d=p,p=-1,a.push(y),g=Math.max(g,y),c++,r.x=0,r.y+=t.lineHeight,f=null))}else a.push(l),g=Math.max(g,l),++c,++x,r.x=0,r.y+=t.lineHeight,f=null}var A=o.charAt(o.length-1);"\r"!==A&&"\n"!==A&&(/(?:\s)/.test(A)&&(l=y),a.push(l),g=Math.max(g,l));for(var I=[],O=0;O<=c;O++){var k=0;"right"===this._font.align?k=g-a[O]:"center"===this._font.align&&(k=(g-a[O])/2),I.push(k)}for(var w=s.length,T=this.tint,H=0;H<w;H++){var z=this._glyphs[H];z?z.texture=s[H].texture:(z=new n.Sprite(s[H].texture),this._glyphs.push(z)),z.position.x=(s[H].position.x+I[s[H].line])*e,z.position.y=s[H].position.y*e,z.scale.x=z.scale.y=e,z.tint=T,z.parent||this.addChild(z)}for(var S=w;S<this._glyphs.length;++S)this.removeChild(this._glyphs[S]);if(this._textWidth=g*e,this._textHeight=(r.y+t.lineHeight)*e,0!==this.anchor.x||0!==this.anchor.y)for(var W=0;W<w;W++)this._glyphs[W].x-=this._textWidth*this.anchor.x,this._glyphs[W].y-=this._textHeight*this.anchor.y;this._maxLineHeight=_*e},i.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},i.prototype.getLocalBounds=function(){return this.validate(),e.prototype.getLocalBounds.call(this)},i.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},i.registerFont=function(t,e){var r={},a=t.getElementsByTagName("info")[0],h=t.getElementsByTagName("common")[0],u=t.getElementsByTagName("page"),f=(0,s.getResolutionOfUrl)(u[0].getAttribute("file"),o.default.RESOLUTION),l={};r.font=a.getAttribute("face"),r.size=parseInt(a.getAttribute("size"),10),r.lineHeight=parseInt(h.getAttribute("lineHeight"),10)/f,r.chars={},e instanceof n.Texture&&(e=[e]);for(var g=0;g<u.length;g++){var c=u[g].getAttribute("id"),p=u[g].getAttribute("file");l[c]=e instanceof Array?e[g]:e[p]}for(var y=t.getElementsByTagName("char"),x=0;x<y.length;x++){var _=y[x],d=parseInt(_.getAttribute("id"),10),m=_.getAttribute("page")||0,v=new n.Rectangle(parseInt(_.getAttribute("x"),10)/f+l[m].frame.x/f,parseInt(_.getAttribute("y"),10)/f+l[m].frame.y/f,parseInt(_.getAttribute("width"),10)/f,parseInt(_.getAttribute("height"),10)/f);r.chars[d]={xOffset:parseInt(_.getAttribute("xoffset"),10)/f,yOffset:parseInt(_.getAttribute("yoffset"),10)/f,xAdvance:parseInt(_.getAttribute("xadvance"),10)/f,kerning:{},texture:new n.Texture(l[m].baseTexture,v),page:m}}for(var b=t.getElementsByTagName("kerning"),A=0;A<b.length;A++){var I=b[A],O=parseInt(I.getAttribute("first"),10)/f,k=parseInt(I.getAttribute("second"),10)/f,w=parseInt(I.getAttribute("amount"),10)/f;r.chars[k]&&(r.chars[k].kerning[O]=w)}return i.fonts[r.font]=r,r},t(i,[{key:"tint",get:function(){return this._font.tint},set:function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0}},{key:"align",get:function(){return this._font.align},set:function(t){this._font.align=t||"left",this.dirty=!0}},{key:"anchor",get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copy(t)}},{key:"font",get:function(){return this._font},set:function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):i.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)}},{key:"text",get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}},{key:"maxLineHeight",get:function(){return this.validate(),this._maxLineHeight}},{key:"textWidth",get:function(){return this.validate(),this._textWidth}},{key:"letterSpacing",get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}},{key:"textHeight",get:function(){return this.validate(),this._textHeight}}]),i}(n.Container);exports.default=c,c.fonts={};
},{"../core":"RjZD","../core/math/ObservablePoint":"aG0R","../core/utils":"dDI1","../core/settings":"tMVT"}],"64fV":[function(require,module,exports) {
"use strict";var t=require("../core"),a=o(t),e=require("../core/textures/Texture"),i=h(e),r=require("../core/textures/BaseTexture"),s=h(r),n=require("../core/utils");function h(t){return t&&t.__esModule?t:{default:t}}function o(t){if(t&&t.__esModule)return t;var a={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(a[e]=t[e]);return a.default=t,a}function c(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var l=a.DisplayObject,d=new a.Matrix;l.prototype._cacheAsBitmap=!1,l.prototype._cacheData=!1;var u=function t(){c(this,t),this.textureCacheId=null,this.originalRenderWebGL=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties(l.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap!==t){this._cacheAsBitmap=t;var a=void 0;t?(this._cacheData||(this._cacheData=new u),(a=this._cacheData).originalRenderWebGL=this.renderWebGL,a.originalRenderCanvas=this.renderCanvas,a.originalUpdateTransform=this.updateTransform,a.originalCalculateBounds=this.calculateBounds,a.originalGetLocalBounds=this.getLocalBounds,a.originalDestroy=this.destroy,a.originalContainsPoint=this.containsPoint,a.originalMask=this._mask,a.originalFilterArea=this.filterArea,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((a=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.renderWebGL=a.originalRenderWebGL,this.renderCanvas=a.originalRenderCanvas,this.calculateBounds=a.originalCalculateBounds,this.getLocalBounds=a.originalGetLocalBounds,this.destroy=a.originalDestroy,this.updateTransform=a.originalUpdateTransform,this.containsPoint=a.originalContainsPoint,this._mask=a.originalMask,this.filterArea=a.originalFilterArea)}}}}),l.prototype._renderCachedWebGL=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderWebGL(t))},l.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.currentRenderer.flush();var r=this.getLocalBounds().clone();if(this._filters&&this._filters.length){var h=this._filters[0].padding;r.pad(h)}r.ceil(a.settings.RESOLUTION);var o=t._activeRenderTarget,c=t.filterManager.filterStack,l=a.RenderTexture.create(r.width,r.height),u="cacheAsBitmap_"+(0,n.uid)();this._cacheData.textureCacheId=u,s.default.addToCache(l.baseTexture,u),i.default.addToCache(l,u);var p=d;p.tx=-r.x,p.ty=-r.y,this.transform.worldTransform.identity(),this.renderWebGL=this._cacheData.originalRenderWebGL,t.render(this,l,!0,p,!0),t.bindRenderTarget(o),t.filterManager.filterStack=c,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var _=new a.Sprite(l);_.transform.worldTransform=this.transform.worldTransform,_.anchor.x=-r.x/r.width,_.anchor.y=-r.y/r.height,_.alpha=e,_._bounds=this._bounds,this._cacheData.sprite=_,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=_.containsPoint.bind(_)}},l.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},l.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),r=this.alpha;this.alpha=1;var h=t.context;e.ceil(a.settings.RESOLUTION);var o=a.RenderTexture.create(e.width,e.height),c="cacheAsBitmap_"+(0,n.uid)();this._cacheData.textureCacheId=c,s.default.addToCache(o.baseTexture,c),i.default.addToCache(o,c);var l=d;this.transform.localTransform.copy(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,o,!0,l,!1),t.context=h,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var u=new a.Sprite(o);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-e.x/e.width,u.anchor.y=-e.y/e.height,u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)}},l.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._lastBoundsID=this._boundsID},l.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},l.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,s.default.removeFromCache(this._cacheData.textureCacheId),i.default.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},l.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};
},{"../core":"RjZD","../core/textures/Texture":"xUki","../core/textures/BaseTexture":"ce6K","../core/utils":"dDI1"}],"yM7h":[function(require,module,exports) {
"use strict";var r=require("../core"),e=t(r);function t(r){if(r&&r.__esModule)return r;var e={};if(null!=r)for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}e.DisplayObject.prototype.name=null,e.Container.prototype.getChildByName=function(r){for(var e=0;e<this.children.length;e++)if(this.children[e].name===r)return this.children[e];return null};
},{"../core":"RjZD"}],"7F5b":[function(require,module,exports) {
"use strict";var t=require("../core"),i=o(t);function o(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(i[o]=t[o]);return i.default=t,i}i.DisplayObject.prototype.getGlobalPosition=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.Point,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.parent?this.parent.toGlobal(this.position,t,o):(t.x=this.position.x,t.y=this.position.y),t};
},{"../core":"RjZD"}],"KRVa":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.BitmapText=exports.TilingSpriteRenderer=exports.TilingSprite=exports.AnimatedSprite=void 0;var e=require("./AnimatedSprite");Object.defineProperty(exports,"AnimatedSprite",{enumerable:!0,get:function(){return n(e).default}});var r=require("./TilingSprite");Object.defineProperty(exports,"TilingSprite",{enumerable:!0,get:function(){return n(r).default}});var t=require("./webgl/TilingSpriteRenderer");Object.defineProperty(exports,"TilingSpriteRenderer",{enumerable:!0,get:function(){return n(t).default}});var i=require("./BitmapText");function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"BitmapText",{enumerable:!0,get:function(){return n(i).default}}),require("./cacheAsBitmap"),require("./getChildByName"),require("./getGlobalPosition");
},{"./AnimatedSprite":"Qekk","./TilingSprite":"+ghv","./webgl/TilingSpriteRenderer":"PpCh","./BitmapText":"qyFb","./cacheAsBitmap":"64fV","./getChildByName":"yM7h","./getGlobalPosition":"7F5b"}],"106G":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../core"),n=o(e),r=require("path");function o(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n.default=e,n}function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function a(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var v=function(e){function n(){return t(this,n),i(this,e.call(this,"\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'))}return a(n,e),n}(n.Filter);exports.default=v;
},{"../../core":"RjZD","path":"UUq2"}],"qmQd":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,n){for(var o=0;o<n.length;o++){var r=n[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,o,r){return o&&e(n.prototype,o),r&&e(n,r),n}}(),n=require("../../core"),o=t(n),r=require("path");function t(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n.default=e,n}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function a(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function u(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var l=function(n){function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random();i(this,o);var t=a(this,n.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));return t.noise=e,t.seed=r,t}return u(o,n),e(o,[{key:"noise",get:function(){return this.uniforms.uNoise},set:function(e){this.uniforms.uNoise=e}},{key:"seed",get:function(){return this.uniforms.uSeed},set:function(e){this.uniforms.uSeed=e}}]),o}(o.Filter);exports.default=l;
},{"../../core":"RjZD","path":"UUq2"}],"fRpE":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),r=require("../../core"),t=o(r),n=require("path");function o(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function i(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function a(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function u(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var l=function(r){function n(e,o){i(this,n);var u=new t.Matrix;e.renderable=!1;var l=a(this,r.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));return l.maskSprite=e,l.maskMatrix=u,l.uniforms.mapSampler=e._texture,l.uniforms.filterMatrix=u,l.uniforms.scale={x:1,y:1},null==o&&(o=20),l.scale=new t.Point(o,o),l}return u(n,r),n.prototype.apply=function(e,r,t){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y,e.applyFilter(this,r,t)},e(n,[{key:"map",get:function(){return this.uniforms.mapSampler},set:function(e){this.uniforms.mapSampler=e}}]),n}(t.Filter);exports.default=l;
},{"../../core":"RjZD","path":"UUq2"}],"Ga9O":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=r;var e=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float strength;","uniform mat3 projectionMatrix;","varying vec2 vBlurTexCoords[%size%];","void main(void)","{","gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);","%blur%","}"].join("\n");function r(r,o){var t=Math.ceil(r/2),i=e,a="",n=void 0;n=o?"vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";for(var s=0;s<r;s++){var x=n.replace("%index%",s);a+=x=x.replace("%sampleIndex%",s-(t-1)+".0"),a+="\n"}return i=(i=i.replace("%blur%",a)).replace("%size%",r)}
},{}],"z7q+":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=l;var e={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},r=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");function l(l){for(var o=e[l],a=o.length,u=r,i="",v=void 0,n=0;n<l;n++){var s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",n);v=n,n>=a&&(v=l-n-1),i+=s=s.replace("%value%",o[v]),i+="\n"}return u=(u=u.replace("%blur%",i)).replace("%size%",l)}
},{}],"39pn":[function(require,module,exports) {
"use strict";function e(e){for(var r=e.getParameter(e.MAX_VARYING_VECTORS),t=15;t>r;)t-=2;return t}exports.__esModule=!0,exports.default=e;
},{}],"Zx84":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),e=require("../../core"),r=f(e),n=require("./generateBlurVertSource"),i=l(n),s=require("./generateBlurFragSource"),u=l(s),o=require("./getMaxBlurKernelSize"),a=l(o);function l(t){return t&&t.__esModule?t:{default:t}}function f(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var y=function(e){function n(t,s,o,a){c(this,n),a=a||5;var l=(0,i.default)(a,!0),f=(0,u.default)(a),p=h(this,e.call(this,l,f));return p.resolution=o||r.settings.RESOLUTION,p._quality=0,p.quality=s||4,p.strength=t||8,p.firstRun=!0,p}return p(n,e),n.prototype.apply=function(t,e,r,n){if(this.firstRun){var s=t.renderer.gl,o=(0,a.default)(s);this.vertexSrc=(0,i.default)(o,!0),this.fragmentSrc=(0,u.default)(o),this.firstRun=!1}if(this.uniforms.strength=1/r.size.width*(r.size.width/e.size.width),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,n);else{for(var l=t.getRenderTarget(!0),f=e,c=l,h=0;h<this.passes-1;h++){t.applyFilter(this,f,c,!0);var p=c;c=f,f=p}t.applyFilter(this,f,r,n),t.returnRenderTarget(l)}},t(n,[{key:"blur",get:function(){return this.strength},set:function(t){this.padding=2*Math.abs(t),this.strength=t}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t}}]),n}(r.Filter);exports.default=y;
},{"../../core":"RjZD","./generateBlurVertSource":"Ga9O","./generateBlurFragSource":"z7q+","./getMaxBlurKernelSize":"39pn"}],"KYHG":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t=require("../../core"),r=f(t),n=require("./generateBlurVertSource"),i=l(n),s=require("./generateBlurFragSource"),u=l(s),o=require("./getMaxBlurKernelSize"),a=l(o);function l(e){return e&&e.__esModule?e:{default:e}}function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=function(t){function n(e,s,o,a){h(this,n),a=a||5;var l=(0,i.default)(a,!1),f=(0,u.default)(a),p=c(this,t.call(this,l,f));return p.resolution=o||r.settings.RESOLUTION,p._quality=0,p.quality=s||4,p.strength=e||8,p.firstRun=!0,p}return p(n,t),n.prototype.apply=function(e,t,r,n){if(this.firstRun){var s=e.renderer.gl,o=(0,a.default)(s);this.vertexSrc=(0,i.default)(o,!1),this.fragmentSrc=(0,u.default)(o),this.firstRun=!1}if(this.uniforms.strength=1/r.size.height*(r.size.height/t.size.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,r,n);else{for(var l=e.getRenderTarget(!0),f=t,h=l,c=0;c<this.passes-1;c++){e.applyFilter(this,f,h,!0);var p=h;h=f,f=p}e.applyFilter(this,f,r,n),e.returnRenderTarget(l)}},e(n,[{key:"blur",get:function(){return this.strength},set:function(e){this.padding=2*Math.abs(e),this.strength=e}},{key:"quality",get:function(){return this._quality},set:function(e){this._quality=e,this.passes=e}}]),n}(r.Filter);exports.default=y;
},{"../../core":"RjZD","./generateBlurVertSource":"Ga9O","./generateBlurFragSource":"z7q+","./getMaxBlurKernelSize":"39pn"}],"//1e":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),e=require("../../core"),r=a(e),n=require("./BlurXFilter"),i=o(n),l=require("./BlurYFilter"),u=o(l);function o(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=function(e){function n(t,l,o,a){s(this,n);var h=b(this,e.call(this));return h.blurXFilter=new i.default(t,l,o,a),h.blurYFilter=new u.default(t,l,o,a),h.padding=0,h.resolution=o||r.settings.RESOLUTION,h.quality=l||4,h.blur=t||8,h}return h(n,e),n.prototype.apply=function(t,e,r){var n=t.getRenderTarget(!0);this.blurXFilter.apply(t,e,n,!0),this.blurYFilter.apply(t,n,r,!1),t.returnRenderTarget(n)},t(n,[{key:"blur",get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"quality",get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t}},{key:"blurX",get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blurY",get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}},{key:"blendMode",get:function(){return this.blurYFilter._blendMode},set:function(t){this.blurYFilter._blendMode=t}}]),n}(r.Filter);exports.default=f;
},{"../../core":"RjZD","./BlurXFilter":"Zx84","./BlurYFilter":"KYHG"}],"fxiT":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(r,n,o){return n&&t(r.prototype,n),o&&t(r,o),r}}(),r=require("../../core"),n=e(r),o=require("path");function e(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r.default=t,r}function i(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function a(t,r){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?t:r}function u(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}var l=function(r){function n(){i(this,n);var t=a(this,r.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));return t.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],t.alpha=1,t}return u(n,r),n.prototype._loadMatrix=function(t){var r=t;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r},n.prototype._multiply=function(t,r,n){return t[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],t[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],t[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],t[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],t[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],t[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],t[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],t[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],t[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],t[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],t[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],t[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],t[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],t[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],t[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],t[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],t[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],t[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],t[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],t[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],t},n.prototype._colorMatrix=function(t){var r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},n.prototype.brightness=function(t,r){var n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)},n.prototype.greyscale=function(t,r){var n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)},n.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},n.prototype.hue=function(t,r){t=(t||0)/180*Math.PI;var n=Math.cos(t),o=Math.sin(t),e=1/3,i=(0,Math.sqrt)(e),a=[n+(1-n)*e,e*(1-n)-i*o,e*(1-n)+i*o,0,0,e*(1-n)+i*o,n+e*(1-n),e*(1-n)-i*o,0,0,e*(1-n)-i*o,e*(1-n)+i*o,n+e*(1-n),0,0,0,0,0,1,0];this._loadMatrix(a,r)},n.prototype.contrast=function(t,r){var n=(t||0)+1,o=-.5*(n-1),e=[n,0,0,0,o,0,n,0,0,o,0,0,n,0,o,0,0,0,1,0];this._loadMatrix(e,r)},n.prototype.saturate=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments[1],n=2*t/3+1,o=-.5*(n-1),e=[n,o,o,0,0,o,n,o,0,0,o,o,n,0,0,0,0,0,1,0];this._loadMatrix(e,r)},n.prototype.desaturate=function(){this.saturate(-1)},n.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},n.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},n.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},n.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},n.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},n.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},n.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},n.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},n.prototype.colorTone=function(t,r,n,o,e){var i=((n=n||16770432)>>16&255)/255,a=(n>>8&255)/255,u=(255&n)/255,l=((o=o||3375104)>>16&255)/255,c=(o>>8&255)/255,s=(255&o)/255,p=[.3,.59,.11,0,0,i,a,u,t=t||.2,0,l,c,s,r=r||.15,0,i-l,a-c,u-s,0,0];this._loadMatrix(p,e)},n.prototype.night=function(t,r){var n=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(n,r)},n.prototype.predator=function(t,r){var n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,r)},n.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},n.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},t(n,[{key:"matrix",get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t}},{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t}}]),n}(n.Filter);exports.default=l,l.prototype.grayscale=l.prototype.greyscale;
},{"../../core":"RjZD","path":"UUq2"}],"GkT9":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t=require("../../core"),r=o(t),n=require("path");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(t){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;i(this,r);var n=a(this,t.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));return n.alpha=e,n.glShaderKey="alpha",n}return u(r,t),e(r,[{key:"alpha",get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e}}]),r}(r.Filter);exports.default=l;
},{"../../core":"RjZD","path":"UUq2"}],"lFUL":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./fxaa/FXAAFilter");Object.defineProperty(exports,"FXAAFilter",{enumerable:!0,get:function(){return o(e).default}});var r=require("./noise/NoiseFilter");Object.defineProperty(exports,"NoiseFilter",{enumerable:!0,get:function(){return o(r).default}});var t=require("./displacement/DisplacementFilter");Object.defineProperty(exports,"DisplacementFilter",{enumerable:!0,get:function(){return o(t).default}});var u=require("./blur/BlurFilter");Object.defineProperty(exports,"BlurFilter",{enumerable:!0,get:function(){return o(u).default}});var l=require("./blur/BlurXFilter");Object.defineProperty(exports,"BlurXFilter",{enumerable:!0,get:function(){return o(l).default}});var i=require("./blur/BlurYFilter");Object.defineProperty(exports,"BlurYFilter",{enumerable:!0,get:function(){return o(i).default}});var n=require("./colormatrix/ColorMatrixFilter");Object.defineProperty(exports,"ColorMatrixFilter",{enumerable:!0,get:function(){return o(n).default}});var a=require("./alpha/AlphaFilter");function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"AlphaFilter",{enumerable:!0,get:function(){return o(a).default}});
},{"./fxaa/FXAAFilter":"106G","./noise/NoiseFilter":"qmQd","./displacement/DisplacementFilter":"fRpE","./blur/BlurFilter":"//1e","./blur/BlurXFilter":"Zx84","./blur/BlurYFilter":"KYHG","./colormatrix/ColorMatrixFilter":"fxiT","./alpha/AlphaFilter":"GkT9"}],"VcKu":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),i=require("../core"),e=n(i);function n(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}function r(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var s=function(){function i(){r(this,i),this.global=new e.Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return i.prototype.getLocalPosition=function(t,i,e){return t.worldTransform.applyInverse(e||this.global,i)},i.prototype.copyEvent=function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},i.prototype.reset=function(){this.isPrimary=!1},t(i,[{key:"pointerId",get:function(){return this.identifier}}]),i}();exports.default=s;
},{"../core":"RjZD"}],"mpmK":[function(require,module,exports) {
"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var n=function(){function n(){t(this,n),this.stopped=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return n.prototype.stopPropagation=function(){this.stopped=!0},n.prototype.reset=function(){this.stopped=!1,this.currentTarget=null,this.target=null},n}();exports.default=n;
},{}],"aVqp":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var e=function(){function e(t){n(this,e),this._pointerId=t,this._flags=e.FLAGS.NONE}return e.prototype._doSet=function(t,n){this._flags=n?this._flags|t:this._flags&~t},t(e,[{key:"pointerId",get:function(){return this._pointerId}},{key:"flags",get:function(){return this._flags},set:function(t){this._flags=t}},{key:"none",get:function(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},set:function(t){this._doSet(this.constructor.FLAGS.OVER,t)}},{key:"rightDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)}},{key:"leftDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)}}]),e}();exports.default=e,e.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4});
},{}],"ya0i":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};
},{}],"IdKE":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=require("../core"),n=d(e),i=require("./InteractionData"),o=v(i),r=require("./InteractionEvent"),s=v(r),a=require("./InteractionTrackingData"),c=v(a),h=require("eventemitter3"),p=v(h),u=require("./interactiveTarget"),l=v(u);function v(t){return t&&t.__esModule?t:{default:t}}function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function E(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.utils.mixins.delayMixin(n.DisplayObject.prototype,l.default);var f=1,y={target:null,data:{global:null}},D=function(e){function i(t,r){m(this,i);var a=P(this,e.call(this));return r=r||{},a.renderer=t,a.autoPreventDefault=void 0===r.autoPreventDefault||r.autoPreventDefault,a.interactionFrequency=r.interactionFrequency||10,a.mouse=new o.default,a.mouse.identifier=f,a.mouse.global.set(-999999),a.activeInteractionData={},a.activeInteractionData[f]=a.mouse,a.interactionDataPool=[],a.eventData=new s.default,a.interactionDOMElement=null,a.moveWhenInside=!1,a.eventsAdded=!1,a.mouseOverRenderer=!1,a.supportsTouchEvents="ontouchstart"in window,a.supportsPointerEvents=!!window.PointerEvent,a.onPointerUp=a.onPointerUp.bind(a),a.processPointerUp=a.processPointerUp.bind(a),a.onPointerCancel=a.onPointerCancel.bind(a),a.processPointerCancel=a.processPointerCancel.bind(a),a.onPointerDown=a.onPointerDown.bind(a),a.processPointerDown=a.processPointerDown.bind(a),a.onPointerMove=a.onPointerMove.bind(a),a.processPointerMove=a.processPointerMove.bind(a),a.onPointerOut=a.onPointerOut.bind(a),a.processPointerOverOut=a.processPointerOverOut.bind(a),a.onPointerOver=a.onPointerOver.bind(a),a.cursorStyles={default:"inherit",pointer:"pointer"},a.currentCursorMode=null,a.cursor=null,a._tempPoint=new n.Point,a.resolution=1,a.setTargetElement(a.renderer.view,a.renderer.resolution),a}return E(i,e),i.prototype.hitTest=function(t,e){return y.target=null,y.data.global=t,e||(e=this.renderer._lastObjectRendered),this.processInteractive(y,e,null,!0),y.target},i.prototype.setTargetElement=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents()},i.prototype.addEvents=function(){this.interactionDOMElement&&(n.ticker.shared.add(this.update,this,n.UPDATE_PRIORITY.INTERACTION),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},i.prototype.removeEvents=function(){this.interactionDOMElement&&(n.ticker.shared.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},i.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var e in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var n=this.activeInteractionData[e];if(n.originalEvent&&"touch"!==n.pointerType){var i=this.configureInteractionEventForDOMEvent(this.eventData,n.originalEvent,n);this.processInteractive(i,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},i.prototype.setCursorMode=function(e){if(e=e||"default",this.currentCursorMode!==e){this.currentCursorMode=e;var n=this.cursorStyles[e];if(n)switch(void 0===n?"undefined":t(n)){case"string":this.interactionDOMElement.style.cursor=n;break;case"function":n(e);break;case"object":Object.assign(this.interactionDOMElement.style,n)}else"string"!=typeof e||Object.prototype.hasOwnProperty.call(this.cursorStyles,e)||(this.interactionDOMElement.style.cursor=e)}},i.prototype.dispatchEvent=function(t,e,n){n.stopped||(n.currentTarget=t,n.type=e,t.emit(e,n),t[e]&&t[e](n))},i.prototype.mapPositionToPoint=function(t,e,n){var i=void 0;i=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var o=navigator.isCocoonJS?this.resolution:1/this.resolution;t.x=(e-i.left)*(this.interactionDOMElement.width/i.width)*o,t.y=(n-i.top)*(this.interactionDOMElement.height/i.height)*o},i.prototype.processInteractive=function(t,e,n,i,o){if(!e||!e.visible)return!1;var r=t.data.global,s=!1,a=o=e.interactive||o,c=!0;if(e.hitArea?(i&&(e.worldTransform.applyInverse(r,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:(i=!1,c=!1)),a=!1):e._mask&&i&&(e._mask.containsPoint(r)||(i=!1,c=!1)),c&&e.interactiveChildren&&e.children)for(var h=e.children,p=h.length-1;p>=0;p--){var u=h[p],l=this.processInteractive(t,u,n,i,a);if(l){if(!u.parent)continue;a=!1,l&&(t.target&&(i=!1),s=!0)}}return o&&(i&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(r)&&(s=!0),e.interactive&&(s&&!t.target&&(t.target=e),n&&n(t,e,!!s))),s},i.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&t.preventDefault();for(var n=e.length,i=0;i<n;i++){var o=e[i],r=this.getInteractionDataForPointerId(o),s=this.configureInteractionEventForDOMEvent(this.eventData,o,r);if(s.data.originalEvent=t,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===o.pointerType)this.emit("touchstart",s);else if("mouse"===o.pointerType||"pen"===o.pointerType){var a=2===o.button;this.emit(a?"rightdown":"mousedown",this.eventData)}}}},i.prototype.processPointerDown=function(t,e,n){var i=t.data,o=t.data.identifier;if(n)if(e.trackedPointers[o]||(e.trackedPointers[o]=new c.default(o)),this.dispatchEvent(e,"pointerdown",t),"touch"===i.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===i.pointerType||"pen"===i.pointerType){var r=2===i.button;r?e.trackedPointers[o].rightDown=!0:e.trackedPointers[o].leftDown=!0,this.dispatchEvent(e,r?"rightdown":"mousedown",t)}},i.prototype.onPointerComplete=function(t,e,n){for(var i=this.normalizeToPointerData(t),o=i.length,r=t.target!==this.interactionDOMElement?"outside":"",s=0;s<o;s++){var a=i[s],c=this.getInteractionDataForPointerId(a),h=this.configureInteractionEventForDOMEvent(this.eventData,a,c);if(h.data.originalEvent=t,this.processInteractive(h,this.renderer._lastObjectRendered,n,e||!r),this.emit(e?"pointercancel":"pointerup"+r,h),"mouse"===a.pointerType||"pen"===a.pointerType){var p=2===a.button;this.emit(p?"rightup"+r:"mouseup"+r,h)}else"touch"===a.pointerType&&(this.emit(e?"touchcancel":"touchend"+r,h),this.releaseInteractionDataForPointerId(a.pointerId,c))}},i.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},i.prototype.processPointerCancel=function(t,e){var n=t.data,i=t.data.identifier;void 0!==e.trackedPointers[i]&&(delete e.trackedPointers[i],this.dispatchEvent(e,"pointercancel",t),"touch"===n.pointerType&&this.dispatchEvent(e,"touchcancel",t))},i.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},i.prototype.processPointerUp=function(t,e,n){var i=t.data,o=t.data.identifier,r=e.trackedPointers[o],s="touch"===i.pointerType,a="mouse"===i.pointerType||"pen"===i.pointerType,h=!1;if(a){var p=2===i.button,u=c.default.FLAGS,l=p?u.RIGHT_DOWN:u.LEFT_DOWN,v=void 0!==r&&r.flags&l;n?(this.dispatchEvent(e,p?"rightup":"mouseup",t),v&&(this.dispatchEvent(e,p?"rightclick":"click",t),h=!0)):v&&this.dispatchEvent(e,p?"rightupoutside":"mouseupoutside",t),r&&(p?r.rightDown=!1:r.leftDown=!1)}n?(this.dispatchEvent(e,"pointerup",t),s&&this.dispatchEvent(e,"touchend",t),r&&(a&&!h||this.dispatchEvent(e,"pointertap",t),s&&(this.dispatchEvent(e,"tap",t),r.over=!1))):r&&(this.dispatchEvent(e,"pointerupoutside",t),s&&this.dispatchEvent(e,"touchendoutside",t)),r&&r.none&&delete e.trackedPointers[o]},i.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this.didMove=!0,this.cursor=null);for(var n=e.length,i=0;i<n;i++){var o=e[i],r=this.getInteractionDataForPointerId(o),s=this.configureInteractionEventForDOMEvent(this.eventData,o,r);s.data.originalEvent=t;var a="touch"!==o.pointerType||this.moveWhenInside;this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerMove,a),this.emit("pointermove",s),"touch"===o.pointerType&&this.emit("touchmove",s),"mouse"!==o.pointerType&&"pen"!==o.pointerType||this.emit("mousemove",s)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},i.prototype.processPointerMove=function(t,e,n){var i=t.data,o="touch"===i.pointerType,r="mouse"===i.pointerType||"pen"===i.pointerType;r&&this.processPointerOverOut(t,e,n),this.moveWhenInside&&!n||(this.dispatchEvent(e,"pointermove",t),o&&this.dispatchEvent(e,"touchmove",t),r&&this.dispatchEvent(e,"mousemove",t))},i.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var n=this.getInteractionDataForPointerId(e),i=this.configureInteractionEventForDOMEvent(this.eventData,e,n);i.data.originalEvent=e,this.processInteractive(i,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",i),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",i):this.releaseInteractionDataForPointerId(n.identifier)}},i.prototype.processPointerOverOut=function(t,e,n){var i=t.data,o=t.data.identifier,r="mouse"===i.pointerType||"pen"===i.pointerType,s=e.trackedPointers[o];n&&!s&&(s=e.trackedPointers[o]=new c.default(o)),void 0!==s&&(n&&this.mouseOverRenderer?(s.over||(s.over=!0,this.dispatchEvent(e,"pointerover",t),r&&this.dispatchEvent(e,"mouseover",t)),r&&null===this.cursor&&(this.cursor=e.cursor)):s.over&&(s.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),r&&this.dispatchEvent(e,"mouseout",t),s.none&&delete e.trackedPointers[o]))},i.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],n=this.getInteractionDataForPointerId(e),i=this.configureInteractionEventForDOMEvent(this.eventData,e,n);i.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",i),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",i)},i.prototype.getInteractionDataForPointerId=function(t){var e=t.pointerId,n=void 0;return e===f||"mouse"===t.pointerType?n=this.mouse:this.activeInteractionData[e]?n=this.activeInteractionData[e]:((n=this.interactionDataPool.pop()||new o.default).identifier=e,this.activeInteractionData[e]=n),n.copyEvent(t),n},i.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},i.prototype.configureInteractionEventForDOMEvent=function(t,e,n){return t.data=n,this.mapPositionToPoint(n.global,e.clientX,e.clientY),navigator.isCocoonJS&&"touch"===e.pointerType&&(n.global.x=n.global.x/this.resolution,n.global.y=n.global.y/this.resolution),"touch"===e.pointerType&&(e.globalX=n.global.x,e.globalY=n.global.y),n.originalEvent=e,t.reset(),t},i.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var n=0,i=t.changedTouches.length;n<i;n++){var o=t.changedTouches[n];void 0===o.button&&(o.button=t.touches.length?1:0),void 0===o.buttons&&(o.buttons=t.touches.length?1:0),void 0===o.isPrimary&&(o.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===o.width&&(o.width=o.radiusX||1),void 0===o.height&&(o.height=o.radiusY||1),void 0===o.tiltX&&(o.tiltX=0),void 0===o.tiltY&&(o.tiltY=0),void 0===o.pointerType&&(o.pointerType="touch"),void 0===o.pointerId&&(o.pointerId=o.identifier||0),void 0===o.pressure&&(o.pressure=o.force||.5),void 0===o.twist&&(o.twist=0),void 0===o.tangentialPressure&&(o.tangentialPressure=0),void 0===o.layerX&&(o.layerX=o.offsetX=o.clientX),void 0===o.layerY&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,e.push(o)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):(void 0===t.isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=f),void 0===t.pressure&&(t.pressure=.5),void 0===t.twist&&(t.twist=0),void 0===t.tangentialPressure&&(t.tangentialPressure=0),t.isNormalized=!0,e.push(t));return e},i.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null},i}(p.default);exports.default=D,n.WebGLRenderer.registerPlugin("interaction",D),n.CanvasRenderer.registerPlugin("interaction",D);
},{"../core":"RjZD","./InteractionData":"VcKu","./InteractionEvent":"mpmK","./InteractionTrackingData":"aVqp","eventemitter3":"2JJl","./interactiveTarget":"ya0i"}],"/j6N":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./InteractionData");Object.defineProperty(exports,"InteractionData",{enumerable:!0,get:function(){return i(e).default}});var t=require("./InteractionManager");Object.defineProperty(exports,"InteractionManager",{enumerable:!0,get:function(){return i(t).default}});var r=require("./interactiveTarget");Object.defineProperty(exports,"interactiveTarget",{enumerable:!0,get:function(){return i(r).default}});var n=require("./InteractionTrackingData");Object.defineProperty(exports,"InteractionTrackingData",{enumerable:!0,get:function(){return i(n).default}});var a=require("./InteractionEvent");function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"InteractionEvent",{enumerable:!0,get:function(){return i(a).default}});
},{"./InteractionData":"VcKu","./InteractionManager":"IdKE","./interactiveTarget":"ya0i","./InteractionTrackingData":"aVqp","./InteractionEvent":"mpmK"}],"vKdq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function n(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();function t(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var e=function(){function e(n,i,r){void 0===i&&(i=!1),t(this,e),this._fn=n,this._once=i,this._thisArg=r,this._next=this._prev=this._owner=null}return n(e,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),e}();function i(n,t){return n._head?(n._tail._next=t,t._prev=n._tail,n._tail=t):(n._head=t,n._tail=t),t._owner=n,t}var r=function(){function r(){t(this,r),this._head=this._tail=void 0}return n(r,[{key:"handlers",value:function(){var n=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this._head;if(n)return!!t;for(var e=[];t;)e.push(t),t=t._next;return e}},{key:"has",value:function(n){if(!(n instanceof e))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return n._owner===this}},{key:"dispatch",value:function(){var n=this._head;if(!n)return!1;for(;n;)n._once&&this.detach(n),n._fn.apply(n._thisArg,arguments),n=n._next;return!0}},{key:"add",value:function(n){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof n)throw new Error("MiniSignal#add(): First arg must be a Function.");return i(this,new e(n,!1,t))}},{key:"once",value:function(n){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof n)throw new Error("MiniSignal#once(): First arg must be a Function.");return i(this,new e(n,!0,t))}},{key:"detach",value:function(n){if(!(n instanceof e))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return n._owner!==this?this:(n._prev&&(n._prev._next=n._next),n._next&&(n._next._prev=n._prev),n===this._head?(this._head=n._next,null===n._next&&(this._tail=null)):n===this._tail&&(this._tail=n._prev,this._tail._next=null),n._owner=null,this)}},{key:"detachAll",value:function(){var n=this._head;if(!n)return this;for(this._head=this._tail=null;n;)n._owner=null,n=n._next;return this}}]),r}();r.MiniSignalBinding=e,exports.default=r,module.exports=exports.default;
},{}],"01sX":[function(require,module,exports) {
"use strict";module.exports=function(e,r){r=r||{};for(var o={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},t=o.parser[r.strictMode?"strict":"loose"].exec(e),s={},a=14;a--;)s[o.key[a]]=t[a]||"";return s[o.q.name]={},s[o.key[12]].replace(o.q.parser,function(e,r,t){r&&(s[o.q.name][r]=t)}),s};
},{}],"bC3n":[function(require,module,exports) {
"use strict";function n(){}function t(n,t,e,r){var u=0,s=n.length;!function a(c){c||u===s?e&&e(c):r?setTimeout(function(){t(n[u++],a)},1):t(n[u++],a)}()}function e(n){return function(){if(null===n)throw new Error("Callback was already called.");var t=n;n=null,t.apply(this,arguments)}}function r(t,r){if(null==r)r=1;else if(0===r)throw new Error("Concurrency must not be zero");var u=0,s={_tasks:[],concurrency:r,saturated:n,unsaturated:n,buffer:r/4,empty:n,drain:n,error:n,started:!1,paused:!1,push:function(n,t){a(n,!1,t)},kill:function(){u=0,s.drain=n,s.started=!1,s._tasks=[]},unshift:function(n,t){a(n,!0,t)},process:function(){for(;!s.paused&&u<s.concurrency&&s._tasks.length;){var n=s._tasks.shift();0===s._tasks.length&&s.empty(),(u+=1)===s.concurrency&&s.saturated(),t(n.data,e(c(n)))}},length:function(){return s._tasks.length},running:function(){return u},idle:function(){return s._tasks.length+u===0},pause:function(){!0!==s.paused&&(s.paused=!0)},resume:function(){if(!1!==s.paused){s.paused=!1;for(var n=1;n<=s.concurrency;n++)s.process()}}};function a(t,e,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(s.started=!0,null==t&&s.idle())setTimeout(function(){return s.drain()},1);else{var u={data:t,callback:"function"==typeof r?r:n};e?s._tasks.unshift(u):s._tasks.push(u),setTimeout(function(){return s.process()},1)}}function c(n){return function(){u-=1,n.callback.apply(n,arguments),null!=arguments[0]&&s.error(arguments[0],n.data),u<=s.concurrency-s.buffer&&s.unsaturated(),s.idle()&&s.drain(),s.process()}}return s}exports.__esModule=!0,exports.eachSeries=t,exports.queue=r;
},{}],"F/bs":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.Resource=void 0;var t=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),e=require("parse-uri"),i=o(e),r=require("mini-signals"),s=o(r);function o(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),h=null,E=0,d=200,u=204,_=1223,l=2;function p(){}var T=exports.Resource=function(){function e(t,i,r){if(n(this,e),"string"!=typeof t||"string"!=typeof i)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(e.STATUS_FLAGS.DATA_URL,0===i.indexOf("data:")),this.name=t,this.url=i,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=e.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=p,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new s.default,this.onProgress=new s.default,this.onComplete=new s.default,this.onAfterMiddleware=new s.default}return e.setExtensionLoadType=function(t,i){O(e._loadTypeMap,t,i)},e.setExtensionXhrType=function(t,i){O(e._xhrTypeMap,t,i)},e.prototype.complete=function(){this._clearEvents(),this._finish()},e.prototype.abort=function(t){if(!this.error){if(this.error=new Error(t),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=e.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.prototype.load=function(t){var i=this;if(!this.isLoading)if(this.isComplete)t&&setTimeout(function(){return t(i)},1);else switch(t&&this.onComplete.once(t),this._setFlag(e.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case e.LOAD_TYPE.IMAGE:this.type=e.TYPE.IMAGE,this._loadElement("image");break;case e.LOAD_TYPE.AUDIO:this.type=e.TYPE.AUDIO,this._loadSourceElement("audio");break;case e.LOAD_TYPE.VIDEO:this.type=e.TYPE.VIDEO,this._loadSourceElement("video");break;case e.LOAD_TYPE.XHR:default:a&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e.prototype._hasFlag=function(t){return 0!=(this._flags&t)},e.prototype._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(e.STATUS_FLAGS.COMPLETE,!0),this._setFlag(e.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e.prototype._loadElement=function(t){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===t&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e.prototype._loadSourceElement=function(t){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(t,this.url[i],Array.isArray(e)?e[i]:e));else{var r=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(r)?r[0]:r))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),t.timeout=this.timeout,this.xhrType===e.XHR_RESPONSE_TYPE.JSON||this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=e.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("timeout",this._boundXhrOnTimeout,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},e.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},e.prototype._createSource=function(t,e,i){i||(i=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=i,r},e.prototype._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e.prototype._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e.prototype._onTimeout=function(){this.abort("Load timed out.")},e.prototype._xhrOnError=function(){var t=this.xhr;this.abort(m(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e.prototype._xhrOnTimeout=function(){var t=this.xhr;this.abort(m(t)+" Request timed out.")},e.prototype._xhrOnAbort=function(){var t=this.xhr;this.abort(m(t)+" Request was aborted by the user.")},e.prototype._xhrOnLoad=function(){var t=this.xhr,i="",r=void 0===t.status?d:t.status;if(""!==t.responseType&&"text"!==t.responseType&&void 0!==t.responseType||(i=t.responseText),r===E&&(i.length>0||t.responseType===e.XHR_RESPONSE_TYPE.BUFFER)?r=d:r===_&&(r=u),(r/100|0)===l){if(this.xhrType===e.XHR_RESPONSE_TYPE.TEXT)this.data=i,this.type=e.TYPE.TEXT;else if(this.xhrType===e.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(i),this.type=e.TYPE.JSON}catch(n){return void this.abort("Error trying to parse loaded json: "+n)}else if(this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var s=new DOMParser;this.data=s.parseFromString(i,"text/xml")}else{var o=document.createElement("div");o.innerHTML=i,this.data=o}this.type=e.TYPE.XML}catch(n){return void this.abort("Error trying to parse loaded xml: "+n)}else this.data=t.response||i;this.complete()}else this.abort("["+t.status+"] "+t.statusText+": "+t.responseURL)},e.prototype._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";e=e||window.location,h||(h=document.createElement("a")),h.href=t;var r=!(t=(0,i.default)(h.href,{strictMode:!0})).port&&""===e.port||t.port===e.port,s=t.protocol?t.protocol+":":"";return t.host===e.hostname&&r&&s===e.protocol?"":"anonymous"},e.prototype._determineXhrType=function(){return e._xhrTypeMap[this.extension]||e.XHR_RESPONSE_TYPE.TEXT},e.prototype._determineLoadType=function(){return e._loadTypeMap[this.extension]||e.LOAD_TYPE.XHR},e.prototype._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var i=t.indexOf("/");e=t.substring(i+1,t.indexOf(";",i))}else{var r=t.indexOf("?"),s=t.indexOf("#"),o=Math.min(r>-1?r:t.length,s>-1?s:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e.prototype._getMimeFromXhrType=function(t){switch(t){case e.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case e.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case e.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case e.XHR_RESPONSE_TYPE.JSON:return"application/json";case e.XHR_RESPONSE_TYPE.DEFAULT:case e.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},t(e,[{key:"isDataUrl",get:function(){return this._hasFlag(e.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(e.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(e.STATUS_FLAGS.LOADING)}}]),e}();function O(t,e,i){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=i)}function m(t){return t.toString().replace("object ","")}T.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},T.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},T.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},T.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},T._loadTypeMap={gif:T.LOAD_TYPE.IMAGE,png:T.LOAD_TYPE.IMAGE,bmp:T.LOAD_TYPE.IMAGE,jpg:T.LOAD_TYPE.IMAGE,jpeg:T.LOAD_TYPE.IMAGE,tif:T.LOAD_TYPE.IMAGE,tiff:T.LOAD_TYPE.IMAGE,webp:T.LOAD_TYPE.IMAGE,tga:T.LOAD_TYPE.IMAGE,svg:T.LOAD_TYPE.IMAGE,"svg+xml":T.LOAD_TYPE.IMAGE,mp3:T.LOAD_TYPE.AUDIO,ogg:T.LOAD_TYPE.AUDIO,wav:T.LOAD_TYPE.AUDIO,mp4:T.LOAD_TYPE.VIDEO,webm:T.LOAD_TYPE.VIDEO},T._xhrTypeMap={xhtml:T.XHR_RESPONSE_TYPE.DOCUMENT,html:T.XHR_RESPONSE_TYPE.DOCUMENT,htm:T.XHR_RESPONSE_TYPE.DOCUMENT,xml:T.XHR_RESPONSE_TYPE.DOCUMENT,tmx:T.XHR_RESPONSE_TYPE.DOCUMENT,svg:T.XHR_RESPONSE_TYPE.DOCUMENT,tsx:T.XHR_RESPONSE_TYPE.DOCUMENT,gif:T.XHR_RESPONSE_TYPE.BLOB,png:T.XHR_RESPONSE_TYPE.BLOB,bmp:T.XHR_RESPONSE_TYPE.BLOB,jpg:T.XHR_RESPONSE_TYPE.BLOB,jpeg:T.XHR_RESPONSE_TYPE.BLOB,tif:T.XHR_RESPONSE_TYPE.BLOB,tiff:T.XHR_RESPONSE_TYPE.BLOB,webp:T.XHR_RESPONSE_TYPE.BLOB,tga:T.XHR_RESPONSE_TYPE.BLOB,json:T.XHR_RESPONSE_TYPE.JSON,text:T.XHR_RESPONSE_TYPE.TEXT,txt:T.XHR_RESPONSE_TYPE.TEXT,ttf:T.XHR_RESPONSE_TYPE.BUFFER,otf:T.XHR_RESPONSE_TYPE.BUFFER},T.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==","undefined"!=typeof module&&(module.exports.default=T);
},{"parse-uri":"01sX","mini-signals":"vKdq"}],"KNjQ":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.Loader=void 0;var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),t=require("mini-signals"),o=h(t),s=require("parse-uri"),n=h(s),i=require("./async"),u=l(i),a=require("./Resource");function l(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function h(e){return e&&e.__esModule?e:{default:e}}function d(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var f=100,c=/(#[\w-]+)?$/,p=exports.Loader=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;d(this,t),this.baseUrl=r,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(r,t){return e._loadResource(r,t)},this._queue=u.queue(this._boundLoadResource,s),this._queue.pause(),this.resources={},this.onProgress=new o.default,this.onError=new o.default,this.onLoad=new o.default,this.onStart=new o.default,this.onComplete=new o.default;for(var n=0;n<t._defaultBeforeMiddleware.length;++n)this.pre(t._defaultBeforeMiddleware[n]);for(var i=0;i<t._defaultAfterMiddleware.length;++i)this.use(t._defaultAfterMiddleware[i])}return t.prototype.add=function(r,t,o,s){if(Array.isArray(r)){for(var n=0;n<r.length;++n)this.add(r[n]);return this}if("object"===(void 0===r?"undefined":e(r))&&(s=t||r.callback||r.onComplete,o=r,t=r.url,r=r.name||r.key||r.url),"string"!=typeof t&&(s=o,o=t,t=r),"string"!=typeof t)throw new Error("No url passed to add resource to loader.");if("function"==typeof o&&(s=o,o=null),this.loading&&(!o||!o.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[r])throw new Error('Resource named "'+r+'" already exists.');if(t=this._prepareUrl(t),this.resources[r]=new a.Resource(r,t,o),"function"==typeof s&&this.resources[r].onAfterMiddleware.once(s),this.loading){for(var i=o.parentResource,u=[],l=0;l<i.children.length;++l)i.children[l].isComplete||u.push(i.children[l]);var h=i.progressChunk*(u.length+1)/(u.length+2);i.children.push(this.resources[r]),i.progressChunk=h;for(var d=0;d<u.length;++d)u[d].progressChunk=h;this.resources[r].progressChunk=h}return this._queue.push(this.resources[r]),this},t.prototype.pre=function(e){return this._beforeMiddleware.push(e),this},t.prototype.use=function(e){return this._afterMiddleware.push(e),this},t.prototype.reset=function(){for(var e in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var r=this.resources[e];r._onLoadBinding&&r._onLoadBinding.detach(),r.isLoading&&r.abort()}return this.resources={},this},t.prototype.load=function(e){if("function"==typeof e&&this.onComplete.once(e),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var r=this._queue._tasks.length,t=f/r,o=0;o<this._queue._tasks.length;++o)this._queue._tasks[o].data.progressChunk=t;this._onStart(),this._queue.resume()}return this},t.prototype._prepareUrl=function(e){var r=(0,n.default)(e,{strictMode:!0}),t=void 0;if(t=r.protocol||!r.path||0===e.indexOf("//")?e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==e.charAt(0)?this.baseUrl+"/"+e:this.baseUrl+e,this.defaultQueryString){var o=c.exec(t)[0];-1!==(t=t.substr(0,t.length-o.length)).indexOf("?")?t+="&"+this.defaultQueryString:t+="?"+this.defaultQueryString,t+=o}return t},t.prototype._loadResource=function(e,r){var t=this;e._dequeue=r,u.eachSeries(this._beforeMiddleware,function(r,o){r.call(t,e,function(){o(e.isComplete?{}:null)})},function(){e.isComplete?t._onLoad(e):(e._onLoadBinding=e.onComplete.once(t._onLoad,t),e.load())},!0)},t.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t.prototype._onComplete=function(){this.progress=f,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t.prototype._onLoad=function(e){var r=this;e._onLoadBinding=null,this._resourcesParsing.push(e),e._dequeue(),u.eachSeries(this._afterMiddleware,function(t,o){t.call(r,e,o)},function(){e.onAfterMiddleware.dispatch(e),r.progress=Math.min(f,r.progress+e.progressChunk),r.onProgress.dispatch(r,e),e.error?r.onError.dispatch(e.error,r,e):r.onLoad.dispatch(r,e),r._resourcesParsing.splice(r._resourcesParsing.indexOf(e),1),r._queue.idle()&&0===r._resourcesParsing.length&&r._onComplete()},!0)},r(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e}}]),t}();p._defaultBeforeMiddleware=[],p._defaultAfterMiddleware=[],p.pre=function(e){return p._defaultBeforeMiddleware.push(e),p},p.use=function(e){return p._defaultAfterMiddleware.push(e),p};
},{"mini-signals":"vKdq","parse-uri":"01sX","./async":"bC3n","./Resource":"F/bs"}],"5Wbt":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.encodeBinary=r;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(r){for(var t="",o=0;o<r.length;){for(var n=[0,0,0],a=[0,0,0,0],l=0;l<n.length;++l)o<r.length?n[l]=255&r.charCodeAt(o++):n[l]=0;switch(a[0]=n[0]>>2,a[1]=(3&n[0])<<4|n[1]>>4,a[2]=(15&n[1])<<2|n[2]>>6,a[3]=63&n[2],o-(r.length-1)){case 2:a[3]=64,a[2]=64;break;case 1:a[3]=64}for(var s=0;s<a.length;++s)t+=e.charAt(a[s])}return t}"undefined"!=typeof module&&(module.exports.default=r);
},{}],"6Jqp":[function(require,module,exports) {
"use strict";var e=require("./Loader").Loader,r=require("./Resource").Resource,o=require("./async"),u=require("./b64");e.Resource=r,e.async=o,e.encodeBinary=u,e.base64=u,module.exports=e,module.exports.Loader=e,module.exports.default=e;
},{"./Loader":"KNjQ","./Resource":"F/bs","./async":"bC3n","./b64":"5Wbt"}],"Eh8S":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.parse=s,exports.default=function(){return function(e,r){if(e.data&&e.type===a.Resource.TYPE.XML)if(0!==e.data.getElementsByTagName("page").length&&0!==e.data.getElementsByTagName("info").length&&null!==e.data.getElementsByTagName("info")[0].getAttribute("face")){var i=e.isDataUrl?"":t.dirname(e.url);e.isDataUrl&&("."===i&&(i=""),this.baseUrl&&i&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(i+="/")),(i=i.replace(this.baseUrl,""))&&"/"!==i.charAt(i.length-1)&&(i+="/");for(var l=e.data.getElementsByTagName("page"),n={},o=function(t){n[t.metadata.pageFile]=t.texture,Object.keys(n).length===l.length&&(s(e,n),r())},u=0;u<l.length;++u){var g=l[u].getAttribute("file"),d=i+g,c=!1;for(var f in this.resources){var p=this.resources[f];if(p.url===d){p.metadata.pageFile=g,p.texture?o(p):p.onAfterMiddleware.add(o),c=!0;break}}if(!c){var h={crossOrigin:e.crossOrigin,loadType:a.Resource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:g},e.metadata.imageMetadata),parentResource:e};this.add(d,h,o)}}}else r();else r()}};var e=require("path"),t=i(e),a=require("resource-loader"),r=require("../extras");function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e,t){e.bitmapFont=r.BitmapText.registerFont(e.data,t)}
},{"path":"UUq2","resource-loader":"6Jqp","../extras":"KRVa"}],"ESZJ":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=function(){return function(r,t){var s=r.name+"_image";if(r.data&&r.type===e.Resource.TYPE.JSON&&r.data.frames&&!this.resources[s]){var i={crossOrigin:r.crossOrigin,metadata:r.metadata.imageMetadata,parentResource:r},o=u(r,this.baseUrl);this.add(s,o,i,function(e){if(e.error)t(e.error);else{var s=new a.Spritesheet(e.texture.baseTexture,r.data,r.url);s.parse(function(){r.spritesheet=s,r.textures=s.textures,t()})}})}else t()}},exports.getResourcePath=u;var e=require("resource-loader"),r=require("url"),t=s(r),a=require("../core");function s(e){return e&&e.__esModule?e:{default:e}}function u(e,r){return e.isDataUrl?e.data.meta.image:t.default.resolve(e.url.replace(r,""),e.data.meta.image)}
},{"resource-loader":"6Jqp","url":"Mej7","../core":"RjZD"}],"08UO":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default=function(){return function(r,u){r.data&&r.type===e.Resource.TYPE.IMAGE&&(r.texture=t.default.fromLoader(r.data,r.url,r.name)),u()}};var e=require("resource-loader"),r=require("../core/textures/Texture"),t=u(r);function u(e){return e&&e.__esModule?e:{default:e}}
},{"resource-loader":"6Jqp","../core/textures/Texture":"xUki"}],"bkHk":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.blobMiddlewareFactory=o;var e=require("../../Resource"),a=require("../../b64"),t=window.URL||window.webkitURL;function o(){return function(o,r){if(o.data){if(o.xhr&&o.xhrType===e.Resource.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof o.data){if(0===o.data.type.indexOf("image")){var n=t.createObjectURL(o.data);return o.blob=o.data,o.data=new Image,o.data.src=n,o.type=e.Resource.TYPE.IMAGE,void(o.data.onload=function(){t.revokeObjectURL(n),o.data.onload=null,r()})}}else{var d=o.xhr.getResponseHeader("content-type");if(d&&0===d.indexOf("image"))return o.data=new Image,o.data.src="data:"+d+";base64,"+(0,a.encodeBinary)(o.xhr.responseText),o.type=e.Resource.TYPE.IMAGE,void(o.data.onload=function(){o.data.onload=null,r()})}r()}else r()}}
},{"../../Resource":"F/bs","../../b64":"5Wbt"}],"MfA+":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("resource-loader"),r=f(e),t=require("resource-loader/lib/middlewares/parsing/blob"),o=require("eventemitter3"),n=f(o),i=require("./textureParser"),a=f(i),u=require("./spritesheetParser"),s=f(u),l=require("./bitmapFontParser"),d=f(l);function f(e){return e&&e.__esModule?e:{default:e}}function c(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function p(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function y(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var b=function(e){function r(t,o){c(this,r);var i=p(this,e.call(this,t,o));n.default.call(i);for(var a=0;a<r._pixiMiddleware.length;++a)i.use(r._pixiMiddleware[a]());return i.onStart.add(function(e){return i.emit("start",e)}),i.onProgress.add(function(e,r){return i.emit("progress",e,r)}),i.onError.add(function(e,r,t){return i.emit("error",e,r,t)}),i.onLoad.add(function(e,r){return i.emit("load",e,r)}),i.onComplete.add(function(e,r){return i.emit("complete",e,r)}),i}return y(r,e),r.addPixiMiddleware=function(e){r._pixiMiddleware.push(e)},r.prototype.destroy=function(){this.removeAllListeners(),this.reset()},r}(r.default);for(var h in exports.default=b,n.default.prototype)b.prototype[h]=n.default.prototype[h];b._pixiMiddleware=[t.blobMiddlewareFactory,a.default,s.default,d.default];var w=r.default.Resource;w.setExtensionXhrType("fnt",w.XHR_RESPONSE_TYPE.DOCUMENT);
},{"resource-loader":"6Jqp","resource-loader/lib/middlewares/parsing/blob":"bkHk","eventemitter3":"2JJl","./textureParser":"08UO","./spritesheetParser":"ESZJ","./bitmapFontParser":"Eh8S"}],"PK7H":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.shared=exports.Resource=exports.textureParser=exports.getResourcePath=exports.spritesheetParser=exports.parseBitmapFontData=exports.bitmapFontParser=exports.Loader=void 0;var e=require("./bitmapFontParser");Object.defineProperty(exports,"bitmapFontParser",{enumerable:!0,get:function(){return i(e).default}}),Object.defineProperty(exports,"parseBitmapFontData",{enumerable:!0,get:function(){return e.parse}});var r=require("./spritesheetParser");Object.defineProperty(exports,"spritesheetParser",{enumerable:!0,get:function(){return i(r).default}}),Object.defineProperty(exports,"getResourcePath",{enumerable:!0,get:function(){return r.getResourcePath}});var t=require("./textureParser");Object.defineProperty(exports,"textureParser",{enumerable:!0,get:function(){return i(t).default}});var o=require("resource-loader");Object.defineProperty(exports,"Resource",{enumerable:!0,get:function(){return o.Resource}});var a=require("../core/Application"),s=i(a),n=require("./loader"),u=i(n);function i(e){return e&&e.__esModule?e:{default:e}}exports.Loader=u.default;var p=new u.default;p.destroy=function(){},exports.shared=p;var d=s.default.prototype;d._loader=null,Object.defineProperty(d,"loader",{get:function(){if(!this._loader){var e=this._options.sharedLoader;this._loader=e?p:new u.default}return this._loader}}),d._parentDestroy=d.destroy,d.destroy=function(e,r){this._loader&&(this._loader.destroy(),this._loader=null),this._parentDestroy(e,r)};
},{"./bitmapFontParser":"Eh8S","./spritesheetParser":"ESZJ","./textureParser":"08UO","resource-loader":"6Jqp","../core/Application":"Y4lo","./loader":"MfA+"}],"esRn":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),e=require("../core"),r=s(e),n=require("../core/textures/Texture"),i=o(n);function o(t){return t&&t.__esModule?t:{default:t}}function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=new r.Point,c=new r.Polygon,h=function(e){function n(t,o,s,f,l){u(this,n);var c=a(this,e.call(this));return c._texture=t||i.default.EMPTY,c.uvs=s||new Float32Array([0,0,1,0,1,1,0,1]),c.vertices=o||new Float32Array([0,0,100,0,100,100,0,100]),c.indices=f||new Uint16Array([0,1,3,2]),c.dirty=0,c.indexDirty=0,c.vertexDirty=0,c.autoUpdate=!0,c.blendMode=r.BLEND_MODES.NORMAL,c.canvasPadding=r.settings.MESH_CANVAS_PADDING,c.drawMode=l||n.DRAW_MODES.TRIANGLE_MESH,c.shader=null,c.tintRgb=new Float32Array([1,1,1]),c._glDatas={},c._uvTransform=new r.TextureMatrix(c._texture),c.uploadUvTransform=!1,c.pluginName="mesh",c}return f(n,e),n.prototype._renderWebGL=function(t){this.refresh(),t.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},n.prototype._renderCanvas=function(t){this.refresh(),t.plugins[this.pluginName].render(this)},n.prototype._onTextureUpdate=function(){this._uvTransform.texture=this._texture,this.refresh()},n.prototype.multiplyUvs=function(){this.uploadUvTransform||this._uvTransform.multiplyUvs(this.uvs)},n.prototype.refresh=function(t){this.autoUpdate&&this.vertexDirty++,this._uvTransform.update(t)&&this._refresh()},n.prototype._refresh=function(){},n.prototype._calculateBounds=function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)},n.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,l);for(var e=this.vertices,r=c.points,i=this.indices,o=this.indices.length,s=this.drawMode===n.DRAW_MODES.TRIANGLES?3:1,u=0;u+2<o;u+=s){var a=2*i[u],f=2*i[u+1],h=2*i[u+2];if(r[0]=e[a],r[1]=e[a+1],r[2]=e[f],r[3]=e[f+1],r[4]=e[h],r[5]=e[h+1],c.contains(l.x,l.y))return!0}return!1},n.prototype.destroy=function(t){for(var r in this._glDatas){var n=this._glDatas[r];n.destroy?n.destroy():(n.vertexBuffer&&(n.vertexBuffer.destroy(),n.vertexBuffer=null),n.indexBuffer&&(n.indexBuffer.destroy(),n.indexBuffer=null),n.uvBuffer&&(n.uvBuffer.destroy(),n.uvBuffer=null),n.vao&&(n.vao.destroy(),n.vao=null))}this._glDatas=null,e.prototype.destroy.call(this,t)},t(n,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}},{key:"tint",get:function(){return r.utils.rgb2hex(this.tintRgb)},set:function(t){this.tintRgb=r.utils.hex2rgb(t,this.tintRgb)}}]),n}(r.Container);exports.default=h,h.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1};
},{"../core":"RjZD","../core/textures/Texture":"xUki"}],"IWZv":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../core"),r=d(e),t=require("pixi-gl-core"),n=u(t),o=require("../Mesh"),i=u(o),a=require("path");function u(e){return e&&e.__esModule?e:{default:e}}function d(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function f(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function s(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function l(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var c=r.Matrix.IDENTITY,v=function(e){function t(r){f(this,t);var n=s(this,e.call(this,r));return n.shader=null,n}return l(t,e),t.prototype.onContextChange=function(){var e=this.renderer.gl;this.shader=new r.Shader(e,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n")},t.prototype.render=function(e){var t=this.renderer,o=t.gl,a=e._texture;if(a.valid){var u=e._glDatas[t.CONTEXT_UID];u||(t.bindVao(null),(u={shader:this.shader,vertexBuffer:n.default.GLBuffer.createVertexBuffer(o,e.vertices,o.STREAM_DRAW),uvBuffer:n.default.GLBuffer.createVertexBuffer(o,e.uvs,o.STREAM_DRAW),indexBuffer:n.default.GLBuffer.createIndexBuffer(o,e.indices,o.STATIC_DRAW),vao:null,dirty:e.dirty,indexDirty:e.indexDirty,vertexDirty:e.vertexDirty}).vao=new n.default.VertexArrayObject(o).addIndex(u.indexBuffer).addAttribute(u.vertexBuffer,u.shader.attributes.aVertexPosition,o.FLOAT,!1,8,0).addAttribute(u.uvBuffer,u.shader.attributes.aTextureCoord,o.FLOAT,!1,8,0),e._glDatas[t.CONTEXT_UID]=u),t.bindVao(u.vao),e.dirty!==u.dirty&&(u.dirty=e.dirty,u.uvBuffer.upload(e.uvs)),e.indexDirty!==u.indexDirty&&(u.indexDirty=e.indexDirty,u.indexBuffer.upload(e.indices)),e.vertexDirty!==u.vertexDirty&&(u.vertexDirty=e.vertexDirty,u.vertexBuffer.upload(e.vertices)),t.bindShader(u.shader),u.shader.uniforms.uSampler=t.bindTexture(a),t.state.setBlendMode(r.utils.correctBlendMode(e.blendMode,a.baseTexture.premultipliedAlpha)),u.shader.uniforms.uTransform&&(e.uploadUvTransform?u.shader.uniforms.uTransform=e._uvTransform.mapCoord.toArray(!0):u.shader.uniforms.uTransform=c.toArray(!0)),u.shader.uniforms.translationMatrix=e.worldTransform.toArray(!0),u.shader.uniforms.uColor=r.utils.premultiplyRgba(e.tintRgb,e.worldAlpha,u.shader.uniforms.uColor,a.baseTexture.premultipliedAlpha);var d=e.drawMode===i.default.DRAW_MODES.TRIANGLE_MESH?o.TRIANGLE_STRIP:o.TRIANGLES;u.vao.draw(d,e.indices.length,0)}},t}(r.ObjectRenderer);exports.default=v,r.WebGLRenderer.registerPlugin("mesh",v);
},{"../../core":"RjZD","pixi-gl-core":"PJsv","../Mesh":"esRn","path":"UUq2"}],"bPb9":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../core"),r=i(e),t=require("../Mesh"),n=o(t);function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function a(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(r){a(this,e),this.renderer=r}return e.prototype.render=function(e){var r=this.renderer,t=r.context,o=e.worldTransform,i=r.resolution;r.roundPixels?t.setTransform(o.a*i,o.b*i,o.c*i,o.d*i,o.tx*i|0,o.ty*i|0):t.setTransform(o.a*i,o.b*i,o.c*i,o.d*i,o.tx*i,o.ty*i),r.context.globalAlpha=e.worldAlpha,r.setBlendMode(e.blendMode),e.drawMode===n.default.DRAW_MODES.TRIANGLE_MESH?this._renderTriangleMesh(e):this._renderTriangles(e)},e.prototype._renderTriangleMesh=function(e){for(var r=e.vertices.length/2,t=0;t<r-2;t++){var n=2*t;this._renderDrawTriangle(e,n,n+2,n+4)}},e.prototype._renderTriangles=function(e){for(var r=e.indices,t=r.length,n=0;n<t;n+=3){var o=2*r[n],i=2*r[n+1],a=2*r[n+2];this._renderDrawTriangle(e,o,i,a)}},e.prototype._renderDrawTriangle=function(e,r,t,n){var o=this.renderer.context,i=e.uvs,a=e.vertices,s=e._texture;if(s.valid){var d=s.baseTexture,l=d.source,h=d.width,u=d.height,c=void 0,f=void 0,v=void 0,g=void 0,p=void 0,T=void 0;if(e.uploadUvTransform){var w=e._uvTransform.mapCoord;c=(i[r]*w.a+i[r+1]*w.c+w.tx)*d.width,f=(i[t]*w.a+i[t+1]*w.c+w.tx)*d.width,v=(i[n]*w.a+i[n+1]*w.c+w.tx)*d.width,g=(i[r]*w.b+i[r+1]*w.d+w.ty)*d.height,p=(i[t]*w.b+i[t+1]*w.d+w.ty)*d.height,T=(i[n]*w.b+i[n+1]*w.d+w.ty)*d.height}else c=i[r]*d.width,f=i[t]*d.width,v=i[n]*d.width,g=i[r+1]*d.height,p=i[t+1]*d.height,T=i[n+1]*d.height;var M=a[r],_=a[t],y=a[n],x=a[r+1],b=a[t+1],m=a[n+1],P=e.canvasPadding/this.renderer.resolution;if(P>0){var q=P/Math.abs(e.worldTransform.a),D=P/Math.abs(e.worldTransform.d),A=(M+_+y)/3,E=(x+b+m)/3,C=M-A,F=x-E,O=Math.sqrt(C*C+F*F);M=A+C/O*(O+q),x=E+F/O*(O+D),F=b-E,_=A+(C=_-A)/(O=Math.sqrt(C*C+F*F))*(O+q),b=E+F/O*(O+D),F=m-E,y=A+(C=y-A)/(O=Math.sqrt(C*C+F*F))*(O+q),m=E+F/O*(O+D)}o.save(),o.beginPath(),o.moveTo(M,x),o.lineTo(_,b),o.lineTo(y,m),o.closePath(),o.clip();var R=c*p+g*v+f*T-p*v-g*f-c*T,S=M*p+g*y+_*T-p*y-g*_-M*T,B=c*_+M*v+f*y-_*v-M*f-c*y,I=c*p*y+g*_*v+M*f*T-M*p*v-g*f*y-c*_*T,j=x*p+g*m+b*T-p*m-g*b-x*T,G=c*b+x*v+f*m-b*v-x*f-c*m,H=c*p*m+g*b*v+x*f*T-x*p*v-g*f*m-c*b*T;o.transform(S/R,j/R,B/R,G/R,I/R,H/R),o.drawImage(l,0,0,h*d.resolution,u*d.resolution,0,0,h,u),o.restore(),this.renderer.invalidateBlendMode()}},e.prototype.renderMeshFlat=function(e){var r=this.renderer.context,t=e.vertices,n=t.length/2;r.beginPath();for(var o=1;o<n-2;++o){var i=2*o,a=t[i],s=t[i+1],d=t[i+2],l=t[i+3],h=t[i+4],u=t[i+5];r.moveTo(a,s),r.lineTo(d,l),r.lineTo(h,u)}r.fillStyle="#FF0000",r.fill(),r.closePath()},e.prototype.destroy=function(){this.renderer=null},e}();exports.default=s,r.CanvasRenderer.registerPlugin("mesh",s);
},{"../../core":"RjZD","../Mesh":"esRn"}],"sY57":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("./Mesh"),e=r(t);function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var n=function(t){function r(o,n,a){i(this,r);var c=s(this,t.call(this,o));return c._ready=!0,c.verticesX=n||10,c.verticesY=a||10,c.drawMode=e.default.DRAW_MODES.TRIANGLES,c.refresh(),c}return o(r,t),r.prototype._refresh=function(){for(var t=this._texture,e=this.verticesX*this.verticesY,r=[],i=[],s=[],o=this.verticesX-1,n=this.verticesY-1,a=t.width/o,c=t.height/n,u=0;u<e;u++){var h=u%this.verticesX,f=u/this.verticesX|0;r.push(h*a,f*c),i.push(h/o,f/n)}for(var l=o*n,p=0;p<l;p++){var v=p%o,y=p/o|0,d=y*this.verticesX+v,_=y*this.verticesX+v+1,w=(y+1)*this.verticesX+v,b=(y+1)*this.verticesX+v+1;s.push(d,_,w),s.push(_,b,w)}this.vertices=new Float32Array(r),this.uvs=new Float32Array(i),this.colors=new Float32Array([]),this.indices=new Uint16Array(s),this.dirty++,this.indexDirty++,this.multiplyUvs()},r.prototype._onTextureUpdate=function(){e.default.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},r}(e.default);exports.default=n;
},{"./Mesh":"esRn"}],"VYYc":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=function(){function t(t,i){for(var e=0;e<i.length;e++){var h=i[e];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}return function(i,e,h){return e&&t(i.prototype,e),h&&t(i,h),i}}(),i=require("./Plane"),e=s(i),h=require("../core/sprites/canvas/CanvasTinter"),r=s(h);function s(t){return t&&t.__esModule?t:{default:t}}function o(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function n(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}function a(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}var u=10,_=function(i){function e(t,h,r,s,a){o(this,e);var _=n(this,i.call(this,t,4,4));return _._origWidth=t.orig.width,_._origHeight=t.orig.height,_._width=_._origWidth,_._height=_._origHeight,_._leftWidth=void 0!==h?h:u,_._rightWidth=void 0!==s?s:u,_._topHeight=void 0!==r?r:u,_._bottomHeight=void 0!==a?a:u,_._cachedTint=16777215,_._tintedTexture=null,_._canvasUvs=null,_.refresh(!0),_}return a(e,i),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,i=this._topHeight+this._bottomHeight,e=this._height>i?1:this._height/i;t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,i=this._leftWidth+this._rightWidth,e=this._width>i?1:this._width/i;t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._renderCanvas=function(t){var i=t.context,e=this.worldTransform,h=t.resolution,s=16777215!==this.tint,o=this._texture;s&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedTexture=r.default.getTintedTexture(this,this.tint));var n=s?this._tintedTexture:o.baseTexture.source;this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var a=this.vertices,u=this._canvasUvs,_=s?0:o.frame.x,f=s?0:o.frame.y,c=_+o.frame.width,d=f+o.frame.height;u[0]=_,u[1]=_+this._leftWidth,u[2]=c-this._rightWidth,u[3]=c,u[4]=f,u[5]=f+this._topHeight,u[6]=d-this._bottomHeight,u[7]=d;for(var g=0;g<8;g++)u[g]*=o.baseTexture.resolution;i.globalAlpha=this.worldAlpha,t.setBlendMode(this.blendMode),t.roundPixels?i.setTransform(e.a*h,e.b*h,e.c*h,e.d*h,e.tx*h|0,e.ty*h|0):i.setTransform(e.a*h,e.b*h,e.c*h,e.d*h,e.tx*h,e.ty*h);for(var l=0;l<3;l++)for(var p=0;p<3;p++){var v=2*p+8*l,b=Math.max(1,u[p+1]-u[p]),y=Math.max(1,u[l+5]-u[l+4]),m=Math.max(1,a[v+10]-a[v]),w=Math.max(1,a[v+11]-a[v+1]);i.drawImage(n,u[p],u[l+4],b,y,a[v],a[v+1],m,w)}},e.prototype._refresh=function(){i.prototype._refresh.call(this);var t=this.uvs,e=this._texture;this._origWidth=e.orig.width,this._origHeight=e.orig.height;var h=1/this._origWidth,r=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=h*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-h*this._rightWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.dirty++,this.multiplyUvs()},t(e,[{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._refresh()}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._refresh()}},{key:"leftWidth",get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()}},{key:"rightWidth",get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()}},{key:"topHeight",get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()}},{key:"bottomHeight",get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()}}]),e}(e.default);exports.default=_;
},{"./Plane":"sY57","../core/sprites/canvas/CanvasTinter":"xwA8"}],"XEQk":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("./Mesh"),e=r(t);function r(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(t){function e(r,o){n(this,e);var s=i(this,t.call(this,r));return s.points=o,s.vertices=new Float32Array(4*o.length),s.uvs=new Float32Array(4*o.length),s.colors=new Float32Array(2*o.length),s.indices=new Uint16Array(2*o.length),s.autoUpdate=!0,s.refresh(),s}return o(e,t),e.prototype._refresh=function(){var t=this.points;if(!(t.length<1)&&this._texture._uvs){this.vertices.length/4!==t.length&&(this.vertices=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length));var e=this.uvs,r=this.indices,n=this.colors;e[0]=0,e[1]=0,e[2]=0,e[3]=1,n[0]=1,n[1]=1,r[0]=0,r[1]=1;for(var i=t.length,o=1;o<i;o++){var s=4*o,a=o/(i-1);e[s]=a,e[s+1]=0,e[s+2]=a,e[s+3]=1,n[s=2*o]=1,n[s+1]=1,r[s=2*o]=s,r[s+1]=s+1}this.dirty++,this.indexDirty++,this.multiplyUvs(),this.refreshVertices()}},e.prototype.refreshVertices=function(){var t=this.points;if(!(t.length<1))for(var e=t[0],r=void 0,n=0,i=0,o=this.vertices,s=t.length,a=0;a<s;a++){var h=t[a],l=4*a;i=-((r=a<t.length-1?t[a+1]:h).x-e.x),n=r.y-e.y;var u=10*(1-a/(s-1));u>1&&(u=1);var c=Math.sqrt(n*n+i*i),f=this._texture.height/2;n/=c,i/=c,n*=f,i*=f,o[l]=h.x+n,o[l+1]=h.y+i,o[l+2]=h.x-n,o[l+3]=h.y-i,e=h}},e.prototype.updateTransform=function(){this.autoUpdate&&this.refreshVertices(),this.containerUpdateTransform()},e}(e.default);exports.default=s;
},{"./Mesh":"esRn"}],"1ZIP":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./Mesh");Object.defineProperty(exports,"Mesh",{enumerable:!0,get:function(){return i(e).default}});var r=require("./webgl/MeshRenderer");Object.defineProperty(exports,"MeshRenderer",{enumerable:!0,get:function(){return i(r).default}});var t=require("./canvas/CanvasMeshRenderer");Object.defineProperty(exports,"CanvasMeshRenderer",{enumerable:!0,get:function(){return i(t).default}});var n=require("./Plane");Object.defineProperty(exports,"Plane",{enumerable:!0,get:function(){return i(n).default}});var u=require("./NineSlicePlane");Object.defineProperty(exports,"NineSlicePlane",{enumerable:!0,get:function(){return i(u).default}});var a=require("./Rope");function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"Rope",{enumerable:!0,get:function(){return i(a).default}});
},{"./Mesh":"esRn","./webgl/MeshRenderer":"IWZv","./canvas/CanvasMeshRenderer":"bPb9","./Plane":"sY57","./NineSlicePlane":"VYYc","./Rope":"XEQk"}],"Q1sA":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),t=require("../core"),r=o(t),i=require("../core/utils");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(t){function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500,i=arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16384,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n(this,o);var h=s(this,t.call(this));return a>16384&&(a=16384),a>e&&(a=e),h._properties=[!1,!0,!1,!1,!1],h._maxSize=e,h._batchSize=a,h._glBuffers={},h._bufferUpdateIDs=[],h._updateID=0,h.interactiveChildren=!1,h.blendMode=r.BLEND_MODES.NORMAL,h.autoResize=l,h.roundPixels=!0,h.baseTexture=null,h.setProperties(i),h._tint=0,h.tintRgb=new Float32Array(4),h.tint=16777215,h}return a(o,t),o.prototype.setProperties=function(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])},o.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},o.prototype.renderWebGL=function(e){var t=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.hasLoaded||this.baseTexture.once("update",function(){return t.onChildrenChange(0)})),e.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))},o.prototype.onChildrenChange=function(e){for(var t=Math.floor(e/this._batchSize);this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID},o.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var t=e.context,r=this.worldTransform,i=!0,o=0,n=0,s=0,a=0;e.setBlendMode(this.blendMode),t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var h=this.children[l];if(h.visible){var u=h._texture.frame;if(t.globalAlpha=this.worldAlpha*h.alpha,h.rotation%(2*Math.PI)==0)i&&(t.setTransform(r.a,r.b,r.c,r.d,r.tx*e.resolution,r.ty*e.resolution),i=!1),o=h.anchor.x*(-u.width*h.scale.x)+h.position.x+.5,n=h.anchor.y*(-u.height*h.scale.y)+h.position.y+.5,s=u.width*h.scale.x,a=u.height*h.scale.y;else{i||(i=!0),h.displayObjectUpdateTransform();var p=h.worldTransform;e.roundPixels?t.setTransform(p.a,p.b,p.c,p.d,p.tx*e.resolution|0,p.ty*e.resolution|0):t.setTransform(p.a,p.b,p.c,p.d,p.tx*e.resolution,p.ty*e.resolution),o=h.anchor.x*-u.width+.5,n=h.anchor.y*-u.height+.5,s=u.width,a=u.height}var f=h._texture.baseTexture.resolution;t.drawImage(h._texture.baseTexture.source,u.x*f,u.y*f,u.width*f,u.height*f,o*e.resolution,n*e.resolution,s*e.resolution,a*e.resolution)}}}},o.prototype.destroy=function(e){if(t.prototype.destroy.call(this,e),this._buffers)for(var r=0;r<this._buffers.length;++r)this._buffers[r].destroy();this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e(o,[{key:"tint",get:function(){return this._tint},set:function(e){this._tint=e,(0,i.hex2rgb)(e,this.tintRgb)}}]),o}(r.Container);exports.default=l;
},{"../core":"RjZD","../core/utils":"dDI1"}],"zjtw":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var o=require("../../core/Shader"),t=e(o);function e(o){return o&&o.__esModule?o:{default:o}}function r(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function i(o,t){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?o:t}function n(o,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);o.prototype=Object.create(t&&t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(o,t):o.__proto__=t)}var a=function(o){function t(e){return r(this,t),i(this,o.call(this,e,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute vec2 aPositionCoord;","attribute float aRotation;","uniform mat3 projectionMatrix;","uniform vec4 uColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   vec2 v = vec2(x, y);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor * uColor;","}"].join("\n"),["varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;","  gl_FragColor = color;","}"].join("\n")))}return n(t,o),t}(t.default);exports.default=a;
},{"../../core/Shader":"wBQE"}],"fUBa":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("pixi-gl-core"),i=a(t),e=require("../../core/utils/createIndicesForQuads"),s=a(e);function a(t){return t&&t.__esModule?t:{default:t}}function r(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(i,e,s,a){r(this,t),this.gl=i,this.size=a,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;++n){var f=e[n];f={attribute:f.attribute,size:f.size,uploadFunction:f.uploadFunction,unsignedByte:f.unsignedByte,offset:f.offset},s[n]?this.dynamicProperties.push(f):this.staticProperties.push(f)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return t.prototype.initBuffers=function(){var t=this.gl,e=0;this.indices=(0,s.default)(this.size),this.indexBuffer=i.default.GLBuffer.createIndexBuffer(t,this.indices,t.STATIC_DRAW),this.dynamicStride=0;for(var a=0;a<this.dynamicProperties.length;++a){var r=this.dynamicProperties[a];r.offset=e,e+=r.size,this.dynamicStride+=r.size}var n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=i.default.GLBuffer.createVertexBuffer(t,n,t.STREAM_DRAW);var f=0;this.staticStride=0;for(var u=0;u<this.staticProperties.length;++u){var c=this.staticProperties[u];c.offset=f,f+=c.size,this.staticStride+=c.size}var d=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(d),this.staticDataUint32=new Uint32Array(d),this.staticBuffer=i.default.GLBuffer.createVertexBuffer(t,d,t.STATIC_DRAW),this.vao=new i.default.VertexArrayObject(t).addIndex(this.indexBuffer);for(var h=0;h<this.dynamicProperties.length;++h){var o=this.dynamicProperties[h];o.unsignedByte?this.vao.addAttribute(this.dynamicBuffer,o.attribute,t.UNSIGNED_BYTE,!0,4*this.dynamicStride,4*o.offset):this.vao.addAttribute(this.dynamicBuffer,o.attribute,t.FLOAT,!1,4*this.dynamicStride,4*o.offset)}for(var l=0;l<this.staticProperties.length;++l){var y=this.staticProperties[l];y.unsignedByte?this.vao.addAttribute(this.staticBuffer,y.attribute,t.UNSIGNED_BYTE,!0,4*this.staticStride,4*y.offset):this.vao.addAttribute(this.staticBuffer,y.attribute,t.FLOAT,!1,4*this.staticStride,4*y.offset)}},t.prototype.uploadDynamic=function(t,i,e){for(var s=0;s<this.dynamicProperties.length;s++){var a=this.dynamicProperties[s];a.uploadFunction(t,i,e,a.unsignedByte?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,a.offset)}this.dynamicBuffer.upload()},t.prototype.uploadStatic=function(t,i,e){for(var s=0;s<this.staticProperties.length;s++){var a=this.staticProperties[s];a.uploadFunction(t,i,e,a.unsignedByte?this.staticDataUint32:this.staticData,this.staticStride,a.offset)}this.staticBuffer.upload()},t.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicBuffer.destroy(),this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer.destroy(),this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null},t}();exports.default=n;
},{"pixi-gl-core":"PJsv","../../core/utils/createIndicesForQuads":"DI0o"}],"gx9Q":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../core"),t=u(e),r=require("./ParticleShader"),i=s(r),o=require("./ParticleBuffer"),n=s(o),a=require("../../core/utils");function s(e){return e&&e.__esModule?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=function(e){function r(i){p(this,r);var o=l(this,e.call(this,i));return o.shader=null,o.indexBuffer=null,o.properties=null,o.tempMatrix=new t.Matrix,o.CONTEXT_UID=0,o}return h(r,e),r.prototype.onContextChange=function(){var e=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.shader=new i.default(e),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,unsignedByte:!0,uploadFunction:this.uploadTint,offset:0}]},r.prototype.start=function(){this.renderer.bindShader(this.shader)},r.prototype.render=function(e){var r=e.children,i=e._maxSize,o=e._batchSize,n=this.renderer,a=r.length;if(0!==a){a>i&&(a=i);var s=e._glBuffers[n.CONTEXT_UID];s||(s=e._glBuffers[n.CONTEXT_UID]=this.generateBuffers(e));var u=r[0]._texture.baseTexture;this.renderer.setBlendMode(t.utils.correctBlendMode(e.blendMode,u.premultipliedAlpha));var p=n.gl,l=e.worldTransform.copy(this.tempMatrix);l.prepend(n._activeRenderTarget.projectionMatrix),this.shader.uniforms.projectionMatrix=l.toArray(!0),this.shader.uniforms.uColor=t.utils.premultiplyRgba(e.tintRgb,e.worldAlpha,this.shader.uniforms.uColor,u.premultipliedAlpha),this.shader.uniforms.uSampler=n.bindTexture(u);for(var h=!1,d=0,f=0;d<a;d+=o,f+=1){var c=a-d;if(c>o&&(c=o),f>=s.length){if(!e.autoResize)break;s.push(this._generateOneMoreBuffer(e))}var y=s[f];y.uploadDynamic(r,d,c);var _=e._bufferUpdateIDs[f]||0;(h=h||y._updateID<_)&&(y._updateID=e._updateID,y.uploadStatic(r,d,c)),n.bindVao(y.vao),y.vao.draw(p.TRIANGLES,6*c)}}},r.prototype.generateBuffers=function(e){for(var t=this.renderer.gl,r=[],i=e._maxSize,o=e._batchSize,a=e._properties,s=0;s<i;s+=o)r.push(new n.default(t,this.properties,a,o));return r},r.prototype._generateOneMoreBuffer=function(e){var t=this.renderer.gl,r=e._batchSize,i=e._properties;return new n.default(t,this.properties,i,r)},r.prototype.uploadVertices=function(e,t,r,i,o,n){for(var a=0,s=0,u=0,p=0,l=0;l<r;++l){var h=e[t+l],d=h._texture,f=h.scale.x,c=h.scale.y,y=d.trim,_=d.orig;y?(a=(s=y.x-h.anchor.x*_.width)+y.width,u=(p=y.y-h.anchor.y*_.height)+y.height):(a=_.width*(1-h.anchor.x),s=_.width*-h.anchor.x,u=_.height*(1-h.anchor.y),p=_.height*-h.anchor.y),i[n]=s*f,i[n+1]=p*c,i[n+o]=a*f,i[n+o+1]=p*c,i[n+2*o]=a*f,i[n+2*o+1]=u*c,i[n+3*o]=s*f,i[n+3*o+1]=u*c,n+=4*o}},r.prototype.uploadPosition=function(e,t,r,i,o,n){for(var a=0;a<r;a++){var s=e[t+a].position;i[n]=s.x,i[n+1]=s.y,i[n+o]=s.x,i[n+o+1]=s.y,i[n+2*o]=s.x,i[n+2*o+1]=s.y,i[n+3*o]=s.x,i[n+3*o+1]=s.y,n+=4*o}},r.prototype.uploadRotation=function(e,t,r,i,o,n){for(var a=0;a<r;a++){var s=e[t+a].rotation;i[n]=s,i[n+o]=s,i[n+2*o]=s,i[n+3*o]=s,n+=4*o}},r.prototype.uploadUvs=function(e,t,r,i,o,n){for(var a=0;a<r;++a){var s=e[t+a]._texture._uvs;s?(i[n]=s.x0,i[n+1]=s.y0,i[n+o]=s.x1,i[n+o+1]=s.y1,i[n+2*o]=s.x2,i[n+2*o+1]=s.y2,i[n+3*o]=s.x3,i[n+3*o+1]=s.y3,n+=4*o):(i[n]=0,i[n+1]=0,i[n+o]=0,i[n+o+1]=0,i[n+2*o]=0,i[n+2*o+1]=0,i[n+3*o]=0,i[n+3*o+1]=0,n+=4*o)}},r.prototype.uploadTint=function(e,t,r,i,o,n){for(var s=0;s<r;++s){var u=e[t+s],p=u._texture.baseTexture.premultipliedAlpha,l=u.alpha,h=l<1&&p?(0,a.premultiplyTint)(u._tintRGB,l):u._tintRGB+(255*l<<24);i[n]=h,i[n+o]=h,i[n+2*o]=h,i[n+3*o]=h,n+=4*o}},r.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),e.prototype.destroy.call(this),this.shader.destroy(),this.indices=null,this.tempMatrix=null},r}(t.ObjectRenderer);exports.default=d,t.WebGLRenderer.registerPlugin("particle",d);
},{"../../core":"RjZD","./ParticleShader":"zjtw","./ParticleBuffer":"fUBa","../../core/utils":"dDI1"}],"8fQc":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./ParticleContainer");Object.defineProperty(exports,"ParticleContainer",{enumerable:!0,get:function(){return t(e).default}});var r=require("./webgl/ParticleRenderer");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"ParticleRenderer",{enumerable:!0,get:function(){return t(r).default}});
},{"./ParticleContainer":"Q1sA","./webgl/ParticleRenderer":"gx9Q"}],"4EC6":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var e=function(){function e(n){t(this,e),this.maxItemsPerFrame=n,this.itemsLeft=0}return e.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},e.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},e}();exports.default=e;
},{}],"NEc+":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../core"),e=n(t),i=require("./limiters/CountLimiter"),r=s(i);function s(t){return t&&t.__esModule?t:{default:t}}function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=e.ticker.shared;e.settings.UPLOADS_PER_FRAME=4;var h=function(){function t(i){var s=this;o(this,t),this.limiter=new r.default(e.settings.UPLOADS_PER_FRAME),this.renderer=i,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){s.queue&&s.prepareItems()},this.registerFindHook(p),this.registerFindHook(k),this.registerFindHook(l),this.registerFindHook(a),this.registerFindHook(d),this.registerUploadHook(f),this.registerUploadHook(c)}return t.prototype.upload=function(t,i){"function"==typeof t&&(i=t,t=null),t&&this.add(t),this.queue.length?(i&&this.completes.push(i),this.ticking||(this.ticking=!0,u.addOnce(this.tick,this,e.UPDATE_PRIORITY.UTILITY))):i&&i()},t.prototype.tick=function(){setTimeout(this.delayedTick,0)},t.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],i=!1;if(t&&!t._destroyed)for(var r=0,s=this.uploadHooks.length;r<s;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),i=!0;break}i||this.queue.shift()}if(this.queue.length)u.addOnce(this.tick,this,e.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var n=this.completes.slice(0);this.completes.length=0;for(var o=0,h=n.length;o<h;o++)n[o]()}},t.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},t.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},t.prototype.add=function(t){for(var i=0,r=this.addHooks.length;i<r&&!this.addHooks[i](t,this.queue);i++);if(t instanceof e.Container)for(var s=t.children.length-1;s>=0;s--)this.add(t.children[s]);return this},t.prototype.destroy=function(){this.ticking&&u.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},t}();function l(t,i){var r=!1;if(t&&t._textures&&t._textures.length)for(var s=0;s<t._textures.length;s++)if(t._textures[s]instanceof e.Texture){var n=t._textures[s].baseTexture;-1===i.indexOf(n)&&(i.push(n),r=!0)}return r}function a(t,i){return t instanceof e.BaseTexture&&(-1===i.indexOf(t)&&i.push(t),!0)}function d(t,i){if(t._texture&&t._texture instanceof e.Texture){var r=t._texture.baseTexture;return-1===i.indexOf(r)&&i.push(r),!0}return!1}function f(t,i){return i instanceof e.Text&&(i.updateText(!0),!0)}function c(t,i){if(i instanceof e.TextStyle){var r=i.toFontString();return e.TextMetrics.measureFont(r),!0}return!1}function p(t,i){if(t instanceof e.Text){-1===i.indexOf(t.style)&&i.push(t.style),-1===i.indexOf(t)&&i.push(t);var r=t._texture.baseTexture;return-1===i.indexOf(r)&&i.push(r),!0}return!1}function k(t,i){return t instanceof e.TextStyle&&(-1===i.indexOf(t)&&i.push(t),!0)}exports.default=h;
},{"../core":"RjZD","./limiters/CountLimiter":"4EC6"}],"laVK":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../core"),r=i(e),t=require("../BasePrepare"),n=o(t);function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function u(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function a(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function s(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var c=function(e){function r(t){u(this,r);var n=a(this,e.call(this,t));return n.uploadHookHelper=n.renderer,n.registerFindHook(l),n.registerUploadHook(p),n.registerUploadHook(f),n}return s(r,e),r}(n.default);function p(e,t){return t instanceof r.BaseTexture&&(t._glTextures[e.CONTEXT_UID]||e.textureManager.updateTexture(t),!0)}function f(e,t){return t instanceof r.Graphics&&((t.dirty||t.clearDirty||!t._webGL[e.plugins.graphics.CONTEXT_UID])&&e.plugins.graphics.updateGraphics(t),!0)}function l(e,t){return e instanceof r.Graphics&&(t.push(e),!0)}exports.default=c,r.WebGLRenderer.registerPlugin("prepare",c);
},{"../../core":"RjZD","../BasePrepare":"NEc+"}],"lVSe":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("../../core"),t=o(e),r=require("../BasePrepare"),n=a(r);function a(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=16,l=function(e){function t(r){i(this,t);var n=c(this,e.call(this,r));return n.uploadHookHelper=n,n.canvas=document.createElement("canvas"),n.canvas.width=u,n.canvas.height=u,n.ctx=n.canvas.getContext("2d"),n.registerUploadHook(f),n}return s(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.ctx=null,this.canvas=null},t}(n.default);function f(e,r){if(r instanceof t.BaseTexture){var n=r.source,a=0===n.width?e.canvas.width:Math.min(e.canvas.width,n.width),o=0===n.height?e.canvas.height:Math.min(e.canvas.height,n.height);return e.ctx.drawImage(n,0,0,a,o,0,0,e.canvas.width,e.canvas.height),!0}return!1}exports.default=l,t.CanvasRenderer.registerPlugin("prepare",l);
},{"../../core":"RjZD","../BasePrepare":"NEc+"}],"p35m":[function(require,module,exports) {
"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}exports.__esModule=!0;var n=function(){function n(o){t(this,n),this.maxMilliseconds=o,this.frameStart=0}return n.prototype.beginFrame=function(){this.frameStart=Date.now()},n.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},n}();exports.default=n;
},{}],"7BI5":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e=require("./webgl/WebGLPrepare");Object.defineProperty(exports,"webgl",{enumerable:!0,get:function(){return i(e).default}});var r=require("./canvas/CanvasPrepare");Object.defineProperty(exports,"canvas",{enumerable:!0,get:function(){return i(r).default}});var t=require("./BasePrepare");Object.defineProperty(exports,"BasePrepare",{enumerable:!0,get:function(){return i(t).default}});var n=require("./limiters/CountLimiter");Object.defineProperty(exports,"CountLimiter",{enumerable:!0,get:function(){return i(n).default}});var u=require("./limiters/TimeLimiter");function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"TimeLimiter",{enumerable:!0,get:function(){return i(u).default}});
},{"./webgl/WebGLPrepare":"laVK","./canvas/CanvasPrepare":"lVSe","./BasePrepare":"NEc+","./limiters/CountLimiter":"4EC6","./limiters/TimeLimiter":"p35m"}],"ix37":[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];exports.__esModule=!0,exports.loader=exports.prepare=exports.particles=exports.mesh=exports.loaders=exports.interaction=exports.filters=exports.extras=exports.extract=exports.accessibility=void 0;var r=require("./polyfill");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return r[e]}})});var t=require("./core");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})});var o=require("./deprecation"),s=j(o),i=require("./accessibility"),a=O(i),p=require("./extract"),u=O(p),l=require("./extras"),n=O(l),x=require("./filters"),c=O(x),f=require("./interaction"),d=O(f),q=require("./loaders"),y=O(q),b=require("./mesh"),_=O(b),m=require("./particles"),v=O(m),h=require("./prepare"),M=O(h);function O(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function j(e){return e&&e.__esModule?e:{default:e}}t.utils.mixins.performMixins();var P=y.shared||null;exports.accessibility=a,exports.extract=u,exports.extras=n,exports.filters=c,exports.interaction=d,exports.loaders=y,exports.mesh=_,exports.particles=v,exports.prepare=M,exports.loader=P,"function"==typeof s.default&&(0,s.default)(exports),e.PIXI=exports;
},{"./polyfill":"bPsC","./core":"RjZD","./deprecation":"+E8Q","./accessibility":"l7H0","./extract":"jvu7","./extras":"KRVa","./filters":"lFUL","./interaction":"/j6N","./loaders":"PK7H","./mesh":"1ZIP","./particles":"8fQc","./prepare":"7BI5"}],"b6Mq":[function(require,module,exports) {
"use strict";function e(e){return Math.abs(e)<.2?0:(e-=.2*Math.sign(e),e/=.8)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"qDQi":[function(require,module,exports) {
"use strict";function e(e,t){var r=Math.sqrt(e*e+t*t);return r>1&&(e/=r,t/=r),[e,t]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"A0Sd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@babylonjs/core/Gamepads/gamepadManager"),o=require("@babylonjs/core/Gamepads/Controllers/genericController"),n=l(require("pixi.js")),t=a(require("./GamepadDeadZone")),r=a(require("./GamepadClamping"));function a(e){return e&&e.__esModule?e:{default:e}}function l(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var t=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};t.get||t.set?Object.defineProperty(o,n,t):o[n]=e[n]}return o.default=e,o}function i(e,o){return d(e)||c(e,o)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(e,o){var n=[],t=!0,r=!1,a=void 0;try{for(var l,i=e[Symbol.iterator]();!(t=(l=i.next()).done)&&(n.push(l.value),!o||n.length!==o);t=!0);}catch(s){r=!0,a=s}finally{try{t||null==i.return||i.return()}finally{if(r)throw a}}return n}function d(e){if(Array.isArray(e))return e}function u(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var f=function o(){u(this,o),function(){var o=new e.GamepadManager,a=new n.Sprite.from("./assets/sprites/gamepadConnected.png");a.x=10,a.y=10,a.width=400,a.height=96;var l=new Audio("./assets/audio/fx/gamepadConnected.mp3"),s=new n.Sprite.from("./assets/sprites/gamepadDisconnected.png");s.x=10,s.y=10,s.width=400,s.height=96;var c=new Audio("./assets/audio/fx/gamepadDisconnected.mp3");o.onGamepadConnectedObservable.add(function(e,o){console.log(e),game.pixiContainer.addChild(a),l.play(),setTimeout(function(){game.pixiContainer.removeChild(a)},1500),e.onButtonDownObservable.add(function(e,o){0===e?console.log(e):1===e?console.log(e):2===e?console.log(e):3===e?console.log(e):4===e?console.log(e):5===e?console.log(e):6===e?console.log(e):7===e?console.log(e):8===e?console.log(e):9===e?console.log(e):10===e?console.log(e):11===e?console.log(e):12===e?console.log(e):13===e?console.log(e):14===e?console.log(e):15===e?console.log(e):16===e?console.log(e):17===e&&console.log(e)}),e.onleftstickchanged(function(e){var o=e.x,n=e.y;o=(0,t.default)(o),n=(0,t.default)(n);var a=(0,r.default)(o,n),l=i(a,2);o=l[0],n=l[1]}),e.onrightstickchanged(function(e){var o=e.x,n=e.y;o=(0,t.default)(o),n=(0,t.default)(n);var a=(0,r.default)(o,n),l=i(a,2);o=l[0],n=l[1]})}),o.onGamepadDisconnectedObservable.add(function(e,o){game.pixiContainer.addChild(s),c.play(),setTimeout(function(){game.pixiContainer.removeChild(s)},1500)})}()};exports.default=f;
},{"@babylonjs/core/Gamepads/gamepadManager":"f8eF","@babylonjs/core/Gamepads/Controllers/genericController":"hYzo","pixi.js":"ix37","./GamepadDeadZone":"b6Mq","./GamepadClamping":"qDQi"}],"NqyQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("@babylonjs/core/Misc/virtualJoystick");function o(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}var e=function e(){var i,s;o(this,e),this.RIGHT_STICK=((i=new t.VirtualJoystick(!1)).setActionOnTouch(function(){console.log("touched!")}),i),this.LEFT_STICK=((s=new t.VirtualJoystick(!0)).setJoystickColor("white"),s),this.R_BUTTON=null,this.L_BUTTON=null};exports.default=e;
},{"@babylonjs/core/Misc/virtualJoystick":"2KsL"}],"BNKO":[function(require,module,exports) {
!function(){"use strict";var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},n="undefined"!=typeof module&&module.exports,l="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,r=function(){for(var n,l=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,t=l.length,u={};r<t;r++)if((n=l[r])&&n[1]in e){for(r=0;r<n.length;r++)u[l[0][r]]=n[r];return u}return!1}(),t={change:r.fullscreenchange,error:r.fullscreenerror},u={request:function(n){return new Promise(function(t){var u=r.requestFullscreen,c=function(){this.off("change",c),t()}.bind(this);n=n||e.documentElement,/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?n[u]():n[u](l?Element.ALLOW_KEYBOARD_INPUT:{}),this.on("change",c)}.bind(this))},exit:function(){return new Promise(function(n){if(this.isFullscreen){var l=function(){this.off("change",l),n()}.bind(this);e[r.exitFullscreen](),this.on("change",l)}else n()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(n,l){var r=t[n];r&&e.addEventListener(r,l,!1)},off:function(n,l){var r=t[n];r&&e.removeEventListener(r,l,!1)},raw:r};r?(Object.defineProperties(u,{isFullscreen:{get:function(){return Boolean(e[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[r.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(e[r.fullscreenEnabled])}}}),n?(module.exports=u,module.exports.default=u):window.screenfull=u):n?module.exports=!1:window.screenfull=!1}();
},{}],"yx/u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("pixi.js"));function t(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};o.get||o.set?Object.defineProperty(t,r,o):t[r]=e[r]}return t.default=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function t(o){r(this,t);var n=e.Texture.WHITE,i=e.Sprite.from(n),a=document.getElementById("renderCanvas");i.position.set(a.width/2,a.height/2)};exports.default=o;
},{"pixi.js":"ix37"}],"7vfu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SubMesh=exports.BaseSubMesh=void 0;var e=o(require("tslib")),t=require("../Misc/tools"),n=require("./buffer"),i=require("../Collisions/intersectionInfo"),r=require("../Culling/boundingInfo"),s=require("../Engines/constants");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};i.get||i.set?Object.defineProperty(t,n,i):t[n]=e[n]}return t.default=e,t}var u=function(){function e(){}return Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},e}();exports.BaseSubMesh=u;var a=function(o){function u(e,t,n,i,r,s,u,a){void 0===a&&(a=!0);var h=o.call(this)||this;return h.materialIndex=e,h.verticesStart=t,h.verticesCount=n,h.indexStart=i,h.indexCount=r,h._renderId=0,h._mesh=s,h._renderingMesh=u||s,s.subMeshes.push(h),h._trianglePlanes=[],h._id=s.subMeshes.length-1,a&&(h.refreshBoundingInfo(),s.computeWorldMatrix(!0)),h}return e.__extends(u,o),u.AddToMesh=function(e,t,n,i,r,s,o,a){return void 0===a&&(a=!0),new u(e,t,n,i,r,s,o,a)},Object.defineProperty(u.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),u.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},u.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},u.prototype.getMesh=function(){return this._mesh},u.prototype.getRenderingMesh=function(){return this._renderingMesh},u.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},u.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;var e=this._renderingMesh.getVerticesData(n.VertexBuffer.PositionKind);if(!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var i,s=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===s.length){var o=this._renderingMesh.getBoundingInfo();i={minimum:o.minimum.clone(),maximum:o.maximum.clone()}}else i=t.Tools.ExtractMinAndMaxIndexed(e,s,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new r.BoundingInfo(i.minimum,i.maximum),this},u.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},u.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t.update(e),this},u.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},u.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},u.prototype.render=function(e){return this._renderingMesh.render(this,e),this},u.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var n=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)n.push(e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]);this._linesIndexBuffer=t.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer},u.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},u.prototype.intersects=function(e,t,n,i){var r=this.getMaterial();if(!r)return null;switch(r.fillMode){case s.Constants.MATERIAL_PointListDrawMode:case s.Constants.MATERIAL_LineListDrawMode:case s.Constants.MATERIAL_LineLoopDrawMode:case s.Constants.MATERIAL_LineStripDrawMode:case s.Constants.MATERIAL_TriangleFanDrawMode:case s.Constants.MATERIAL_TriangleStripDrawMode:return null}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?this._intersectLines(e,t,n,this._mesh.intersectionThreshold,i):this._intersectTriangles(e,t,n,i)},u.prototype._intersectLines=function(e,t,n,r,s){for(var o=null,u=this.indexStart;u<this.indexStart+this.indexCount;u+=2){var a=t[n[u]],h=t[n[u+1]],f=e.intersectionSegment(a,h,r);if(!(f<0)&&((s||!o||f<o.distance)&&((o=new i.IntersectionInfo(null,null,f)).faceId=u/2,s)))break}return o},u.prototype._intersectTriangles=function(e,t,n,i){for(var r=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=3){var o=t[n[s]],u=t[n[s+1]],a=t[n[s+2]],h=e.intersectsTriangle(o,u,a);if(h){if(h.distance<0)continue;if((i||!r||h.distance<r.distance)&&((r=h).faceId=s/3,i))break}}return r},u.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},u.prototype.clone=function(e,t){var n=new u(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){var i=this.getBoundingInfo();if(!i)return n;n._boundingInfo=new r.BoundingInfo(i.minimum,i.maximum)}return n},u.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},u.prototype.getClassName=function(){return"SubMesh"},u.CreateFromIndices=function(e,t,n,i,r){for(var s=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=(r||i).getIndices(),h=t;h<t+n;h++){var f=a[h];f<s&&(s=f),f>o&&(o=f)}return new u(e,s,o-s+1,t,n,i,r)},u}(u);exports.SubMesh=a;
},{"tslib":"vCxL","../Misc/tools":"RkuS","./buffer":"YHhW","../Collisions/intersectionInfo":"RtU8","../Culling/boundingInfo":"1eEz","../Engines/constants":"vn8z"}],"koBp":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mesh=exports._InstancesBatch=exports._CreationDataStorage=exports.MeshLODLevel=void 0;var e=b(require("tslib")),t=require("../Misc/observable"),r=require("../Misc/tools"),i=require("../Misc/deepCopier"),s=require("../Misc/tags"),n=require("../Maths/math"),a=require("../node"),o=require("./buffer"),h=require("./mesh.vertexData"),l=require("./geometry"),c=require("./abstractMesh"),u=require("./subMesh"),f=require("../Culling/boundingInfo"),d=require("../Materials/material"),g=require("../Animations/animation"),p=require("../Loading/sceneLoaderFlags"),m=require("../Physics/physicsImpostor"),y=require("../Engines/constants"),v=require("../Misc/decorators"),_=require("../Misc/logger");function b(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};i.get||i.set?Object.defineProperty(t,r,i):t[r]=e[r]}return t.default=e,t}var M=function(){return function(e,t){this.distance=e,this.mesh=t}}();exports.MeshLODLevel=M;var I=function(){return function(){}}();exports._CreationDataStorage=I;var x=function(){return function(){this.visibleInstances={},this.renderIdForInstances=new Array,this.batchCache=new V,this.instancesBufferSize=2048}}(),V=function(){return function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}}();exports._InstancesBatch=V;var D=function(c){function b(e,t,r,n,a,o){void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=!0);var h=c.call(this,e,t)||this;if(h.delayLoadState=y.Constants.DELAYLOADSTATE_NONE,h.instances=new Array,h._LODLevels=new Array,h._instanceDataStorage=new x,h._originalBuilderSideOrientation=b.DEFAULTSIDE,h.overrideMaterialSideOrientation=null,h._areNormalsFrozen=!1,h._source=null,h._isMesh=!0,t=h.getScene(),n){if(n._geometry&&n._geometry.applyToMesh(h),i.DeepCopier.DeepCopy(n,h,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable"],["_poseMatrix"]),h._source=n,t.useClonedMeshhMap&&(n.meshMap||(n.meshMap={}),n.meshMap[h.uniqueId]=h),h._originalBuilderSideOrientation=n._originalBuilderSideOrientation,h._creationDataStorage=n._creationDataStorage,h._source._ranges){var l=h._source._ranges;for(var e in l)l.hasOwnProperty(e)&&l[e]&&h.createAnimationRange(e,l[e].from,l[e].to)}var u;if(n.metadata&&n.metadata.clone?h.metadata=n.metadata.clone():h.metadata=n.metadata,s.Tags&&s.Tags.HasTags(n)&&s.Tags.AddTagsTo(h,s.Tags.GetTags(n,!0)),h.parent=n.parent,h.setPivotMatrix(n.getPivotMatrix()),h.id=e+"."+n.id,h.material=n.material,!a)for(var f=n.getDescendants(!0),d=0;d<f.length;d++){var g=f[d];g.clone&&g.clone(e+"."+g.name,h)}var p=h.getScene().getPhysicsEngine();if(o&&p){var m=p.getImpostorForPhysicsObject(n);m&&(h.physicsImpostor=m.clone(h))}for(u=0;u<t.particleSystems.length;u++){var v=t.particleSystems[u];v.emitter===n&&v.clone(v.name,h)}h.refreshBoundingInfo(),h.computeWorldMatrix(!0)}return null!==r&&(h.parent=r),h}return e.__extends(b,c),Object.defineProperty(b.prototype,"onBeforeRenderObservable",{get:function(){return this._onBeforeRenderObservable||(this._onBeforeRenderObservable=new t.Observable),this._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onAfterRenderObservable",{get:function(){return this._onAfterRenderObservable||(this._onAfterRenderObservable=new t.Observable),this._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeDrawObservable",{get:function(){return this._onBeforeDrawObservable||(this._onBeforeDrawObservable=new t.Observable),this._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"morphTargetManager",{get:function(){return this._morphTargetManager},set:function(e){this._morphTargetManager!==e&&(this._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),b.prototype.getClassName=function(){return"Mesh"},b.prototype.toString=function(e){var t=c.prototype.toString.call(this,e);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var r=0;r<this.animations.length;r++)t+=", animation[0]: "+this.animations[r].toString(e);if(e)if(this._geometry){var i=this.getIndices(),s=this.getVerticesData(o.VertexBuffer.PositionKind);s&&i&&(t+=", flat shading: "+(s.length/3===i.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t},b.prototype._unBindEffect=function(){c.prototype._unBindEffect.call(this);for(var e=0,t=this.instances;e<t.length;e++){t[e]._unBindEffect()}},Object.defineProperty(b.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),b.prototype.getLODLevels=function(){return this._LODLevels},b.prototype._sortLODLevels=function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},b.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return _.Logger.Warn("You cannot use a mesh as LOD level twice"),this;var r=new M(e,t);return this._LODLevels.push(r),t&&(t._masterMesh=this),this._sortLODLevels(),this},b.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var r=this._LODLevels[t];if(r.distance===e)return r.mesh}return null},b.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[t].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},b.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var r;t?r=t:r=this.getBoundingInfo().boundingSphere;var i=r.centerWorld.subtract(e.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>i)return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var s=0;s<this._LODLevels.length;s++){var n=this._LODLevels[s];if(n.distance<i)return n.mesh&&(n.mesh._preActivate(),n.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(i,this,n.mesh),n.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},Object.defineProperty(b.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),b.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},b.prototype.getVerticesData=function(e,t,r){return this._geometry?this._geometry.getVerticesData(e,t,r):null},b.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},b.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},b.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},b.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach(function(t){e.push(t)}),e}return this._geometry.getVerticesDataKinds()},b.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},b.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(b.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),b.prototype.isReady=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.delayLoadState===y.Constants.DELAYLOADSTATE_LOADING)return!1;if(!c.prototype.isReady.call(this,e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;var r=this.getEngine(),i=this.getScene(),s=t||r.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var n=this.material||i.defaultMaterial;if(n)if(n._storeEffectOnSubMeshes)for(var a=0,o=this.subMeshes;a<o.length;a++){var h=(p=o[a]).getMaterial();if(h)if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,p,s))return!1}else if(!h.isReady(this,s))return!1}else if(!n.isReady(this,s))return!1;for(var l=0,u=this._lightSources;l<u.length;l++){var f=u[l].getShadowGenerator();if(f)for(var d=0,g=this.subMeshes;d<g.length;d++){var p=g[d];if(!f.isReady(p,s))return!1}}for(var m=0,v=this._LODLevels;m<v.length;m++){var _=v[m];if(_.mesh&&!_.mesh.isReady(s))return!1}return!0},Object.defineProperty(b.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),b.prototype.freezeNormals=function(){return this._areNormalsFrozen=!0,this},b.prototype.unfreezeNormals=function(){return this._areNormalsFrozen=!1,this},Object.defineProperty(b.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),b.prototype._preActivate=function(){var e=this.getScene().getRenderId();return this._preActivateId===e?this:(this._preActivateId=e,this._instanceDataStorage.visibleInstances=null,this)},b.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},b.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},b.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},b.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var r=this.getIndices();if(!r)return null;var i=r.length,s=!1;if(e)s=!0;else for(var n=0,a=this.subMeshes;n<a.length;n++){var o=a[n];if(o.indexStart+o.indexCount>=i){s=!0;break}if(o.verticesStart+o.verticesCount>=t){s=!0;break}}if(!s)return this.subMeshes[0]}return this.releaseSubMeshes(),new u.SubMesh(0,0,t,0,this.getTotalIndices(),this)},b.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),r=t/e|0,i=0;r%3!=0;)r++;this.releaseSubMeshes();for(var s=0;s<e&&!(i>=t);s++)u.SubMesh.CreateFromIndices(0,i,Math.min(r,t-i),this),i+=r;this.synchronizeInstances()}},b.prototype.setVerticesData=function(e,t,r,i){if(void 0===r&&(r=!1),this._geometry)this._geometry.setVerticesData(e,t,r,i);else{var s=new h.VertexData;s.set(t,e);var n=this.getScene();new l.Geometry(l.Geometry.RandomId(),n,s,r,this)}return this},b.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var r=this.getVertexBuffer(e);r&&r.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},b.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=l.Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},b.prototype.updateVerticesData=function(e,t,r,i){return this._geometry?(i?(this.makeGeometryUnique(),this.updateVerticesData(e,t,r,!1)):this._geometry.updateVerticesData(e,t,r),this):this},b.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var r=this.getVerticesData(o.VertexBuffer.PositionKind);if(!r)return this;if(e(r),this.updateVerticesData(o.VertexBuffer.PositionKind,r,!1,!1),t){var i=this.getIndices(),s=this.getVerticesData(o.VertexBuffer.NormalKind);if(!s)return this;h.VertexData.ComputeNormals(r,i,s),this.updateVerticesData(o.VertexBuffer.NormalKind,s,!1,!1)}return this},b.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(l.Geometry.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},b.prototype.setIndices=function(e,t,r){if(void 0===t&&(t=null),void 0===r&&(r=!1),this._geometry)this._geometry.setIndices(e,t,r);else{var i=new h.VertexData;i.indices=e;var s=this.getScene();new l.Geometry(l.Geometry.RandomId(),s,i,r,this)}return this},b.prototype.updateIndices=function(e,t){return this._geometry?(this._geometry.updateIndices(e,t),this):this},b.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},b.prototype._bind=function(e,t,r){if(!this._geometry)return this;var i,s=this.getScene().getEngine();if(this._unIndexed)i=null;else switch(r){case d.Material.PointFillMode:i=null;break;case d.Material.WireFrameFillMode:i=e._getLinesIndexBuffer(this.getIndices(),s);break;default:case d.Material.TriangleFillMode:i=this._unIndexed?null:this._geometry.getIndexBuffer()}return this._geometry._bind(t,i),this},b.prototype._draw=function(e,t,r,i){if(void 0===i&&(i=!1),!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeDrawObservable&&this._onBeforeDrawObservable.notifyObservers(this);var s=this.getScene(),n=s.getEngine();if(this._unIndexed||t==d.Material.PointFillMode?n.drawArraysType(t,e.verticesStart,e.verticesCount,r):t==d.Material.WireFrameFillMode?n.drawElementsType(t,0,e._linesIndexCount,r):n.drawElementsType(t,e.indexStart,e.indexCount,r),s._isAlternateRenderingEnabled&&!i){var a=e.effect||this._effectiveMaterial.getEffect();if(!a||!s.activeCamera)return this;s._switchToAlternateCameraConfiguration(!0),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a),n.setViewport(s.activeCamera._alternateCamera.viewport),this._draw(e,t,r,!0),n.setViewport(s.activeCamera.viewport),s._switchToAlternateCameraConfiguration(!1),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a)}return this},b.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},b.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},b.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},b.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},b.prototype._getInstancesRenderList=function(e){var t=this.getScene(),r=this._instanceDataStorage.batchCache;if(r.mustReturn=!1,r.renderSelf[e]=this.isEnabled()&&this.isVisible,r.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances){var i=this._instanceDataStorage.visibleInstances,s=t.getRenderId(),n=t._isInIntermediateRendering()?i.intermediateDefaultRenderId:i.defaultRenderId;r.visibleInstances[e]=i[s];var a=this._renderId;!r.visibleInstances[e]&&n&&(r.visibleInstances[e]=i[n],s=Math.max(n,s),a=Math.max(i.selfDefaultRenderId,s));var o=r.visibleInstances[e];if(o&&o.length){if(this._instanceDataStorage.renderIdForInstances[e]===s)return r.mustReturn=!0,r;s!==a&&(r.renderSelf[e]=!1)}this._instanceDataStorage.renderIdForInstances[e]=s}return r},b.prototype._renderWithInstances=function(e,t,r,i,s){var n=r.visibleInstances[e._id];if(!n)return this;for(var a=16*(n.length+1)*4,h=this._instanceDataStorage,l=h.instancesBufferSize,c=h.instancesBuffer;h.instancesBufferSize<a;)h.instancesBufferSize*=2;h.instancesData&&l==h.instancesBufferSize||(h.instancesData=new Float32Array(h.instancesBufferSize/4));var u=0,f=0,d=this.getWorldMatrix();if(r.renderSelf[e._id]&&(d.copyToArray(h.instancesData,u),u+=16,f++),n)for(var g=0;g<n.length;g++){n[g].getWorldMatrix().copyToArray(h.instancesData,u),u+=16,f++}return c&&l==h.instancesBufferSize?c.updateDirectly(h.instancesData,0,f):(c&&c.dispose(),c=new o.Buffer(s,h.instancesData,!0,16,!1,!0),h.instancesBuffer=c,this.setVerticesBuffer(c.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(c.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(c.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(c.createVertexBuffer("world3",12,4))),this._bind(e,i,t),this._draw(e,t,f),s.unbindInstanceAttributes(),this},b.prototype._processRendering=function(e,t,r,i,s,n,a){var o=this.getScene().getEngine();if(s)this._renderWithInstances(e,r,i,t,o);else{i.renderSelf[e._id]&&(n&&n(!1,this.getWorldMatrix(),a),this._draw(e,r,this._instanceDataStorage.overridenInstanceCount));var h=i.visibleInstances[e._id];if(h)for(var l=0;l<h.length;l++){var c=h[l].getWorldMatrix();n&&n(!0,c,a),this._draw(e,r)}}return this},b.prototype.render=function(e,t){if(this._checkOcclusionQuery())return this;var r=this.getScene(),i=this._getInstancesRenderList(e._id);if(i.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeRenderObservable&&this._onBeforeRenderObservable.notifyObservers(this);var s,n=r.getEngine(),a=n.getCaps().instancedArrays&&null!==i.visibleInstances[e._id]&&void 0!==i.visibleInstances[e._id],o=e.getMaterial();if(!o)return this;if(this._effectiveMaterial=o,this._effectiveMaterial._storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,e,a))return this}else if(!this._effectiveMaterial.isReady(this,a))return this;t&&n.setAlphaMode(this._effectiveMaterial.alphaMode);for(var h=0,l=r._beforeRenderingMeshStage;h<l.length;h++){l[h].action(this,e,i)}if(!(s=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var c=this.skeleton&&this.skeleton.overrideMesh||this,u=this.overrideMaterialSideOrientation;null==u&&(u=this._effectiveMaterial.sideOrientation,c._getWorldMatrixDeterminant()<0&&(u=u===d.Material.ClockWiseSideOrientation?d.Material.CounterClockWiseSideOrientation:d.Material.ClockWiseSideOrientation));var f=this._effectiveMaterial._preBind(s,u);this._effectiveMaterial.forceDepthWrite&&n.setDepthWrite(!0);var g=r.forcePointsCloud?d.Material.PointFillMode:r.forceWireframe?d.Material.WireFrameFillMode:this._effectiveMaterial.fillMode;a||this._bind(e,s,g);var p=c.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(p,this,e):this._effectiveMaterial.bind(p,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(n.setState(!0,this._effectiveMaterial.zOffset,!1,!f),this._processRendering(e,s,g,i,a,this._onBeforeDraw,this._effectiveMaterial),n.setState(!0,this._effectiveMaterial.zOffset,!1,f)),this._processRendering(e,s,g,i,a,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var m=0,y=r._afterRenderingMeshStage;m<y.length;m++){y[m].action(this,e,i)}return this._onAfterRenderObservable&&this._onAfterRenderObservable.notifyObservers(this),this},b.prototype._onBeforeDraw=function(e,t,r){e&&r&&r.bindOnlyWorldMatrix(t)},b.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(o.VertexBuffer.MatricesWeightsKind)&&(this.isVerticesDataPresent(o.VertexBuffer.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},b.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind),t=e.length,r=0;r<t;r+=4){var i=e[r]+e[r+1]+e[r+2]+e[r+3];if(0===i)e[r]=1;else{var s=1/i;e[r]*=s,e[r+1]*=s,e[r+2]*=s,e[r+3]*=s}}this.setVerticesData(o.VertexBuffer.MatricesWeightsKind,e)},b.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(o.VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind),r=t.length,i=0;i<r;i+=4){var s=t[i]+t[i+1]+t[i+2]+t[i+3];if(0===(s+=e[i]+e[i+1]+e[i+2]+e[i+3]))t[i]=1;else{var n=1/s;t[i]*=n,t[i+1]*=n,t[i+2]*=n,t[i+3]*=n,e[i]*=n,e[i+1]*=n,e[i+2]*=n,e[i+3]*=n}}this.setVerticesData(o.VertexBuffer.MatricesWeightsKind,t),this.setVerticesData(o.VertexBuffer.MatricesWeightsKind,e)},b.prototype.validateSkinning=function(){var e=this.getVerticesData(o.VertexBuffer.MatricesWeightsExtraKind),t=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var r=t.length,i=0,s=0,n=0,a=0,h=null===e?4:8,l=new Array,c=0;c<=h;c++)l[c]=0;for(c=0;c<r;c+=4){for(var u=t[c],f=u,d=0===f?0:1,g=1;g<h;g++){var p=g<4?t[c+g]:e[c+g-4];p>u&&i++,0!==p&&d++,f+=p,u=p}if(l[d]++,d>n&&(n=d),0===f)s++;else{var m=1/f,y=0;for(g=0;g<h;g++)y+=g<4?Math.abs(t[c+g]-t[c+g]*m):Math.abs(e[c+g-4]-e[c+g-4]*m);y>.001&&a++}}var v=this.skeleton.bones.length,_=this.getVerticesData(o.VertexBuffer.MatricesIndicesKind),b=this.getVerticesData(o.VertexBuffer.MatricesIndicesExtraKind),M=0;for(c=0;c<r;c++)for(g=0;g<h;g++){var I=g<4?_[g]:b[g-4];(I>=v||I<0)&&M++}return{skinned:!0,valid:0===s&&0===a&&0===M,report:"Number of Weights = "+r/4+"\nMaximum influences = "+n+"\nMissing Weights = "+s+"\nNot Sorted = "+i+"\nNot Normalized = "+a+"\nWeightCounts = ["+l+"]\nNumber of bones = "+v+"\nBad Bone Indices = "+M}},b.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):this.delayLoadState===y.Constants.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=y.Constants.DELAYLOADSTATE_LOADING,this._queueLoad(e)),this},b.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var i=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return r.Tools.LoadFile(this.delayLoadingFile,function(r){r instanceof ArrayBuffer?t._delayLoadingFunction(r,t):t._delayLoadingFunction(JSON.parse(r),t),t.instances.forEach(function(e){e._syncSubMeshes()}),t.delayLoadState=y.Constants.DELAYLOADSTATE_LOADED,e._removePendingData(t)},function(){},e.offlineProvider,i),this},b.prototype.isInFrustum=function(e){return this.delayLoadState!==y.Constants.DELAYLOADSTATE_LOADING&&(!!c.prototype.isInFrustum.call(this,e)&&(this._checkDelayState(),!0))},b.prototype.setMaterialByID=function(e){var t,r=this.getScene().materials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;var i=this.getScene().multiMaterials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;return this},b.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},b.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(o.VertexBuffer.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var r,i=this.getVerticesData(o.VertexBuffer.PositionKind),s=new Array;for(r=0;r<i.length;r+=3)n.Vector3.TransformCoordinates(n.Vector3.FromArray(i,r),e).toArray(s,r);if(this.setVerticesData(o.VertexBuffer.PositionKind,s,this.getVertexBuffer(o.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(o.VertexBuffer.NormalKind)){for(i=this.getVerticesData(o.VertexBuffer.NormalKind),s=[],r=0;r<i.length;r+=3)n.Vector3.TransformNormal(n.Vector3.FromArray(i,r),e).normalize().toArray(s,r);this.setVerticesData(o.VertexBuffer.NormalKind,s,this.getVertexBuffer(o.VertexBuffer.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},b.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=n.Quaternion.Identity()),this._worldMatrix=n.Matrix.Identity(),this},Object.defineProperty(b.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),b.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},b.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},b.prototype.clone=function(e,t,r,i){return void 0===e&&(e=""),void 0===i&&(i=!0),new b(e,this.getScene(),t,this,r,i)},b.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0),this._onBeforeDrawObservable&&this._onBeforeDrawObservable.clear(),this._onBeforeRenderObservable&&this._onBeforeRenderObservable.clear(),this._onAfterRenderObservable&&this._onAfterRenderObservable.clear(),this._scene.useClonedMeshhMap){if(this.meshMap)for(var r in this.meshMap){(n=this.meshMap[r])&&(n._source=null,this.meshMap[r]=void 0)}this._source&&this._source.meshMap&&(this._source.meshMap[this.uniqueId]=void 0)}else for(var i=0,s=this.getScene().meshes;i<s.length;i++){var n;(n=s[i])._source&&n._source===this&&(n._source=null)}for(this._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();c.prototype.dispose.call(this,e,t)},b.prototype.applyDisplacementMap=function(e,t,i,s,n,a,o){var h=this;void 0===o&&(o=!1);var l=this.getScene();return r.Tools.LoadImage(e,function(e){var r=document.createElement("canvas"),l=r.getContext("2d"),c=e.width,u=e.height;r.width=c,r.height=u,l.drawImage(e,0,0);var f=l.getImageData(0,0,c,u).data;h.applyDisplacementMapFromBuffer(f,c,u,t,i,n,a,o),s&&s(h)},function(){},l.offlineProvider),this},b.prototype.applyDisplacementMapFromBuffer=function(e,t,r,i,s,a,l,c){if(void 0===c&&(c=!1),!this.isVerticesDataPresent(o.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(o.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(o.VertexBuffer.UVKind))return _.Logger.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var u=this.getVerticesData(o.VertexBuffer.PositionKind,!0,!0),f=this.getVerticesData(o.VertexBuffer.NormalKind),d=this.getVerticesData(o.VertexBuffer.UVKind),g=n.Vector3.Zero(),p=n.Vector3.Zero(),m=n.Vector2.Zero();a=a||n.Vector2.Zero(),l=l||new n.Vector2(1,1);for(var y=0;y<u.length;y+=3){n.Vector3.FromArrayToRef(u,y,g),n.Vector3.FromArrayToRef(f,y,p),n.Vector2.FromArrayToRef(d,y/3*2,m);var v=4*((Math.abs(m.x*l.x+a.x)*t%t|0)+(Math.abs(m.y*l.y+a.y)*r%r|0)*t),b=.3*(e[v]/255)+.59*(e[v+1]/255)+.11*(e[v+2]/255);p.normalize(),p.scaleInPlace(i+(s-i)*b),(g=g.add(p)).toArray(u,y)}return h.VertexData.ComputeNormals(u,this.getIndices(),f),c?(this.setVerticesData(o.VertexBuffer.PositionKind,u),this.setVerticesData(o.VertexBuffer.NormalKind,f)):(this.updateVerticesData(o.VertexBuffer.PositionKind,u),this.updateVerticesData(o.VertexBuffer.NormalKind,f)),this},b.prototype.convertToFlatShadedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},s={},a={},h=!1;for(e=0;e<r.length;e++){t=r[e];var l=this.getVertexBuffer(t);t!==o.VertexBuffer.NormalKind?(i[t]=l,s[t]=i[t].getData(),a[t]=[]):(h=l.isUpdatable(),r.splice(e,1),e--)}var c,f=this.subMeshes.slice(0),d=this.getIndices(),g=this.getTotalIndices();for(c=0;c<g;c++){var p=d[c];for(e=0;e<r.length;e++)for(var m=i[t=r[e]].getStrideSize(),y=0;y<m;y++)a[t].push(s[t][p*m+y])}var v=[],_=a[o.VertexBuffer.PositionKind];for(c=0;c<g;c+=3){d[c]=c,d[c+1]=c+1,d[c+2]=c+2;for(var b=n.Vector3.FromArray(_,3*c),M=n.Vector3.FromArray(_,3*(c+1)),I=n.Vector3.FromArray(_,3*(c+2)),x=b.subtract(M),V=I.subtract(M),D=n.Vector3.Normalize(n.Vector3.Cross(x,V)),B=0;B<3;B++)v.push(D.x),v.push(D.y),v.push(D.z)}for(this.setIndices(d),this.setVerticesData(o.VertexBuffer.NormalKind,v,h),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,a[t],i[t].isUpdatable());this.releaseSubMeshes();for(var S=0;S<f.length;S++){var A=f[S];u.SubMesh.AddToMesh(A.materialIndex,A.indexStart,A.indexCount,A.indexStart,A.indexCount,this)}return this.synchronizeInstances(),this},b.prototype.convertToUnIndexedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},s={},n={};for(e=0;e<r.length;e++){t=r[e];var a=this.getVertexBuffer(t);i[t]=a,s[t]=i[t].getData(),n[t]=[]}var o,h=this.subMeshes.slice(0),l=this.getIndices(),c=this.getTotalIndices();for(o=0;o<c;o++){var f=l[o];for(e=0;e<r.length;e++)for(var d=i[t=r[e]].getStrideSize(),g=0;g<d;g++)n[t].push(s[t][f*d+g])}for(o=0;o<c;o+=3)l[o]=o,l[o+1]=o+1,l[o+2]=o+2;for(this.setIndices(l),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,n[t],i[t].isUpdatable());this.releaseSubMeshes();for(var p=0;p<h.length;p++){var m=h[p];u.SubMesh.AddToMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},b.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,r,i=h.VertexData.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(o.VertexBuffer.NormalKind)&&i.normals)for(t=0;t<i.normals.length;t++)i.normals[t]*=-1;if(i.indices)for(t=0;t<i.indices.length;t+=3)r=i.indices[t+1],i.indices[t+1]=i.indices[t+2],i.indices[t+2]=r;return i.applyToMesh(this),this},b.prototype.createInstance=function(e){return b._instancedMeshFactory(e,this)},b.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this},b.prototype.optimizeIndices=function(e){var t=this,i=this.getIndices(),s=this.getVerticesData(o.VertexBuffer.PositionKind);if(!s||!i)return this;for(var a=new Array,h=0;h<s.length;h+=3)a.push(n.Vector3.FromArray(s,h));var l=new Array;return r.AsyncLoop.SyncAsyncForLoop(a.length,40,function(e){for(var t=a.length-1-e,r=a[t],i=0;i<t;++i){var s=a[i];if(r.equals(s)){l[t]=i;break}}},function(){for(var r=0;r<i.length;++r)i[r]=l[i[r]]||i[r];var s=t.subMeshes.slice(0);t.setIndices(i),t.subMeshes=s,e&&e(t)}),this},b.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),s.Tags&&s.Tags.HasTags(this)&&(e.tags=s.Tags.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t){var r=t.id;e.geometryId=r,e.subMeshes=[];for(var i=0;i<this.subMeshes.length;i++){var n=this.subMeshes[i];e.subMeshes.push({materialIndex:n.materialIndex,verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount})}}this.material?e.materialId=this.material.id:this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id);var a=this.getPhysicsImpostor();a&&(e.physicsMass=a.getParam("mass"),e.physicsFriction=a.getParam("friction"),e.physicsRestitution=a.getParam("mass"),e.physicsImpostor=a.type),this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var o=0;o<this.instances.length;o++){var h=this.instances[o];if(!h.doNotSerialize){var l={name:h.name,id:h.id,position:h.position.asArray(),scaling:h.scaling.asArray()};h.parent&&(l.parentId=h.parent.id),h.rotationQuaternion?l.rotationQuaternion=h.rotationQuaternion.asArray():h.rotation&&(l.rotation=h.rotation.asArray()),e.instances.push(l),v.SerializationHelper.AppendSerializedAnimations(h,l),l.ranges=h.serializeAnimationRanges()}}v.SerializationHelper.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},b.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return _.Logger.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var r=e.getActiveTarget(t),i=r.getPositions();if(!i)return void _.Logger.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(o.VertexBuffer.PositionKind+t,i,!1,3);var s=r.getNormals();s&&this.geometry.setVerticesData(o.VertexBuffer.NormalKind+t,s,!1,3);var n=r.getTangents();n&&this.geometry.setVerticesData(o.VertexBuffer.TangentKind+t,n,!1,3)}}else for(t=0;this.geometry.isVerticesDataPresent(o.VertexBuffer.PositionKind+t);)this.geometry.removeVerticesData(o.VertexBuffer.PositionKind+t),this.geometry.isVerticesDataPresent(o.VertexBuffer.NormalKind+t)&&this.geometry.removeVerticesData(o.VertexBuffer.NormalKind+t),this.geometry.isVerticesDataPresent(o.VertexBuffer.TangentKind+t)&&this.geometry.removeVerticesData(o.VertexBuffer.TangentKind+t),t++}},b.Parse=function(e,t,r){var i;if((i=e.type&&"GroundMesh"===e.type?b._GroundMeshParser(e,t):new b(e.name,t)).id=e.id,s.Tags&&s.Tags.AddTagsTo(i,e.tags),i.position=n.Vector3.FromArray(e.position),void 0!==e.metadata&&(i.metadata=e.metadata),e.rotationQuaternion?i.rotationQuaternion=n.Quaternion.FromArray(e.rotationQuaternion):e.rotation&&(i.rotation=n.Vector3.FromArray(e.rotation)),i.scaling=n.Vector3.FromArray(e.scaling),e.localMatrix?i.setPreTransformMatrix(n.Matrix.FromArray(e.localMatrix)):e.pivotMatrix&&i.setPivotMatrix(n.Matrix.FromArray(e.pivotMatrix)),i.setEnabled(e.isEnabled),i.isVisible=e.isVisible,i.infiniteDistance=e.infiniteDistance,i.showBoundingBox=e.showBoundingBox,i.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(i.applyFog=e.applyFog),void 0!==e.pickable&&(i.isPickable=e.pickable),void 0!==e.alphaIndex&&(i.alphaIndex=e.alphaIndex),i.receiveShadows=e.receiveShadows,i.billboardMode=e.billboardMode,void 0!==e.visibility&&(i.visibility=e.visibility),i.checkCollisions=e.checkCollisions,void 0!==e.isBlocker&&(i.isBlocker=e.isBlocker),i._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(i._waitingFreezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(i._waitingParentId=e.parentId),void 0!==e.actions&&(i._waitingActions=e.actions),void 0!==e.overlayAlpha&&(i.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(i.overlayColor=n.Color3.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(i.renderOverlay=e.renderOverlay),i.isUnIndexed=!!e.isUnIndexed,i.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(i.delayLoadState=y.Constants.DELAYLOADSTATE_NOTLOADED,i.delayLoadingFile=r+e.delayLoadingFile,i._boundingInfo=new f.BoundingInfo(n.Vector3.FromArray(e.boundingBoxMinimum),n.Vector3.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(i._binaryInfo=e._binaryInfo),i._delayInfo=[],e.hasUVs&&i._delayInfo.push(o.VertexBuffer.UVKind),e.hasUVs2&&i._delayInfo.push(o.VertexBuffer.UV2Kind),e.hasUVs3&&i._delayInfo.push(o.VertexBuffer.UV3Kind),e.hasUVs4&&i._delayInfo.push(o.VertexBuffer.UV4Kind),e.hasUVs5&&i._delayInfo.push(o.VertexBuffer.UV5Kind),e.hasUVs6&&i._delayInfo.push(o.VertexBuffer.UV6Kind),e.hasColors&&i._delayInfo.push(o.VertexBuffer.ColorKind),e.hasMatricesIndices&&i._delayInfo.push(o.VertexBuffer.MatricesIndicesKind),e.hasMatricesWeights&&i._delayInfo.push(o.VertexBuffer.MatricesWeightsKind),i._delayLoadingFunction=l.Geometry._ImportGeometry,p.SceneLoaderFlags.ForceFullSceneLoadingForIncremental&&i._checkDelayState()):l.Geometry._ImportGeometry(e,i),e.materialId?i.setMaterialByID(e.materialId):i.material=null,e.morphTargetManagerId>-1&&(i.morphTargetManager=t.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId>-1&&(i.skeleton=t.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(i.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var h=0;h<e.animations.length;h++){var c=e.animations[h];i.animations.push(g.Animation.Parse(c))}a.Node.ParseAnimationRanges(i,e,t)}if(e.autoAnimate&&t.beginAnimation(i,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?i.layerMask=Math.abs(parseInt(e.layerMask)):i.layerMask=268435455,e.physicsImpostor&&(i.physicsImpostor=new m.PhysicsImpostor(i,e.physicsImpostor,{mass:e.physicsMass,friction:e.physicsFriction,restitution:e.physicsRestitution},t)),e.instances)for(var u=0;u<e.instances.length;u++){var d=e.instances[u],v=i.createInstance(d.name);if(d.id&&(v.id=d.id),s.Tags&&(d.tags?s.Tags.AddTagsTo(v,d.tags):s.Tags.AddTagsTo(v,e.tags)),v.position=n.Vector3.FromArray(d.position),d.parentId&&(v._waitingParentId=d.parentId),d.rotationQuaternion?v.rotationQuaternion=n.Quaternion.FromArray(d.rotationQuaternion):d.rotation&&(v.rotation=n.Vector3.FromArray(d.rotation)),v.scaling=n.Vector3.FromArray(d.scaling),null!=d.checkCollisions&&null!=d.checkCollisions&&(v.checkCollisions=d.checkCollisions),null!=d.pickable&&null!=d.pickable&&(v.isPickable=d.pickable),null!=d.showBoundingBox&&null!=d.showBoundingBox&&(v.showBoundingBox=d.showBoundingBox),null!=d.showSubMeshesBoundingBox&&null!=d.showSubMeshesBoundingBox&&(v.showSubMeshesBoundingBox=d.showSubMeshesBoundingBox),null!=d.alphaIndex&&null!=d.showSubMeshesBoundingBox&&(v.alphaIndex=d.alphaIndex),d.physicsImpostor&&(v.physicsImpostor=new m.PhysicsImpostor(v,d.physicsImpostor,{mass:d.physicsMass,friction:d.physicsFriction,restitution:d.physicsRestitution},t)),d.animations){for(h=0;h<d.animations.length;h++)c=d.animations[h],v.animations.push(g.Animation.Parse(c));a.Node.ParseAnimationRanges(v,d,t),d.autoAnimate&&t.beginAnimation(v,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1)}}return i},b.CreateRibbon=function(e,t,r,i,s,n,a,o,h){throw"Import MeshBuilder before creating meshes."},b.CreateDisc=function(e,t,r,i,s,n){throw void 0===i&&(i=null),"Import MeshBuilder before creating meshes."},b.CreateBox=function(e,t,r,i,s){throw void 0===r&&(r=null),"Import MeshBuilder before creating meshes."},b.CreateSphere=function(e,t,r,i,s,n){throw"Import MeshBuilder before creating meshes."},b.CreateCylinder=function(e,t,r,i,s,n,a,o,h){throw"Import MeshBuilder before creating meshes."},b.CreateTorus=function(e,t,r,i,s,n,a){throw"Import MeshBuilder before creating meshes."},b.CreateTorusKnot=function(e,t,r,i,s,n,a,o,h,l){throw"Import MeshBuilder before creating meshes."},b.CreateLines=function(e,t,r,i,s){throw void 0===r&&(r=null),void 0===i&&(i=!1),void 0===s&&(s=null),"Import MeshBuilder before creating meshes."},b.CreateDashedLines=function(e,t,r,i,s,n,a,o){throw void 0===n&&(n=null),"Import MeshBuilder before creating meshes."},b.CreatePolygon=function(e,t,r,i,s,n){throw"Import MeshBuilder before creating meshes."},b.ExtrudePolygon=function(e,t,r,i,s,n,a){throw"Import MeshBuilder before creating meshes."},b.ExtrudeShape=function(e,t,r,i,s,n,a,o,h,l){throw void 0===a&&(a=null),"Import MeshBuilder before creating meshes."},b.ExtrudeShapeCustom=function(e,t,r,i,s,n,a,o,h,l,c,u){throw"Import MeshBuilder before creating meshes."},b.CreateLathe=function(e,t,r,i,s,n,a){throw"Import MeshBuilder before creating meshes."},b.CreatePlane=function(e,t,r,i,s){throw"Import MeshBuilder before creating meshes."},b.CreateGround=function(e,t,r,i,s,n){throw"Import MeshBuilder before creating meshes."},b.CreateTiledGround=function(e,t,r,i,s,n,a,o,h){throw"Import MeshBuilder before creating meshes."},b.CreateGroundFromHeightMap=function(e,t,r,i,s,n,a,o,h,l,c){throw"Import MeshBuilder before creating meshes."},b.CreateTube=function(e,t,r,i,s,n,a,o,h,l){throw"Import MeshBuilder before creating meshes."},b.CreatePolyhedron=function(e,t,r){throw"Import MeshBuilder before creating meshes."},b.CreateIcoSphere=function(e,t,r){throw"Import MeshBuilder before creating meshes."},b.CreateDecal=function(e,t,r,i,s,n){throw"Import MeshBuilder before creating meshes."},b.prototype.setPositionsForCPUSkinning=function(){if(!this._sourcePositions){var e=this.getVerticesData(o.VertexBuffer.PositionKind);if(!e)return this._sourcePositions;this._sourcePositions=new Float32Array(e),this.isVertexBufferUpdatable(o.VertexBuffer.PositionKind)||this.setVerticesData(o.VertexBuffer.PositionKind,e,!0)}return this._sourcePositions},b.prototype.setNormalsForCPUSkinning=function(){if(!this._sourceNormals){var e=this.getVerticesData(o.VertexBuffer.NormalKind);if(!e)return this._sourceNormals;this._sourceNormals=new Float32Array(e),this.isVertexBufferUpdatable(o.VertexBuffer.NormalKind)||this.setVerticesData(o.VertexBuffer.NormalKind,e,!0)}return this._sourceNormals},b.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(o.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(o.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(o.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(o.VertexBuffer.MatricesWeightsKind))return this;if(!this._sourcePositions){var t=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=t}this._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(o.VertexBuffer.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var i=this.getVerticesData(o.VertexBuffer.NormalKind);if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i));var s=this.getVerticesData(o.VertexBuffer.MatricesIndicesKind),a=this.getVerticesData(o.VertexBuffer.MatricesWeightsKind);if(!a||!s)return this;for(var h,l=this.numBoneInfluencers>4,c=l?this.getVerticesData(o.VertexBuffer.MatricesIndicesExtraKind):null,u=l?this.getVerticesData(o.VertexBuffer.MatricesWeightsExtraKind):null,f=e.getTransformMatrices(this),d=n.Vector3.Zero(),g=new n.Matrix,p=new n.Matrix,m=0,y=0;y<r.length;y+=3,m+=4){var v;for(h=0;h<4;h++)(v=a[m+h])>0&&(n.Matrix.FromFloat32ArrayToRefScaled(f,Math.floor(16*s[m+h]),v,p),g.addToSelf(p));if(l)for(h=0;h<4;h++)(v=u[m+h])>0&&(n.Matrix.FromFloat32ArrayToRefScaled(f,Math.floor(16*c[m+h]),v,p),g.addToSelf(p));n.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[y],this._sourcePositions[y+1],this._sourcePositions[y+2],g,d),d.toArray(r,y),n.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[y],this._sourceNormals[y+1],this._sourceNormals[y+2],g,d),d.toArray(i,y),g.reset()}return this.updateVerticesData(o.VertexBuffer.PositionKind,r),this.updateVerticesData(o.VertexBuffer.NormalKind,i),this},b.MinMax=function(e){var t=null,r=null;return e.forEach(function(e){var i=e.getBoundingInfo().boundingBox;t&&r?(t.minimizeInPlace(i.minimumWorld),r.maximizeInPlace(i.maximumWorld)):(t=i.minimumWorld,r=i.maximumWorld)}),t&&r?{min:t,max:r}:{min:n.Vector3.Zero(),max:n.Vector3.Zero()}},b.Center=function(e){var t=e instanceof Array?b.MinMax(e):e;return n.Vector3.Center(t.min,t.max)},b.MergeMeshes=function(e,t,r,i,s){var n;if(void 0===t&&(t=!0),!r){var a=0;for(n=0;n<e.length;n++)if(e[n]&&(a+=e[n].getTotalVertices())>65536)return _.Logger.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var o,l=null,c=new Array,f=null;for(n=0;n<e.length;n++)if(e[n]){var d=e[n].computeWorldMatrix(!0);(o=h.VertexData.ExtractFromMesh(e[n],!0,!0)).transform(d),l?l.merge(o,r):(l=o,f=e[n]),s&&c.push(e[n].getTotalIndices())}if(f=f,i||(i=new b(f.name+"_merged",f.getScene())),l.applyToMesh(i),i.material=f.material,i.checkCollisions=f.checkCollisions,t)for(n=0;n<e.length;n++)e[n]&&e[n].dispose();if(s){i.releaseSubMeshes(),n=0;for(var g=0;n<c.length;)u.SubMesh.CreateFromIndices(0,g,c[n],i),g+=c[n],n++}return i},b.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},b.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var r=this.instances[this.instances.length-1];this.instances[t]=r,r._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},b.FRONTSIDE=h.VertexData.FRONTSIDE,b.BACKSIDE=h.VertexData.BACKSIDE,b.DOUBLESIDE=h.VertexData.DOUBLESIDE,b.DEFAULTSIDE=h.VertexData.DEFAULTSIDE,b.NO_CAP=0,b.CAP_START=1,b.CAP_END=2,b.CAP_ALL=3,b._instancedMeshFactory=function(e,t){throw"Import InstancedMesh before creating instances."},b._GroundMeshParser=function(e,t){throw"Import GroundMesh before trying to parse it."},b}(c.AbstractMesh);exports.Mesh=D;
},{"tslib":"vCxL","../Misc/observable":"gtkL","../Misc/tools":"RkuS","../Misc/deepCopier":"RVA4","../Misc/tags":"Ae8d","../Maths/math":"Iizi","../node":"P+He","./buffer":"YHhW","./mesh.vertexData":"+kld","./geometry":"QQcI","./abstractMesh":"Nnvo","./subMesh":"7vfu","../Culling/boundingInfo":"1eEz","../Materials/material":"v46b","../Animations/animation":"8SP4","../Loading/sceneLoaderFlags":"Gju8","../Physics/physicsImpostor":"jNlR","../Engines/constants":"vn8z","../Misc/decorators":"knvU","../Misc/logger":"Fvml"}],"iqPq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MeshBuilder=void 0;var e=require("../Misc/tools"),t=require("../scene"),a=require("../Maths/math"),r=require("./mesh"),n=require("./buffer"),i=require("./linesMesh"),o=require("./mesh.vertexData"),s=require("./groundMesh"),u=require("./polygonMesh"),l=require("../Culling/boundingInfo");r.Mesh.CreateRibbon=function(e,t,a,r,n,i,o,s,u){return void 0===a&&(a=!1),void 0===o&&(o=!1),d.CreateRibbon(e,{pathArray:t,closeArray:a,closePath:r,offset:n,updatable:o,sideOrientation:s,instance:u},i)},r.Mesh.CreateDisc=function(e,t,a,r,n,i){void 0===r&&(r=null);var o={radius:t,tessellation:a,sideOrientation:i,updatable:n};return d.CreateDisc(e,o,r)},r.Mesh.CreateBox=function(e,t,a,r,n){void 0===a&&(a=null);var i={size:t,sideOrientation:n,updatable:r};return d.CreateBox(e,i,a)},r.Mesh.CreateSphere=function(e,t,a,r,n,i){var o={segments:t,diameterX:a,diameterY:a,diameterZ:a,sideOrientation:i,updatable:n};return d.CreateSphere(e,o,r)},r.Mesh.CreateCylinder=function(e,a,n,i,o,s,u,l,h){void 0!==u&&u instanceof t.Scene||(void 0!==u&&(h=l||r.Mesh.DEFAULTSIDE,l=u),u=s,s=1);var c={height:a,diameterTop:n,diameterBottom:i,tessellation:o,subdivisions:s,sideOrientation:h,updatable:l};return d.CreateCylinder(e,c,u)},r.Mesh.CreateTorus=function(e,t,a,r,n,i,o){var s={diameter:t,thickness:a,tessellation:r,sideOrientation:o,updatable:i};return d.CreateTorus(e,s,n)},r.Mesh.CreateTorusKnot=function(e,t,a,r,n,i,o,s,u,l){var h={radius:t,tube:a,radialSegments:r,tubularSegments:n,p:i,q:o,sideOrientation:l,updatable:u};return d.CreateTorusKnot(e,h,s)},r.Mesh.CreateLines=function(e,t,a,r,n){void 0===a&&(a=null),void 0===r&&(r=!1),void 0===n&&(n=null);var i={points:t,updatable:r,instance:n};return d.CreateLines(e,i,a)},r.Mesh.CreateDashedLines=function(e,t,a,r,n,i,o,s){void 0===i&&(i=null);var u={points:t,dashSize:a,gapSize:r,dashNb:n,updatable:o,instance:s};return d.CreateDashedLines(e,u,i)},r.Mesh.CreatePolygon=function(e,t,a,r,n,i){var o={shape:t,holes:r,updatable:n,sideOrientation:i};return d.CreatePolygon(e,o,a)},r.Mesh.ExtrudePolygon=function(e,t,a,r,n,i,o){var s={shape:t,holes:n,depth:a,updatable:i,sideOrientation:o};return d.ExtrudePolygon(e,s,r)},r.Mesh.ExtrudeShape=function(e,t,a,n,i,o,s,u,l,h){void 0===s&&(s=null);var c={shape:t,path:a,scale:n,rotation:i,cap:0===o?0:o||r.Mesh.NO_CAP,sideOrientation:l,instance:h,updatable:u};return d.ExtrudeShape(e,c,s)},r.Mesh.ExtrudeShapeCustom=function(e,t,a,n,i,o,s,u,l,h,c,p){var f={shape:t,path:a,scaleFunction:n,rotationFunction:i,ribbonCloseArray:o,ribbonClosePath:s,cap:0===u?0:u||r.Mesh.NO_CAP,sideOrientation:c,instance:p,updatable:h};return d.ExtrudeShapeCustom(e,f,l)},r.Mesh.CreateLathe=function(e,t,a,r,n,i,o){var s={shape:t,radius:a,tessellation:r,sideOrientation:o,updatable:i};return d.CreateLathe(e,s,n)},r.Mesh.CreatePlane=function(e,t,a,r,n){var i={size:t,width:t,height:t,sideOrientation:n,updatable:r};return d.CreatePlane(e,i,a)},r.Mesh.CreateGround=function(e,t,a,r,n,i){var o={width:t,height:a,subdivisions:r,updatable:i};return d.CreateGround(e,o,n)},r.Mesh.CreateTiledGround=function(e,t,a,r,n,i,o,s,u){var l={xmin:t,zmin:a,xmax:r,zmax:n,subdivisions:i,precision:o,updatable:u};return d.CreateTiledGround(e,l,s)},r.Mesh.CreateGroundFromHeightMap=function(e,t,a,r,n,i,o,s,u,l,h){var c={width:a,height:r,subdivisions:n,minHeight:i,maxHeight:o,updatable:u,onReady:l,alphaFilter:h};return d.CreateGroundFromHeightMap(e,t,c,s)},r.Mesh.CreateTube=function(e,t,a,r,n,i,o,s,u,l){var h={path:t,radius:a,tessellation:r,radiusFunction:n,arc:1,cap:i,updatable:s,sideOrientation:u,instance:l};return d.CreateTube(e,h,o)},r.Mesh.CreatePolyhedron=function(e,t,a){return d.CreatePolyhedron(e,t,a)},r.Mesh.CreateIcoSphere=function(e,t,a){return d.CreateIcoSphere(e,t,a)},r.Mesh.CreateDecal=function(e,t,a,r,n,i){var o={position:a,normal:r,size:n,angle:i};return d.CreateDecal(e,t,o)};var d=function(){function t(){}return t._UpdateSideOrientation=function(e){return e==r.Mesh.DOUBLESIDE?r.Mesh.DOUBLESIDE:null==e?r.Mesh.FRONTSIDE:e},t.CreateBox=function(e,a,n){void 0===n&&(n=null);var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateBox(a).applyToMesh(i,a.updatable),i},t.CreateSphere=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateSphere(a).applyToMesh(i,a.updatable),i},t.CreateDisc=function(e,a,n){void 0===n&&(n=null);var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateDisc(a).applyToMesh(i,a.updatable),i},t.CreateIcoSphere=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateIcoSphere(a).applyToMesh(i,a.updatable),i},t.CreateRibbon=function(e,i,s){void 0===s&&(s=null);var u=i.pathArray,d=i.closeArray,h=i.closePath,c=t._UpdateSideOrientation(i.sideOrientation),p=i.instance,f=i.updatable;if(p){var g=a.Tmp.Vector3[0].setAll(Number.MAX_VALUE),v=a.Tmp.Vector3[1].setAll(-Number.MAX_VALUE),C=p.getVerticesData(n.VertexBuffer.PositionKind);if(function(e){for(var t=u[0].length,a=p,n=0,i=a._originalBuilderSideOrientation===r.Mesh.DOUBLESIDE?2:1,o=1;o<=i;++o)for(var s=0;s<u.length;++s){var l=u[s],d=l.length;t=t<d?t:d;for(var h=0;h<t;++h){var c=l[h];e[n]=c.x,e[n+1]=c.y,e[n+2]=c.z,g.minimizeInPlaceFromFloats(c.x,c.y,c.z),v.maximizeInPlaceFromFloats(c.x,c.y,c.z),n+=3}a._creationDataStorage&&a._creationDataStorage.closePath&&(c=l[0],e[n]=c.x,e[n+1]=c.y,e[n+2]=c.z,n+=3)}}(C),p._boundingInfo?p._boundingInfo.reConstruct(g,v,p._worldMatrix):p._boundingInfo=new l.BoundingInfo(g,v,p._worldMatrix),p.updateVerticesData(n.VertexBuffer.PositionKind,C,!1,!1),i.colors){for(var b=p.getVerticesData(n.VertexBuffer.ColorKind),M=0,_=0;M<i.colors.length;M++,_+=4){var x=i.colors[M];b[_]=x.r,b[_+1]=x.g,b[_+2]=x.b,b[_+3]=x.a}p.updateVerticesData(n.VertexBuffer.ColorKind,b,!1,!1)}if(i.uvs){for(var V=p.getVerticesData(n.VertexBuffer.UVKind),D=0;D<i.uvs.length;D++)V[2*D]=i.uvs[D].x,V[2*D+1]=i.uvs[D].y;p.updateVerticesData(n.VertexBuffer.UVKind,V,!1,!1)}if(!p.areNormalsFrozen||p.isFacetDataEnabled){var y=p.getIndices(),m=p.getVerticesData(n.VertexBuffer.NormalKind),S=p.isFacetDataEnabled?p.getFacetDataParameters():null;if(o.VertexData.ComputeNormals(C,y,m,S),p._creationDataStorage&&p._creationDataStorage.closePath)for(var O=0,P=0,A=0;A<u.length;A++)O=3*p._creationDataStorage.idx[A],P=A+1<u.length?3*(p._creationDataStorage.idx[A+1]-1):m.length-3,m[O]=.5*(m[O]+m[P]),m[O+1]=.5*(m[O+1]+m[P+1]),m[O+2]=.5*(m[O+2]+m[P+2]),m[P]=m[O],m[P+1]=m[O+1],m[P+2]=m[O+2];p.areNormalsFrozen||p.updateVerticesData(n.VertexBuffer.NormalKind,m,!1,!1)}return p}var w=new r.Mesh(e,s);w._originalBuilderSideOrientation=c,w._creationDataStorage=new r._CreationDataStorage;var T=o.VertexData.CreateRibbon(i);return h&&(w._creationDataStorage.idx=T._idx),w._creationDataStorage.closePath=h,w._creationDataStorage.closeArray=d,T.applyToMesh(w,f),w},t.CreateCylinder=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateCylinder(a).applyToMesh(i,a.updatable),i},t.CreateTorus=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateTorus(a).applyToMesh(i,a.updatable),i},t.CreateTorusKnot=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreateTorusKnot(a).applyToMesh(i,a.updatable),i},t.CreateLineSystem=function(e,t,a){var r=t.instance,s=t.lines,u=t.colors;if(r){var l,d,h=r.getVerticesData(n.VertexBuffer.PositionKind);u&&(l=r.getVerticesData(n.VertexBuffer.ColorKind));for(var c=0,p=0,f=0;f<s.length;f++)for(var g=s[f],v=0;v<g.length;v++)h[c]=g[v].x,h[c+1]=g[v].y,h[c+2]=g[v].z,u&&l&&(d=u[f],l[p]=d[v].r,l[p+1]=d[v].g,l[p+2]=d[v].b,l[p+3]=d[v].a,p+=4),c+=3;return r.updateVerticesData(n.VertexBuffer.PositionKind,h,!1,!1),u&&l&&r.updateVerticesData(n.VertexBuffer.ColorKind,l,!1,!1),r}var C=!!u,b=new i.LinesMesh(e,a,null,void 0,void 0,C,t.useVertexAlpha);return o.VertexData.CreateLineSystem(t).applyToMesh(b,t.updatable),b},t.CreateLines=function(e,a,r){void 0===r&&(r=null);var n=a.colors?[a.colors]:null;return t.CreateLineSystem(e,{lines:[a.points],updatable:a.updatable,instance:a.instance,colors:n,useVertexAlpha:a.useVertexAlpha},r)},t.CreateDashedLines=function(e,t,n){void 0===n&&(n=null);var s=t.points,u=t.instance,l=t.gapSize||1,d=t.dashSize||3;if(u){return u.updateMeshPositions(function(e){var t,r,n=a.Vector3.Zero(),i=e.length/6,o=0,l=0,d=0,h=0,c=0,p=0;for(c=0;c<s.length-1;c++)s[c+1].subtractToRef(s[c],n),o+=n.length();t=o/i;var f=u._creationDataStorage.dashSize;for(r=f*t/(f+u._creationDataStorage.gapSize),c=0;c<s.length-1;c++)for(s[c+1].subtractToRef(s[c],n),l=Math.floor(n.length()/t),n.normalize(),p=0;p<l&&h<e.length;)d=t*p,e[h]=s[c].x+d*n.x,e[h+1]=s[c].y+d*n.y,e[h+2]=s[c].z+d*n.z,e[h+3]=s[c].x+(d+r)*n.x,e[h+4]=s[c].y+(d+r)*n.y,e[h+5]=s[c].z+(d+r)*n.z,h+=6,p++;for(;h<e.length;)e[h]=s[c].x,e[h+1]=s[c].y,e[h+2]=s[c].z,h+=3},!1),u}var h=new i.LinesMesh(e,n);return o.VertexData.CreateDashedLines(t).applyToMesh(h,t.updatable),h._creationDataStorage=new r._CreationDataStorage,h._creationDataStorage.dashSize=d,h._creationDataStorage.gapSize=l,h},t.ExtrudeShape=function(e,a,n){void 0===n&&(n=null);var i=a.path,o=a.shape,s=a.scale||1,u=a.rotation||0,l=0===a.cap?0:a.cap||r.Mesh.NO_CAP,d=a.updatable,h=t._UpdateSideOrientation(a.sideOrientation),c=a.instance||null,p=a.invertUV||!1;return t._ExtrudeShapeGeneric(e,o,i,s,u,null,null,!1,!1,l,!1,n,!!d,h,c,p,a.frontUVs||null,a.backUVs||null)},t.ExtrudeShapeCustom=function(e,a,n){var i=a.path,o=a.shape,s=a.scaleFunction||function(){return 1},u=a.rotationFunction||function(){return 0},l=a.ribbonCloseArray||!1,d=a.ribbonClosePath||!1,h=0===a.cap?0:a.cap||r.Mesh.NO_CAP,c=a.updatable,p=t._UpdateSideOrientation(a.sideOrientation),f=a.instance,g=a.invertUV||!1;return t._ExtrudeShapeGeneric(e,o,i,null,null,s,u,l,d,h,!0,n,!!c,p,f||null,g,a.frontUVs||null,a.backUVs||null)},t.CreateLathe=function(e,n,i){var o,s=n.arc?n.arc<=0||n.arc>1?1:n.arc:1,u=void 0===n.closed||n.closed,l=n.shape,d=n.radius||1,h=n.tessellation||64,c=n.clip||0,p=n.updatable,f=t._UpdateSideOrientation(n.sideOrientation),g=n.cap||r.Mesh.NO_CAP,v=2*Math.PI,C=new Array,b=n.invertUV||!1,M=0,_=0,x=v/h*s,V=new Array;for(M=0;M<=h-c;M++){V=[];for(g!=r.Mesh.CAP_START&&g!=r.Mesh.CAP_ALL||(V.push(new a.Vector3(0,l[0].y,0)),V.push(new a.Vector3(Math.cos(M*x)*l[0].x*d,l[0].y,Math.sin(M*x)*l[0].x*d))),_=0;_<l.length;_++)o=new a.Vector3(Math.cos(M*x)*l[_].x*d,l[_].y,Math.sin(M*x)*l[_].x*d),V.push(o);g!=r.Mesh.CAP_END&&g!=r.Mesh.CAP_ALL||(V.push(new a.Vector3(Math.cos(M*x)*l[l.length-1].x*d,l[l.length-1].y,Math.sin(M*x)*l[l.length-1].x*d)),V.push(new a.Vector3(0,l[l.length-1].y,0))),C.push(V)}return t.CreateRibbon(e,{pathArray:C,closeArray:u,sideOrientation:f,updatable:p,invertUV:b,frontUVs:n.frontUVs,backUVs:n.backUVs},i)},t.CreatePlane=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreatePlane(a).applyToMesh(i,a.updatable),a.sourcePlane&&(i.translate(a.sourcePlane.normal,-a.sourcePlane.d),i.setDirection(a.sourcePlane.normal.scale(-1))),i},t.CreateGround=function(e,t,a){var r=new s.GroundMesh(e,a);return r._setReady(!1),r._subdivisionsX=t.subdivisionsX||t.subdivisions||1,r._subdivisionsY=t.subdivisionsY||t.subdivisions||1,r._width=t.width||1,r._height=t.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,o.VertexData.CreateGround(t).applyToMesh(r,t.updatable),r._setReady(!0),r},t.CreateTiledGround=function(e,t,a){var n=new r.Mesh(e,a);return o.VertexData.CreateTiledGround(t).applyToMesh(n,t.updatable),n},t.CreateGroundFromHeightMap=function(t,r,n,i){var u=n.width||10,l=n.height||10,d=n.subdivisions||1,h=n.minHeight||0,c=n.maxHeight||1,p=n.colorFilter||new a.Color3(.3,.59,.11),f=n.alphaFilter||0,g=n.updatable,v=n.onReady,C=new s.GroundMesh(t,i);C._subdivisionsX=d,C._subdivisionsY=d,C._width=u,C._height=l,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ,C._setReady(!1);return e.Tools.LoadImage(r,function(e){var t=document.createElement("canvas"),a=t.getContext("2d");if(!a)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!i.isDisposed){var r=e.width,n=e.height;t.width=r,t.height=n,a.drawImage(e,0,0);var s=a.getImageData(0,0,r,n).data;o.VertexData.CreateGroundFromHeightMap({width:u,height:l,subdivisions:d,minHeight:h,maxHeight:c,colorFilter:p,buffer:s,bufferWidth:r,bufferHeight:n,alphaFilter:f}).applyToMesh(C,g),v&&v(C),C._setReady(!0)}},function(){},i.offlineProvider),C},t.CreatePolygon=function(e,r,n){r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation);for(var i=r.shape,s=r.holes||[],l=r.depth||0,d=[],h=[],c=0;c<i.length;c++)d[c]=new a.Vector2(i[c].x,i[c].z);d[0].equalsWithEpsilon(d[d.length-1],1e-8)&&d.pop();for(var p=new u.PolygonMeshBuilder(e,d,n),f=0;f<s.length;f++){h=[];for(var g=0;g<s[f].length;g++)h.push(new a.Vector2(s[f][g].x,s[f][g].z));p.addHole(h)}var v=p.build(r.updatable,l);return v._originalBuilderSideOrientation=r.sideOrientation,o.VertexData.CreatePolygon(v,r.sideOrientation,r.faceUV,r.faceColors,r.frontUVs,r.backUVs).applyToMesh(v,r.updatable),v},t.ExtrudePolygon=function(e,a,r){return t.CreatePolygon(e,a,r)},t.CreateTube=function(e,n,i){var o=n.path,s=n.instance,u=1;void 0!==n.radius?u=n.radius:s&&(u=s._creationDataStorage.radius);var l=n.tessellation||64,d=n.radiusFunction||null,h=n.cap||r.Mesh.NO_CAP,c=n.invertUV||!1,p=n.updatable,f=t._UpdateSideOrientation(n.sideOrientation);n.arc=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1;var g,v,C=function(e,t,n,i,o,s,u,l){for(var d,h,c,p,f=t.getTangents(),g=t.getNormals(),v=t.getDistances(),C=2*Math.PI/o*l,b=s||function(){return i},M=a.Tmp.Matrix[0],_=u===r.Mesh.NO_CAP||u===r.Mesh.CAP_END?0:2,x=0;x<e.length;x++){h=b(x,v[x]),d=Array(),c=g[x];for(var V=0;V<o;V++)a.Matrix.RotationAxisToRef(f[x],C*V,M),p=d[V]?d[V]:a.Vector3.Zero(),a.Vector3.TransformCoordinatesToRef(c,M,p),p.scaleInPlace(h).addInPlace(e[x]),d[V]=p;n[_]=d,_++}var D=function(t,a){for(var r=Array(),n=0;n<t;n++)r.push(e[a]);return r};switch(u){case r.Mesh.NO_CAP:break;case r.Mesh.CAP_START:n[0]=D(o,0),n[1]=n[2].slice(0);break;case r.Mesh.CAP_END:n[_]=n[_-1].slice(0),n[_+1]=D(o,e.length-1);break;case r.Mesh.CAP_ALL:n[0]=D(o,0),n[1]=n[2].slice(0),n[_]=n[_-1].slice(0),n[_+1]=D(o,e.length-1)}return n};if(s){var b=s._creationDataStorage,M=n.arc||b.arc;return v=C(o,g=b.path3D.update(o),b.pathArray,u,b.tessellation,d,b.cap,M),s=t.CreateRibbon("",{pathArray:v,instance:s}),b.path3D=g,b.pathArray=v,b.arc=M,b.radius=u,s}v=C(o,g=new a.Path3D(o),new Array,u,l,d,h=h<0||h>3?0:h,n.arc);var _=t.CreateRibbon(e,{pathArray:v,closePath:!0,closeArray:!1,updatable:p,sideOrientation:f,invertUV:c,frontUVs:n.frontUVs,backUVs:n.backUVs},i);return _._creationDataStorage.pathArray=v,_._creationDataStorage.path3D=g,_._creationDataStorage.tessellation=l,_._creationDataStorage.cap=h,_._creationDataStorage.arc=n.arc,_._creationDataStorage.radius=u,_},t.CreatePolyhedron=function(e,a,n){var i=new r.Mesh(e,n);return a.sideOrientation=t._UpdateSideOrientation(a.sideOrientation),i._originalBuilderSideOrientation=a.sideOrientation,o.VertexData.CreatePolyhedron(a).applyToMesh(i,a.updatable),i},t.CreateDecal=function(e,t,i){var s=t.getIndices(),u=t.getVerticesData(n.VertexBuffer.PositionKind),l=t.getVerticesData(n.VertexBuffer.NormalKind),d=i.position||a.Vector3.Zero(),h=i.normal||a.Vector3.Up(),c=i.size||a.Vector3.One(),p=i.angle||0;if(!h){var f=new a.Vector3(0,0,1),g=t.getScene().activeCamera,v=a.Vector3.TransformCoordinates(f,g.getWorldMatrix());h=g.globalPosition.subtract(v)}var C=-Math.atan2(h.z,h.x)-Math.PI/2,b=Math.sqrt(h.x*h.x+h.z*h.z),M=Math.atan2(h.y,b),_=a.Matrix.RotationYawPitchRoll(C,M,p).multiply(a.Matrix.Translation(d.x,d.y,d.z)),x=a.Matrix.Invert(_),V=t.getWorldMatrix().multiply(x),D=new o.VertexData;D.indices=[],D.positions=[],D.normals=[],D.uvs=[];for(var y=0,m=function(e){var t=new a.PositionNormalVertex;if(!s||!u||!l)return t;var r=s[e];return t.position=new a.Vector3(u[3*r],u[3*r+1],u[3*r+2]),t.position=a.Vector3.TransformCoordinates(t.position,V),t.normal=new a.Vector3(l[3*r],l[3*r+1],l[3*r+2]),t.normal=a.Vector3.TransformNormal(t.normal,V),t},S=function(e,t){if(0===e.length)return e;for(var r=.5*Math.abs(a.Vector3.Dot(c,t)),n=function(e,n){var i=a.Vector3.GetClipFactor(e.position,n.position,t,r);return new a.PositionNormalVertex(a.Vector3.Lerp(e.position,n.position,i),a.Vector3.Lerp(e.normal,n.normal,i))},i=new Array,o=0;o<e.length;o+=3){var s,u,l,d=null,h=null,p=null,f=null;switch(((s=a.Vector3.Dot(e[o].position,t)-r>0)?1:0)+((u=a.Vector3.Dot(e[o+1].position,t)-r>0)?1:0)+((l=a.Vector3.Dot(e[o+2].position,t)-r>0)?1:0)){case 0:i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]);break;case 1:if(s&&(d=e[o+1],h=e[o+2],p=n(e[o],d),f=n(e[o],h)),u){d=e[o],h=e[o+2],p=n(e[o+1],d),f=n(e[o+1],h),i.push(p),i.push(h.clone()),i.push(d.clone()),i.push(h.clone()),i.push(p.clone()),i.push(f);break}l&&(d=e[o],h=e[o+1],p=n(e[o+2],d),f=n(e[o+2],h)),d&&h&&p&&f&&(i.push(d.clone()),i.push(h.clone()),i.push(p),i.push(f),i.push(p.clone()),i.push(h.clone()));break;case 2:s||(h=n(d=e[o].clone(),e[o+1]),p=n(d,e[o+2]),i.push(d),i.push(h),i.push(p)),u||(h=n(d=e[o+1].clone(),e[o+2]),p=n(d,e[o]),i.push(d),i.push(h),i.push(p)),l||(h=n(d=e[o+2].clone(),e[o]),p=n(d,e[o+1]),i.push(d),i.push(h),i.push(p))}}return i},O=0;O<s.length;O+=3){var P=new Array;if(P.push(m(O)),P.push(m(O+1)),P.push(m(O+2)),P=S(P,new a.Vector3(1,0,0)),P=S(P,new a.Vector3(-1,0,0)),P=S(P,new a.Vector3(0,1,0)),P=S(P,new a.Vector3(0,-1,0)),P=S(P,new a.Vector3(0,0,1)),0!==(P=S(P,new a.Vector3(0,0,-1))).length)for(var A=0;A<P.length;A++){var w=P[A];D.indices.push(y),w.position.toArray(D.positions,3*y),w.normal.toArray(D.normals,3*y),D.uvs.push(.5+w.position.x/c.x),D.uvs.push(.5+w.position.y/c.y),y++}}var T=new r.Mesh(e,t.getScene());return D.applyToMesh(T),T.position=d.clone(),T.rotation=new a.Vector3(M,C,p),T},t._ExtrudeShapeGeneric=function(e,n,i,o,s,u,l,d,h,c,p,f,g,v,C,b,M,_){var x,V,D=function(e,t,n,i,o,s,u,l,d,h){for(var c=n.getTangents(),p=n.getNormals(),f=n.getBinormals(),g=n.getDistances(),v=0,C=h&&l?l:function(){return null!==s?s:0},b=h&&u?u:function(){return null!==o?o:1},M=d===r.Mesh.NO_CAP||d===r.Mesh.CAP_END?0:2,_=a.Tmp.Matrix[0],x=0;x<t.length;x++){for(var V=new Array,D=C(x,g[x]),y=b(x,g[x]),m=0;m<e.length;m++){a.Matrix.RotationAxisToRef(c[x],v,_);var S=c[x].scale(e[m].z).add(p[x].scale(e[m].x)).add(f[x].scale(e[m].y)),O=V[m]?V[m]:a.Vector3.Zero();a.Vector3.TransformCoordinatesToRef(S,_,O),O.scaleInPlace(y).addInPlace(t[x]),V[m]=O}i[M]=V,v+=D,M++}var P=function(e){var t,r=Array(),n=a.Vector3.Zero();for(t=0;t<e.length;t++)n.addInPlace(e[t]);for(n.scaleInPlace(1/e.length),t=0;t<e.length;t++)r.push(n);return r};switch(d){case r.Mesh.NO_CAP:break;case r.Mesh.CAP_START:i[0]=P(i[2]),i[1]=i[2];break;case r.Mesh.CAP_END:i[M]=i[M-1],i[M+1]=P(i[M-1]);break;case r.Mesh.CAP_ALL:i[0]=P(i[2]),i[1]=i[2],i[M]=i[M-1],i[M+1]=P(i[M-1])}return i};if(C){var y=C._creationDataStorage;return x=y.path3D.update(i),V=D(n,i,y.path3D,y.pathArray,o,s,u,l,y.cap,p),C=r.Mesh.CreateRibbon("",V,!1,!1,0,f||void 0,!1,0,C)}V=D(n,i,x=new a.Path3D(i),new Array,o,s,u,l,c=c<0||c>3?0:c,p);var m=t.CreateRibbon(e,{pathArray:V,closeArray:d,closePath:h,updatable:g,sideOrientation:v,invertUV:b,frontUVs:M||void 0,backUVs:_||void 0},f);return m._creationDataStorage.pathArray=V,m._creationDataStorage.path3D=x,m._creationDataStorage.cap=c,m},t}();exports.MeshBuilder=d;
},{"../Misc/tools":"RkuS","../scene":"FKAx","../Maths/math":"Iizi","./mesh":"koBp","./buffer":"YHhW","./linesMesh":"ztjm","./mesh.vertexData":"+kld","./groundMesh":"JvWG","./polygonMesh":"t6eO","../Culling/boundingInfo":"1eEz"}],"9Nig":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@babylonjs/core/Meshes/groundMesh"),s=require("@babylonjs/core/meshes/meshBuilder");function o(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var r=function e(r){o(this,e);var i=s.MeshBuilder.CreateGround("ground",{width:60,height:50,subdivisions:0},r);i.position.y=-10,i.checkCollisions=!0,i.receiveShadows=!0};exports.default=r;
},{"@babylonjs/core/Meshes/groundMesh":"JvWG","@babylonjs/core/meshes/meshBuilder":"iqPq"}],"zhzd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Deferred=void 0;var e=function(){function e(){var e=this;this.promise=new Promise(function(r,t){e._resolve=r,e._reject=t})}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),e}();exports.Deferred=e;
},{}],"QrbQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnimationGroup=exports.TargetedAnimation=void 0;var t=require("./animation"),e=require("../Misc/observable"),i=require("../Engines/engineStore"),n=function(){return function(){}}();exports.TargetedAnimation=n;var a=function(){function n(t,n){void 0===n&&(n=null),this.name=t,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this.onAnimationEndObservable=new e.Observable,this.onAnimationLoopObservable=new e.Observable,this.onAnimationGroupEndObservable=new e.Observable,this.onAnimationGroupPauseObservable=new e.Observable,this.onAnimationGroupPlayObservable=new e.Observable,this._scene=n||i.EngineStore.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.animationGroups.push(this)}return Object.defineProperty(n.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(t){if(this._speedRatio!==t){this._speedRatio=t;for(var e=0;e<this._animatables.length;e++){this._animatables[e].speedRatio=this._speedRatio}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animatables",{get:function(){return this._animatables},enumerable:!0,configurable:!0}),n.prototype.addTargetedAnimation=function(t,e){var i={animation:t,target:e},n=t.getKeys();return this._from>n[0].frame&&(this._from=n[0].frame),this._to<n[n.length-1].frame&&(this._to=n[n.length-1].frame),this._targetedAnimations.push(i),i},n.prototype.normalize=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),null==t&&(t=this._from),null==e&&(e=this._to);for(var i=0;i<this._targetedAnimations.length;i++){var n=this._targetedAnimations[i].animation.getKeys(),a=n[0],r=n[n.length-1];if(a.frame>t){var s={frame:t,value:a.value,inTangent:a.inTangent,outTangent:a.outTangent,interpolation:a.interpolation};n.splice(0,0,s)}if(r.frame<e){s={frame:e,value:r.value,inTangent:r.outTangent,outTangent:r.outTangent,interpolation:r.interpolation};n.push(s)}}return this._from=t,this._to=e,this},n.prototype.start=function(t,e,i,n){var a=this;if(void 0===t&&(t=!1),void 0===e&&(e=1),this._isStarted||0===this._targetedAnimations.length)return this;for(var r=function(r){var o=s._scene.beginDirectAnimation(r.target,[r.animation],void 0!==i?i:s._from,void 0!==n?n:s._to,t,e);o.onAnimationEnd=function(){a.onAnimationEndObservable.notifyObservers(r),a._checkAnimationGroupEnded(o)},o.onAnimationLoop=function(){a.onAnimationLoopObservable.notifyObservers(r)},s._animatables.push(o)},s=this,o=0,h=this._targetedAnimations;o<h.length;o++){r(h[o])}return this._speedRatio=e,void 0!==i&&void 0!==n&&i>n&&this._speedRatio>0&&(this._speedRatio=-e),this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},n.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var t=0;t<this._animatables.length;t++){this._animatables[t].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},n.prototype.play=function(t){if(this.isStarted&&this._animatables.length===this._targetedAnimations.length){if(void 0!==t)for(var e=0;e<this._animatables.length;e++){this._animatables[e].loopAnimation=t}this.restart()}else this.stop(),this.start(t,this._speedRatio);return this._isPaused=!1,this},n.prototype.reset=function(){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++){this._animatables[t].reset()}return this},n.prototype.restart=function(){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++){this._animatables[t].restart()}return this.onAnimationGroupPlayObservable.notifyObservers(this),this},n.prototype.stop=function(){if(!this._isStarted)return this;for(var t=this._animatables.slice(),e=0;e<t.length;e++)t[e].stop();return this._isStarted=!1,this},n.prototype.setWeightForAllAnimatables=function(t){for(var e=0;e<this._animatables.length;e++){this._animatables[e].weight=t}return this},n.prototype.syncAllAnimationsWith=function(t){for(var e=0;e<this._animatables.length;e++){this._animatables[e].syncWith(t)}return this},n.prototype.goToFrame=function(t){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++){this._animatables[e].goToFrame(t)}return this},n.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var t=this._scene.animationGroups.indexOf(this);t>-1&&this._scene.animationGroups.splice(t,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear()},n.prototype._checkAnimationGroupEnded=function(t){var e=this._animatables.indexOf(t);e>-1&&this._animatables.splice(e,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},n.Parse=function(e,i){for(var a=new n(e.name,i),r=0;r<e.targetedAnimations.length;r++){var s=e.targetedAnimations[r],o=t.Animation.Parse(s.animation),h=s.targetId;if("influence"===s.animation.property){var l=i.getMorphTargetById(h);l&&a.addTargetedAnimation(o,l)}else{var u=i.getNodeByID(h);null!=u&&a.addTargetedAnimation(o,u)}}return null!==e.from&&null!==e.from&&a.normalize(e.from,e.to),a},n.prototype.getClassName=function(){return"AnimationGroup"},n.prototype.toString=function(t){var e="Name: "+this.name;return e+=", type: "+this.getClassName(),t&&(e+=", from: "+this._from,e+=", to: "+this._to,e+=", isStarted: "+this._isStarted,e+=", speedRatio: "+this._speedRatio,e+=", targetedAnimations length: "+this._targetedAnimations.length,e+=", animatables length: "+this._animatables),e},n}();exports.AnimationGroup=a;
},{"./animation":"8SP4","../Misc/observable":"gtkL","../Engines/engineStore":"n+VE"}],"cReH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bone=void 0;var t=n(require("tslib")),o=require("../Maths/math"),e=require("../Misc/arrayTools"),i=require("../Animations/animation"),r=require("../node");function n(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,e):{};i.get||i.set?Object.defineProperty(o,e,i):o[e]=t[e]}return o.default=t,o}var a=function(r){function n(t,e,i,n,a,s,l){void 0===i&&(i=null),void 0===n&&(n=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null);var p=r.call(this,t,e.getScene(),!1)||this;return p.name=t,p.children=new Array,p.animations=new Array,p._index=null,p._absoluteTransform=new o.Matrix,p._invertedAbsoluteTransform=new o.Matrix,p._scalingDeterminant=1,p._worldTransform=new o.Matrix,p._needToDecompose=!0,p._needToCompose=!1,p._linkedTransformNode=null,p._skeleton=e,p._localMatrix=n?n.clone():o.Matrix.Identity(),p._restPose=a||p._localMatrix.clone(),p._baseMatrix=s||p._localMatrix.clone(),p._index=l,e.bones.push(p),p.setParent(i,!1),(s||n)&&p._updateDifferenceMatrix(),p}return t.__extends(n,r),Object.defineProperty(n.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(t){this._localMatrix.copyFrom(t),this._needToDecompose=!0},enumerable:!0,configurable:!0}),n.prototype.getSkeleton=function(){return this._skeleton},n.prototype.getParent=function(){return this._parent},n.prototype.setParent=function(t,o){if(void 0===o&&(o=!0),this._parent!==t){if(this._parent){var e=this._parent.children.indexOf(this);-1!==e&&this._parent.children.splice(e,1)}this._parent=t,this._parent&&this._parent.children.push(this),o&&this._updateDifferenceMatrix(),this.markAsDirty()}},n.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},n.prototype.getBaseMatrix=function(){return this._baseMatrix},n.prototype.getRestPose=function(){return this._restPose},n.prototype.getWorldMatrix=function(){return this._worldTransform},n.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},n.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},n.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},n.prototype.linkTransformNode=function(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},Object.defineProperty(n.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(t){this._decompose(),this._localPosition.copyFrom(t),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotation",{get:function(){return this.getRotation()},set:function(t){this.setRotation(t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(t){this.setRotationQuaternion(t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaling",{get:function(){return this.getScale()},set:function(t){this.setScale(t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),n.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=o.Vector3.Zero(),this._localRotation=o.Quaternion.Zero(),this._localPosition=o.Vector3.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},n.prototype._compose=function(){this._needToCompose&&(this._needToCompose=!1,o.Matrix.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix))},n.prototype.updateMatrix=function(t,o,e){void 0===o&&(o=!0),void 0===e&&(e=!0),this._baseMatrix.copyFrom(t),o&&this._updateDifferenceMatrix(),e?(this._localMatrix.copyFrom(t),this._markAsDirtyAndDecompose()):this.markAsDirty()},n.prototype._updateDifferenceMatrix=function(t,o){if(void 0===o&&(o=!0),t||(t=this._baseMatrix),this._parent?t.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(t),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),o)for(var e=0;e<this.children.length;e++)this.children[e]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},n.prototype.markAsDirty=function(){this._currentRenderId++,this._childRenderId++,this._skeleton._markAsDirty()},n.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},n.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},n.prototype.copyAnimationRange=function(t,o,e,r,n){void 0===r&&(r=!1),void 0===n&&(n=null),0===this.animations.length&&(this.animations.push(new i.Animation(this.name,"_matrix",t.animations[0].framePerSecond,i.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var a=t.animations[0].getRange(o);if(!a)return!1;for(var s,l,p,c=a.from,u=a.to,m=t.animations[0].getKeys(),f=t.length,h=t.getParent(),d=this.getParent(),_=r&&h&&f&&this.length&&f!==this.length,y=_&&d&&h?d.length/h.length:1,T=r&&!d&&n&&(1!==n.x||1!==n.y||1!==n.z),g=this.animations[0].getKeys(),v=0,A=m.length;v<A;v++)(s=m[v]).frame>=c&&s.frame<=u&&(r?(p=s.value.clone(),_?(l=p.getTranslation(),p.setTranslation(l.scaleInPlace(y))):T&&n?(l=p.getTranslation(),p.setTranslation(l.multiplyInPlace(n))):p=s.value):p=s.value,g.push({frame:s.frame+e,value:p}));return this.animations[0].createRange(o,c+e,u+e),!0},n.prototype.translate=function(t,e,i){void 0===e&&(e=o.Space.LOCAL);var r=this.getLocalMatrix();if(e==o.Space.LOCAL)r.addAtIndex(12,t.x),r.addAtIndex(13,t.y),r.addAtIndex(14,t.z);else{var a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=n._tmpMats[0],l=n._tmpVecs[0];this._parent&&(i&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.setTranslationFromFloats(0,0,0),s.invert(),o.Vector3.TransformCoordinatesToRef(t,s,l),r.addAtIndex(12,l.x),r.addAtIndex(13,l.y),r.addAtIndex(14,l.z)}this._markAsDirtyAndDecompose()},n.prototype.setPosition=function(t,e,i){void 0===e&&(e=o.Space.LOCAL);var r=this.getLocalMatrix();if(e==o.Space.LOCAL)r.setTranslationFromFloats(t.x,t.y,t.z);else{var a=null;i&&(a=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=n._tmpMats[0],l=n._tmpVecs[0];this._parent&&(i&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.invert(),o.Vector3.TransformCoordinatesToRef(t,s,l),r.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()},n.prototype.setAbsolutePosition=function(t,e){this.setPosition(t,o.Space.WORLD,e)},n.prototype.scale=function(t,e,i,r){void 0===r&&(r=!1);var a=this.getLocalMatrix(),s=n._tmpMats[0];o.Matrix.ScalingToRef(t,e,i,s),s.multiplyToRef(a,a),s.invert();for(var l=0,p=this.children;l<p.length;l++){var c=(f=p[l]).getLocalMatrix();c.multiplyToRef(s,c),c.multiplyAtIndex(12,t),c.multiplyAtIndex(13,e),c.multiplyAtIndex(14,i),f._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),r)for(var u=0,m=this.children;u<m.length;u++){var f;(f=m[u]).scale(t,e,i,r)}},n.prototype.setScale=function(t){this._decompose(),this._localScaling.copyFrom(t),this._markAsDirtyAndCompose()},n.prototype.getScale=function(){return this._decompose(),this._localScaling},n.prototype.getScaleToRef=function(t){this._decompose(),t.copyFrom(this._localScaling)},n.prototype.setYawPitchRoll=function(t,e,i,r,a){if(void 0===r&&(r=o.Space.LOCAL),r===o.Space.LOCAL){var s=n._tmpQuat;return o.Quaternion.RotationYawPitchRollToRef(t,e,i,s),void this.setRotationQuaternion(s,r,a)}var l=n._tmpMats[0];if(this._getNegativeRotationToRef(l,a)){var p=n._tmpMats[1];o.Matrix.RotationYawPitchRollToRef(t,e,i,p),l.multiplyToRef(p,p),this._rotateWithMatrix(p,r,a)}},n.prototype.rotate=function(t,e,i,r){void 0===i&&(i=o.Space.LOCAL);var a=n._tmpMats[0];a.setTranslationFromFloats(0,0,0),o.Matrix.RotationAxisToRef(t,e,a),this._rotateWithMatrix(a,i,r)},n.prototype.setAxisAngle=function(t,e,i,r){if(void 0===i&&(i=o.Space.LOCAL),i===o.Space.LOCAL){var a=n._tmpQuat;return o.Quaternion.RotationAxisToRef(t,e,a),void this.setRotationQuaternion(a,i,r)}var s=n._tmpMats[0];if(this._getNegativeRotationToRef(s,r)){var l=n._tmpMats[1];o.Matrix.RotationAxisToRef(t,e,l),s.multiplyToRef(l,l),this._rotateWithMatrix(l,i,r)}},n.prototype.setRotation=function(t,e,i){void 0===e&&(e=o.Space.LOCAL),this.setYawPitchRoll(t.y,t.x,t.z,e,i)},n.prototype.setRotationQuaternion=function(t,e,i){if(void 0===e&&(e=o.Space.LOCAL),e===o.Space.LOCAL)return this._decompose(),this._localRotation.copyFrom(t),void this._markAsDirtyAndCompose();var r=n._tmpMats[0];if(this._getNegativeRotationToRef(r,i)){var a=n._tmpMats[1];o.Matrix.FromQuaternionToRef(t,a),r.multiplyToRef(a,a),this._rotateWithMatrix(a,e,i)}},n.prototype.setRotationMatrix=function(t,e,i){if(void 0===e&&(e=o.Space.LOCAL),e===o.Space.LOCAL){var r=n._tmpQuat;return o.Quaternion.FromRotationMatrixToRef(t,r),void this.setRotationQuaternion(r,e,i)}var a=n._tmpMats[0];if(this._getNegativeRotationToRef(a,i)){var s=n._tmpMats[1];s.copyFrom(t),a.multiplyToRef(t,s),this._rotateWithMatrix(s,e,i)}},n.prototype._rotateWithMatrix=function(t,e,i){void 0===e&&(e=o.Space.LOCAL);var r=this.getLocalMatrix(),a=r.m[12],s=r.m[13],l=r.m[14],p=this.getParent(),c=n._tmpMats[3],u=n._tmpMats[4];p&&e==o.Space.WORLD?(i?(c.copyFrom(i.getWorldMatrix()),p.getAbsoluteTransform().multiplyToRef(c,c)):c.copyFrom(p.getAbsoluteTransform()),u.copyFrom(c),u.invert(),r.multiplyToRef(c,r),r.multiplyToRef(t,r),r.multiplyToRef(u,r)):e==o.Space.WORLD&&i?(c.copyFrom(i.getWorldMatrix()),u.copyFrom(c),u.invert(),r.multiplyToRef(c,r),r.multiplyToRef(t,r),r.multiplyToRef(u,r)):r.multiplyToRef(t,r),r.setTranslationFromFloats(a,s,l),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},n.prototype._getNegativeRotationToRef=function(t,e){var i=n._tmpMats[2];return t.copyFrom(this.getAbsoluteTransform()),e&&(t.multiplyToRef(e.getWorldMatrix(),t),o.Matrix.ScalingToRef(e.scaling.x,e.scaling.y,e.scaling.z,i)),t.invert(),!isNaN(t.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(i,t),!0)},n.prototype.getPosition=function(t,e){void 0===t&&(t=o.Space.LOCAL),void 0===e&&(e=null);var i=o.Vector3.Zero();return this.getPositionToRef(t,e,i),i},n.prototype.getPositionToRef=function(t,e,i){if(void 0===t&&(t=o.Space.LOCAL),t==o.Space.LOCAL){var r=this.getLocalMatrix();i.x=r.m[12],i.y=r.m[13],i.z=r.m[14]}else{var a=null;e&&(a=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=n._tmpMats[0];e&&a?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(a,s)):s=this.getAbsoluteTransform(),i.x=s.m[12],i.y=s.m[13],i.z=s.m[14]}},n.prototype.getAbsolutePosition=function(t){void 0===t&&(t=null);var e=o.Vector3.Zero();return this.getPositionToRef(o.Space.WORLD,t,e),e},n.prototype.getAbsolutePositionToRef=function(t,e){this.getPositionToRef(o.Space.WORLD,t,e)},n.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var t=this._skeleton.getPoseMatrix();t&&this._absoluteTransform.multiplyToRef(t,this._absoluteTransform)}for(var o=this.children,e=o.length,i=0;i<e;i++)o[i].computeAbsoluteTransforms()},n.prototype.getDirection=function(t,e){void 0===e&&(e=null);var i=o.Vector3.Zero();return this.getDirectionToRef(t,e,i),i},n.prototype.getDirectionToRef=function(t,e,i){void 0===e&&(e=null);var r=null;e&&(r=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=n._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),e&&r&&a.multiplyToRef(r,a),o.Vector3.TransformNormalToRef(t,a,i),i.normalize()},n.prototype.getRotation=function(t,e){void 0===t&&(t=o.Space.LOCAL),void 0===e&&(e=null);var i=o.Vector3.Zero();return this.getRotationToRef(t,e,i),i},n.prototype.getRotationToRef=function(t,e,i){void 0===t&&(t=o.Space.LOCAL),void 0===e&&(e=null);var r=n._tmpQuat;this.getRotationQuaternionToRef(t,e,r),r.toEulerAnglesToRef(i)},n.prototype.getRotationQuaternion=function(t,e){void 0===t&&(t=o.Space.LOCAL),void 0===e&&(e=null);var i=o.Quaternion.Identity();return this.getRotationQuaternionToRef(t,e,i),i},n.prototype.getRotationQuaternionToRef=function(t,e,i){if(void 0===t&&(t=o.Space.LOCAL),void 0===e&&(e=null),t==o.Space.LOCAL)this._decompose(),i.copyFrom(this._localRotation);else{var r=n._tmpMats[0],a=this.getAbsoluteTransform();e?a.multiplyToRef(e.getWorldMatrix(),r):r.copyFrom(a),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.decompose(void 0,i,void 0)}},n.prototype.getRotationMatrix=function(t,e){void 0===t&&(t=o.Space.LOCAL);var i=o.Matrix.Identity();return this.getRotationMatrixToRef(t,e,i),i},n.prototype.getRotationMatrixToRef=function(t,e,i){if(void 0===t&&(t=o.Space.LOCAL),t==o.Space.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(i);else{var r=n._tmpMats[0],a=this.getAbsoluteTransform();e?a.multiplyToRef(e.getWorldMatrix(),r):r.copyFrom(a),r.multiplyAtIndex(0,this._scalingDeterminant),r.multiplyAtIndex(1,this._scalingDeterminant),r.multiplyAtIndex(2,this._scalingDeterminant),r.getRotationMatrixToRef(i)}},n.prototype.getAbsolutePositionFromLocal=function(t,e){void 0===e&&(e=null);var i=o.Vector3.Zero();return this.getAbsolutePositionFromLocalToRef(t,e,i),i},n.prototype.getAbsolutePositionFromLocalToRef=function(t,e,i){void 0===e&&(e=null);var r=null;e&&(r=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=n._tmpMats[0];e&&r?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(r,a)):a=this.getAbsoluteTransform(),o.Vector3.TransformCoordinatesToRef(t,a,i)},n.prototype.getLocalPositionFromAbsolute=function(t,e){void 0===e&&(e=null);var i=o.Vector3.Zero();return this.getLocalPositionFromAbsoluteToRef(t,e,i),i},n.prototype.getLocalPositionFromAbsoluteToRef=function(t,e,i){void 0===e&&(e=null);var r=null;e&&(r=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=n._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),e&&r&&a.multiplyToRef(r,a),a.invert(),o.Vector3.TransformCoordinatesToRef(t,a,i)},n._tmpVecs=e.ArrayTools.BuildArray(2,o.Vector3.Zero),n._tmpQuat=o.Quaternion.Identity(),n._tmpMats=e.ArrayTools.BuildArray(5,o.Matrix.Identity),n}(r.Node);exports.Bone=a;
},{"tslib":"vCxL","../Maths/math":"Iizi","../Misc/arrayTools":"eIrG","../Animations/animation":"8SP4","../node":"P+He"}],"WCXp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RawTexture=void 0;var t=r(require("tslib")),e=require("../../Materials/Textures/texture"),n=require("../../Engines/constants");function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,n):{};r.get||r.set?Object.defineProperty(e,n,r):e[n]=t[n]}return e.default=t,e}var o=function(r){function o(t,o,T,i,E,s,u,a,R){void 0===s&&(s=!0),void 0===u&&(u=!1),void 0===a&&(a=n.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===R&&(R=n.Constants.TEXTURETYPE_UNSIGNED_INT);var _=r.call(this,null,E,!s,u)||this;return _.format=i,_._engine=E.getEngine(),_._texture=E.getEngine().createRawTexture(t,o,T,i,s,u,a,null,R),_.wrapU=e.Texture.CLAMP_ADDRESSMODE,_.wrapV=e.Texture.CLAMP_ADDRESSMODE,_}return t.__extends(o,r),o.prototype.update=function(t){this._engine.updateRawTexture(this._texture,t,this._texture.format,this._texture.invertY,void 0,this._texture.type)},o.CreateLuminanceTexture=function(t,e,r,T,i,E,s){return void 0===i&&(i=!0),void 0===E&&(E=!1),void 0===s&&(s=n.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE),new o(t,e,r,n.Constants.TEXTUREFORMAT_LUMINANCE,T,i,E,s)},o.CreateLuminanceAlphaTexture=function(t,e,r,T,i,E,s){return void 0===i&&(i=!0),void 0===E&&(E=!1),void 0===s&&(s=n.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE),new o(t,e,r,n.Constants.TEXTUREFORMAT_LUMINANCE_ALPHA,T,i,E,s)},o.CreateAlphaTexture=function(t,e,r,T,i,E,s){return void 0===i&&(i=!0),void 0===E&&(E=!1),void 0===s&&(s=n.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE),new o(t,e,r,n.Constants.TEXTUREFORMAT_ALPHA,T,i,E,s)},o.CreateRGBTexture=function(t,e,r,T,i,E,s,u){return void 0===i&&(i=!0),void 0===E&&(E=!1),void 0===s&&(s=n.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===u&&(u=n.Constants.TEXTURETYPE_UNSIGNED_INT),new o(t,e,r,n.Constants.TEXTUREFORMAT_RGB,T,i,E,s,u)},o.CreateRGBATexture=function(t,e,r,T,i,E,s,u){return void 0===i&&(i=!0),void 0===E&&(E=!1),void 0===s&&(s=n.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===u&&(u=n.Constants.TEXTURETYPE_UNSIGNED_INT),new o(t,e,r,n.Constants.TEXTUREFORMAT_RGBA,T,i,E,s,u)},o.CreateRTexture=function(t,r,T,i,E,s,u,a){return void 0===E&&(E=!0),void 0===s&&(s=!1),void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=n.Constants.TEXTURETYPE_FLOAT),new o(t,r,T,n.Constants.TEXTUREFORMAT_R,i,E,s,u,a)},o}(e.Texture);exports.RawTexture=o;
},{"tslib":"vCxL","../../Materials/Textures/texture":"KNsj","../../Engines/constants":"vn8z"}],"f/YG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Skeleton=void 0;var e=require("./bone"),t=require("../Misc/observable"),n=require("../Maths/math"),i=require("../Materials/Textures/rawTexture"),s=require("../Animations/animation"),r=require("../Engines/engineStore"),o=require("../Engines/constants"),a=require("../Misc/logger"),h=require("../Misc/deepCopier"),m=function(){function m(e,i,s){this.name=e,this.id=i,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=n.Matrix.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._numBonesWithLinkedTransformNode=0,this.doNotSerialize=!1,this.useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new t.Observable,this.bones=[],this._scene=s||r.EngineStore.LastCreatedScene,this._scene.skeletons.push(this),this._isDirty=!0;var o=this._scene.getEngine().getCaps();this._canUseTextureForBones=o.textureFloat&&o.maxVertexTextureImageUnits>0}return Object.defineProperty(m.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones&&!this.needInitialSkinMatrix},enumerable:!0,configurable:!0}),m.prototype.getTransformMatrices=function(e){return this.needInitialSkinMatrix&&e._bonesTransformMatrices?e._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},m.prototype.getTransformMatrixTexture=function(){return this._transformMatrixTexture},m.prototype.getScene=function(){return this._scene},m.prototype.toString=function(e){var t="Name: "+this.name+", nBones: "+this.bones.length;if(t+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var i in this._ranges)n&&(t+=", ",n=!1),t+=i;t+="}"}return t},m.prototype.getBoneIndexByName=function(e){for(var t=0,n=this.bones.length;t<n;t++)if(this.bones[t].name===e)return t;return-1},m.prototype.createAnimationRange=function(e,t,n){if(!this._ranges[e]){this._ranges[e]=new s.AnimationRange(e,t,n);for(var i=0,r=this.bones.length;i<r;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].createRange(e,t,n)}},m.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var n=0,i=this.bones.length;n<i;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(e,t);this._ranges[e]=null},m.prototype.getAnimationRange=function(e){return this._ranges[e]},m.prototype.getAnimationRanges=function(){var e,t=[],n=0;for(e in this._ranges)t[n]=this._ranges[e],n++;return t},m.prototype.copyAnimationRange=function(e,t,n){if(void 0===n&&(n=!1),this._ranges[t]||!e.getAnimationRange(t))return!1;var i,r,o=!0,h=this._getHighestAnimationFrame()+1,m={},g=e.bones;for(r=0,i=g.length;r<i;r++)m[g[r].name]=g[r];this.bones.length!==g.length&&(a.Logger.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+g.length),o=!1);var l=n&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(r=0,i=this.bones.length;r<i;r++){var u=this.bones[r].name,f=m[u];f?o=o&&this.bones[r].copyAnimationRange(f,t,h,n,l):(a.Logger.Warn("copyAnimationRange: not same rig, missing source bone "+u),o=!1)}var p=e.getAnimationRange(t);return p&&(this._ranges[t]=new s.AnimationRange(t,p.from+h,p.to+h)),o},m.prototype.returnToRest=function(){for(var e=0;e<this.bones.length;e++)this.bones[e].returnToRest()},m.prototype._getHighestAnimationFrame=function(){for(var e=0,t=0,n=this.bones.length;t<n;t++)if(this.bones[t].animations[0]){var i=this.bones[t].animations[0].getHighestFrame();e<i&&(e=i)}return e},m.prototype.beginAnimation=function(e,t,n,i){var s=this.getAnimationRange(e);return s?this._scene.beginAnimation(this,s.from,s.to,t,n,i):null},m.prototype._markAsDirty=function(){this._isDirty=!0},m.prototype._registerMeshWithPoseMatrix=function(e){this._meshesWithPoseMatrix.push(e)},m.prototype._unregisterMeshWithPoseMatrix=function(e){var t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)},m.prototype._computeTransformMatrices=function(e,t){this.onBeforeComputeObservable.notifyObservers(this);for(var n=0;n<this.bones.length;n++){var i=this.bones[n],s=i.getParent();if(s?i.getLocalMatrix().multiplyToRef(s.getWorldMatrix(),i.getWorldMatrix()):t?i.getLocalMatrix().multiplyToRef(t,i.getWorldMatrix()):i.getWorldMatrix().copyFrom(i.getLocalMatrix()),-1!==i._index){var r=null===i._index?n:i._index;i.getInvertedAbsoluteTransform().multiplyToArray(i.getWorldMatrix(),e,16*r)}}this._identity.copyToArray(e,16*this.bones.length)},m.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var e=0,t=this.bones;e<t.length;e++){var s=t[e];s._linkedTransformNode&&(s._linkedTransformNode.computeWorldMatrix(),s._matrix=s._linkedTransformNode._localMatrix,s.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var r=0;r<this._meshesWithPoseMatrix.length;r++){var a=this._meshesWithPoseMatrix[r],h=a.getPoseMatrix();if(a._bonesTransformMatrices&&a._bonesTransformMatrices.length===16*(this.bones.length+1)||(a._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==a){this._synchronizedWithMesh=a;for(var m=0;m<this.bones.length;m++){var g=this.bones[m];if(!g.getParent())g.getBaseMatrix().multiplyToRef(h,n.Tmp.Matrix[1]),g._updateDifferenceMatrix(n.Tmp.Matrix[1])}}this._computeTransformMatrices(a._bonesTransformMatrices,h)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=i.RawTexture.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,o.Constants.TEXTURE_NEAREST_SAMPLINGMODE,o.Constants.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},m.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables},m.prototype.clone=function(t,n){var i=new m(t,n||t,this._scene);i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var s=0;s<this.bones.length;s++){var r=this.bones[s],o=null,a=r.getParent();if(a){var g=this.bones.indexOf(a);o=i.bones[g]}var l=new e.Bone(r.name,i,o,r.getBaseMatrix().clone(),r.getRestPose().clone());h.DeepCopier.DeepCopy(r.animations,l.animations)}if(this._ranges)for(var u in i._ranges={},this._ranges){var f=this._ranges[u];f&&(i._ranges[u]=f.clone())}return this._isDirty=!0,i},m.prototype.enableBlending=function(e){void 0===e&&(e=.01),this.bones.forEach(function(t){t.animations.forEach(function(t){t.enableBlending=!0,t.blendingSpeed=e})})},m.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},m.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var t=0;t<this.bones.length;t++){var n=this.bones[t],i=n.getParent(),s={parentBoneIndex:i?this.bones.indexOf(i):-1,name:n.name,matrix:n.getBaseMatrix().toArray(),rest:n.getRestPose().toArray()};for(var r in e.bones.push(s),n.length&&(s.length=n.length),n.metadata&&(s.metadata=n.metadata),n.animations&&n.animations.length>0&&(s.animation=n.animations[0].serialize()),e.ranges=[],this._ranges){var o=this._ranges[r];if(o){var a={};a.name=r,a.from=o.from,a.to=o.to,e.ranges.push(a)}}}return e},m.Parse=function(t,i){var r,o=new m(t.name,t.id,i);for(t.dimensionsAtRest&&(o.dimensionsAtRest=n.Vector3.FromArray(t.dimensionsAtRest)),o.needInitialSkinMatrix=t.needInitialSkinMatrix,r=0;r<t.bones.length;r++){var a=t.bones[r],h=null;a.parentBoneIndex>-1&&(h=o.bones[a.parentBoneIndex]);var g=a.rest?n.Matrix.FromArray(a.rest):null,l=new e.Bone(a.name,o,h,n.Matrix.FromArray(a.matrix),g);void 0!==a.id&&null!==a.id&&(l.id=a.id),a.length&&(l.length=a.length),a.metadata&&(l.metadata=a.metadata),a.animation&&l.animations.push(s.Animation.Parse(a.animation))}if(t.ranges)for(r=0;r<t.ranges.length;r++){var u=t.ranges[r];o.createAnimationRange(u.name,u.from,u.to)}return o},m.prototype.computeAbsoluteTransforms=function(e){void 0===e&&(e=!1);var t=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=t||e)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=t)},m.prototype.getPoseMatrix=function(){var e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e},m.prototype.sortBones=function(){for(var e=new Array,t=new Array(this.bones.length),n=0;n<this.bones.length;n++)this._sortBones(n,e,t);this.bones=e},m.prototype._sortBones=function(e,t,n){if(!n[e]){n[e]=!0;var i=this.bones[e];void 0===i._index&&(i._index=e);var s=i.getParent();s&&this._sortBones(this.bones.indexOf(s),t,n),t.push(i)}},m}();exports.Skeleton=m;
},{"./bone":"cReH","../Misc/observable":"gtkL","../Maths/math":"Iizi","../Materials/Textures/rawTexture":"WCXp","../Animations/animation":"8SP4","../Engines/engineStore":"n+VE","../Engines/constants":"vn8z","../Misc/logger":"Fvml","../Misc/deepCopier":"RVA4"}],"E2Hr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextureTools=void 0;var A=require("../Materials/Textures/texture"),g=require("../Materials/Textures/renderTargetTexture"),B=require("../PostProcesses/passPostProcess"),C=require("../Engines/constants"),w=function(){function w(){}return w.CreateResizedCopy=function(w,E,Q,I){void 0===I&&(I=!0);var D=w.getScene(),e=D.getEngine(),s=new g.RenderTargetTexture("resized"+w.name,{width:E,height:Q},D,!w.noMipmap,!0,w._texture.type,!1,w.samplingMode,!1);s.wrapU=w.wrapU,s.wrapV=w.wrapV,s.uOffset=w.uOffset,s.vOffset=w.vOffset,s.uScale=w.uScale,s.vScale=w.vScale,s.uAng=w.uAng,s.vAng=w.vAng,s.wAng=w.wAng,s.coordinatesIndex=w.coordinatesIndex,s.level=w.level,s.anisotropicFilteringLevel=w.anisotropicFilteringLevel,s._texture.isReady=!1,w.wrapU=A.Texture.CLAMP_ADDRESSMODE,w.wrapV=A.Texture.CLAMP_ADDRESSMODE;var f=new B.PassPostProcess("pass",1,null,I?A.Texture.BILINEAR_SAMPLINGMODE:A.Texture.NEAREST_SAMPLINGMODE,e,!1,C.Constants.TEXTURETYPE_UNSIGNED_INT);return f.getEffect().executeWhenCompiled(function(){f.onApply=function(A){A.setTexture("textureSampler",w)};var A=s.getInternalTexture();A&&(D.postProcessManager.directRender([f],A),e.unBindFramebuffer(A),s.disposeFramebufferObjects(),f.dispose(),A.isReady=!0)}),s},w.GetEnvironmentBRDFTexture=function(g){if(!g._environmentBRDFTexture){var B=A.Texture.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",g,!0,!1,A.Texture.BILINEAR_SAMPLINGMODE);B.wrapU=A.Texture.CLAMP_ADDRESSMODE,B.wrapV=A.Texture.CLAMP_ADDRESSMODE,g._environmentBRDFTexture=B}return g._environmentBRDFTexture},w._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xu19Z7PtTHbW1g3jMMbGmGDAZAMm5xxMLDAU0WSKWOQcCoqccw6eGdtgk4yNbZxnvvAL+Af8Af6AsQl+06ako9X36dXPSi3pnPu+cz/cOntL3S1pq5+w1mrpLs/eud9fvn27rf9evPPwFz+v22S7fGZ/n7/70G79J5/Xv/qzbLP+Pnvvoc/6Tz7jX/15/c62LfeH7fofbpfP3l/ct36Wf+u4+D37+XYb++G26LPsr/zFttnPuh37bm1bt0f7MvtlnOx4uv0H4fty8UUsz77rfn/57u32cgXvDv72eQf0tl0+G38b0Nf9K4Dl704MEfA16KsE8Gw9JgD+DQE8EA0DT2b7GwK4GHnF4a8iguXZt9/vL5/dbisJbEq/uwD5vIK/fbbAv4N9U/8nJIDNCazKvBLBGwdwu62OhajxmQSAx6gqNp5HCg9wPan2nwSNjhLD8ux/3u8vP3y7vbwDAYjtR8AzFyDqLu1Q+YEINnew23rPCYiKb+q/K7o4AVT4tg0t/h4ydJZfkQASQ/d5b9fZ/Z1ENmuPn/cwYCYEELBguKC3nRkCnE0AFOwOKCOAR/sH/L4hgFMpbSWP5dn/uN9ffs7t9mJ5cAHoBLTyszBAFJ/F/xIKdASw5wgaEWDMLySxAk4svf6L+4QAGPiJCziNAPb4f3UZ2dh/m+z7BK4SAPYrxf5FB6ABPgCUAfANAZwKyscc7IEA/vv9/uLzbreXzx9cQCMACAl00m8jAlF7ov6SCMQ8gJsMFFBnCECSg5H6TxJAU3vPAbwhgFfz9AABeOEDBcIbB3AqPzwQwH+731/8sNvt5Ydut5e3B2C/fG9P+jESgGz/RgxG9r9VAwTUUh0goQDafUz+DYnAnSha5l99Z1l/yQVswAZSGIAugNd/9xBgCw9E8aECkHUB22QPHIAVDlQdQAMWAibhBgZAasAVHUAI8Cqg96Tm0bj3VBS9jwd7IIBvuN9ffMHt9vLTbreXy+32QlwAhgMIeuNzKwOqCoB2Aa00KHE+EsIeDuj4H2N+Hf/TfAC6A4nhgQCQDDwiaKDXiq9KgBEJNPArAtCk0AEd2mpAizW3/lYIoANpBPg3BPA+hjs/9eXZV+0E8Bm32wsJA9aEoBCAuAABPiEAC/yDC4gSgRgKRHkAlgsI6v7iEFqJEMgBwb4BGkEfEEDnDlReoAP/SQRgOYIB+IYDMEE/SQBbXoLNr0jhq4qOZc0PHBSf5oKW519xvz//kbfby8+83V68ABfwniIBgwgQ/HoRUMv8w5qAoQqgk4DWQiCw+63eD8k/XAPQgK5s/5a5xzAAqgR6wY9k+ZEMtCOoJABb230hEHMFWQdgAl0Ap/+uc6tKBrrP/n0AuwfiNwTwNKguHHV5/qX3+/M1B/Ddb7cXax7g2e324vaQB3hhkMAW92tHoFb96cVAbimwkgQ0Vv7R+D8iACfuxzKfLvnNlAAjAsBwwP2MwLQAD9sbYJME0AFcg5uBPSAA0x0AobhtcDKDA0j3KYDhk7Hp8uKj9/vzH3C7vfget9uLT9nDgDUZuOYCLBJA8MNKPyGGIftPrL+4gy3eh5p/lwRUYYAs9Fn7tM/E9lvJwCH2DxJ/mPTr4nyyLiDtBgTAGCrgNuPzNuETgN+suEEAFhng9lkCoICMLH7V0isCeEMCxylrefkl9/uzz90J4NNUGLDmAnYXINUBrf5dCCAuQCcCvYVAYPk3G++VAveVfkIAFRLolgbr2F9ifP33pAqAV/fHRF4HcAS7AKlAAEIYFNwITOszs/wMsB6II4BXFZ0QwBsSOEYCDwTw2TsBfPrt9uLlqzCgcwFABI0EVCiANl8Uvq0JWNsi2JPZ/0YKsOiHxftsW4v51ZqAaBWgZf91PsBL/jFHwEqBR1cCiuJ3gAfCmCEA3cf8rmz8AMZHIoA3JDBPAsuHVgL4jNvt+UoCH34ggK0asIYBGArsAB7AD+reQgCl+GwZ8LaNlP3MEEDaSg4ACMGr/+ulwV4JsAEfLH42/vdKgWElAJ4QpBl+LAlKErHwt+oGMgTA2ngE4IUIOH3dGr/hAKT/m/UBdSJYPuVL7vflU26352sScCWAD+0EsCcDVxewKjfmAzAsENVn4EfgdySgnYB81yEAgL4RA8T8mTUASAAYBgylQAkL8K/+zL6rsl8qF6ArAeS7WRGoAB8Sf7isN/VZqTs6jQ5wXlweWfyqpQ8I4I0TmCCAT/3I/b48u92ef9bt9nwNAdZE4FoOFALYXcAGegkDMByAzzQEgJh+cAIs/legH0IA5QTCPADE+7ISkD0TgA/8sBIgLQfOgF/F9kPcr+J8fIYguyCILQRKgV4DNviOzoKqeJS0u4AA3pBAjQSWT//I/b5OmC0MWB3ASgBrGLA+IryvDNxCgRXo+wKhjgwk8bcTwUACsJ09ANRVAALwCxmEoFcrAUsuAJ4M1E8BDuHABAHomJ8RgACrZfQLyT9dBWi2OOEG9NJd/TDQ8HAQuBE97ZhjGKy6o+imnU+4gDckkCeB5cMfud/v6zr9Dz84gOdCAM/3JwQhF9CAD25gBWWz/8wNgMpj3K9Lfy0foMMBVffXyT4r+cceC9bvCcDFP0311QrATPkvWgosYQFLAuoqQEcQuw3v2si25F+M1RkZXLUU+CgBmCBOEsCbvECOBJbP+Oj9fv+u2+3Zp91uz9cy4Kfebs/3ROD6iPD2b10YJCXB+0PyrgsHdtBuRACfBeTN+uM+suJPSEDbfh3/oxPoHgwiC3/06j8Eutj69sAQqj++I0CUfvIpwCEvYCT90O4Pn1XsT5Ve1/+dcp9FBh3woqXBSEJkvjHHEOUPqJPAjUUCeOMGfCJYPvOj9/t7//d2e7YmAlcS2B3A8xcPYcBm/7ULEDIQew+5gS0EIEA31R8Uf6gAoBsgKwBd9ddvBBJAs6XARgLQXQ2o7T8+IETe+9eRACg7rhCMVgCiE8D4O9wOCb2ubOht1/vYd2ubzLlgKbBHEDSnAMfL6durVm8qBPwXWz7rY/f7/X/fbsvL2+3Zqv4QAjzfw4COAMAJbEC3wC8koBJ9lAhgxZ+4hi3Oh/f8dU8EqtV/JhHgWn9cC4CJQZXZp6GAk/1nawMkrrcqAiwPIIA2FwOB2oaAF5UkcX+GADBs0I5gsNbBQqCorJcFJjqWKvhNMjky0Aek7/LZH7vf3/vO2215vruAD91uz/dSYCOAPQzYkoD7vw34sFIQw4LNymNSUKk8Wv0hCYhkoJ74Q6BboO9eDKoWAHXvBiCvAdPZf4nt3QqA924AbfXV8t8uN4Bt2We029WkoErWpSoCSm11TM8AOYA5uRS4RAITIQDDavaYHxCcm5exfM7H7vd3v2N9McDt9uxDD//WKsAG/ue32/M1DEACuO3g1jkBsf57fqCL/7UbIISAio85AAG0VQEYiIC9DJTYfy/+Dx8HlpeDRK8G90IBHQbgWgD2WT8LoOJ7NyeA5JEkAwwxmuqzur5X6y+sBEwDMggrqoBNH7c68Puk/fI9Vwfwvx4e6H724oEA1iSg5AAaAewlweeyLmAnAHQCTfU1CTAH4GyTMt+QDMRFQFEYQB71lXUAOjHYlvTqh4N2xe5yASoh2PpaJUGDBDrLr9cGIDlY1l+vDlQOAQHckYMiA68KMFsGtOy65RCGsMIDT+QqJoD3yUwCy/f+6P3+7koAt50AXrwigM0FrIuEoBrwHMMAUhmQUKAlAwHo7VmAPURo9h/r//ozLv1V7/5v6wGMV4B3rwYPXEBqIZAQwp4TYDE+LQlqtQfw6my/LgsyZaeLg7wVgmDnWQ5AA5ZWCDRx7ECzyn3udgFptFCIgTlyFRMEUCKgA+O/jl2Xz/3o/f7Otz88QvpszQOsLmAPARoBSDVgud02AthdwPZ5BSxUBVr8L3kAVHrvs076KSLQi3/M9QCJ7H/G/rf4n8X41XIgcwHecuBMDgAe+BHA6uQgqnvbF5DB5hwUQM3vQgIWkKOVftH+gAC6cz0RXZ9MjmD5fh/ZCWCd1CsB7CSwhgArAUgIIC5AQoDOCewJwab+CH79WR4C0mQAZT4hEQS9DgfEztNkoEECDfi6FAhZflb6Q1XXqwHDEECpvZX4a0qP1l7bfAS98cQfzQUo9a4mASMC0CsIm6JGK/2i/QkCuFK9PxmIYPm8nQDu795uy3K7LTvwVyJAB7ARwJoAVLkA7QIkJ9A5AQS95Ad2YmgvAJWwQFcBpB38pUuB9wVKbAWgCXwV86Mz2ICKTwUWFgOxMEBicr0eoBwCGBUADfxsDsAiA+zflNay31ZcfnAdAAXgDGkcdAcfZCJYfuCX3O9vf/vtthHAmgcQF7ATwOoAtn9IACsRSDkQ/wqIIUGoXYEQQ/sL5IDJP539776DwodVAGlr5QBgP8sDdApP3gSUXQa8/rZsRaBeHmy+HwDyCI1MUNlZzX9iJSBO9igJGJYCo4RdIqMfJQ4Ztq8C7FXjHuSnQ92XH/yvdwJ4Z68ErOXAlQRW0O9/JRG42v9GBHsuAImAqv+uzDo30C3yAfVHoHeg9xyAp/7wlp+WFCSWv1sOTBb+0EoAZP5DImBrApAUMFHolQG19c+EAkbpjyUEdQ6gm/QEsCzZFxKDlWNwprJVWfBm/1WAvWrcQ0ie7Lz80H91v7/9v263+9sPI2zrAZAEdvXvXMBKBJIIFDcgyUAEvHICg/o7wA/Bvyt35wCc2F9Cg03RvRyAA34N8hD0xsIfXP7bQgDMFSgyYO8GsF4N/hQ5ALak1yUGRQDZZJ5VWXgKEsie8yQuH63b8vn/8oEA3lsJYJ2EQgD73xX4z9bs/74gaHMBQgA7+DsXAJWBBniHCLTtNx2AUnkG/LYNiUCpvX7wp6sIOHF/lwgkNf8UGagwYMgLMBdgLQCyVgOyciCGCs5nz/Jr8EXOQOcQZEbrfjjTU8qaCBseMyx4vxPB8iP+RU8A24Kg9R8Qgaj/av8lDBgcwApQ+QdVgW0bKr3+jsk//AztzBKgtv4K+Kj08rl7JFgt9BnCAIsQcD2AsQAolQj0CAGAqhOFCK5u3cA+84dyIJLCPm6buAgoBa5qDoDF6wzUkZ13iSDKKwTamSKZSf29cuzJUwq7LV/wz18RwH2Nl9dKABLArv6bC5B/+9OBGxmsIIR1AQ3w2gk4RECTfwBulgC0rP96/FYJUOv9SzkAB/xuKTBY/qsTgZ0LILF/s/RW9v81ywEwhbeAwUIH6hRwGp+wEOhqoF49fojqQoPlR/+z+/3t77jd3n3rdru999CzEYAQAYJfXACEAqL8W5lQgA5uoJUK9zxBB3ii9ALiYT2AjvuN72wFILP+XdlP8gLKFeg6f5QM3AC+VlMMZ9ABGuN+VePHWL6tHVD23or3tQPo2iWfBRgShDp0ELcBjmIAbwTWqEzIJvLM6kEDEFcD9erxCzg3my4/9p/e7299x+323lu32+oAtjwAhgE7Cazqv7mAvRLQcgG7A9B5AAwHus87CWBYsIKFfe+eCSBgt2J+7QBQ+VsogOU/9fIPBvLhASEF8AHwlhPQ2wVYFhmo/Wby74QyYLcmQAEbbbue2FcnAb28QTmHQKBwNVCvHv8IESw//h/f7299pyIA7QIE/LsTeIbqL59hPUADvHIBG8jBIWgn0L4rsKMj2Noomz8QgZELsCoAAnh0Caj8lup7ib9tX+ZBoKgUmFkWTGJ8S/UHZa/kAHT+QGaeoeQmMUC/CoAzVYAjYDvSNwPCq8fPnINus/zEfwQE8O7tdt8dwGZjIQQQ9Y9cwAB+RQIC4I4MdvvdLL+O//E7LgLykn6q3Efjf6X8bOUfkoNYcQZ8z/KzBUBYCqT/YQgjBuOBHxPs7JHh7JoAy/IzWz+xEtBKBEYg8fIGw+SeQQQ+CzHZP+oWXWPU/8z9y0/+h/f729/5kAN4791X/6/cpl4SCsDfLRQwHEBLCmJFYH92vssNgBPo7D8qv4CekIHpAjKgx1iffGbKb5UAQwdguIAtz2KsEWj7vIQggNON91lYoIFN2mznYKj9UBmwQgXLLcDstRTdBchEFWAWcLP9MgC9cuzM8aXN8lP//v3+9v/uCUDyAM0FIBFADqAjAsgFiAvYwK3/MfAL8InSd/Yfy37Qpyv3OSTgxf8C5vZXPfF3aB2AA3hJGg5LghMOgCUBo8SgEAyC3Irvh5xAwhW0cT1iQBKYWds/QQLdeVUQcrEjeGoiWH7633sggHfWJOAaAkglYL/wLQyQf3tYsCp9CwmgFIgOgIJ/JwMdBuB3cQTDX4z9wR2whN+WE9idh67761p/F/8bpb8O/OotQCsJDhZfji0qT9p0LsCI83X9H8E9KH8iCSiTrQO29bwAAbvlCipPAw4T/oRKQAVElbaMJ472t7jnqnEjrlt+1t+539/6P4oAxLquawIkF7Bb/40M9hAAHcD2GVzABmBYKSgxfyMGAbROCipl1w6gs/8ZF0Cy/UIOOr7vHAIu9iHP/2v77yX9ROUt29+AHVUCnDJgtvSn8wXsnQGzIUAW3F27qFS4z2CrD07wCogqbR8LtGecUwR4vX/5OX/7FQFsOYC9FCiToBGAEAH83ZwA5AM06BspiPKrNQIt/kcg69iffBegNqVXb/wdQgIMC0DltUuQ+L+Bmz0OrNTdK/91+4JVf15SEPMCYRkwEfc3stBxurMS0AoTMKRocaV8cKw6jpcFsdUn2/8qRT8buGeP55HC8vP+5v3+1v99cADvvfNQBZB4dO24Kv5GAntSUOz/+n1wAis4wAnoMAC/N9svSUKsBABgmwPAbQTwWzsW/2vAI6j14h+1CEjnBYZFQWSxj+sEVFyPjgBBrhf+aOtPY39vRaBVJlQ2vyOGIATQsb6etBguDMSQyAF4IMhUAmZANNNnUNSqBDvtzzif6HSWL/wbuwN4eycA4gDEBQgRYPzfSGC3/BYBdOCHxKBHBAJoAbdWfIz1I9XXsf5g9y0yAJB7iUDPCaC6e2EA2ngMGyIHwAgBldncf4ID0EDXVp1NYmbnrclOtyfDhiPOoCO4CEXB/rOBfOZ4yy/8a7sDAALY1gKAfWMEgOovoNdk0IArKr+7gwH02gWQ2L4t/sEEoLL2IQnoFX96HYC4CIz/jcSgAJSVAtu2RPZ/SPRBHkC7AkYEqceC2fqBfdKaCcHAAeAkpKVBCANcElBVgBQRTC4HngHOTJ+rQo2jhEbP6xf/VU4AmBza7L+EAZgLgGSgxP8dGQDwmQOQbS2xp6oEWAnQn1seIEMCJO4fsv8Q2w/JQU0IJMvPiCCT/NPuQP/noJ0rAFBa23VSr1N/vQhIgxzzB9odMMIAkGvFZPF6JkyIlJeFFl6IcRYYX0ciOOOcll/6l+/3t/7fngPYy4BSCmyT0SGAlgvY4/+BAET10fZjUhAWCg2AV8nBEPQ6D6DJgSUAoQ/G+Dr+T9l/pfg0HxAs/e3WBUhbsihIgHKkHGiGCQHYO/UHomDgdd0BcRkZlYtyAFlgZNtlzqkSJcwc1xr/6FjLL/tLPQG8t+YA3tuXBKPiqISgAB//bjZdkoNE/Rs5EAIYXIAKCwYHYJADlvhalp8RgS4PogNwFN8jgo1A2LoALxRw1gA09TbCAjckQHBZlQEFwEoS0Iv1S3mAYFGPlwOIJn+0v+ocPohEsHzRX9gJYM0BvPvwTyoB2gGsP6iEAowANsBJWAAVgRYeAPCb/WdkAKEAttNJwRbzM+UPQI8K36k9Kf3RagBTe2vhj3o8uAFXLxUGxTdXBrK1AIltTZ2JzUe7Lp/Ralvxvrb5kcWP9nv2fwBzIRF4FRFkx/XcwRljHCGm5Vf++fv9re+63d4xCABVRhOAJoOtRCguQKoCmghwv7L/mBPQwB/KfMQhCEF0ym8RAUkIToUAxrP/gxOwSoDGmn9WCjTzASw3kHQA5poA7Q4g3n+MEMAChiadiopXwHZV26usvB43e/7Lr/pznADakmBdDcB8AFj+5ggcF4AhgAlwwyUM6m+pPgF8U3BS6jOdAAkJ3HUAO5C7ZKBT99/IVDsGhwyY3e8qNfhCERXDa5BrlW/ftaoqe265Ar0U+PIQQCUzqwqYBYfnSK4AcuW8sjmHaMzl1/zZnQDeud3eXRcCrfH/ngNYbyxzAKL8nQNAMiC5gI0gBNz42XIBAnAkBACwqDyWByPlp2BPWP7WD0Crs/5ewq+1JaBnWX8rEajbDiVAlbNpwHRyAJ4D6EqECQcQWfxo/0wI4E3wcPJnUbSLXqH5A26qHaD9kb7ssKaj+nV/ZiSALRG4rwhsJLBfUKt/k3yAJMGwEtCFBGD/PTIY4n6d8ANyaEk/Q/nPUv8h+WeRgXYCVgIwSwbK3osKi4PonEGUC2C2Pngc2LL73Xanlj9bBTg7BIgAFe2vuoxZS14B7wy/DCT8xX/qfn/rrYccwLtrElA7AJkgkrDSJUHJfO/Z/wZ4Kx8g4IXyYKfm0i9QfkoSJK5HghALr51Ce2Jwv0ad9BvAj1WCidKfZf1x3UDnvPQ90HYf7o1WfSQMGbOpU1D3H6oCynpjPE7VfSccpoalMEHNdAxFKkDLgDzTRo5ZaXukz1E34f1Gy2/8kzEB6MUlsjCoCwWMEAAdgOcGTECrnECn+JYTgPyABn0U82vwt7hfJft0rK9DAlHooTSolH94GxBUAnTSL/reAbz6UBADt344SDkIJBIT5E62HgnEAwgFmjq3ChFkAJUFd7Zd9fwsdZ89nnX85Tf/8Z0A1hwAOgDJAxBbuU1usboYCoiCKvWX+L/lAUDlNUG0bD8Bt7dviP9Vf0v9LbV3XQCz/3qbZf2d0h8D+JAPYDb/RAfArL1l92W7Z/OjEICpOZvkw7bES0EisET7M0RxRNkzx78qJGj37rf+MUUA+zoAnQjs1gTAhJNyFy4X7kBtkYHKB0ifDMgrLiADfJMESGa/Cwe0/a+CHsmA5QQ8N6ByAzJZh1IhEobOAegsvwaVDhEKDkCre0cielYbau4SQfIZggyIM0DMtMkc6ywnMHMsduzlt/+R+/2tt2+3d8QBiAtQSUBaEVDxPyYB22cEuiYDQgJtLUFk7539ke1vgAeAR05gC3ekbAclwuaEjEVA3XoAAnLpT6sBCuStrUrIpqsBHhkwcBOVTecFJAteCAFSyk/GzapwBOJofwV0mbEQkNX2p/X9HX9IEcB7eyLw3q8IlPgSbV/LBThEIMreQJkhAeYOIsDrsELV8VmIgHX9ITGo1L+BnxGB5wQY6IvKLzZZCKD7nsj8m+sADjoAVHk9ga19tF1CzSk5GO8T9MCUAdpZbSqEUW17lpNYfucfvN/fBgfwLlQBcEnwdkA9cdGiCjCgGrCpZhACDMSA6wL28dewgKl6GzuI963EXwtf1Nr/wQ0YMb+bCJwAPgKc5gPIPeiImeUC4B5J2zbZnGXBQjI4Mdk2HFNPYqv9MNlJCJByAzPPEezIiUAe7a8ANjPWGYpePc52Db/799/vb7/zKgQQAnhvDwH0cwFWLqBluwkRYJ7AqgoMTiHjApTqR9ZfbLxbCbCUX1wOKQGiO8ASn7XdKgMimL2SoG4nkxGVnqk+OoeBDHR4AN87EmCWnlULBGiBuiNJMFC5RJB8HsACRgYwZ7WpEEY2pNEuYOoYv/f37Q7g3dvtnT3+39YC6BBAv3IK1wVA9p8SAYC5gRDBqz53QDasvag/dQboGMCy0zBA7e/CgoTyszX/VeA35QeH1YGc2Hwr2YchGn5mJNGVd8FdoEOIHEBo9VkeQc3cqFJgEkPhxSBHwoIMCVTAlx1vlggq4y+/7/fe72+tDuDdV2XARgD7isDtd95BpZWjKRUov4Acwa6BT5OEsEjICg1aBUAl8DpwA2kgQeCYbHsjL0zygfKbll9XC5xk3zYGgM1yA0IKERGgI2PJQJ20M13CAQfgWv1kEjBj+Yc2zlqAGdWPgBPtrwI2O16FXMrn8Ad+z04AaxVgTwDiasAtBNgnrK4E6HBgSApichCBBHkBCnQNbmb1iTPoSEXlDXCfTv6x0EAA2OUDtCPA70bMT6sAXjVAlf4sIhieC8BYXy0CYk5gIPKCA8CJGzoAI5QYJqoRzx8NAZ6KCLLgzra7igSWP/i79hzA6gCAAMQFrBMNSUCrFypUm+x78k/cQRffY45AqatOGDJy0CDHkh5dDERielFhWvrTIYHO+icy/jK+qe6sCkCAH70erLsXylXMWv5GFowQrLyACISU6HZ0W+RALX0Qz2ug4NgYUWScRNQ+q6IZ8GbaVMCdHS99jX/4dwIBCAmsoNd5AHAB1sRDArByAV1YgLkBnfRDF6AtPbP4LNY32lkOgMX/tPynSKFzC466Y2JP+mT+mk8BOiVAVP2MA9COgH4nQGcgHxyCAe5uMicqARTcJ+QBIlB5+6O+V4E7c9wMCSx/9HfkCEDyAMPDJiQZ2AABqtZUVwG7s+ZWMlCDO/F9iPFZso9l/IkDaMRgxPqe4g8JQa30yg14pdaM7TddgWHxXcUPVgLqvnqyWw6AqrlT0jPV33AekYJb4IlAdfX+6LwR0BVi8Yhg+WO//X5/e68AyLMAawlwCAEwF2BkpTfgqwlu5QU6G45KrdYNsNi9qwAQMgjBnyEDI77XYGcxfjXut1wAhlfSptsGoNHJPab6XkLwTAeAk1MIidp+mJlRJYCqPxCABwizr0aUDl3I/ogEMsDMjJEZp0oYjECWP/HbSA4ACEDWAbA8gJ6MjADWbYP6i5LqvyRROBBABHgjXEAV14k963s7d0koOkm/s+J+FiaERADqbjkAHKNNrsRCoE7lmYsQ0HjlPm+dgMzKRLmQkkgyBJhR/SPWPwPyTJuriWD5U78FHMB7eyJQ5QDaYiBhXL0mgGWumRNQAO/KbieTASMOL8bvVgUSq2/lAvAaOvDiwiEjs6/BThdZ6bUBJNvfuQN0Z+pzVzI09nXqrT3UMRMAACAASURBVJcKg+J6xKAnLao7Tvruc6ZcyBS6EDpUXUIEvgyAz2oTnQuqe+aYzT386d98v69rALZ1AEIAazVgz/4zBzC8aorlAdS2rkIgC4e8v2TxkOsGMLeA45I6vgZ7ygFg4g8JQhOdl+FPZv+ZnRey0CQhE4PtH1TfCBmkXQd+S+1ZXkCTiQZq0gG4sb6qMHSAKFYQHpsIMoDMtKla/syYy5/9Tb0DWGP/7R8QgOUA2NtnzEw3LhRS6hjlA9CK6/gfS4XU5rOk427p9bg02cfATtS9CwGcSsB6/taTf9Zvx0ItvQ2JgH7WgEYyMMA+5AwmHMBMDsAjAhrPTz5M9H4mggy4M65g+XO/YSeAXf1lLYAsBca/24D7MwKdakBIYOUBxKYyJ0BDAeIOTOW2QI75AgVkXNVH7b+VBFTgDisAQda/gd5LrCrlZpa/WXJrEVBk+cGxNWAkqwDMQWiFNq2/zNKgDOi6A2NFICULRAV8rrSN7HgEzmh/NH4G2MZlDi8qXf78Fz8QgNj/thjIcADtvw9HNcgQwGxIwPIGLHTQVj8BfszWmzkAlZsQwFrlPbcCYOUCjBwKKwl6pUBRWyFhukxY7LmO7414X8f61BVY4YLY9iDBhy6BTX6LPJCoPHtcAXelbQRUD+gZEojGZyCvjrv8hV/fOwArBGBLgnFpcGdJYUJ0gNknxLDNCwm8xKEV6xtqPwt4DWpm92kIQICN7bSNF2Xv/pLfUgNd5wxoCEAA34GbqL0VAmhSuMIBuIqv8wGJRUQWmCzAfNIQwV/8tff7O+9BEhBKgEMiUIUAXjLQinMbAAAcCIruFWMVgBPFX28iLhW2Yvzu+JCo06A21wAQm69XRVJwk+RpaiEQCxeQKEDlaWhgtEWQWEqvt7vhwoQDKAFfjR+5hytdgjf20X1HLH/kIpa//GtUCLATgE4CogOQz628IwzslKx0gosuG1bWnuUGotJhyzUYYUIjBSsnoJKVXZnPCAeYo3EBH1UDDIA38CniiBR/CA1I1r5VEQBUg/1XVt8jjG7iWZUD5WEz5UIK8sRagIhYquQQgfqI/a/aeBYKZMOD5a/86r0MCGsApAqQcQDbgTQBMNuqJ70GE/nuOgMSGjDFj7ZZhNABnxBTIxon459Vfa9yYpUEEfRU5RXounEUkJEgGJlEYNb9O2IQ16hsO07y9nk2ETjzJKG4JIKUSlgQKqyDzgzQM22ic/AcxPLXflXSAew30no8eDsJvBGWyhmJsKojQOAOi3R0yRFtPcvuqxo/tf7qeryYv2T/mZqT0IARgfzmG9Eg6erP8Jvr+4Tk4Sk6IwnWfgA/IxsCPhmfKWuk3ugcqENIgLwC+hl1j4Ac7c+CPDNOd4/++q/ccwCRA1iFHkqAtBrA3ICh/J46Yp7AjM+DHIK27t1aA0YIbKGPIisrw59NAOqSH/0NEKyMCBS4qwnAtNpnk4JGnN8pfKYKoIgiA2R2DEYglW1XE8FZQI6AHu1vv8nf+BUPBNDKgFYOgDkAsHdmQhAnkhP74kNDg72OwgMP0CRuN90GW+CTdCwWoVluQKv3EAYQ1cZjuOpv9JXJNyT49KIgliMwlByVu7kJUFwvPBjcQuaxYSuUOBAGZMjGIxEP1BEQn3z/3/oi4gA0CQD4uxAACMBLCKLNjFSPJd3Q7rtJOWu1oZNcHMgmE+8H5T3P3Xj7OlCzCgEeN+sEVDs8Rpu4Ol9ggd1ScuYWkAQIsDv1lrYqB+BZ/2FfsBqQAe3sbZG6Xwn2aGzr3Ja//cuJA8CnAXfr314SajgBkwBwAs6EAwmwWWFChThY0s8iI297B3DDPYRtCLi3Psb2AdRAHrKvqb9BCEyNtaKXS4OkoqAnomXjKUEo9e/GSjqAs0HvAS8C5WzfaNwKES1/95cZDmAlAbIacPudIRcgi4H0oqBuUirgU6WDSVtJsHnJw8gtZNyGWeJLEJNn61vZzYjzo/3dQ0Ea1DgmUXMWAqTAbil9UOaLynttQj+iAzibCCLQRfstUM+ShJiqqP/y937p7gDuex5gBz5bByD23woDMA9ACeCAG8jkCLTis+8ZUhjCAisZOKvwySw/OoWONFWMrmv4ZsWAqX+wrXMGbLkwnMvgIowEIWuHTsV1CTKz978WeViA88IKDzRnA/Ts8TyCcUng7/+SngC2twFZJLBPljIB4IQ1wgA9waPM+rCfJApN9Tae1beOGZ1LO06CEKj7UbF9A7CVB7AShIa9R3Uf1gOwhF9V6S1iEEQFDqFN3my14IJEYNYRTANNERd+PZMMIsXXp7H8g198v68VgHf2uP9dBX5xAtvbgaUUqEqCg/1HKweAlx9vsLeGIlqxchWojCyqY1RCgXK5jxGHofIsD9B+V92nSAgIxCEkgLEGBU8mAaO4PgoVmEJbOQQG1CzIs+08Msg6kAwRzJBOlgiWf/SLRgewksCq8l0YAKBveQAgBGb/t4vDhJQmAwf4a9dQeZPWnJbiHMfgOYeNlAKlx3BFOxs3L6B+LySS8EUg6rzwuEgQ3luBGugDqx/lCzyCGPbtCBBi05M9Io2OFB4hEXgmGLMgzZDEjIvYruUf/0I7BGgkAJWAbY46SUArGThMyAIZVADH2ppEkiCBir2n5xmpu5ME1I5pUH+LYEnFICKEDpiFEADPSSu0JhQX/MphTBFBIYnI3MRjgLviLs48H9OR/JNf4IcAK9bxPwoV9TerAXgj4T0BOJk9MhAQDZOfACUCNgIy0zbTJpPZpyGAQwTiKug7AYkr0L+N991Vf00gpGyHINbK3yZVMQQwVT2xEMh1BEZ/Nvk1EKsKmgXyGeOeTQQdEf/TL3wggNX2b/H//jqwLRGo1gC0HMCeD9AlQPw+WDqZJEZIoCdaNY6OgOmFAVq5u7ae3Y9AHam7sd8kApUsZHaekclAvrv86eoBcwkZkFvrA1hf1wU4Cu4Btu1T/c8G/hWgrxDEmSFDc0D//OdDCEAqADoPIMnA7a8wrv6LpSEFfJlkoQtAdfKShEmAWlUDN7xgOYYE6DPuBY+Lv0W0HRXdK/cN2X6l0jqcsICubbx2AVeFAK7Sy+zV1YDiasAjgH6MvqZth+vXH6sksfyLn/eKAFaw6yoA5gEE9FYScDsZZfsR8CwhSJNb2Tq5UVLsQO0lE5Pk4bqRiBDU/oEcHFVn9X1T4dFZ6TKhYfWZcltqbm6HsZm6D07QKuGRcqQGgEUKSF5N2QySYPutbZkw4SmJwCIIJIXIYSz/8uf2BEDXAWAosN/w7gUhAHwhge7GY2wGBKFtf5oMGKgcl1Cx/wKwKKQY2hWB3oHbqver7ab6J8t/2L9VbaR6sM8auk4gArlRNbBchQnSaBw5RyV7lRCAgSYCerS/otRZwqiMmSECc7x/9XNUDkCvAyB5AAwDtrlBQgG8KegCOsvolQgrgPKcQKTQSReBhOCquBP3a8LTToXF/vpY8ls2J6AdBFH/rNJfov4YDoL6UzVP5gDc8MBJBFbBnwHrWW08EEcqrvhw+5oNBZZ//bMLBCDqb7kAcAJtUQeyOuQDcGIPnzFeJQClSbJqngBULW3xIzKpkBYe3wGxkISn/u5zASwccLbh5NHhht43ELsFcGeFXwfmA1UAdBsZ9YxU/ej+zDkwJ+RtO5Mkmhh9yc+637cKwJ79lxyAlP/kKcC1IqBzAJgL0K4AQwC0m7hgyAsBrAVEaL0HJU6SQKeiyT6dWictOwsTsqW+9ttosAax/pA3AKJBEqEhQLX+T+J2PG9GEIxEPPC6ag/SNzhOtm/fZo3JABYpfLT/KBFU+leUvxHNR37mSAAC/lYBUDkA76EgIYWOAHASKnXHm4/hwaB8pIxIV8oFFpxlziNws/0diSgF91bwuQQmE7QQ+2fUvwO+pf7KkXRA9db6W6QB1+KCHu1qMgTQE70DoTOG24/Y5qMuIEMOFYBXQ4FM++WjP2MnAFUClGTg5gCEAMhy4M4F7JNou/eZ0qBWELD7qO6D0uNkZXmEwKqb4HXI4wzAa8ejLTYSjb5mfXz8jgCvlP86YrhC/ZH4lfpSFU4SgAfMo88TZFxAlRgyY1aI4Iy2zQF87KfbBLCVAAP199YCaBJAV9AlnAxX0NqwnIBSrHSSziAPa/VeJt/ACMp0AY6l1+CNvofqb6h6NikoJMMUHN2apayZNt3YxRwAPa6Tb2iTXj4cVP2MwkdkUQFz5njsGt1tX/rTHghArwHY7P++DBhdwDanYCWgzgPIfh2TtfUB+6QcJhcBedfGUXoGwAaOyXhdKy4rC1rxPAtlymqfjP0x5h6ArVSdARJdiQa6BWC8t3h8RhQ616AnY+cEigRQdREWUZ1NDBnFz4I5Y+OroMf2y5f9VE4ACH50AS4B7OD28gDtxyEVgW6yOIQwWGlg/Uz8bQLXcBoa/AM56Dq8FcMbCTyx/o3ISF3fsvaMWPRv7JLEPht08nC4TyTDb5UNI1VnwO3coaHQFPBKxa0QwAO/G1LAucwA+2oHkDkny2Vs27/8pygCANUXF9D+h2CdC1CA334rcQf7Z7yxsp8qiFpBOKhPQAiW6jIlN9UdzllAKQBjdtxT9eF8HJLQ5xNae6Lska1nSu+pfyMjb3GOlxwEYrHANwA6sO/abdBxyRiPAf4ZoGf6WOA9y0Es/+YnAwHs4JfsP4v/JSEoTgD/is1veYFZEsB+xAp7gDEX0yRU2asQaHX2wD8QjEEsCDKt0pZqM2LpSqaiiNpteCW7mQSgukc4UTWxsH0Z8EaKT/erRGIW/E/pAo6AOdt35+Pxvwf/t0gA8BKQFfzZMiDmAYakoJ4oUB2gE4UtHDLiYQSa9bnsDEhJj4HfdBYHF/V4Vn8gvh3sh9Rfk60ot7c9Uf+Xc80AkDnCNGng+RrnzCa/RS6Z8zXBJDv0ORnf9bHY96Pbov7LV/ykMQfQrQMgVQABvP67//60BKgXA7UTU9Z/mDgk+TeAndjrBtpCBcEF9Wz23on7j1p9TW74mzaH4jgC/Vtri20uDdakzvIDbTL0y1I9Gx+V8CJHgNeTBfIMEXhjz5LDU5HB8pU/ccwByBOAXQ6AxP9sQVBL5EJGF8uByPYDCehJE1UGAuB7JKD3MadA22iFx9DCiPPpeZAFOZWyH46Jk2cDPiZFRX1IvI7XrMdg2fsOvCRsYGMM25QadgC8KAeQIg5BblAajOL26v5Z4DPrb6m95wKWf/cTxhwAPgJskQAu/aUhAIB5+22J9aelQa0uOuFFQoRBCY2Soc4PNBDBMQVAGJ50amqVI8kYOH4F3FTZsyU9EvuLMs4q/NBP3SNT1Y2FPQyQcs0RYYT7JxYTZQgiAmoE/Ki/8E80DgO+RQYe8Nvx/v2P3wng9updALgAyEoEYrY/ejS4katyBegG2OfOEqpSX7s4K0QohgVUpSft+5VgR7BFsb/nEkxScByD/s31pB2IIOMSIETRE9YLF0wiOGMtwcUu4EoyyIAe79uyEsDwIhAsBSrrT6sAuyJ0i4KU6p9CAkpl9boBNuHT7iCw9vThJBJfe8erKrt2IZZjoWSIcTkLCTwVt6oC6nojwLKYvuoWIsUf1DsZRljn7m3PAPcMBY/GqIK8YU/IHTYs/+HHKQLYAd+tBCQkMIQA7L0AQAxo8bbjI1MXPiOIqMJNOgIEly4HmvsUIaUA7oQ0tD/LuBsAzTqC7XosUnAy/MwBZADtKTl1fjhB2aT19j9RCHAGOWTGyII/Gyos//HHAgEo5c8kAbv4X6m+lRDEmy73EtViSEA5pcFOIVTSMHIEAgTLVuvVceXVeFWwO3F+ByIW5zuxv1ZRRqL6d2TK64E1Y/9dIiDWfVB3veqPEcEThAARcDNgPKtNdC6Dw/lPP+Z+fxcWAOHbgM2FQKDsQ/wP+7TSo+qzsiAqk1apLmGoVUor4kTpcCCDALzZen1EQpbNp+QEjgNdiZWxN8t4pCKQUXeLOChZOFacEoFxTmzsYRIjEZwQAnjjRwCL7Hu0PxofLnVc1IM7gzxGE96vWgkAHwUWF8AWAuGDQOyhIAQ/KwPu+9t5KmVvJwXtMHSgE9BQfU0g7oMy2g4byb9ZMFtkwUCMhNDtJ2VDDVoNLBoSEBLpQBYB18kPpElkv9HM1XRzwFB85gzw2BaArX4uoRRAFYG7up+RQYYgKm5i+aof/RACiPK39wAAEbB3ArSq3v4Bl//qpcAa8Nt3QhAM7N0FE7DTSWc4goEUAAwm8Ky1CNYCG69syWr/BJBWLkArvWflL1H/iDwE2I6dH0hKJkeyYtCRFYCThSdZYLuEwo6hCGwGlE9FBsNx//OP2gkAwwBJBBoVgK4SsE8KyQWwuJ8RAoIdCQJvpMXqVnlQA3z4TpRdjsHA1IEo6hss7JFzQQDQYwaE0AHAUmMrSWgAmJKomuRH7D8DmOVWGMAjgHb7T8oBeORR2XcFOcyMyfps2776C/ocwPr7df8rkEMC23xS/0uQLgVm3IBOAHYni1ldneHVcSMJKdbJEYYOQU7BDR+M8VMZeQZUY1tHVNYxlQJnQgJNKNbk9tzGAFovx0CWDXurDkPF1+MVcgBZhzDbbgaoVWdQsftNaIHcNwLQIYCQgCh9SwaC2jfgQ/lPg92qAnQnokIB6gCUcrlVAqNsZqqco+xMtTM2/FTwVxyBofAsvGGgNe25UxqskgxV+ETIkCaCAgFEzkLmqdXuqZ1ARBam6gMAl6/5kSoEUPYfwa/fBNSeBQBi2MZW7wRox8skBgnYTUfgKLeA11O4KDk3gJ0pWzI00BOYxuhOeU9fhwXWqdg/Io7MfuJKKNhBfRrAJisAFJgH1wF4oPYAF4HxyP6oLwN6xhls/f7Lj7jf5dHf9hdeBNoRgJH5L4UB+2TSpBDmBADsCG5U9izYq+Sg25uKqqsJhnJ64JdrcC13Mfan14tAdDL76MhM0qmOFdh2fRxGJBZQoycKI7BkQZ5tFx0v2h+BPw30BrhXH7bweCOA/eWf+kUgFvjxKcChGqAAbuYADCLQ4N5O14j9I/DjftcGe1UDpn7Ogh2LhCrHfyzw098Hwews/aVkkMzkD8qd7JciggNJQItUjoC0CuAjxMLOMzz3r/3h4ADgLcDM+ktOwKwC4HJg9ZmV/RoXWaGBUv1TiYABO8ofWLHwRDLPBd8JCn8quLMWPeMkiPozK5/dNpBCkAPIgnwWiLP9QqAqBc8of6rN1/3wh4VA8gRg9AxARwI7iFgJUCcAKwlBFg50lQIdDoCbMC1rpYKQrBygW+kUMcjkR+CsxvHus/sReCPQRvsR0A74rPCBnXtK6ZVTsdzgYwK+ovaVthE5zCi/8MnydZ+vQgC1AIiFARveINHnJQMbNlHlAbDbiTj7NBmUiYCoNqsiDBNUT+YjoHaSh3Lz3BDBcivedkaSjvqa8X2ypBe+QEQBVl9vBHrmCCi4H7EKcJban00GFcJYvv6H9UlA+i4AXAuAZT/1WWf/LdXv8G6VAQkxlMHPMsJFJ3CJylugstTaU2FPdT3wZpQ9UZ4LiYvU/TswJ1xDRsWZ88v0a0oIFjtDNt7YEQCPEEc0dnX/AwGQ2P9oDkDCAvld9XdP9dEV4I3tbpaenMZ3V2lIn0yCSlv0wyTh1Nkz9p6ppxVGoFU2VV/UOqn+6NKiMbtzdQgmcgRv1P/hJlXdw/C7/dcfajsAifeFDESU27MB+wa5jzoUaOB3LD4SA4v9NVF4LgAnd3ehgeozAHugHianEx6wCR+FG2YeA294whVQYtjvWQRUMw9BlDIkG7b6j4VmVrusOp9s/y0ncJX6R+POAD4kiI0A4L8BQ+Uf3gfg2H/2MBBTfdP+C7vAzdaPAFfIwLSERHVoIoqUBjNKm3EDGVIwx8kAOFLuaL86hkkkxcU/jDgrSh8CUhG9B6iMzc+0iUB7xO6H4EWszLqBb/ghJARgTwKytwI7OYAhBHBcQDYckOtlTmFYABIA3XILbCEJ3QaE1ampsRItHTbsF+mqqpUryCzZzYA/QzJJN+ICPLFqLwPCI/F/aXy5N4YjiRT6akB7BGmd2/INP/ghBGjJPwL+1QnIfGf2X8CuQ4GGEZXoO9UFEOdwhAxYDiCtXE79ngKh2t7LFWTAHwAbSTEKEby2kaqznEHUJ6XmCUJJjaPUdFbFK4CvtI2IprJ/+caVAHQSkD0ObL0MxCgJbnNNqb7+XlX+KATYLlwdky4NZVaRxY/ZcMGLZwNHkCaXCPwZ1bbOBZXNyS0wkJruSKmll1w9CsrHdACzZOBdYwWwYj7CcAhcijf+8o0/KHYAkgzs/u4Trqm+/g7gKYUDRNG7F4jKhTlAbz+SbgNjdz+g0S5yA0wFO5AQAnHVzwOoZ/vPAn8yMeclKSMlPwOspm1nhO2oeRZEM+0qgH8q9d/O8ZtWAig4AMGQuRDIWQ48JAUBkO3eRcDWuQSi+pETQOBSdpxQ/kjJI7IYljkrVXaBlajpZxbqeGrOQEDzGqA8OoywfvdqHP5+IICznEKFSDJOYhjvm35g0QEkFwIh2Bm4w3AgcAJ6MrV5R+y9BpcmCFQl+oOz8MByE0qNu/EK4UDkJBihWHF7Bvz4m5jAJct+I8Wn+6+I1a8YE0k4+OwBtaLwlbYZwIfjrQQwrP4jK/82+6+2y8q/IQmolR2SiNvvqFUc3x/A9jOwESfAgB6BnxGJFR6E9tWbhJ499ey9FUbIhDT6ejadAjwKMbSVtkgxY7kvAOuZjwFn1fvq0CACeAhucGPycejzzT9gdABYERheCLqDUQhh+0qeC2iYNcBvWf4wMWgQhE7+CdHoC04TAlFy0zkY6+41udAJkyANar8JKVIHEBFEspYfOZLIxofkmSEOr82B+H9WvWcIoALaStuILNj+bdtKAF4JUKu+uQpQx/5AFKj6NBwQeiLOYCCxKEegCELb++GHcCoCA2taYHXU0IrtXTJhjsd5kKcDpziDBEEgQZkkg+MBWVigiYjA/T3gZofjGI4kC+azwTszXgTaqwlgHX/5ls97tRRYVL2tADRCgUH1yYKgDofE4nc4VqDG/EGbE0ZiziMIF/yGYlCHYJEKKzviJLaOEWTbQ5CQpN9AAhcoP5JWGaBA8lmyKYHZI+FgldwMeLNhgncNlX0RWczufyAAWQqcjP2tCgACV+Z+t0RYAUmIpAOxEdtHTmDbTybBsHaAnIMmiuHmatcBk9m8iexcEgrqVgP2c6cxvFL+LMii2HkYJ5Er8H6TaeL4ANj/CKSPofiIowcH8P23COBGnwHQhOBVALxHg1l4kCED0mbIEVjqTIhk+4GT26dJIXAF0yGBQR4U6MR5ZNsNTkIRS0mVsa8ir+o4LnF4ZKvPYXKV3xWK/1o4gG/9/ioJKC8E9dyAAXaM75sDANDp+N8LA7p3CyjF1Y5B3xxKEsZ6AVo5SIDYZHMvGRUlqqLseLCSbzunpBVGMsy6hTA0icAWXf9sIjC45irZyPzKuJUjIH4KxR8cwLd+v50A1PMAmOzTnwXTYvkld7Bth5uM+9uBo3yAodKR8uP4HUEQ5dFtGYEM25QCDwQQqVAEzAgcQdx/JvipC4jICX50Cpxk/wzoorCkAsrM8WbHM0WCEGXU9qr9y0oAWwiglH8LCYz1/w3wqvznqr5BDhqsUwuEqg5BkUwHdgOI2yGsx02tHIHcaGd/pMQIbArMRF7hCGAwFMqAxWwTEdys+sO9zJzfjBuoKPVVba8lgGISsFsApElivyE45wdXADdNhwUdlkm8nnYCCeWXY+l439tecgvG5OxuZqSMjnPoJnwWYJETYUoenWOkaBP9M2C2yDML8my72fg/Am2FLKKxZvZvfb7t+77KAWxOwEj8NXUHp7DNb3QBCvwSAnSCq0MAQhiitugOcCzcbsX71qrAri9OXEY21nMGHUu9GnG4oQVncMg2Z8FPSDEFNMcVHemf6ssIidw3a6wsyM9oVwXhUQLwznkQMVIKbQRAV/45RKDJoAHcIQMhiwjUQwjQscer3hYh0BWBxhhCNCzej/ZZx9FuIsolHLbMFUWfAXIUviAY2ecKOUVjMTIoXH8EmAwhRSA/Cuoj/c255pHot33uQw6A5QFku5cLQGAjMSDmLCcw4BImixUaCDCZkntuwGtPCcABCx6nHBJkVDg7qSuvwEoAcQDIBPi9MTIAKyt59rcKyGWWHCr9IvJ4kv2NAII8gIC1Wwqs1wUAoi0yEABrx82UP+sGziCFDsgkHLDyBN1N80gjqCLg+CkQJOPqdn4BUOhEniENVJtE/2x8TduRa/IAmT1WBMSzxomO8yj7P/65r1YCotIPn0m8j28BFpVvwGdkoCRf2/gOd1k3MNgImIEEyBZZYEKJugVrHYEoi3EsTSzu5HEIZCCFyuQPnMIl4If7kgVMtt0hUkOCMj5XgVex7VM2XU3IlEAQxyPDdP0//n3GlYAh+FWs370OXBbbqWSfblNxAlbbsuUPyMLLBeA9YLafTZruB8+AO2vps+32650Flqem4b4T1d881oyreWICqJLL1e2XjQDkjUDkmX+d5WffEVeWE0CBNJU/qfq6f0eQBdVv/Qw1tdyCBWzGsDJGqBIZgiCAzjqK0kQ6A1hnjOGBNUEwIUmd5AAqxyndB0PFw7nkOAY9R5ePf+9XSUBGBAJudAVt234Ttn37xi4ESGyTE0rnAIBtBqwfAD/+Zl68r8nGdA3RykEsy2TtfJYkKsfWk+wM4GavJwnA2fj/CDCPgqzSPwoLov1HSOUVAeBKwGgtgJH80+AfbL8OC9A66Od0gFy0UiuCa+Sjt0cKboYQRGmHsR0w4vmGE0GRltk+AapuIlTbG9dcDh8mxpkCauL6wt/eUcojfY8AUiv0Wd+tc3ogAA/8xsKfDuykTVP2/YO1GlCLNnUCiii0Cpu7LUfgjUf2WTG/JgXLORwFtbkE2VLQRNKPTgiHjNKASBw7PZZ2J0Vnc+Q4ugsk6gAAG0BJREFUVVKKQH/muZxKCp/4Xv3DQGLn0fI3sEerAPVTghAaaFyllgcDi1Asq43t6yzwI2IIKgHiOFKWjZyjZ3XZBMuAOJqYbTJVwwuDfIb/l8FR2cy5VX6Ts0HmZdunz90i7eClJZnjZdoMv1EjAMcFbLiYAT+x8TpX0DCeAHPXxAA5XTug7YiW7on9NPYPwgLtEEKiSNjcTg2y4YSehCeBv+xUZid98ne5khCmwHaQDGeOGfVZVgKwqgAiiBH4U2XAfTCco1qxNcAZxiOAm+J/kSvwEoYU4Anl325ath0hr5BYNPDYq9Sr4LzY+reJfBZZVa/vhPYRGGf2Z/p4bZZPfM++CmCFAF4YIETR/upnApw3AqUJAQ4ShQPD/ovA3wjdANDwwxvKZbVjN45uSwI427eqnIywpsbIKOT7iAAy4Ix+p5kxMn2kzSsCCKoA+AiwJoOOAJTtF8vPSAK3NSFLhAJdPwLuTKiwHc8jhsx+1YaGBSRxJdeadQgWETBVTJNG0mVEE3TbXww9yg6lmPzL/gapawNSitpXgIdcF40783tlzmUd94EAEiVAuc8m+HWOoCH61fxAy19R/mplAElHicqrryeD3wM1fVkpm1gBkOgxHEV0gZA4VnpiFlQ5MzHNNoXjpM+9APBozKuI59BvpgAwJgE/B0KA6CWgrP7vZP4bWcBJZJYEI1FYQuzlAtw8gTFg2jXs12I+diz7gQA9tu/2GaRkOQvrfYapiZgNR6znyMn1zQCkpG7GOZfG0PenQAAZIM6cS2bcq9osnxAC0C6AgH14+Ie9EIQQwoY5FRo0HAbbKY5In3Yf2QtHEGVWiGEAVhHow1cHPHgeJnAZqAIll3GrSUdKBkdyBmQF41WTsxv3LMK6mAAe5bdwSKt6/AcCMEIAmevrbz88A7Dv1CofVQQ66w9ftAJrMdSuAHD46ucIiEGDeRDcKCwgB43KgZYa47l4biIav0QyybjfOufhWGcRiQHK7nivKQFUATcQ+Ylgnhl7+cT3sEOARgDO038dATjZ/w74AKTM9q05AScjBY8YEHRVy4/Kr4mEKZXbRnaSa/IAvR3HISk3CZkkr3AMOPeM3c2SiTtWAfyzgDyz3+xYZ/6e6XPoCMBZ9tuAboB8cALKIbT5x54H2CeVBrkGOHUFHjFQNlBJ6wnVZ+AWgogA3Fg6cVymuJ1zME/kYQdT0CwgXTUpEFdmUodtCgQQjrVf2NXtMuNn2lTu18x4rxyACgO8sp+n+ts+A+Rs+a+0Z1jFfXS/ASLLGQxjJEAYlgpn1FwdN0UazloDD6wR4aQVH4GTPP+ZCUkn/MmhxtWgsu7H7O9x5fkun/hsFQKw5B+AGsGfjfc9UrDIYjukmmjatlv4taoAFduvyccFWYJIvOSdFvIo7s8Avps0ScBaE606VoVUdFvL9byO4Inc2PvhnEcC2CfL+mf7p+P//ar1dgTsEA7AmJ1gFrZ36k36tXEjV8CshFwT3tEsqBPt2rDQNqX68GNl2kfEUQGmpcQR+VSOkQJIQf2vUMorxkxdd1R+hbl6aLzmAMhCnuEZAKPmrxW+EYAFcGtpsLM9dATgUrSiMvLQbSruYArQCaKIAJxyCjgxnGN6hGLuyy55npicFuEcJZSjAD7aPwvOK46TGfPBAej4nz3959T8B8VXYMR5aK4HIACOLD8DLZvzlp2nZiAB1G1+J9pVbD8jrdR6Awts5PymQL+Pf6j6EBCCNVHN/7iV/lgq6XkWCcn1k2NmwX2UxLLHyQBeLkPGXD7x3cccQGbdP1P9UPmt5CAAqiMLOVvD8re2XkjggHXASALUWfAzl4BzKLT0wblk+kdt0vuNc6lMbBPkhtU9tMpRgfUogGaApfmi8lsdPd9S/44ASLyPQEelZwlATQqIPU/56ctB1MtEGI61slP1NybvU4LfELBXmxMZfzZGxnGkQY8HgB9rxkVM9XkK0imqfYUYqgRYAnHBEelxXzkAJwcg4EOFz9p+5hSasBPlZuGCMgIPIkwmiN50RjWg+22zDsFxHRnwR21cEKtzjADvTUx0OzMgjsY2VbEI/iq4ps+L3JiKslfPszJ2pS2exwMBZHMA+8Re709HAGxxELTtnACgWZNIa5ew/APY9c0xngno+qlBXHxfDP7tBlaOwSZjsn+GFLZJciAMOUQYRQI4dKxHBvWVJDAz9vKJz4rXAYjidiHA/sPRtQDWE4LGOwIt1e+2KxvgEsD7DPyotNPqXwQNO84ApIkxI3IJwXryMcPjnUAAVeCd1f6MaxsJgNX9WXjgKbzlCIwyX7vn3jJhpZCUAGBjRBCKTzjukoraOlfbp04iooTk04mFic4I6QiwvQkvp+XlL44cewYkZwF0uDZ1D2Ztu76VR8ZZPv5ZDxpOwwDr+X9P4ZV9b66B2HodRmgXnHEGrc8Tgz98B4GF4wJp0Bud7B+BqDu9fcxMn6hNaT+5llL/IsnNkMNMn9eZUDYC0M/5I2jXzxqowzaw9l1bZzsCl1p9I1zQJCHkhffeVH+HJBgA9HwysZYE4TA/Z/sZziECi+clPAXOKg62y5xLFHJMjZFU2ciVnA30GRJ4jD7Lxz/zVQ5AwFVa/rt3osAv5gIQ3A+25OFuenbefV6AlBLZeBb4U/hMNSLQC8gonPyzx7Xq7gapyObwfKJx4SfIOJmzjveYQM78VlW7PktU2eseCSCI9wegW5Y/SQwakDpksPYLM1juofVTQHFxE71NKGkJQmyGDTyt9qsFGeCYo8N5ZcfJtnMnsvo9smNm2mWBUHU50bFnjvvYY67H6wiAvvLLyQPgk3xWqKCFRZSdAbdti5KBilws8YrcAd70cgxfJYtAYQPI97uPEog62DbxCmNGE7UKJjx2duwz2kVjXLl/hiAihzEz5isCCFYByhzRCj0A37H92xjE1neuwtmP/V1nQBYKWfMbQ40MCKvtD5EMO6ErgBqMGQGBnWa6z37sdPujoUYUipy4f9a+R0A/c9zl277bXgXYRQABjsDUIK0Anym7DiW0m2CCaS0ZHsggafuzYO6GSwCQNkn0CwnojDESYUwFjDjcTL9osVHZTTwigCMgvu77txCAEkCy7s9IAcHI3IIGNoJwIAV0ppmwYD+4xgn9HoCpAuIQl0aDsF9nH0J6KDWo2v5DKk86zxy/QjCZtq9Tm+hcrtq/EUCn9M4LQIYwYL+x5mpABUgK8H0jgmH47IC/U38Sl1fBnwV+GryzuYILwd+GTl5ENPmyzNONkzx2xg7PklP2ujLtHqtNdJxov3YljQBEibW1t7Y34CVW/Wngt3vv9MXxB4sPd5w5CBY+6PESTvihCUzU7JzF68uCwzrnSnKudCx1MZmJUxo/itWTP+bMeWX7PEW7s46ZGSdq00IA+uYfou4DkEG9vX2W7Weqz8gBccjcAQNPRfnNuUjcCQPB6a7BZIMqBI32SfBVjhZNtm6sxPFL48HglX5XtM2OeWa7zFhWm+VbP6NPAgrYXOX3VH8fwFT9qEqg+rvq76izRxQZfEVlQXcOJ4nDBdgZY6TZKoZ6ZpLFo4iq8JZHj1Htf1X7K8bNjDnTZiCAyPLPxvs4LnUEiaW/HaifCPyReEXEkSGfM22/nO82OaKTTyP4QMOLQo/M5NdnfXWf6viZ9pk263Vm2m0hwOoAUK3NxUCBsrvEkFH9YI1AN3+zFYHki0M6UBog8bCDYcth0SUHOgW3pwxyAPiJ9wvMjp6Z7Gzsx+pXPU62/RntGgFYyt/IQVnS9au3DwHL6vc6RIjWASDIBntvOMvsSkAPwBZuuu0HQBuNUwUFPd+LwZ+diFc4kPSxyQ/52H2rx6u0z7bV7ZZvkRyAEddr694BP3IFmXyAE/NHlt8iAv2fjXju1wJ/Cvhq4AzOzDZO58y4mXxClUxObX/4IvqzyU547xqOjnGkf7VvpX2p7bd8eCIJKIpLXAFTfq322jl0feCOee00qC2HYIHfUt408GFgb26n5v0JawVmiOVUgHuDpX6E+GwqEzseLRcnXz3OzDVV+3jtl5UAEKAIOhO40WO+mZifOA5KBEG7DuCJhUADIcDkZPPUJIQDil21/dP4KXYsNs9g46HNgYGrkz1/UucRwHrMo+c527/abwwBdgLoSIAou1bjSNU98jD/81Ct/t7/IyAuRPocAH9F9be2pEM0x+l+tTEag03u11H55Zy2yTZzURUUH2xbBVDmcEfGfOy+yzfrEMBaCrzfTAbsiBwyYcGg/oSEAOu9sKi2oe2fUP3WJQnacN4XbH84lp6VB9xJZoKn25RPPD3yaQ2PAC5zEkfHP9I/03cjAAbgAegHFv9YBMEsPyqsPgcNbNaWgb+bh4QsNLHgjWV9Q4IxZoZFIubxghmWcRWZSVrgj/xwb8Df/VYZMEY/7hVjPBAAgIIqvKHGkfJ3Y0UEsl99+L4AaQcoxLmm593Z4Gfz2pvrw76kg5giBXIiV+EwHDdsEE336/efAaiZszzzuEfHWr7508k7ARXIEMjMGZhKnnkpKGnDxhu2ESWfAX8K0Jn/ZwBmgjn3E7Y/i5uIWDITM3uszFgdYV01cPVEgvZHwXP0dK46fmXc5Zs+nZcBN8BFqn10v7H8V5NMZ7kTVYHBoicBTMkgqaqhC3AaRHiJ9m8TccJZeBM4dUw2wIHrjABVmdjkJ2nDV8eJzuus/VeelzX2RgCDwnuLghxV74CbedQ3Uy5MvBQkUn53P7odreIJUFnzvdueGKdq+b3xLwF2NqE/zRxnweiDNc6VpLD+Uo0AGnjBWg92f6dVur2yNFhA59h4nEfb5+T6fw2MCPxU9ZV8mG3UXKNzn1yjnqIRZtz9RXIpinaIplkiCgd+08D9Bc4ihuUbMQRQkzXrDBAv4UNBcllR+IDK/Ejgb5MZZnVEIJ7V9J4M9EAdEUI7ZqZhVrkzZJawFslTegPvR/gFMiSxEYBW2PX7oPIROWTe+JsIHzoygS/6fDTwjiq/Bv8s8BmJAOfR2x6BxnMW1dDBIyxrTkbnt/VzGqX6PwIgjhxCX0MGXEeO9xh912t4IIAo5nfAj2o0kAaqeDLb341hHNcDf/QEoAvsI8lCA4nW5D/iAE5558ABxR/O/SDCD3a/DCuZ83q/E8HyDZ/mVAF2pCEoKcizdj5DJEIaVfAnlgJXwT/lApxS3wzoM2DLTNSK8mfHE+UvtS/A9apxM6fwlMeW81vJ5WrnsREAA/W2LQHsVMyfGKez/gr8Q1ignEXm8V8PzFXXYIHJUmY2mWbIwPq/EvWEzkzeTJuQNMgg2XEzIJwJb6rjHgp7zjrYI43D3MryX8EBWHZ+VvUtEmGAbseAGUSPWwT/2apvglntOAv0bRwDWRnAXdYmM/BkEvKpgZm8tEeC7nWH6QhgRvVdkColt9rKcT1ioC4gsP0V8LttjUnMwFkBvjXJhu2EFGcBEk3saL8cN5uHmD3PaMpnzzMax9v/GMc4cn5n9N0IANXXBWnmPQCi0Enwb8AO2mbAXwFw1fJXiKQBxLg7FYJAR8aGiyboZfvVwNFxMhN1ZoyZPplzie5hZYzXve3y9RICEBAOZJAEdQnQxpiuG3DWBWA//RnJhu5TdyskFTIDKwBPtU2qfwQGb3/Ut/utEo0TTUxczPSd6ZMF5pVjZ88hanfkHDcCiAC7HSAqFQJthi4icAlU8YMyImPtAcAOmLBtCHzCHikwR6GEvtMnVxQY6ZFD2vMt8TDTjFN5yj5Xgisa29t/BNSV4y5f/6nj04ADABNZfI8kqJor5XcVPwF+D7RybimSgF/PHDNQ5YhAPCC2vkl3EYF6VvlpP7VxZpJW+lTasntbAYLVduYcKse9evzoXJav+9RX6wBkMnUKfgH4U+VFDcTkcmANCAR/SBIF8M+CPOUUCDnijZwB9UyfDlSJmZpo0s3HTPtMm7McRMkNRcgK9s9e18HDDt03AugArx7qMfftQ0XKP+MmvD4U4HguhDi8PpV9mfUGTJFToJdrMGaGNWHO2u46iYCQjgAwC4RsuyxRZoA0c8xo3CvGjI7p3dvla4kD2Dqom06JIOsOEs8A4A9jOZCzwV9yBKpxBtSZNt01JY5h3cwzicA7p84VZGZech1AFhjZdjPneYTIop+iet7ReGed60YAFuBc9T8R/IPiF2N+Rh6RWtM+xEmIw/EmlEckacA6KnsGuL0JaO5LJv2ykztqF+2fBXV23LNApcc5cnyPCM4Yd/kv6ACyoM62q7wSTD+BaDiQlAuYLBNSIBeAGRGBSQbkTlZAf0bb4dySbqQ62TOTNtPGDVkIarJjnkkCR45Z/V1nHMPa5xUBwEQ/TfnhF3DHJC8TYa7gKPhLqg8Hi4Bd3W9ZbDZhzgB3ZYx2bs7szUzsqM3R/Y/pBqJzPZM0HgP4eD0bAaTi/WxeoBDvD6SQIAzG/K1bslJgEUF3o48+XUhi32EiFev8WYKYAjzOPBCDSFkicHj7o75Zlc+MQy4vurS2vzp+9ryvtveZ81i+5lPGMiBT3zRJ7J3Tig9UHvVxHYC6SxmQm22csVwC2q8lcgTbGGRWHQF4tq83KbYxjNkegWAW6NG4mUk84wYyx50Zt3K+FgFUzu2o+9gIIALeVeBHuxmdQxb8VeAP48IAEZCn9zvHsCZQFuDZdvQ4CeWPJudTE0F0fjNOoDLmEQKoHmfmWjRhLF8dOQA1KVygFpKDrwP4B7IwgDkNdOYIDJBlgXt2O7wPenJEE3IG7DN9qhM9Ou8rx5slgMo5zzoT5hY2AjBBfTL48cfZhs6+OhzOvANtArBpR5AA5mEiIHc5GjPrCLLEcIXyW5O3uj07sTNgybTJgjU7Vna8KtEebe/1X/6z5QAmwT+AnL1g9CD4hTzcsMAiDba9mPCLQEv3G2RlTfoMoDNtvEnZ+quBZlR6Buwzx7lCvTMAz7SZIYDsuFlyZCrvnddGAIMDCMDfgbxCFIkKgUcg2q6m1X3/VWj7yTUD7Ec1iSHhLrJEcAT0dLIVKxHRRKwSQQSAq/dH15PdX2030z76LRj4oz7LV2kHQJRqIAgB1GOD31DRChF0bR3lM8GcKO91fYvuwmJr73y8yeQSRlL5zwL1rOJHk/jo/oxyR8e4GtDZ41fPoyeAQhKvVBk4Q/kD8FdIYLvhCTLxQozIAWzDBwCLQB3tj87BnQwTyl8hgkrbzKSNAHD1/gxJZNtkrhfVPLo2rfyV9hsBlMH8RMpfBjn8MpbyZ8asEEEbT/1GFZWOgB/tD13EBcpfBfwVbiCa+FfvrwA7OpfKWLNksZ7D8p8+lFwI9AS2H1U0A1Rp47YlwLTaTwF/7xSB9Oj+I+pfeX15SCYGyWYm5etGAhlQPmabqxwFjrsRgAaO+f0k5ccTcI+dBGuaHJLjReByCSNQ16PAj/qHgIUBKqrN2h7tH6ncFQQRgSoCeLQ/Gj+65gxxasufPSZrt/zHrAN4jcCfBjyG4RPPCZQdgAOuCLgeqUSEFIIeZt0VQD46pjeBryCBCMRX788CNjqPCplYx9wIIHQAB8GfVvwT3gNAgTQBflflme0l7qJCIDMgzwCvtQmcSZpECi82rTiECBTVsWbHi/pl9kdtzgT20bGW/xA5gNcc/K4bOAh8D8DdD3/kPygplhVLoL9Q+TPnESlUFdTV9rPOIgLw0f1HQRv9rjpE8I63EYDpAF5D8LuAP2j5o7GpSkMn/UNXvlfaZtxCa3Oh8lcAWWk7C9yzjpEFmAes2X3ZY2dIKNNm+feWA3hC8FeASNuS9QxZNbeOTfur38i6edkxI2BnVFc7kyPWPnO8yvhntI0m9WOSwBGQRy7g6P4skWwEMDiASfDjzTFdxX5m3f4CYCNyyCzwicZIkQUBv6fiFYWvtDVB9cjKnyWLqrqfBehZsM4CcbZfFrjR+BFRynGWf6cdwCT4GahSJBCAPwJrtx++6GOnQK3icVO5T3p+oAL0qG13fYScvImVAW/p+CoIzYxfPb8qkUSAuIIgZseMzjWzP9NmPb+NABpYXgPwlwAPE02vZjwT8BHJsMn7ZG6AzLoMAM9qU7H5Z6j7GWNkVLd6nCwAFVe2r5HCn7V/+crVAVSeAUALbyjhrPJ7LsIC9NaHKN4lDsBQVtMpOI7CIyg2ebxjzKr/DOgzfSok8NhtI2CeCfQjID3SN7pG3L985cvEOgAE/ZFXfSceCio7AMO1uIShriflFhySqQL2DMKgx0yofwbAnnupALYCpsx5PUaY8H4ILSoAjxzG8hUvi88C7Ee3VB5PjrZJuA02BgVp4EBSwM7E/cn1BBVV90A2tQ86RQCOCCuz/ygRZAF/lETOBLSnypXz9Igssy8igIp7WP7tTgAhcCfVuyOBE8DfLq4A/shVuERhAGsKpBeFBNH/gmRNqogoov2PRQJHj/MYJDBDDkeAPHs8fcxGAJaiVwHMwLZtS4Df7Kst+8HKgQX44fj7hizYz24XKbH8rmjzItAe3R+dU9WmZ53AB5UEZoE8228ggH+TdQAFADMgpQhGAZ0SAlHkSOGj/VZ4MRNCZPvMtuv6JQgqA9gqKWTBmAV3tl32uGcpvgWy6vZZpT8L5CgQlAA85a2qtwZ6RflDB5AEfwT4aL+21Fb7LIhn+kfAzfzHIhVgR22j8zmq/BVQZc61SgKV41fH9n6bWXI4q9/y5SoJiAMfBb9Xm7ccwXB8cQVE7QayIW8groI0s5KwOmYEHm9Cm/suUP+MEp/V5oiaV8B6VdsZEphR9Jk+FXLYCMAE0oTtb2OpCZoBq+kAjLFMsgDP4x33TOsfugohMnJuEUEM56lmRaSIV+/PnP8RwGfHrxzjyrZnksPlBPBlRhlwxrpnwW8CnWXJC0RymBCS5b4zwV5Wf+hwBNhH+lqW9rHdwVF1P9r/dQZ6ljiWlQC0SjIbPLRRilYFv0cC7Yc9WOrLAFWf94y9n+ljnZurdie8YnzquMS9PAUJHAVshqCs63oMsFeuzzvPaB8eZ/lS7QCU4jJVNckgUGurH1XuiVJfilSYFTdUtUIgR0nA67/tU7OjouBll2GEKVnQZ4EWXUPFps8es3KM15EEskoPt3T7KP02AojUO0UCk+CnoCWAzII7Au2w3yG8o6COzoUBioKCnKPrFBjJqRlQcQLVY2WJIjNuBaCvIwlUVX0G0NVjdATwMXEAAYBdEnhC8Ecgc/efGPNH5xFNdhOQRdt/ptpHCh3tj675CFE8JTFUjv2UriFz7GUlgOp/DNKRwUHwdxPfUeMjDoCCq5BfOOoEZvpr2x+BLavolXEyAM6obnTMzHEqoMuc09HxKv2rbTPAVYZO/ydUbXfkKP4/BnecprBuissAAAAASUVORK5CYII=",w}();exports.TextureTools=w;
},{"../Materials/Textures/texture":"KNsj","../Materials/Textures/renderTargetTexture":"ji3V","../PostProcesses/passPostProcess":"E14w","../Engines/constants":"vn8z"}],"kysf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pbrFragmentDeclaration=void 0;var n=require("../../Materials/effect"),e="pbrFragmentDeclaration",f="uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif";n.Effect.IncludesShadersStore[e]=f;var i={name:e,shader:f};exports.pbrFragmentDeclaration=i;
},{"../../Materials/effect":"Ru7D"}],"hz+b":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pbrUboDeclaration=void 0;var n=require("../../Materials/effect"),i="pbrUboDeclaration",o="layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec4 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec4 vRefractionInfos;\nuniform vec2 vReflectionInfos;\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 refractionMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float pointSize;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};";n.Effect.IncludesShadersStore[i]=o;var e={name:i,shader:o};exports.pbrUboDeclaration=e;
},{"../../Materials/effect":"Ru7D"}],"Qnqg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pbrFunctions=void 0;var e=require("../../Materials/effect"),n="pbrFunctions",t="\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor)\n{\nroughness=max(roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV);\nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nvec3 fresnel=fresnelSchlickGGX(VdotH,reflectance0,reflectance90);\nreturn fresnel*specTerm;\n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel*NdotL/PI;\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n\n\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=clamp(reflectance0*25.0,0.0,1.0);\nreturn reflectance90;\n}\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nfloat microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn clamp(square(temp)-1.0+ambientOcclusion,0.0,1.0);\n}\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal) {\n\nvec3 reflection=reflect(view,normal);\nfloat temp=clamp( 1.0+1.1*dot(reflection,normal),0.0,1.0);\nreturn square(temp);\n}";e.Effect.IncludesShadersStore[n]=t;var o={name:n,shader:t};exports.pbrFunctions=o;
},{"../../Materials/effect":"Ru7D"}],"A+ba":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.harmonicsFunctions=void 0;var n=require("../../Materials/effect"),e="harmonicsFunctions",r="#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 quaternionVectorRotation_ScaledSqrtTwo(vec4 Q,vec3 V){\nvec3 T=cross(Q.xyz,V);\nT+=Q.www*V;\nreturn cross(Q.xyz,T)+V;\n}\nvec3 environmentIrradianceJones(vec3 normal)\n{\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif";n.Effect.IncludesShadersStore[e]=r;var c={name:e,shader:r};exports.harmonicsFunctions=c;
},{"../../Materials/effect":"Ru7D"}],"MJ0r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pbrLightFunctions=void 0;var t=require("../../Materials/effect"),e="pbrLightFunctions",n="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nstruct pointLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat attenuation;\n};\nstruct spotLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nvec3 directionToLightCenterW;\nfloat attenuation;\n};\nfloat computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/((lightDistanceSquared+0.001));\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nconst float minDistanceSquared=0.01*0.01;\nfloat lightDistanceFalloff=1.0/(max(lightDistanceSquared,minDistanceSquared));\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=clamp(1.0-factor*factor,0.,1.);\nattenuation*=attenuation;\n\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977;\n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\n\n\n\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=clamp(cd*lightAngleScale+lightAngleOffset,0.,1.);\n\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}\npointLightingInfo computePointLightingInfo(vec4 lightData) {\npointLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nreturn result;\n}\nspotLightingInfo computeSpotLightingInfo(vec4 lightData) {\nspotLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.directionToLightCenterW=normalize(result.lightOffset);\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nreturn result;\n}\nlightingInfo computePointLighting(pointLightingInfo info,vec3 viewDirectionW,vec3 vNormal,vec3 diffuseColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\nfloat lightDistance=sqrt(info.lightDistanceSquared);\nvec3 lightDirection=normalize(info.lightOffset);\n\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*info.attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor*info.attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(spotLightingInfo info,vec3 viewDirectionW,vec3 vNormal,vec4 lightDirection,vec3 diffuseColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\n\nfloat lightDistance=sqrt(info.lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+info.directionToLightCenterW);\nNdotL=clamp(dot(vNormal,info.directionToLightCenterW),0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*info.attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor*info.attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeDirectionalLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\nfloat lightDistance=length(-lightData.xyz);\nvec3 lightDirection=normalize(-lightData.xyz);\n\nroughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nNdotL=clamp(NdotL,0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);\nresult.specular=specTerm*diffuseColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}";t.Effect.IncludesShadersStore[e]=n;var o={name:e,shader:n};exports.pbrLightFunctions=o;
},{"../../Materials/effect":"Ru7D"}],"Fd+4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pbrPixelShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/pbrFragmentDeclaration"),require("./ShadersInclude/pbrUboDeclaration"),require("./ShadersInclude/lightFragmentDeclaration"),require("./ShadersInclude/lightUboDeclaration"),require("./ShadersInclude/reflectionFunction"),require("./ShadersInclude/imageProcessingDeclaration"),require("./ShadersInclude/helperFunctions"),require("./ShadersInclude/imageProcessingFunctions"),require("./ShadersInclude/shadowsFragmentFunctions"),require("./ShadersInclude/pbrFunctions"),require("./ShadersInclude/harmonicsFunctions"),require("./ShadersInclude/pbrLightFunctions"),require("./ShadersInclude/bumpFragmentFunctions"),require("./ShadersInclude/clipPlaneFragmentDeclaration"),require("./ShadersInclude/logDepthDeclaration"),require("./ShadersInclude/fogFragmentDeclaration"),require("./ShadersInclude/clipPlaneFragment"),require("./ShadersInclude/bumpFragment"),require("./ShadersInclude/depthPrePass"),require("./ShadersInclude/lightFragment"),require("./ShadersInclude/logDepthFragment"),require("./ShadersInclude/fogFragment");var n="pbrPixelShader",i="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n#include<__decl__pbrFragment>\nuniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n\n#include<shadowsFragmentFunctions>\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#include<bumpFragment>\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalW.xyz);\nvec3 nDfdy=dFdy(normalW.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\n\nfloat geometricRoughnessFactor=pow(clamp(slopeSquare ,0.,1.),0.333);\n\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\n#else\nfloat geometricRoughnessFactor=0.;\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#endif\n#endif\n#endif\n\nmicroSurface=clamp(microSurface,0.,1.);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=fresnelSchlickEnvironmentGGX(clamp(dot(viewDirectionW,normalForward),0.0,1.0),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=clamp(NdotVUnclamped,0.,1.)+0.00001;\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#ifdef SPECULARAA\n\n\nalphaG+=(0.75*geometricAlphaGFactor);\n#endif\n\n#ifdef REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,1.0);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#else\nfloat lodRefractionNormalized=clamp(refractionLOD/log2(vRefractionMicrosurfaceInfos.x),0.,1.);\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,1.);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x),0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=environmentIrradianceJones(irradianceVector);\n#endif\n#endif\n\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\n\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb;\n#ifdef GAMMALIGHTMAP\nlightmapColor=toLinearSpace(lightmapColor);\n#endif\nlightmapColor*=vLightmapInfos.y;\n#endif\nlightingInfo info;\npointLightingInfo pointInfo;\nspotLightingInfo spotInfo;\nfloat shadow=1.;\nfloat NdotL=-1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec2 brdfSamplerUV=vec2(NdotV,roughness);\n\nvec4 environmentBrdf=texture2D(environmentBrdfSampler,brdfSamplerUV);\nvec3 specularEnvironmentReflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=fresnelSchlickEnvironmentGGX(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#ifdef REFRACTION\nvec3 refractance=vec3(0.0,0.0,0.0);\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedo;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedo*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nenvironmentRefraction.rgb*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=transmission;\n#endif\n\n\n\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance.rgb;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#endif\n\n#ifdef REFRACTION\nvec3 finalRefraction=environmentRefraction.rgb;\nfinalRefraction*=refractance;\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=clamp(alpha+luminanceOverAlpha*luminanceOverAlpha,0.,1.);\n#endif\n#endif\n#endif\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse.rgb+=vAmbientColor;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;\n#endif\n\n\n\nvec4 finalColor=vec4(\nfinalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#endif\n#ifdef REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\ngl_FragColor=finalColor;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n}\n";e.Effect.ShadersStore[n]=i;var r={name:n,shader:i};exports.pbrPixelShader=r;
},{"../Materials/effect":"Ru7D","./ShadersInclude/pbrFragmentDeclaration":"kysf","./ShadersInclude/pbrUboDeclaration":"hz+b","./ShadersInclude/lightFragmentDeclaration":"eDit","./ShadersInclude/lightUboDeclaration":"qU/b","./ShadersInclude/reflectionFunction":"Ls+y","./ShadersInclude/imageProcessingDeclaration":"/fRP","./ShadersInclude/helperFunctions":"yU4e","./ShadersInclude/imageProcessingFunctions":"/UJT","./ShadersInclude/shadowsFragmentFunctions":"UheC","./ShadersInclude/pbrFunctions":"Qnqg","./ShadersInclude/harmonicsFunctions":"A+ba","./ShadersInclude/pbrLightFunctions":"MJ0r","./ShadersInclude/bumpFragmentFunctions":"SFE/","./ShadersInclude/clipPlaneFragmentDeclaration":"3IG7","./ShadersInclude/logDepthDeclaration":"/goi","./ShadersInclude/fogFragmentDeclaration":"D8oi","./ShadersInclude/clipPlaneFragment":"1a3B","./ShadersInclude/bumpFragment":"UmUu","./ShadersInclude/depthPrePass":"EveZ","./ShadersInclude/lightFragment":"bpJ4","./ShadersInclude/logDepthFragment":"lwja","./ShadersInclude/fogFragment":"2f5n"}],"gafL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pbrVertexDeclaration=void 0;var n=require("../../Materials/effect"),e="pbrVertexDeclaration",i="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n";n.Effect.IncludesShadersStore[e]=i;var f={name:e,shader:i};exports.pbrVertexDeclaration=f;
},{"../../Materials/effect":"Ru7D"}],"mubZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pbrVertexShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/pbrVertexDeclaration"),require("./ShadersInclude/pbrUboDeclaration"),require("./ShadersInclude/helperFunctions"),require("./ShadersInclude/bonesDeclaration"),require("./ShadersInclude/instancesDeclaration"),require("./ShadersInclude/harmonicsFunctions"),require("./ShadersInclude/bumpVertexDeclaration"),require("./ShadersInclude/clipPlaneVertexDeclaration"),require("./ShadersInclude/fogVertexDeclaration"),require("./ShadersInclude/lightFragmentDeclaration"),require("./ShadersInclude/lightUboDeclaration"),require("./ShadersInclude/morphTargetsVertexGlobalDeclaration"),require("./ShadersInclude/morphTargetsVertexDeclaration"),require("./ShadersInclude/logDepthDeclaration"),require("./ShadersInclude/morphTargetsVertex"),require("./ShadersInclude/instancesVertex"),require("./ShadersInclude/bonesVertex"),require("./ShadersInclude/bumpVertex"),require("./ShadersInclude/clipPlaneVertex"),require("./ShadersInclude/fogVertex"),require("./ShadersInclude/shadowsVertex"),require("./ShadersInclude/logDepthVertex");var n="pbrVertexShader",i="precision highp float;\n#include<__decl__pbrVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(positionUpdated,1.0)).xyz;\n#else\nvPositionUVW=positionUpdated;\n#endif\n#endif\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=environmentIrradianceJones(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}";e.Effect.ShadersStore[n]=i;var r={name:n,shader:i};exports.pbrVertexShader=r;
},{"../Materials/effect":"Ru7D","./ShadersInclude/pbrVertexDeclaration":"gafL","./ShadersInclude/pbrUboDeclaration":"hz+b","./ShadersInclude/helperFunctions":"yU4e","./ShadersInclude/bonesDeclaration":"1TNa","./ShadersInclude/instancesDeclaration":"YHup","./ShadersInclude/harmonicsFunctions":"A+ba","./ShadersInclude/bumpVertexDeclaration":"jVUH","./ShadersInclude/clipPlaneVertexDeclaration":"ftQJ","./ShadersInclude/fogVertexDeclaration":"rUWx","./ShadersInclude/lightFragmentDeclaration":"eDit","./ShadersInclude/lightUboDeclaration":"qU/b","./ShadersInclude/morphTargetsVertexGlobalDeclaration":"NDwH","./ShadersInclude/morphTargetsVertexDeclaration":"qccd","./ShadersInclude/logDepthDeclaration":"/goi","./ShadersInclude/morphTargetsVertex":"71sF","./ShadersInclude/instancesVertex":"yjPN","./ShadersInclude/bonesVertex":"60le","./ShadersInclude/bumpVertex":"XVwt","./ShadersInclude/clipPlaneVertex":"UKQU","./ShadersInclude/fogVertex":"e4r3","./ShadersInclude/shadowsVertex":"67Rd","./ShadersInclude/logDepthVertex":"Dvgk"}],"rgaZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PBRBaseMaterial=void 0;var e=A(require("tslib")),t=require("../../Misc/decorators"),i=require("../../Misc/logger"),r=require("../../Misc/smartArray"),a=require("../../Misc/textureTools"),s=require("../../scene"),n=require("../../Maths/math"),o=require("../../Meshes/buffer"),l=require("../../Materials/imageProcessingConfiguration"),u=require("../../Materials/effect"),f=require("../../Materials/materialDefines"),h=require("../../Materials/pushMaterial"),T=require("../../Materials/materialHelper"),_=require("../../Materials/Textures/texture"),E=require("../materialFlags"),c=require("../../Engines/constants");function A(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,i):{};r.get||r.set?Object.defineProperty(t,i,r):t[i]=e[i]}return t.default=e,t}require("../../Shaders/pbr.fragment"),require("../../Shaders/pbr.vertex");var m=function(t){function i(){var e=t.call(this)||this;return e.PBR=!0,e.MAINUV1=!1,e.MAINUV2=!1,e.UV1=!1,e.UV2=!1,e.ALBEDO=!1,e.ALBEDODIRECTUV=0,e.VERTEXCOLOR=!1,e.AMBIENT=!1,e.AMBIENTDIRECTUV=0,e.AMBIENTINGRAYSCALE=!1,e.OPACITY=!1,e.VERTEXALPHA=!1,e.OPACITYDIRECTUV=0,e.OPACITYRGB=!1,e.ALPHATEST=!1,e.DEPTHPREPASS=!1,e.ALPHABLEND=!1,e.ALPHAFROMALBEDO=!1,e.ALPHATESTVALUE="0.5",e.SPECULAROVERALPHA=!1,e.RADIANCEOVERALPHA=!1,e.ALPHAFRESNEL=!1,e.LINEARALPHAFRESNEL=!1,e.PREMULTIPLYALPHA=!1,e.EMISSIVE=!1,e.EMISSIVEDIRECTUV=0,e.REFLECTIVITY=!1,e.REFLECTIVITYDIRECTUV=0,e.SPECULARTERM=!1,e.MICROSURFACEFROMREFLECTIVITYMAP=!1,e.MICROSURFACEAUTOMATIC=!1,e.LODBASEDMICROSFURACE=!1,e.MICROSURFACEMAP=!1,e.MICROSURFACEMAPDIRECTUV=0,e.METALLICWORKFLOW=!1,e.ROUGHNESSSTOREINMETALMAPALPHA=!1,e.ROUGHNESSSTOREINMETALMAPGREEN=!1,e.METALLNESSSTOREINMETALMAPBLUE=!1,e.AOSTOREINMETALMAPRED=!1,e.ENVIRONMENTBRDF=!1,e.NORMAL=!1,e.TANGENT=!1,e.BUMP=!1,e.BUMPDIRECTUV=0,e.OBJECTSPACE_NORMALMAP=!1,e.PARALLAX=!1,e.PARALLAXOCCLUSION=!1,e.NORMALXYSCALE=!0,e.LIGHTMAP=!1,e.LIGHTMAPDIRECTUV=0,e.USELIGHTMAPASSHADOWMAP=!1,e.GAMMALIGHTMAP=!1,e.REFLECTION=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.USESPHERICALFROMREFLECTIONMAP=!1,e.USESPHERICALINVERTEX=!1,e.REFLECTIONMAP_OPPOSITEZ=!1,e.LODINREFLECTIONALPHA=!1,e.GAMMAREFLECTION=!1,e.RGBDREFLECTION=!1,e.RADIANCEOCCLUSION=!1,e.HORIZONOCCLUSION=!1,e.REFRACTION=!1,e.REFRACTIONMAP_3D=!1,e.REFRACTIONMAP_OPPOSITEZ=!1,e.LODINREFRACTIONALPHA=!1,e.GAMMAREFRACTION=!1,e.RGBDREFRACTION=!1,e.LINKREFRACTIONTOTRANSPARENCY=!1,e.INSTANCES=!1,e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE=!1,e.NONUNIFORMSCALING=!1,e.MORPHTARGETS=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS_TANGENT=!1,e.NUM_MORPH_INFLUENCERS=0,e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.USEPHYSICALLIGHTFALLOFF=!1,e.USEGLTFLIGHTFALLOFF=!1,e.TWOSIDEDLIGHTING=!1,e.SHADOWFLOAT=!1,e.CLIPPLANE=!1,e.CLIPPLANE2=!1,e.CLIPPLANE3=!1,e.CLIPPLANE4=!1,e.POINTSIZE=!1,e.FOG=!1,e.LOGARITHMICDEPTH=!1,e.FORCENORMALFORWARD=!1,e.SPECULARAA=!1,e.UNLIT=!1,e.rebuild(),e}return e.__extends(i,t),i.prototype.reset=function(){t.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},i}(f.MaterialDefines),R=function(f){function h(e,t){var i=f.call(this,e,t)||this;return i._directIntensity=1,i._emissiveIntensity=1,i._environmentIntensity=1,i._specularIntensity=1,i._lightingInfos=new n.Vector4(i._directIntensity,i._emissiveIntensity,i._environmentIntensity,i._specularIntensity),i._disableBumpMap=!1,i._ambientTextureStrength=1,i._ambientTextureImpactOnAnalyticalLights=h.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,i._ambientColor=new n.Color3(0,0,0),i._albedoColor=new n.Color3(1,1,1),i._reflectivityColor=new n.Color3(1,1,1),i._reflectionColor=new n.Color3(1,1,1),i._emissiveColor=new n.Color3(0,0,0),i._microSurface=.9,i._indexOfRefraction=.66,i._invertRefractionY=!1,i._linkRefractionWithTransparency=!1,i._useLightmapAsShadowmap=!1,i._useHorizonOcclusion=!0,i._useRadianceOcclusion=!0,i._useAlphaFromAlbedoTexture=!1,i._useSpecularOverAlpha=!0,i._useMicroSurfaceFromReflectivityMapAlpha=!1,i._useRoughnessFromMetallicTextureAlpha=!0,i._useRoughnessFromMetallicTextureGreen=!1,i._useMetallnessFromMetallicTextureBlue=!1,i._useAmbientOcclusionFromMetallicTextureRed=!1,i._useAmbientInGrayScale=!1,i._useAutoMicroSurfaceFromReflectivityMap=!1,i._lightFalloff=h.LIGHTFALLOFF_PHYSICAL,i._useRadianceOverAlpha=!0,i._useObjectSpaceNormalMap=!1,i._useParallax=!1,i._useParallaxOcclusion=!1,i._parallaxScaleBias=.05,i._disableLighting=!1,i._maxSimultaneousLights=4,i._invertNormalMapX=!1,i._invertNormalMapY=!1,i._twoSidedLighting=!1,i._alphaCutOff=.4,i._forceAlphaTest=!1,i._useAlphaFresnel=!1,i._useLinearAlphaFresnel=!1,i._transparencyMode=null,i._environmentBRDFTexture=null,i._forceIrradianceInFragment=!1,i._forceNormalForward=!1,i._enableSpecularAntiAliasing=!1,i._renderTargets=new r.SmartArray(16),i._globalAmbientColor=new n.Color3(0,0,0),i._unlit=!1,i._attachImageProcessingConfiguration(null),i.getRenderTargetTextures=function(){return i._renderTargets.reset(),E.MaterialFlags.ReflectionTextureEnabled&&i._reflectionTexture&&i._reflectionTexture.isRenderTarget&&i._renderTargets.push(i._reflectionTexture),E.MaterialFlags.RefractionTextureEnabled&&i._refractionTexture&&i._refractionTexture.isRenderTarget&&i._renderTargets.push(i._refractionTexture),i._renderTargets},i._environmentBRDFTexture=a.TextureTools.GetEnvironmentBRDFTexture(t),i}return e.__extends(h,f),h.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(h.prototype,"hasRenderTargetTextures",{get:function(){return!!(E.MaterialFlags.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(E.MaterialFlags.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),h.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(h.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._forceAlphaTest=e===h.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"_disableAlphaBlending",{get:function(){return this._linkRefractionWithTransparency||this._transparencyMode===h.PBRMATERIAL_OPAQUE||this._transparencyMode===h.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),h.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},h.prototype.needAlphaBlendingForMesh=function(e){return!this._disableAlphaBlending&&f.prototype.needAlphaBlendingForMesh.call(this,e)},h.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this._linkRefractionWithTransparency&&(null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===h.PBRMATERIAL_ALPHATEST))},h.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==h.PBRMATERIAL_OPAQUE},h.prototype.getAlphaTestTexture=function(){return this._albedoTexture},h.prototype.isReadyForSubMesh=function(e,t,r){if(t.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new m);var a=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&a._renderId===this.getScene().getRenderId())return!0;var s=this.getScene(),n=s.getEngine();if(a._areTexturesDirty&&s.texturesEnabled){if(this._albedoTexture&&E.MaterialFlags.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&E.MaterialFlags.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&E.MaterialFlags.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var l=this._getReflectionTexture();if(l&&E.MaterialFlags.ReflectionTextureEnabled&&!l.isReadyOrNotBlocking())return!1;if(this._lightmapTexture&&E.MaterialFlags.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&E.MaterialFlags.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(E.MaterialFlags.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(n.getCaps().standardDerivatives&&this._bumpTexture&&E.MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;var u=this._getRefractionTexture();if(u&&E.MaterialFlags.RefractionTextureEnabled&&!u.isReadyOrNotBlocking())return!1;if(this._environmentBRDFTexture&&E.MaterialFlags.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(a._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;n.getCaps().standardDerivatives||e.isVerticesDataPresent(o.VertexBuffer.NormalKind)||(e.createNormals(!0),i.Logger.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));var f=t.effect,h=this._prepareEffect(e,a,this.onCompiled,this.onError,r);return h&&(this.allowShaderHotSwapping&&f&&!h.isReady()?(h=f,a.markAsUnprocessed()):(s.resetCachedMaterial(),t.setEffect(h,a),this.buildUniformLayout())),!(!t.effect||!t.effect.isReady())&&(a._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},h.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},h.prototype._prepareEffect=function(e,t,i,r,a,s){if(void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===s&&(s=null),this._prepareDefines(e,t,a,s),!t.isDirty)return null;t.markAsProcessed();var n=this.getScene().getEngine(),f=new u.EffectFallbacks,h=0;t.USESPHERICALINVERTEX&&f.addFallback(h++,"USESPHERICALINVERTEX"),t.FOG&&f.addFallback(h,"FOG"),t.SPECULARAA&&f.addFallback(h,"SPECULARAA"),t.POINTSIZE&&f.addFallback(h,"POINTSIZE"),t.LOGARITHMICDEPTH&&f.addFallback(h,"LOGARITHMICDEPTH"),t.PARALLAX&&f.addFallback(h,"PARALLAX"),t.PARALLAXOCCLUSION&&f.addFallback(h++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&f.addFallback(h++,"ENVIRONMENTBRDF"),t.TANGENT&&f.addFallback(h++,"TANGENT"),t.BUMP&&f.addFallback(h++,"BUMP"),h=T.MaterialHelper.HandleFallbacksForShadows(t,f,this._maxSimultaneousLights,h++),t.SPECULARTERM&&f.addFallback(h++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&f.addFallback(h++,"USESPHERICALFROMREFLECTIONMAP"),t.LIGHTMAP&&f.addFallback(h++,"LIGHTMAP"),t.NORMAL&&f.addFallback(h++,"NORMAL"),t.AMBIENT&&f.addFallback(h++,"AMBIENT"),t.EMISSIVE&&f.addFallback(h++,"EMISSIVE"),t.VERTEXCOLOR&&f.addFallback(h++,"VERTEXCOLOR"),t.NUM_BONE_INFLUENCERS>0&&f.addCPUSkinningFallback(h++,e),t.MORPHTARGETS&&f.addFallback(h++,"MORPHTARGETS");var _=[o.VertexBuffer.PositionKind];t.NORMAL&&_.push(o.VertexBuffer.NormalKind),t.TANGENT&&_.push(o.VertexBuffer.TangentKind),t.UV1&&_.push(o.VertexBuffer.UVKind),t.UV2&&_.push(o.VertexBuffer.UV2Kind),t.VERTEXCOLOR&&_.push(o.VertexBuffer.ColorKind),T.MaterialHelper.PrepareAttributesForBones(_,e,t,f),T.MaterialHelper.PrepareAttributesForInstances(_,t),T.MaterialHelper.PrepareAttributesForMorphTargets(_,e,t);var E=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX","vSphericalYY","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vReflectionMicrosurfaceInfos","vRefractionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth"],c=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","microSurfaceSampler","environmentBrdfSampler","boneSampler"],A=["Material","Scene"];l.ImageProcessingConfiguration&&(l.ImageProcessingConfiguration.PrepareUniforms(E,t),l.ImageProcessingConfiguration.PrepareSamplers(c,t)),T.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:E,uniformBuffersNames:A,samplers:c,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});var m=t.toString();return n.createEffect("pbr",{attributes:_,uniformsNames:E,uniformBuffersNames:A,samplers:c,defines:m,fallbacks:f,onCompiled:i,onError:r,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS}},n)},h.prototype._prepareDefines=function(e,t,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var a=this.getScene(),s=a.getEngine();if(T.MaterialHelper.PrepareDefinesForLights(a,e,t,!0,this._maxSimultaneousLights,this._disableLighting),t._needNormals=!0,t.METALLICWORKFLOW=this.isMetallicWorkflow(),t._areTexturesDirty){if(t._needUVs=!1,a.texturesEnabled){a.getEngine().getCaps().textureLOD&&(t.LODBASEDMICROSFURACE=!0),this._albedoTexture&&E.MaterialFlags.DiffuseTextureEnabled?T.MaterialHelper.PrepareDefinesForMergedUV(this._albedoTexture,t,"ALBEDO"):t.ALBEDO=!1,this._ambientTexture&&E.MaterialFlags.AmbientTextureEnabled?(T.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,t,"AMBIENT"),t.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):t.AMBIENT=!1,this._opacityTexture&&E.MaterialFlags.OpacityTextureEnabled?(T.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,t,"OPACITY"),t.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):t.OPACITY=!1;var n=this._getReflectionTexture();if(n&&E.MaterialFlags.ReflectionTextureEnabled){switch(t.REFLECTION=!0,t.GAMMAREFLECTION=n.gammaSpace,t.RGBDREFLECTION=n.isRGBD,t.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!n.invertZ:n.invertZ,t.LODINREFLECTIONALPHA=n.lodLevelInAlpha,n.coordinatesMode===_.Texture.INVCUBIC_MODE&&(t.INVERTCUBICMAP=!0),t.REFLECTIONMAP_3D=n.isCube,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,n.coordinatesMode){case _.Texture.EXPLICIT_MODE:t.REFLECTIONMAP_EXPLICIT=!0;break;case _.Texture.PLANAR_MODE:t.REFLECTIONMAP_PLANAR=!0;break;case _.Texture.PROJECTION_MODE:t.REFLECTIONMAP_PROJECTION=!0;break;case _.Texture.SKYBOX_MODE:t.REFLECTIONMAP_SKYBOX=!0;break;case _.Texture.SPHERICAL_MODE:t.REFLECTIONMAP_SPHERICAL=!0;break;case _.Texture.EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case _.Texture.FIXED_EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case _.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case _.Texture.CUBIC_MODE:case _.Texture.INVCUBIC_MODE:default:t.REFLECTIONMAP_CUBIC=!0,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!!n.boundingBoxSize}n.coordinatesMode!==_.Texture.SKYBOX_MODE?n.sphericalPolynomial&&(t.USESPHERICALFROMREFLECTIONMAP=!0,this._forceIrradianceInFragment||a.getEngine().getCaps().maxVaryingVectors<=8?t.USESPHERICALINVERTEX=!1:t.USESPHERICALINVERTEX=!0):t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!n.getReflectionTextureMatrix().isIdentity()}else t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1;this._lightmapTexture&&E.MaterialFlags.LightmapTextureEnabled?(T.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,t,"LIGHTMAP"),t.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,t.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace):t.LIGHTMAP=!1,this._emissiveTexture&&E.MaterialFlags.EmissiveTextureEnabled?T.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,t,"EMISSIVE"):t.EMISSIVE=!1,E.MaterialFlags.SpecularTextureEnabled?(this._metallicTexture?(T.MaterialHelper.PrepareDefinesForMergedUV(this._metallicTexture,t,"REFLECTIVITY"),t.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,t.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,t.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,t.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(T.MaterialHelper.PrepareDefinesForMergedUV(this._reflectivityTexture,t,"REFLECTIVITY"),t.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,t.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):t.REFLECTIVITY=!1,this._microSurfaceTexture?T.MaterialHelper.PrepareDefinesForMergedUV(this._microSurfaceTexture,t,"MICROSURFACEMAP"):t.MICROSURFACEMAP=!1):(t.REFLECTIVITY=!1,t.MICROSURFACEMAP=!1),a.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&E.MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap?(T.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,t,"BUMP"),this._useParallax&&this._albedoTexture&&E.MaterialFlags.DiffuseTextureEnabled?(t.PARALLAX=!0,t.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):t.PARALLAX=!1,t.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):t.BUMP=!1;var l=this._getRefractionTexture();l&&E.MaterialFlags.RefractionTextureEnabled?(t.REFRACTION=!0,t.REFRACTIONMAP_3D=l.isCube,t.GAMMAREFRACTION=l.gammaSpace,t.RGBDREFRACTION=l.isRGBD,t.REFRACTIONMAP_OPPOSITEZ=l.invertZ,t.LODINREFRACTIONALPHA=l.lodLevelInAlpha,this._linkRefractionWithTransparency&&(t.LINKREFRACTIONTOTRANSPARENCY=!0)):t.REFRACTION=!1,this._environmentBRDFTexture&&E.MaterialFlags.ReflectionTextureEnabled?t.ENVIRONMENTBRDF=!0:t.ENVIRONMENTBRDF=!1,this._shouldUseAlphaFromAlbedoTexture()?t.ALPHAFROMALBEDO=!0:t.ALPHAFROMALBEDO=!1}t.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===h.LIGHTFALLOFF_STANDARD?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===h.LIGHTFALLOFF_GLTF?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!0):(t.USEPHYSICALLIGHTFALLOFF=!0,t.USEGLTFLIGHTFALLOFF=!1),t.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?t.TWOSIDEDLIGHTING=!0:t.TWOSIDEDLIGHTING=!1,t.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),t.PREMULTIPLYALPHA=this.alphaMode===c.Constants.ALPHA_PREMULTIPLIED||this.alphaMode===c.Constants.ALPHA_PREMULTIPLIED_PORTERDUFF,t.ALPHABLEND=this.needAlphaBlendingForMesh(e),t.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,t.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel,t.SPECULARAA=a.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}t._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(t),t.FORCENORMALFORWARD=this._forceNormalForward,t.RADIANCEOCCLUSION=this._useRadianceOcclusion,t.HORIZONOCCLUSION=this._useHorizonOcclusion,t._areMiscDirty&&(T.MaterialHelper.PrepareDefinesForMisc(e,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,t),t.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(o.VertexBuffer.NormalKind)),T.MaterialHelper.PrepareDefinesForFrameBoundValues(a,s,t,!!i,r),T.MaterialHelper.PrepareDefinesForAttributes(e,t,!0,!0,!0,this._transparencyMode!==h.PBRMATERIAL_OPAQUE)},h.prototype.forceCompilation=function(t,i,r){var a=this,s=e.__assign({clipPlane:!1},r),n=new m,o=this._prepareEffect(t,n,void 0,void 0,void 0,s.clipPlane);o.isReady()?i&&i(this):o.onCompileObservable.add(function(){i&&i(a)})},h.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vAlbedoInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",4),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vReflectivityInfos",3),this._uniformBuffer.addUniform("vMicroSurfaceSamplerInfos",2),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vReflectionPosition",3),this._uniformBuffer.addUniform("vReflectionSize",3),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("albedoMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("reflectivityMatrix",16),this._uniformBuffer.addUniform("microSurfaceSamplerMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionColor",3),this._uniformBuffer.addUniform("vAlbedoColor",4),this._uniformBuffer.addUniform("vLightingIntensity",4),this._uniformBuffer.addUniform("vRefractionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectivityColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},h.prototype.unbind=function(){this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._uniformBuffer.setTexture("refractionSampler",null),f.prototype.unbind.call(this)},h.prototype.bindForSubMesh=function(e,t,i){var r=this.getScene(),a=i._materialDefines;if(a){var o=i.effect;if(o){this._activeEffect=o,this.bindOnlyWorldMatrix(e),a.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var l=this._mustRebind(r,o,t.visibility);T.MaterialHelper.BindBonesParameters(t,this._activeEffect);var u=null;if(l){this._uniformBuffer.bindToEffect(o,"Material"),this.bindViewProjection(o),u=this._getReflectionTexture();var f=this._getRefractionTexture();if(!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(r.texturesEnabled){if(this._albedoTexture&&E.MaterialFlags.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),T.MaterialHelper.BindTextureMatrix(this._albedoTexture,this._uniformBuffer,"albedo")),this._ambientTexture&&E.MaterialFlags.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),T.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&E.MaterialFlags.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),T.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),u&&E.MaterialFlags.ReflectionTextureEnabled){if(this._uniformBuffer.updateMatrix("reflectionMatrix",u.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",u.level,0),u.boundingBoxSize){var _=u;this._uniformBuffer.updateVector3("vReflectionPosition",_.boundingBoxPosition),this._uniformBuffer.updateVector3("vReflectionSize",_.boundingBoxSize)}var c=u.sphericalPolynomial;a.USESPHERICALFROMREFLECTIONMAP&&c&&(this._activeEffect.setFloat3("vSphericalX",c.x.x,c.x.y,c.x.z),this._activeEffect.setFloat3("vSphericalY",c.y.x,c.y.y,c.y.z),this._activeEffect.setFloat3("vSphericalZ",c.z.x,c.z.y,c.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",c.xx.x-c.zz.x,c.xx.y-c.zz.y,c.xx.z-c.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",c.yy.x-c.zz.x,c.yy.y-c.zz.y,c.yy.z-c.zz.z),this._activeEffect.setFloat3("vSphericalZZ",c.zz.x,c.zz.y,c.zz.z),this._activeEffect.setFloat3("vSphericalXY",c.xy.x,c.xy.y,c.xy.z),this._activeEffect.setFloat3("vSphericalYZ",c.yz.x,c.yz.y,c.yz.z),this._activeEffect.setFloat3("vSphericalZX",c.zx.x,c.zx.y,c.zx.z)),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",u.getSize().width,u.lodGenerationScale,u.lodGenerationOffset)}if(this._emissiveTexture&&E.MaterialFlags.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),T.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&E.MaterialFlags.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),T.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),E.MaterialFlags.SpecularTextureEnabled&&(this._metallicTexture?(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),T.MaterialHelper.BindTextureMatrix(this._metallicTexture,this._uniformBuffer,"reflectivity")):this._reflectivityTexture&&(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),T.MaterialHelper.BindTextureMatrix(this._reflectivityTexture,this._uniformBuffer,"reflectivity")),this._microSurfaceTexture&&(this._uniformBuffer.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),T.MaterialHelper.BindTextureMatrix(this._microSurfaceTexture,this._uniformBuffer,"microSurfaceSampler"))),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&E.MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),T.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),r._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),f&&E.MaterialFlags.RefractionTextureEnabled){this._uniformBuffer.updateMatrix("refractionMatrix",f.getReflectionTextureMatrix());var A=1;f.isCube||f.depth&&(A=f.depth),this._uniformBuffer.updateFloat4("vRefractionInfos",f.level,this._indexOfRefraction,A,this._invertRefractionY?-1:1),this._uniformBuffer.updateFloat3("vRefractionMicrosurfaceInfos",f.getSize().width,f.lodGenerationScale,f.lodGenerationOffset)}}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),a.METALLICWORKFLOW?(n.Tmp.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,n.Tmp.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,this._uniformBuffer.updateColor4("vReflectivityColor",n.Tmp.Color3[0],0)):this._uniformBuffer.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface),this._uniformBuffer.updateColor3("vEmissiveColor",E.MaterialFlags.EmissiveTextureEnabled?this._emissiveColor:n.Color3.BlackReadOnly),this._uniformBuffer.updateColor3("vReflectionColor",this._reflectionColor),this._uniformBuffer.updateColor4("vAlbedoColor",this._albedoColor,this.alpha*t.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity,this._lightingInfos.w=this._specularIntensity,this._uniformBuffer.updateVector4("vLightingIntensity",this._lightingInfos)}r.texturesEnabled&&(this._albedoTexture&&E.MaterialFlags.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&E.MaterialFlags.AmbientTextureEnabled&&this._uniformBuffer.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&E.MaterialFlags.OpacityTextureEnabled&&this._uniformBuffer.setTexture("opacitySampler",this._opacityTexture),u&&E.MaterialFlags.ReflectionTextureEnabled&&(a.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("reflectionSampler",u):(this._uniformBuffer.setTexture("reflectionSampler",u._lodTextureMid||u),this._uniformBuffer.setTexture("reflectionSamplerLow",u._lodTextureLow||u),this._uniformBuffer.setTexture("reflectionSamplerHigh",u._lodTextureHigh||u))),a.ENVIRONMENTBRDF&&this._uniformBuffer.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),f&&E.MaterialFlags.RefractionTextureEnabled&&(a.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("refractionSampler",f):(this._uniformBuffer.setTexture("refractionSampler",f._lodTextureMid||f),this._uniformBuffer.setTexture("refractionSamplerLow",f._lodTextureLow||f),this._uniformBuffer.setTexture("refractionSamplerHigh",f._lodTextureHigh||f))),this._emissiveTexture&&E.MaterialFlags.EmissiveTextureEnabled&&this._uniformBuffer.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&E.MaterialFlags.LightmapTextureEnabled&&this._uniformBuffer.setTexture("lightmapSampler",this._lightmapTexture),E.MaterialFlags.SpecularTextureEnabled&&(this._metallicTexture?this._uniformBuffer.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&this._uniformBuffer.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&this._uniformBuffer.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&r.getEngine().getCaps().standardDerivatives&&E.MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap&&this._uniformBuffer.setTexture("bumpSampler",this._bumpTexture)),T.MaterialHelper.BindClipPlane(this._activeEffect,r),r.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var m=r._forcedViewPosition?r._forcedViewPosition:r._mirroredCameraPosition?r._mirroredCameraPosition:r.activeCamera.globalPosition,R=r.useRightHandedSystem===(null!=r._mirroredCameraPosition);o.setFloat4("vEyePosition",m.x,m.y,m.z,R?-1:1),o.setColor3("vAmbientColor",this._globalAmbientColor)}!l&&this.isFrozen||(r.lightsEnabled&&!this._disableLighting&&T.MaterialHelper.BindLights(r,t,this._activeEffect,a,this._maxSimultaneousLights,this._lightFalloff!==h.LIGHTFALLOFF_STANDARD),(r.fogEnabled&&t.applyFog&&r.fogMode!==s.Scene.FOGMODE_NONE||u)&&this.bindView(o),T.MaterialHelper.BindFogParameters(r,t,this._activeEffect,!0),a.NUM_MORPH_INFLUENCERS&&T.MaterialHelper.BindMorphTargetParameters(t,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),T.MaterialHelper.BindLogDepth(a,this._activeEffect,r)),this._uniformBuffer.update(),this._afterBind(t,this._activeEffect)}}},h.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},h.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},h.prototype._getRefractionTexture=function(){return this._refractionTexture?this._refractionTexture:this._linkRefractionWithTransparency?this.getScene().environmentTexture:null},h.prototype.dispose=function(e,t){t&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene()._environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),f.prototype.dispose.call(this,e,t)},h.PBRMATERIAL_OPAQUE=0,h.PBRMATERIAL_ALPHATEST=1,h.PBRMATERIAL_ALPHABLEND=2,h.PBRMATERIAL_ALPHATESTANDBLEND=3,h.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=1,h.LIGHTFALLOFF_PHYSICAL=0,h.LIGHTFALLOFF_GLTF=1,h.LIGHTFALLOFF_STANDARD=2,e.__decorate([(0,t.serializeAsImageProcessingConfiguration)()],h.prototype,"_imageProcessingConfiguration",void 0),e.__decorate([(0,t.serialize)()],h.prototype,"useLogarithmicDepth",null),e.__decorate([(0,t.serialize)()],h.prototype,"transparencyMode",null),h}(h.PushMaterial);exports.PBRBaseMaterial=R;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Misc/logger":"Fvml","../../Misc/smartArray":"vK5Y","../../Misc/textureTools":"E2Hr","../../scene":"FKAx","../../Maths/math":"Iizi","../../Meshes/buffer":"YHhW","../../Materials/imageProcessingConfiguration":"Ik3r","../../Materials/effect":"Ru7D","../../Materials/materialDefines":"2sZs","../../Materials/pushMaterial":"6Ul+","../../Materials/materialHelper":"DR7Q","../../Materials/Textures/texture":"KNsj","../materialFlags":"5KcB","../../Engines/constants":"vn8z","../../Shaders/pbr.fragment":"Fd+4","../../Shaders/pbr.vertex":"mubZ"}],"0yWt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PBRMaterial=void 0;var e=a(require("tslib")),r=require("../../Misc/decorators"),t=require("../../Misc/textureTools"),o=require("../../Maths/math"),i=require("./pbrBaseMaterial"),s=require("../../Misc/typeStore");function a(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};o.get||o.set?Object.defineProperty(r,t,o):r[t]=e[t]}return r.default=e,r}var l=function(s){function a(e,r){var i=s.call(this,e,r)||this;return i.directIntensity=1,i.emissiveIntensity=1,i.environmentIntensity=1,i.specularIntensity=1,i.disableBumpMap=!1,i.ambientTextureStrength=1,i.ambientTextureImpactOnAnalyticalLights=a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,i.ambientColor=new o.Color3(0,0,0),i.albedoColor=new o.Color3(1,1,1),i.reflectivityColor=new o.Color3(1,1,1),i.reflectionColor=new o.Color3(1,1,1),i.emissiveColor=new o.Color3(0,0,0),i.microSurface=1,i.indexOfRefraction=.66,i.invertRefractionY=!1,i.linkRefractionWithTransparency=!1,i.useLightmapAsShadowmap=!1,i.useAlphaFromAlbedoTexture=!1,i.forceAlphaTest=!1,i.alphaCutOff=.4,i.useSpecularOverAlpha=!0,i.useMicroSurfaceFromReflectivityMapAlpha=!1,i.useRoughnessFromMetallicTextureAlpha=!0,i.useRoughnessFromMetallicTextureGreen=!1,i.useMetallnessFromMetallicTextureBlue=!1,i.useAmbientOcclusionFromMetallicTextureRed=!1,i.useAmbientInGrayScale=!1,i.useAutoMicroSurfaceFromReflectivityMap=!1,i.useRadianceOverAlpha=!0,i.useObjectSpaceNormalMap=!1,i.useParallax=!1,i.useParallaxOcclusion=!1,i.parallaxScaleBias=.05,i.disableLighting=!1,i.forceIrradianceInFragment=!1,i.maxSimultaneousLights=4,i.invertNormalMapX=!1,i.invertNormalMapY=!1,i.twoSidedLighting=!1,i.useAlphaFresnel=!1,i.useLinearAlphaFresnel=!1,i.environmentBRDFTexture=null,i.forceNormalForward=!1,i.enableSpecularAntiAliasing=!1,i.useHorizonOcclusion=!0,i.useRadianceOcclusion=!0,i.unlit=!1,i._environmentBRDFTexture=t.TextureTools.GetEnvironmentBRDFTexture(r),i}return e.__extends(a,s),Object.defineProperty(a.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===i.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL},set:function(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?i.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL:i.PBRBaseMaterial.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===i.PBRBaseMaterial.LIGHTFALLOFF_GLTF},set:function(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?i.PBRBaseMaterial.LIGHTFALLOFF_GLTF:i.PBRBaseMaterial.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),a.prototype.getClassName=function(){return"PBRMaterial"},a.prototype.getActiveTextures=function(){var e=s.prototype.getActiveTextures.call(this);return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},a.prototype.hasTexture=function(e){return!!s.prototype.hasTexture.call(this,e)||(this._albedoTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._reflectivityTexture===e||(this._metallicTexture===e||(this._microSurfaceTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e)))))))))},a.prototype.clone=function(e){var t=this,o=r.SerializationHelper.Clone(function(){return new a(e,t.getScene())},this);return o.id=e,o.name=e,o},a.prototype.serialize=function(){var e=r.SerializationHelper.Serialize(this);return e.customType="BABYLON.PBRMaterial",e},a.Parse=function(e,t,o){return r.SerializationHelper.Parse(function(){return new a(e.name,t)},e,t,o)},a.PBRMATERIAL_OPAQUE=i.PBRBaseMaterial.PBRMATERIAL_OPAQUE,a.PBRMATERIAL_ALPHATEST=i.PBRBaseMaterial.PBRMATERIAL_ALPHATEST,a.PBRMATERIAL_ALPHABLEND=i.PBRBaseMaterial.PBRMATERIAL_ALPHABLEND,a.PBRMATERIAL_ALPHATESTANDBLEND=i.PBRBaseMaterial.PBRMATERIAL_ALPHATESTANDBLEND,a.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=i.PBRBaseMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"directIntensity",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"emissiveIntensity",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"environmentIntensity",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"specularIntensity",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"disableBumpMap",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"albedoTexture",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"ambientTexture",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"ambientTextureStrength",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],a.prototype,"opacityTexture",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionTexture",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"emissiveTexture",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectivityTexture",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"metallicTexture",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"metallic",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"roughness",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"microSurfaceTexture",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"bumpTexture",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty",null)],a.prototype,"lightmapTexture",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"refractionTexture",void 0),e.__decorate([(0,r.serializeAsColor3)("ambient"),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"ambientColor",void 0),e.__decorate([(0,r.serializeAsColor3)("albedo"),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"albedoColor",void 0),e.__decorate([(0,r.serializeAsColor3)("reflectivity"),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectivityColor",void 0),e.__decorate([(0,r.serializeAsColor3)("reflection"),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"reflectionColor",void 0),e.__decorate([(0,r.serializeAsColor3)("emissive"),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"emissiveColor",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"microSurface",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"indexOfRefraction",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"invertRefractionY",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"linkRefractionWithTransparency",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useLightmapAsShadowmap",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],a.prototype,"useAlphaFromAlbedoTexture",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],a.prototype,"forceAlphaTest",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],a.prototype,"alphaCutOff",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useSpecularOverAlpha",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRoughnessFromMetallicTextureGreen",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useMetallnessFromMetallicTextureBlue",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useAmbientInGrayScale",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),e.__decorate([(0,r.serialize)()],a.prototype,"usePhysicalLightFalloff",null),e.__decorate([(0,r.serialize)()],a.prototype,"useGLTFLightFalloff",null),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRadianceOverAlpha",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useObjectSpaceNormalMap",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useParallax",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useParallaxOcclusion",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"parallaxScaleBias",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsLightsDirty")],a.prototype,"disableLighting",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"forceIrradianceInFragment",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsLightsDirty")],a.prototype,"maxSimultaneousLights",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"invertNormalMapX",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"invertNormalMapY",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"twoSidedLighting",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useAlphaFresnel",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useLinearAlphaFresnel",void 0),e.__decorate([(0,r.serializeAsTexture)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"environmentBRDFTexture",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"forceNormalForward",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"enableSpecularAntiAliasing",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useHorizonOcclusion",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],a.prototype,"useRadianceOcclusion",void 0),e.__decorate([(0,r.serialize)(),(0,r.expandToProperty)("_markAllSubMeshesAsMiscDirty")],a.prototype,"unlit",void 0),a}(i.PBRBaseMaterial);exports.PBRMaterial=l,s._TypeStore.RegisteredTypes["BABYLON.PBRMaterial"]=l;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Misc/textureTools":"E2Hr","../../Maths/math":"Iizi","./pbrBaseMaterial":"rgaZ","../../Misc/typeStore":"WgxS"}],"e3lx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MorphTarget=void 0;var e=o(require("tslib")),t=require("../Misc/observable"),n=require("../Engines/engineStore"),i=require("../Meshes/buffer"),r=require("../Animations/animation"),s=require("../Misc/decorators");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};i.get||i.set?Object.defineProperty(t,n,i):t[n]=e[n]}return t.default=e,t}var a=function(){function o(e,i,r){void 0===i&&(i=0),void 0===r&&(r=null),this.name=e,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this.onInfluenceChanged=new t.Observable,this._onDataLayoutChanged=new t.Observable,this._animationPropertiesOverride=null,this._scene=r||n.EngineStore.LastCreatedScene,this.influence=i}return Object.defineProperty(o.prototype,"influence",{get:function(){return this._influence},set:function(e){if(this._influence!==e){var t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===t||0===e)}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),o.prototype.setPositions=function(e){var t=this.hasPositions;this._positions=e,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},o.prototype.getPositions=function(){return this._positions},o.prototype.setNormals=function(e){var t=this.hasNormals;this._normals=e,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},o.prototype.getNormals=function(){return this._normals},o.prototype.setTangents=function(e){var t=this.hasTangents;this._tangents=e,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},o.prototype.getTangents=function(){return this._tangents},o.prototype.serialize=function(){var e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),s.SerializationHelper.AppendSerializedAnimations(this,e),e},o.prototype.getClassName=function(){return"MorphTarget"},o.Parse=function(e){var t=new o(e.name,e.influence);if(t.setPositions(e.positions),null!=e.id&&(t.id=e.id),e.normals&&t.setNormals(e.normals),e.tangents&&t.setTangents(e.tangents),e.animations)for(var n=0;n<e.animations.length;n++){var i=e.animations[n];t.animations.push(r.Animation.Parse(i))}return t},o.FromMesh=function(e,t,n){t||(t=e.name);var r=new o(t,n,e.getScene());return r.setPositions(e.getVerticesData(i.VertexBuffer.PositionKind)),e.isVerticesDataPresent(i.VertexBuffer.NormalKind)&&r.setNormals(e.getVerticesData(i.VertexBuffer.NormalKind)),e.isVerticesDataPresent(i.VertexBuffer.TangentKind)&&r.setTangents(e.getVerticesData(i.VertexBuffer.TangentKind)),r},e.__decorate([(0,s.serialize)()],o.prototype,"id",void 0),o}();exports.MorphTarget=a;
},{"tslib":"vCxL","../Misc/observable":"gtkL","../Engines/engineStore":"n+VE","../Meshes/buffer":"YHhW","../Animations/animation":"8SP4","../Misc/decorators":"knvU"}],"l5Nr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MorphTargetManager=void 0;var e=require("../Misc/smartArray"),t=require("../Misc/logger"),r=require("../Engines/engineStore"),n=require("./morphTarget"),s=function(){function s(t){void 0===t&&(t=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new e.SmartArray(16),this._supportsNormals=!1,this._supportsTangents=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,t||(t=r.EngineStore.LastCreatedScene),this._scene=t,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(s.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"supportsNormals",{get:function(){return this._supportsNormals},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"supportsTangents",{get:function(){return this._supportsTangents},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),s.prototype.getActiveTarget=function(e){return this._activeTargets.data[e]},s.prototype.getTarget=function(e){return this._targets[e]},s.prototype.addTarget=function(e){var t=this;this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add(function(e){t._syncActiveTargets(e)})),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add(function(){t._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},s.prototype.removeTarget=function(e){var t=this._targets.indexOf(e);t>=0&&(this._targets.splice(t,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[0]),this._syncActiveTargets(!0))},s.prototype.serialize=function(){var e={};e.id=this.uniqueId,e.targets=[];for(var t=0,r=this._targets;t<r.length;t++){var n=r[t];e.targets.push(n.serialize())}return e},s.prototype._syncActiveTargets=function(e){var r=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._vertexCount=0;for(var n=0,s=this._targets;n<s.length;n++){var a=s[n];if(0!==a.influence){this._activeTargets.push(a),this._tempInfluences[r++]=a.influence,this._supportsNormals=this._supportsNormals&&a.hasNormals,this._supportsTangents=this._supportsTangents&&a.hasTangents;var i=a.getPositions();if(i){var o=i.length/3;if(0===this._vertexCount)this._vertexCount=o;else if(this._vertexCount!==o)return void t.Logger.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===r||(this._influences=new Float32Array(r));for(var u=0;u<r;u++)this._influences[u]=this._tempInfluences[u];e&&this.synchronize()},s.prototype.synchronize=function(){if(this._scene)for(var e=0,t=this._scene.meshes;e<t.length;e++){var r=t[e];r.morphTargetManager===this&&r._syncGeometryWithMorphTargetManager()}},s.Parse=function(e,t){var r=new s(t);r._uniqueId=e.id;for(var a=0,i=e.targets;a<i.length;a++){var o=i[a];r.addTarget(n.MorphTarget.Parse(o))}return r},s}();exports.MorphTargetManager=s;
},{"../Misc/smartArray":"vK5Y","../Misc/logger":"Fvml","../Engines/engineStore":"n+VE","./morphTarget":"e3lx"}],"oQoW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AssetContainer=exports.KeepAssets=void 0;var e=s(require("tslib")),t=require("./abstractScene"),o=require("./Meshes/mesh");function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,o):{};s.get||s.set?Object.defineProperty(t,o,s):t[o]=e[o]}return t.default=e,t}var n=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e.__extends(o,t),o}(t.AbstractScene);exports.KeepAssets=n;var r=function(t){function s(e){var o=t.call(this)||this;return o.scene=e,o.sounds=[],o.effectLayers=[],o.layers=[],o.lensFlareSystems=[],o.proceduralTextures=[],o.reflectionProbes=[],o}return e.__extends(s,t),s.prototype.addAllToScene=function(){var e=this;this.cameras.forEach(function(t){e.scene.addCamera(t)}),this.lights.forEach(function(t){e.scene.addLight(t)}),this.meshes.forEach(function(t){e.scene.addMesh(t)}),this.skeletons.forEach(function(t){e.scene.addSkeleton(t)}),this.animations.forEach(function(t){e.scene.addAnimation(t)}),this.animationGroups.forEach(function(t){e.scene.addAnimationGroup(t)}),this.multiMaterials.forEach(function(t){e.scene.addMultiMaterial(t)}),this.materials.forEach(function(t){e.scene.addMaterial(t)}),this.morphTargetManagers.forEach(function(t){e.scene.addMorphTargetManager(t)}),this.geometries.forEach(function(t){e.scene.addGeometry(t)}),this.transformNodes.forEach(function(t){e.scene.addTransformNode(t)}),this.actionManagers.forEach(function(t){e.scene.addActionManager(t)}),this.textures.forEach(function(t){e.scene.addTexture(t)}),this.reflectionProbes.forEach(function(t){e.scene.addReflectionProbe(t)});for(var t=0,o=this.scene._serializableComponents;t<o.length;t++){o[t].addFromContainer(this)}},s.prototype.removeAllFromScene=function(){var e=this;this.cameras.forEach(function(t){e.scene.removeCamera(t)}),this.lights.forEach(function(t){e.scene.removeLight(t)}),this.meshes.forEach(function(t){e.scene.removeMesh(t)}),this.skeletons.forEach(function(t){e.scene.removeSkeleton(t)}),this.animations.forEach(function(t){e.scene.removeAnimation(t)}),this.animationGroups.forEach(function(t){e.scene.removeAnimationGroup(t)}),this.multiMaterials.forEach(function(t){e.scene.removeMultiMaterial(t)}),this.materials.forEach(function(t){e.scene.removeMaterial(t)}),this.morphTargetManagers.forEach(function(t){e.scene.removeMorphTargetManager(t)}),this.geometries.forEach(function(t){e.scene.removeGeometry(t)}),this.transformNodes.forEach(function(t){e.scene.removeTransformNode(t)}),this.actionManagers.forEach(function(t){e.scene.removeActionManager(t)}),this.textures.forEach(function(t){e.scene.removeTexture(t)}),this.reflectionProbes.forEach(function(t){e.scene.removeReflectionProbe(t)});for(var t=0,o=this.scene._serializableComponents;t<o.length;t++){o[t].removeFromContainer(this)}},s.prototype.dispose=function(){this.cameras.forEach(function(e){e.dispose()}),this.lights.forEach(function(e){e.dispose()}),this.meshes.forEach(function(e){e.dispose()}),this.skeletons.forEach(function(e){e.dispose()}),this.animationGroups.forEach(function(e){e.dispose()}),this.multiMaterials.forEach(function(e){e.dispose()}),this.materials.forEach(function(e){e.dispose()}),this.geometries.forEach(function(e){e.dispose()}),this.transformNodes.forEach(function(e){e.dispose()}),this.actionManagers.forEach(function(e){e.dispose()}),this.textures.forEach(function(e){e.dispose()}),this.reflectionProbes.forEach(function(e){e.dispose()});for(var e=0,t=this.scene._serializableComponents;e<t.length;e++){t[e].dispose()}},s.prototype._moveAssets=function(e,t,o){if(e)for(var s=0,n=e;s<n.length;s++){var r=n[s],i=!0;if(o)for(var a=0,c=o;a<c.length;a++){if(r===c[a]){i=!1;break}}i&&t.push(r)}},s.prototype.moveAllFromScene=function(e){for(var t in void 0===e&&(e=new n),this)this.hasOwnProperty(t)&&(this[t]=this[t]||[],this._moveAssets(this.scene[t],this[t],e[t]));this.removeAllFromScene()},s.prototype.createRootMesh=function(){var e=new o.Mesh("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(t){t.parent||e.addChild(t)}),this.meshes.unshift(e),e},s}(t.AbstractScene);exports.AssetContainer=r;
},{"tslib":"vCxL","./abstractScene":"x731","./Meshes/mesh":"aXN+"}],"1AHo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GLTFFileLoader=exports.GLTFLoaderState=exports.GLTFLoaderAnimationStartMode=exports.GLTFLoaderCoordinateSystemMode=void 0;var e,r,t,o=require("@babylonjs/core/Misc/observable"),n=require("@babylonjs/core/Misc/tools"),a=require("@babylonjs/core/Loading/sceneLoader"),s=require("@babylonjs/core/assetContainer");exports.GLTFLoaderCoordinateSystemMode=e,function(e){e[e.AUTO=0]="AUTO",e[e.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(e||(exports.GLTFLoaderCoordinateSystemMode=e={})),exports.GLTFLoaderAnimationStartMode=r,function(e){e[e.NONE=0]="NONE",e[e.FIRST=1]="FIRST",e[e.ALL=2]="ALL"}(r||(exports.GLTFLoaderAnimationStartMode=r={})),exports.GLTFLoaderState=t,function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.COMPLETE=2]="COMPLETE"}(t||(exports.GLTFLoaderState=t={}));var i=function(){function t(){this.onParsedObservable=new o.Observable,this.coordinateSystemMode=e.AUTO,this.animationStartMode=r.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable=new o.Observable,this.onTextureLoadedObservable=new o.Observable,this.onMaterialLoadedObservable=new o.Observable,this.onCameraLoadedObservable=new o.Observable,this.onCompleteObservable=new o.Observable,this.onErrorObservable=new o.Observable,this.onDisposeObservable=new o.Observable,this.onExtensionLoadedObservable=new o.Observable,this.validate=!1,this.onValidatedObservable=new o.Observable,this._loader=null,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(t.prototype,"onParsed",{set:function(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMeshLoaded",{set:function(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTextureLoaded",{set:function(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMaterialLoaded",{set:function(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onCameraLoaded",{set:function(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onComplete",{set:function(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onError",{set:function(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onExtensionLoaded",{set:function(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onValidated",{set:function(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null),this._clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},t.prototype._clear=function(){this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear()},t.prototype.importMeshAsync=function(e,r,t,o,n,a){var s=this;return this._parseAsync(r,t,o,a).then(function(t){return s._log("Loading "+(a||"")),s._loader=s._getLoader(t),s._loader.importMeshAsync(e,r,t,o,n,a)})},t.prototype.loadAsync=function(e,r,t,o,n){var a=this;return this._parseAsync(e,r,t,n).then(function(r){return a._log("Loading "+(n||"")),a._loader=a._getLoader(r),a._loader.loadAsync(e,r,t,o,n)})},t.prototype.loadAssetContainerAsync=function(e,r,t,o,n){var a=this;return this._parseAsync(e,r,t,n).then(function(r){return a._log("Loading "+(n||"")),a._loader=a._getLoader(r),a._loader.importMeshAsync(null,e,r,t,o,n).then(function(r){var t=new s.AssetContainer(e);return Array.prototype.push.apply(t.meshes,r.meshes),Array.prototype.push.apply(t.particleSystems,r.particleSystems),Array.prototype.push.apply(t.skeletons,r.skeletons),Array.prototype.push.apply(t.animationGroups,r.animationGroups),t.removeAllFromScene(),t})})},t.prototype.canDirectLoad=function(e){return-1!==e.indexOf("scene")&&-1!==e.indexOf("node")},t.prototype.createPlugin=function(){return new t},Object.defineProperty(t.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!0,configurable:!0}),t.prototype.whenCompleteAsync=function(){var e=this;return new Promise(function(r,t){e.onCompleteObservable.addOnce(function(){r()}),e.onErrorObservable.addOnce(function(e){t(e)})})},t.prototype._parseAsync=function(e,r,t,o){var n=this;return Promise.resolve().then(function(){var a=r instanceof ArrayBuffer?n._unpackBinary(r):{json:r,bin:null};return n._validateAsync(e,a.json,t,o).then(function(){n._startPerformanceCounter("Parse JSON"),n._log("JSON length: "+a.json.length);var e={json:JSON.parse(a.json),bin:a.bin};return n._endPerformanceCounter("Parse JSON"),n.onParsedObservable.notifyObservers(e),n.onParsedObservable.clear(),e})})},t.prototype._validateAsync=function(e,r,t,o){var a=this;if(!this.validate||"undefined"==typeof GLTFValidator)return Promise.resolve();this._startPerformanceCounter("Validate JSON");var s={externalResourceFunction:function(r){return a.preprocessUrlAsync(t+r).then(function(r){return e._loadFileAsync(r,!0,!0)}).then(function(e){return new Uint8Array(e)})}};return o&&"data:"!==o.substr(0,5)&&(s.uri="file:"===t?o:""+t+o),GLTFValidator.validateString(r,s).then(function(e){a._endPerformanceCounter("Validate JSON"),a.onValidatedObservable.notifyObservers(e),a.onValidatedObservable.clear()},function(e){a._endPerformanceCounter("Validate JSON"),n.Tools.Warn("Failed to validate: "+e),a.onValidatedObservable.clear()})},t.prototype._getLoader=function(e){var r=e.json.asset||{};this._log("Asset version: "+r.version),r.minVersion&&this._log("Asset minimum version: "+r.minVersion),r.generator&&this._log("Asset generator: "+r.generator);var o=t._parseVersion(r.version);if(!o)throw new Error("Invalid version: "+r.version);if(void 0!==r.minVersion){var n=t._parseVersion(r.minVersion);if(!n)throw new Error("Invalid minimum version: "+r.minVersion);if(t._compareVersion(n,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+r.minVersion)}var a={1:t._CreateGLTF1Loader,2:t._CreateGLTF2Loader}[o.major];if(!a)throw new Error("Unsupported version: "+r.version);return a(this)},t.prototype._unpackBinary=function(e){this._startPerformanceCounter("Unpack binary"),this._log("Binary length: "+e.byteLength);var r=new d(e),t=r.readUint32();if(1179937895!==t)throw new Error("Unexpected magic: "+t);var o,n=r.readUint32();switch(this.loggingEnabled&&this._log("Binary version: "+n),n){case 1:o=this._unpackBinaryV1(r);break;case 2:o=this._unpackBinaryV2(r);break;default:throw new Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack binary"),o},t.prototype._unpackBinaryV1=function(e){var r=e.readUint32();if(r!=e.getLength())throw new Error("Length in header does not match actual data length: "+r+" != "+e.getLength());var o,n=e.readUint32(),a=e.readUint32();switch(a){case 0:o=t._decodeBufferToText(e.readUint8Array(n));break;default:throw new Error("Unexpected content format: "+a)}var s=e.getLength()-e.getPosition();return{json:o,bin:e.readUint8Array(s)}},t.prototype._unpackBinaryV2=function(e){var r=1313821514,o=5130562,n=e.readUint32();if(n!==e.getLength())throw new Error("Length in header does not match actual data length: "+n+" != "+e.getLength());var a=e.readUint32();if(e.readUint32()!==r)throw new Error("First chunk format is not JSON");for(var s=t._decodeBufferToText(e.readUint8Array(a)),i=null;e.getPosition()<e.getLength();){var d=e.readUint32();switch(e.readUint32()){case r:throw new Error("Unexpected JSON chunk");case o:i=e.readUint8Array(d);break;default:e.skipBytes(d)}}return{json:s,bin:i}},t._parseVersion=function(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};var r=(e+"").match(/^(\d+)\.(\d+)/);return r?{major:parseInt(r[1]),minor:parseInt(r[2])}:null},t._compareVersion=function(e,r){return e.major>r.major?1:e.major<r.major?-1:e.minor>r.minor?1:e.minor<r.minor?-1:0},t._decodeBufferToText=function(e){for(var r="",t=e.byteLength,o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r},t.prototype._logOpen=function(e){this._log(e),this._logIndentLevel++},t.prototype._logClose=function(){--this._logIndentLevel},t.prototype._logEnabled=function(e){var r=t._logSpaces.substr(0,2*this._logIndentLevel);n.Tools.Log(""+r+e)},t.prototype._logDisabled=function(e){},t.prototype._startPerformanceCounterEnabled=function(e){n.Tools.StartPerformanceCounter(e)},t.prototype._startPerformanceCounterDisabled=function(e){},t.prototype._endPerformanceCounterEnabled=function(e){n.Tools.EndPerformanceCounter(e)},t.prototype._endPerformanceCounterDisabled=function(e){},t.IncrementalLoading=!0,t.HomogeneousCoordinates=!1,t._logSpaces="                                ",t}();exports.GLTFFileLoader=i;var d=function(){function e(e){this._arrayBuffer=e,this._dataView=new DataView(e),this._byteOffset=0}return e.prototype.getPosition=function(){return this._byteOffset},e.prototype.getLength=function(){return this._arrayBuffer.byteLength},e.prototype.readUint32=function(){var e=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,e},e.prototype.readUint8Array=function(e){var r=new Uint8Array(this._arrayBuffer,this._byteOffset,e);return this._byteOffset+=e,r},e.prototype.skipBytes=function(e){this._byteOffset+=e},e}();a.SceneLoader&&a.SceneLoader.RegisterPlugin(new i);
},{"@babylonjs/core/Misc/observable":"gtkL","@babylonjs/core/Misc/tools":"RkuS","@babylonjs/core/Loading/sceneLoader":"tpk9","@babylonjs/core/assetContainer":"oQoW"}],"9HbH":[function(require,module,exports) {

"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GLTFLoader=exports.ArrayItem=void 0;var e=require("@babylonjs/core/Misc/deferred"),t=require("@babylonjs/core/Maths/math"),r=require("@babylonjs/core/Misc/tools"),n=require("@babylonjs/core/Cameras/camera"),a=require("@babylonjs/core/Cameras/freeCamera"),o=require("@babylonjs/core/Animations/animationGroup"),i=require("@babylonjs/core/Animations/animation"),s=require("@babylonjs/core/Bones/bone"),l=require("@babylonjs/core/Bones/skeleton"),u=require("@babylonjs/core/Materials/material"),c=require("@babylonjs/core/Materials/PBR/pbrMaterial"),f=require("@babylonjs/core/Materials/Textures/texture"),d=require("@babylonjs/core/Meshes/transformNode"),h=require("@babylonjs/core/Meshes/buffer"),p=require("@babylonjs/core/Meshes/geometry"),y=require("@babylonjs/core/Meshes/mesh"),_=require("@babylonjs/core/Morph/morphTarget"),m=require("@babylonjs/core/Morph/morphTargetManager"),b=require("@babylonjs/core/Loading/sceneLoader"),A=require("../glTFFileLoader"),g=function(){function e(){}return e.Get=function(e,t,r){if(!t||null==r||!t[r])throw new Error(e+": Failed to find index ("+r+")");return t[r]},e.Assign=function(e){if(e)for(var t=0;t<e.length;t++)e[t].index=t},e}();exports.ArrayItem=g;var v=function(){function v(e){this._completePromises=new Array,this._disposed=!1,this._state=null,this._extensions={},this._defaultBabylonMaterialData={},this._requests=new Array,this._parent=e}return v.RegisterExtension=function(e,t){v.UnregisterExtension(e)&&r.Tools.Warn("Extension with the name '"+e+"' already exists"),v._ExtensionFactories[e]=t,v._ExtensionNames.push(e)},v.UnregisterExtension=function(e){if(!v._ExtensionFactories[e])return!1;delete v._ExtensionFactories[e];var t=v._ExtensionNames.indexOf(e);return-1!==t&&v._ExtensionNames.splice(t,1),!0},Object.defineProperty(v.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),v.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;for(var e=0,t=this._requests;e<t.length;e++){t[e].abort()}for(var r in this._requests.length=0,delete this.gltf,delete this.babylonScene,this._completePromises.length=0,this._extensions){this._extensions[r].dispose&&this._extensions[r].dispose()}this._extensions={},delete this._rootBabylonMesh,delete this._progressCallback,this._parent._clear()}},v.prototype.importMeshAsync=function(e,t,r,n,a,o){var i=this;return Promise.resolve().then(function(){i.babylonScene=t,i._rootUrl=n,i._fileName=o||"scene",i._progressCallback=a,i._loadData(r);var s=null;if(e){var l={};if(i.gltf.nodes)for(var u=0,c=i.gltf.nodes;u<c.length;u++){var f=c[u];f.name&&(l[f.name]=f.index)}s=(e instanceof Array?e:[e]).map(function(e){var t=l[e];if(void 0===t)throw new Error("Failed to find node '"+e+"'");return t})}return i._loadAsync(s,function(){return{meshes:i._getMeshes(),particleSystems:[],skeletons:i._getSkeletons(),animationGroups:i._getAnimationGroups()}})})},v.prototype.loadAsync=function(e,t,r,n,a){var o=this;return Promise.resolve().then(function(){return o.babylonScene=e,o._rootUrl=r,o._fileName=a||"scene",o._progressCallback=n,o._loadData(t),o._loadAsync(null,function(){})})},v.prototype._loadAsync=function(e,t){var n=this;return Promise.resolve().then(function(){n._uniqueRootUrl=-1===n._rootUrl.indexOf("file:")&&n._fileName?n._rootUrl:""+n._rootUrl+Date.now()+"/",n._loadExtensions(),n._checkExtensions();var a=A.GLTFLoaderState[A.GLTFLoaderState.LOADING]+" => "+A.GLTFLoaderState[A.GLTFLoaderState.READY],o=A.GLTFLoaderState[A.GLTFLoaderState.LOADING]+" => "+A.GLTFLoaderState[A.GLTFLoaderState.COMPLETE];n._parent._startPerformanceCounter(a),n._parent._startPerformanceCounter(o),n._setState(A.GLTFLoaderState.LOADING),n._extensionsOnLoading();var i=new Array;if(e)i.push(n.loadSceneAsync("/nodes",{nodes:e,index:-1}));else{var s=g.Get("/scene",n.gltf.scenes,n.gltf.scene||0);i.push(n.loadSceneAsync("/scenes/"+s.index,s))}n._parent.compileMaterials&&i.push(n._compileMaterialsAsync()),n._parent.compileShadowGenerators&&i.push(n._compileShadowGeneratorsAsync());var l=Promise.all(i).then(function(){return n._rootBabylonMesh&&n._rootBabylonMesh.setEnabled(!0),n._setState(A.GLTFLoaderState.READY),n._extensionsOnReady(),n._startAnimations(),t()});return l.then(function(){n._parent._endPerformanceCounter(a),r.Tools.SetImmediate(function(){n._disposed||Promise.all(n._completePromises).then(function(){n._parent._endPerformanceCounter(o),n._setState(A.GLTFLoaderState.COMPLETE),n._parent.onCompleteObservable.notifyObservers(void 0),n._parent.onCompleteObservable.clear(),n.dispose()},function(e){n._parent.onErrorObservable.notifyObservers(e),n._parent.onErrorObservable.clear(),n.dispose()})})}),l},function(e){throw n._disposed||(n._parent.onErrorObservable.notifyObservers(e),n._parent.onErrorObservable.clear(),n.dispose()),e})},v.prototype._loadData=function(e){if(this.gltf=e.json,this._setupData(),e.bin){var t=this.gltf.buffers;if(t&&t[0]&&!t[0].uri){var n=t[0];(n.byteLength<e.bin.byteLength-3||n.byteLength>e.bin.byteLength)&&r.Tools.Warn("Binary buffer length ("+n.byteLength+") from JSON does not match chunk length ("+e.bin.byteLength+")"),n._data=Promise.resolve(e.bin)}else r.Tools.Warn("Unexpected BIN chunk")}},v.prototype._setupData=function(){if(g.Assign(this.gltf.accessors),g.Assign(this.gltf.animations),g.Assign(this.gltf.buffers),g.Assign(this.gltf.bufferViews),g.Assign(this.gltf.cameras),g.Assign(this.gltf.images),g.Assign(this.gltf.materials),g.Assign(this.gltf.meshes),g.Assign(this.gltf.nodes),g.Assign(this.gltf.samplers),g.Assign(this.gltf.scenes),g.Assign(this.gltf.skins),g.Assign(this.gltf.textures),this.gltf.nodes){for(var e={},t=0,r=this.gltf.nodes;t<r.length;t++){if((l=r[t]).children)for(var n=0,a=l.children;n<a.length;n++){e[a[n]]=l.index}}for(var o=this._createRootNode(),i=0,s=this.gltf.nodes;i<s.length;i++){var l,u=e[(l=s[i]).index];l.parent=void 0===u?o:this.gltf.nodes[u]}}},v.prototype._loadExtensions=function(){for(var e=0,t=v._ExtensionNames;e<t.length;e++){var r=t[e],n=v._ExtensionFactories[r](this);this._extensions[r]=n,this._parent.onExtensionLoadedObservable.notifyObservers(n)}this._parent.onExtensionLoadedObservable.clear()},v.prototype._checkExtensions=function(){if(this.gltf.extensionsRequired)for(var e=0,t=this.gltf.extensionsRequired;e<t.length;e++){var r=t[e],n=this._extensions[r];if(!n||!n.enabled)throw new Error("Require extension "+r+" is not available")}},v.prototype._setState=function(e){this._state=e,this.log(A.GLTFLoaderState[this._state])},v.prototype._createRootNode=function(){this._rootBabylonMesh=new y.Mesh("__root__",this.babylonScene),this._rootBabylonMesh.setEnabled(!1);var e={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case A.GLTFLoaderCoordinateSystemMode.AUTO:this.babylonScene.useRightHandedSystem||(e.rotation=[0,1,0,0],e.scale=[1,1,-1],v._LoadTransform(e,this._rootBabylonMesh));break;case A.GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:this.babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),e},v.prototype.loadSceneAsync=function(e,t){var r=this,n=this._extensionsLoadSceneAsync(e,t);if(n)return n;var a=new Array;if(this.logOpen(e+" "+(t.name||"")),t.nodes)for(var o=0,i=t.nodes;o<i.length;o++){var s=i[o],l=g.Get(e+"/nodes/"+s,this.gltf.nodes,s);a.push(this.loadNodeAsync("/nodes/"+l.index,l,function(e){e.parent=r._rootBabylonMesh}))}if(this.gltf.nodes)for(var u=0,c=this.gltf.nodes;u<c.length;u++){if((l=c[u])._babylonTransformNode&&l._babylonBones)for(var f=0,d=l._babylonBones;f<d.length;f++){d[f].linkTransformNode(l._babylonTransformNode)}}return a.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(a).then(function(){})},v.prototype._forEachPrimitive=function(e,t){if(e._primitiveBabylonMeshes)for(var r=0,n=e._primitiveBabylonMeshes;r<n.length;r++){t(n[r])}},v.prototype._getMeshes=function(){var e=new Array;e.push(this._rootBabylonMesh);var t=this.gltf.nodes;if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];this._forEachPrimitive(a,function(t){e.push(t)})}return e},v.prototype._getSkeletons=function(){var e=new Array,t=this.gltf.skins;if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];a._data&&e.push(a._data.babylonSkeleton)}return e},v.prototype._getAnimationGroups=function(){var e=new Array,t=this.gltf.animations;if(t)for(var r=0,n=t;r<n.length;r++){var a=n[r];a._babylonAnimationGroup&&e.push(a._babylonAnimationGroup)}return e},v.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case A.GLTFLoaderAnimationStartMode.NONE:break;case A.GLTFLoaderAnimationStartMode.FIRST:0!==(e=this._getAnimationGroups()).length&&e[0].start(!0);break;case A.GLTFLoaderAnimationStartMode.ALL:for(var e,t=0,n=e=this._getAnimationGroups();t<n.length;t++){n[t].start(!0)}break;default:return void r.Tools.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},v.prototype.loadNodeAsync=function(e,t,r){var n=this;void 0===r&&(r=function(){});var a=this._extensionsLoadNodeAsync(e,t,r);if(a)return a;if(t._babylonTransformNode)throw new Error(e+": Invalid recursive node hierarchy");var o=new Array;this.logOpen(e+" "+(t.name||""));var i=function(a){if(v.AddPointerMetadata(a,e),v._LoadTransform(t,a),null!=t.camera){var i=g.Get(e+"/camera",n.gltf.cameras,t.camera);o.push(n.loadCameraAsync("/cameras/"+i.index,i,function(e){e.parent=a}))}if(t.children)for(var s=0,l=t.children;s<l.length;s++){var u=l[s],c=g.Get(e+"/children/"+u,n.gltf.nodes,u);o.push(n.loadNodeAsync("/nodes/"+c.index,c,function(e){e.parent=a}))}r(a)};if(null==t.mesh){var s=t.name||"node"+t.index;t._babylonTransformNode=new d.TransformNode(s,this.babylonScene),i(t._babylonTransformNode)}else{var l=g.Get(e+"/mesh",this.gltf.meshes,t.mesh);o.push(this._loadMeshAsync("/meshes/"+l.index,t,l,i))}return this.logClose(),Promise.all(o).then(function(){return n._forEachPrimitive(t,function(e){e.refreshBoundingInfo(!0)}),t._babylonTransformNode})},v.prototype._loadMeshAsync=function(e,t,r,n){var a=r.primitives;if(!a||!a.length)throw new Error(e+": Primitives are missing");null==a[0].index&&g.Assign(a);var o=new Array;this.logOpen(e+" "+(r.name||""));var i=t.name||"node"+t.index;if(1===a.length){var s=r.primitives[0];o.push(this._loadMeshPrimitiveAsync(e+"/primitives/"+s.index,i,t,r,s,function(e){t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]}))}else{t._babylonTransformNode=new d.TransformNode(i,this.babylonScene),t._primitiveBabylonMeshes=[];for(var l=0,u=a;l<u.length;l++){s=u[l];o.push(this._loadMeshPrimitiveAsync(e+"/primitives/"+s.index,i+"_primitive"+s.index,t,r,s,function(e){e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)}))}}if(null!=t.skin){var c=g.Get(e+"/skin",this.gltf.skins,t.skin);o.push(this._loadSkinAsync("/skins/"+c.index,t,c))}return n(t._babylonTransformNode),this.logClose(),Promise.all(o).then(function(){return t._babylonTransformNode})},v.prototype._loadMeshPrimitiveAsync=function(e,t,r,n,a,o){var i=this;this.logOpen(""+e);var s,l,u=null==r.skin&&!n.primitives[0].targets,c=a._instanceData;if(u&&c)s=c.babylonSourceMesh.createInstance(t),l=c.promise;else{var f=new Array,d=new y.Mesh(t,this.babylonScene);this._createMorphTargets(e,r,n,a,d),f.push(this._loadVertexDataAsync(e,a,d).then(function(t){return i._loadMorphTargetsAsync(e,a,d,t).then(function(){t.applyToMesh(d)})}));var h=v._GetDrawMode(e,a.mode);if(null==a.material){var p=this._defaultBabylonMaterialData[h];p||(p=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(p),this._defaultBabylonMaterialData[h]=p),d.material=p}else{var _=g.Get(e+"/material",this.gltf.materials,a.material);f.push(this._loadMaterialAsync("/materials/"+_.index,_,d,h,function(e){d.material=e}))}l=Promise.all(f),u&&(a._instanceData={babylonSourceMesh:d,promise:l}),s=d}return v.AddPointerMetadata(s,e),this._parent.onMeshLoadedObservable.notifyObservers(s),o(s),this.logClose(),l.then(function(){return s})},v.prototype._loadVertexDataAsync=function(e,t,r){var n=this,a=this._extensionsLoadVertexDataAsync(e,t,r);if(a)return a;var o=t.attributes;if(!o)throw new Error(e+": Attributes are missing");var i=new Array,s=new p.Geometry(r.name,this.babylonScene);if(null==t.indices)r.isUnIndexed=!0;else{var l=g.Get(e+"/indices",this.gltf.accessors,t.indices);i.push(this._loadIndicesAccessorAsync("/accessors/"+l.index,l).then(function(e){s.setIndices(e)}))}var u=function(t,a,l){if(null!=o[t]){r._delayInfo=r._delayInfo||[],-1===r._delayInfo.indexOf(a)&&r._delayInfo.push(a);var u=g.Get(e+"/attributes/"+t,n.gltf.accessors,o[t]);i.push(n._loadVertexAccessorAsync("/accessors/"+u.index,u,a).then(function(e){s.setVerticesBuffer(e,u.count)})),l&&l(u)}};return u("POSITION",h.VertexBuffer.PositionKind),u("NORMAL",h.VertexBuffer.NormalKind),u("TANGENT",h.VertexBuffer.TangentKind),u("TEXCOORD_0",h.VertexBuffer.UVKind),u("TEXCOORD_1",h.VertexBuffer.UV2Kind),u("JOINTS_0",h.VertexBuffer.MatricesIndicesKind),u("WEIGHTS_0",h.VertexBuffer.MatricesWeightsKind),u("COLOR_0",h.VertexBuffer.ColorKind,function(e){"VEC4"===e.type&&(r.hasVertexAlpha=!0)}),Promise.all(i).then(function(){return s})},v.prototype._createMorphTargets=function(e,t,r,n,a){if(n.targets){if(null==t._numMorphTargets)t._numMorphTargets=n.targets.length;else if(n.targets.length!==t._numMorphTargets)throw new Error(e+": Primitives do not have the same number of targets");a.morphTargetManager=new m.MorphTargetManager;for(var o=0;o<n.targets.length;o++){var i=t.weights?t.weights[o]:r.weights?r.weights[o]:0;a.morphTargetManager.addTarget(new _.MorphTarget("morphTarget"+o,i))}}},v.prototype._loadMorphTargetsAsync=function(e,t,r,n){if(!t.targets)return Promise.resolve();for(var a=new Array,o=r.morphTargetManager,i=0;i<o.numTargets;i++){var s=o.getTarget(i);a.push(this._loadMorphTargetVertexDataAsync(e+"/targets/"+i,n,t.targets[i],s))}return Promise.all(a).then(function(){})},v.prototype._loadMorphTargetVertexDataAsync=function(e,t,r,n){var a=this,o=new Array,i=function(n,i,s){if(null!=r[n]){var l=t.getVertexBuffer(i);if(l){var u=g.Get(e+"/"+n,a.gltf.accessors,r[n]);o.push(a._loadFloatAccessorAsync("/accessors/"+u.index,u).then(function(e){s(l,e)}))}}};return i("POSITION",h.VertexBuffer.PositionKind,function(e,t){e.forEach(t.length,function(e,r){t[r]+=e}),n.setPositions(t)}),i("NORMAL",h.VertexBuffer.NormalKind,function(e,t){e.forEach(t.length,function(e,r){t[r]+=e}),n.setNormals(t)}),i("TANGENT",h.VertexBuffer.TangentKind,function(e,t){var r=0;e.forEach(t.length/3*4,function(e,n){(n+1)%4!=0&&(t[r++]+=e)}),n.setTangents(t)}),Promise.all(o).then(function(){})},v._LoadTransform=function(e,r){if(null==e.skin){var n=t.Vector3.Zero(),a=t.Quaternion.Identity(),o=t.Vector3.One();if(e.matrix)t.Matrix.FromArray(e.matrix).decompose(o,a,n);else e.translation&&(n=t.Vector3.FromArray(e.translation)),e.rotation&&(a=t.Quaternion.FromArray(e.rotation)),e.scale&&(o=t.Vector3.FromArray(e.scale));r.position=n,r.rotationQuaternion=a,r.scaling=o}},v.prototype._loadSkinAsync=function(e,t,r){var n=this,a=function(e){n._forEachPrimitive(t,function(t){t.skeleton=e})};if(r._data)return a(r._data.babylonSkeleton),r._data.promise;var o="skeleton"+r.index,i=new l.Skeleton(r.name||o,o,this.babylonScene);i.overrideMesh=this._rootBabylonMesh,this._loadBones(e,r,i),a(i);var s=this._loadSkinInverseBindMatricesDataAsync(e,r).then(function(e){n._updateBoneMatrices(i,e)});return r._data={babylonSkeleton:i,promise:s},s},v.prototype._loadBones=function(e,t,r){for(var n={},a=0,o=t.joints;a<o.length;a++){var i=o[a],s=g.Get(e+"/joints/"+i,this.gltf.nodes,i);this._loadBone(s,t,r,n)}},v.prototype._loadBone=function(e,t,r,n){var a=n[e.index];if(a)return a;var o=null;e.parent&&e.parent._babylonTransformNode!==this._rootBabylonMesh&&(o=this._loadBone(e.parent,t,r,n));var i=t.joints.indexOf(e.index);return a=new s.Bone(e.name||"joint"+e.index,r,o,this._getNodeMatrix(e),null,null,i),n[e.index]=a,e._babylonBones=e._babylonBones||[],e._babylonBones.push(a),a},v.prototype._loadSkinInverseBindMatricesDataAsync=function(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);var r=g.Get(e+"/inverseBindMatrices",this.gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/"+r.index,r)},v.prototype._updateBoneMatrices=function(e,r){for(var n=0,a=e.bones;n<a.length;n++){var o=a[n],i=t.Matrix.Identity(),s=o._index;r&&-1!==s&&(t.Matrix.FromArrayToRef(r,16*s,i),i.invertToRef(i));var l=o.getParent();l&&i.multiplyToRef(l.getInvertedAbsoluteTransform(),i),o.updateMatrix(i,!1,!1),o._updateDifferenceMatrix(void 0,!1)}},v.prototype._getNodeMatrix=function(e){return e.matrix?t.Matrix.FromArray(e.matrix):t.Matrix.Compose(e.scale?t.Vector3.FromArray(e.scale):t.Vector3.One(),e.rotation?t.Quaternion.FromArray(e.rotation):t.Quaternion.Identity(),e.translation?t.Vector3.FromArray(e.translation):t.Vector3.Zero())},v.prototype.loadCameraAsync=function(e,r,o){void 0===o&&(o=function(){});var i=this._extensionsLoadCameraAsync(e,r,o);if(i)return i;var s=new Array;this.logOpen(e+" "+(r.name||""));var l=new a.FreeCamera(r.name||"camera"+r.index,t.Vector3.Zero(),this.babylonScene,!1);switch(l.rotation=new t.Vector3(0,Math.PI,0),r.type){case"perspective":var u=r.perspective;if(!u)throw new Error(e+": Camera perspective properties are missing");l.fov=u.yfov,l.minZ=u.znear,l.maxZ=u.zfar||Number.MAX_VALUE;break;case"orthographic":if(!r.orthographic)throw new Error(e+": Camera orthographic properties are missing");l.mode=n.Camera.ORTHOGRAPHIC_CAMERA,l.orthoLeft=-r.orthographic.xmag,l.orthoRight=r.orthographic.xmag,l.orthoBottom=-r.orthographic.ymag,l.orthoTop=r.orthographic.ymag,l.minZ=r.orthographic.znear,l.maxZ=r.orthographic.zfar;break;default:throw new Error(e+": Invalid camera type ("+r.type+")")}return v.AddPointerMetadata(l,e),this._parent.onCameraLoadedObservable.notifyObservers(l),o(l),Promise.all(s).then(function(){return l})},v.prototype._loadAnimationsAsync=function(){var e=this.gltf.animations;if(!e)return Promise.resolve();for(var t=new Array,r=0;r<e.length;r++){var n=e[r];t.push(this.loadAnimationAsync("/animations/"+n.index,n))}return Promise.all(t).then(function(){})},v.prototype.loadAnimationAsync=function(e,t){var r=this._extensionsLoadAnimationAsync(e,t);if(r)return r;var n=new o.AnimationGroup(t.name||"animation"+t.index,this.babylonScene);t._babylonAnimationGroup=n;var a=new Array;g.Assign(t.channels),g.Assign(t.samplers);for(var i=0,s=t.channels;i<s.length;i++){var l=s[i];a.push(this._loadAnimationChannelAsync(e+"/channels/"+l.index,e,t,l,n))}return Promise.all(a).then(function(){return n.normalize(0),n})},v.prototype._loadAnimationChannelAsync=function(e,r,n,a,o){var s=this;if(null==a.target.node)return Promise.resolve();var l=g.Get(e+"/target/node",this.gltf.nodes,a.target.node);if("weights"===a.target.path&&!l._numMorphTargets||"weights"!==a.target.path&&!l._babylonTransformNode)return Promise.resolve();var u=g.Get(e+"/sampler",n.samplers,a.sampler);return this._loadAnimationSamplerAsync(r+"/samplers/"+a.sampler,u).then(function(r){var n,u;switch(a.target.path){case"translation":n="position",u=i.Animation.ANIMATIONTYPE_VECTOR3;break;case"rotation":n="rotationQuaternion",u=i.Animation.ANIMATIONTYPE_QUATERNION;break;case"scale":n="scaling",u=i.Animation.ANIMATIONTYPE_VECTOR3;break;case"weights":n="influence",u=i.Animation.ANIMATIONTYPE_FLOAT;break;default:throw new Error(e+"/target/path: Invalid value ("+a.target.path+")")}var c,f,d=0;switch(n){case"position":c=function(){var e=t.Vector3.FromArray(r.output,d);return d+=3,e};break;case"rotationQuaternion":c=function(){var e=t.Quaternion.FromArray(r.output,d);return d+=4,e};break;case"scaling":c=function(){var e=t.Vector3.FromArray(r.output,d);return d+=3,e};break;case"influence":c=function(){for(var e=new Array(l._numMorphTargets),t=0;t<l._numMorphTargets;t++)e[t]=r.output[d++];return e}}switch(r.interpolation){case"STEP":f=function(e){return{frame:r.input[e],value:c(),interpolation:i.AnimationKeyInterpolation.STEP}};break;case"LINEAR":f=function(e){return{frame:r.input[e],value:c()}};break;case"CUBICSPLINE":f=function(e){return{frame:r.input[e],inTangent:c(),value:c(),outTangent:c()}}}for(var h=new Array(r.input.length),p=0;p<r.input.length;p++)h[p]=f(p);if("influence"===n)for(var y=function(e){var t=o.name+"_channel"+o.targetedAnimations.length,r=new i.Animation(t,n,1,u);r.setKeys(h.map(function(t){return{frame:t.frame,inTangent:t.inTangent?t.inTangent[e]:void 0,value:t.value[e],outTangent:t.outTangent?t.outTangent[e]:void 0}})),s._forEachPrimitive(l,function(t){var n=t.morphTargetManager.getTarget(e),a=r.clone();n.animations.push(a),o.addTargetedAnimation(a,n)})},_=0;_<l._numMorphTargets;_++)y(_);else{var m=o.name+"_channel"+o.targetedAnimations.length,b=new i.Animation(m,n,1,u);b.setKeys(h),l._babylonTransformNode.animations.push(b),o.addTargetedAnimation(b,l._babylonTransformNode)}})},v.prototype._loadAnimationSamplerAsync=function(e,t){if(t._data)return t._data;var r=t.interpolation||"LINEAR";switch(r){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(e+"/interpolation: Invalid value ("+t.interpolation+")")}var n=g.Get(e+"/input",this.gltf.accessors,t.input),a=g.Get(e+"/output",this.gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync("/accessors/"+n.index,n),this._loadFloatAccessorAsync("/accessors/"+a.index,a)]).then(function(e){var t=e[0],n=e[1];return{input:t,interpolation:r,output:n}}),t._data},v.prototype._loadBufferAsync=function(e,t){if(t._data)return t._data;if(!t.uri)throw new Error(e+"/uri: Value is missing");return t._data=this.loadUriAsync(e+"/uri",t.uri),t._data},v.prototype.loadBufferViewAsync=function(e,t){if(t._data)return t._data;var r=g.Get(e+"/buffer",this.gltf.buffers,t.buffer);return t._data=this._loadBufferAsync("/buffers/"+r.index,r).then(function(r){try{return new Uint8Array(r.buffer,r.byteOffset+(t.byteOffset||0),t.byteLength)}catch(n){throw new Error(e+": "+n.message)}}),t._data},v.prototype._loadIndicesAccessorAsync=function(e,t){if("SCALAR"!==t.type)throw new Error(e+"/type: Invalid value "+t.type);if(5121!==t.componentType&&5123!==t.componentType&&5125!==t.componentType)throw new Error(e+"/componentType: Invalid value "+t.componentType);if(t._data)return t._data;var r=g.Get(e+"/bufferView",this.gltf.bufferViews,t.bufferView);return t._data=this.loadBufferViewAsync("/bufferViews/"+r.index,r).then(function(r){return v._GetTypedArray(e,t.componentType,r,t.byteOffset,t.count)}),t._data},v.prototype._loadFloatAccessorAsync=function(e,t){var r=this;if(5126!==t.componentType)throw new Error("Invalid component type "+t.componentType);if(t._data)return t._data;var n=v._GetNumComponents(e,t.type),a=n*t.count;if(null==t.bufferView)t._data=Promise.resolve(new Float32Array(a));else{var o=g.Get(e+"/bufferView",this.gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/"+o.index,o).then(function(r){return v._GetTypedArray(e,t.componentType,r,t.byteOffset,a)})}if(t.sparse){var i=t.sparse;t._data=t._data.then(function(a){var o=a,s=g.Get(e+"/sparse/indices/bufferView",r.gltf.bufferViews,i.indices.bufferView),l=g.Get(e+"/sparse/values/bufferView",r.gltf.bufferViews,i.values.bufferView);return Promise.all([r.loadBufferViewAsync("/bufferViews/"+s.index,s),r.loadBufferViewAsync("/bufferViews/"+l.index,l)]).then(function(r){for(var a=r[0],s=r[1],l=v._GetTypedArray(e+"/sparse/indices",i.indices.componentType,a,i.indices.byteOffset,i.count),u=v._GetTypedArray(e+"/sparse/values",t.componentType,s,i.values.byteOffset,n*i.count),c=0,f=0;f<l.length;f++)for(var d=l[f]*n,h=0;h<n;h++)o[d++]=u[c++];return o})})}return t._data},v.prototype._loadVertexBufferViewAsync=function(e,t){var r=this;return e._babylonBuffer?e._babylonBuffer:(e._babylonBuffer=this.loadBufferViewAsync("/bufferViews/"+e.index,e).then(function(e){return new h.Buffer(r.babylonScene.getEngine(),e,!1)}),e._babylonBuffer)},v.prototype._loadVertexAccessorAsync=function(e,t,n){var a=this;if(t._babylonVertexBuffer)return t._babylonVertexBuffer;if(t.sparse)t._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+t.index,t).then(function(e){return new h.VertexBuffer(a.babylonScene.getEngine(),e,n,!1)});else if(t.byteOffset&&t.byteOffset%h.VertexBuffer.GetTypeByteLength(t.componentType)!=0)r.Tools.Warn("Accessor byte offset is not a multiple of component type byte length"),t._babylonVertexBuffer=this._loadFloatAccessorAsync("/accessors/"+t.index,t).then(function(e){return new h.VertexBuffer(a.babylonScene.getEngine(),e,n,!1)});else{var o=g.Get(e+"/bufferView",this.gltf.bufferViews,t.bufferView);t._babylonVertexBuffer=this._loadVertexBufferViewAsync(o,n).then(function(r){var i=v._GetNumComponents(e,t.type);return new h.VertexBuffer(a.babylonScene.getEngine(),r,n,!1,!1,o.byteStride,!1,t.byteOffset,i,t.componentType,t.normalized,!0)})}return t._babylonVertexBuffer},v.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(e,r,n){if(!(n instanceof c.PBRMaterial))throw new Error(e+": Material type not supported");var a=new Array;return r&&(r.baseColorFactor?(n.albedoColor=t.Color3.FromArray(r.baseColorFactor),n.alpha=r.baseColorFactor[3]):n.albedoColor=t.Color3.White(),n.metallic=null==r.metallicFactor?1:r.metallicFactor,n.roughness=null==r.roughnessFactor?1:r.roughnessFactor,r.baseColorTexture&&a.push(this.loadTextureInfoAsync(e+"/baseColorTexture",r.baseColorTexture,function(e){e.name=n.name+" (Base Color)",n.albedoTexture=e})),r.metallicRoughnessTexture&&(a.push(this.loadTextureInfoAsync(e+"/metallicRoughnessTexture",r.metallicRoughnessTexture,function(e){e.name=n.name+" (Metallic Roughness)",n.metallicTexture=e})),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(a).then(function(){})},v.prototype._loadMaterialAsync=function(e,t,r,n,a){void 0===a&&(a=function(){});var o=this._extensionsLoadMaterialAsync(e,t,r,n,a);if(o)return o;t._data=t._data||{};var i=t._data[n];if(!i){this.logOpen(e+" "+(t.name||""));var s=this.createMaterial(e,t,n);i={babylonMaterial:s,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,t,s)},t._data[n]=i,v.AddPointerMetadata(s,e),this._parent.onMaterialLoadedObservable.notifyObservers(s),this.logClose()}return i.babylonMeshes.push(r),r.onDisposeObservable.addOnce(function(){var e=i.babylonMeshes.indexOf(r);-1!==e&&i.babylonMeshes.splice(e,1)}),a(i.babylonMaterial),i.promise.then(function(){return i.babylonMaterial})},v.prototype._createDefaultMaterial=function(e,t){var r=new c.PBRMaterial(e,this.babylonScene);return r.sideOrientation=this.babylonScene.useRightHandedSystem?u.Material.CounterClockWiseSideOrientation:u.Material.ClockWiseSideOrientation,r.fillMode=t,r.enableSpecularAntiAliasing=!0,r.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,r.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,r.transparencyMode=c.PBRMaterial.PBRMATERIAL_OPAQUE,r.metallic=1,r.roughness=1,r},v.prototype.createMaterial=function(e,t,r){var n=this._extensionsCreateMaterial(e,t,r);if(n)return n;var a=t.name||"material"+t.index;return this._createDefaultMaterial(a,r)},v.prototype.loadMaterialPropertiesAsync=function(e,t,r){var n=this._extensionsLoadMaterialPropertiesAsync(e,t,r);if(n)return n;var a=new Array;return a.push(this.loadMaterialBasePropertiesAsync(e,t,r)),t.pbrMetallicRoughness&&a.push(this._loadMaterialMetallicRoughnessPropertiesAsync(e+"/pbrMetallicRoughness",t.pbrMetallicRoughness,r)),this.loadMaterialAlphaProperties(e,t,r),Promise.all(a).then(function(){})},v.prototype.loadMaterialBasePropertiesAsync=function(e,r,n){if(!(n instanceof c.PBRMaterial))throw new Error(e+": Material type not supported");var a=new Array;return n.emissiveColor=r.emissiveFactor?t.Color3.FromArray(r.emissiveFactor):new t.Color3(0,0,0),r.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),r.normalTexture&&(a.push(this.loadTextureInfoAsync(e+"/normalTexture",r.normalTexture,function(e){e.name=n.name+" (Normal)",n.bumpTexture=e})),n.invertNormalMapX=!this.babylonScene.useRightHandedSystem,n.invertNormalMapY=this.babylonScene.useRightHandedSystem,null!=r.normalTexture.scale&&(n.bumpTexture.level=r.normalTexture.scale),n.forceIrradianceInFragment=!0),r.occlusionTexture&&(a.push(this.loadTextureInfoAsync(e+"/occlusionTexture",r.occlusionTexture,function(e){e.name=n.name+" (Occlusion)",n.ambientTexture=e})),n.useAmbientInGrayScale=!0,null!=r.occlusionTexture.strength&&(n.ambientTextureStrength=r.occlusionTexture.strength)),r.emissiveTexture&&a.push(this.loadTextureInfoAsync(e+"/emissiveTexture",r.emissiveTexture,function(e){e.name=n.name+" (Emissive)",n.emissiveTexture=e})),Promise.all(a).then(function(){})},v.prototype.loadMaterialAlphaProperties=function(e,t,r){if(!(r instanceof c.PBRMaterial))throw new Error(e+": Material type not supported");switch(t.alphaMode||"OPAQUE"){case"OPAQUE":r.transparencyMode=c.PBRMaterial.PBRMATERIAL_OPAQUE;break;case"MASK":r.transparencyMode=c.PBRMaterial.PBRMATERIAL_ALPHATEST,r.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,r.albedoTexture&&(r.albedoTexture.hasAlpha=!0);break;case"BLEND":r.transparencyMode=c.PBRMaterial.PBRMATERIAL_ALPHABLEND,r.albedoTexture&&(r.albedoTexture.hasAlpha=!0,r.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(e+"/alphaMode: Invalid value ("+t.alphaMode+")")}},v.prototype.loadTextureInfoAsync=function(e,t,r){var n=this;void 0===r&&(r=function(){});var a=this._extensionsLoadTextureInfoAsync(e,t,r);if(a)return a;this.logOpen(""+e);var o=g.Get(e+"/index",this.gltf.textures,t.index),i=this._loadTextureAsync("/textures/"+t.index,o,function(a){a.coordinatesIndex=t.texCoord||0,v.AddPointerMetadata(a,e),n._parent.onTextureLoadedObservable.notifyObservers(a),r(a)});return this.logClose(),i},v.prototype._loadTextureAsync=function(t,n,a){var o=this;void 0===a&&(a=function(){});var i=new Array;this.logOpen(t+" "+(n.name||""));var s=null==n.sampler?v._DefaultSampler:g.Get(t+"/sampler",this.gltf.samplers,n.sampler),l=this._loadSampler("/samplers/"+s.index,s),u=g.Get(t+"/source",this.gltf.images,n.source),c=null;u.uri&&(r.Tools.IsBase64(u.uri)?c=u.uri:this.babylonScene.getEngine().textureFormatInUse&&(c=this._rootUrl+u.uri));var d=new e.Deferred,h=new f.Texture(c,this.babylonScene,l.noMipMaps,!1,l.samplingMode,function(){o._disposed||d.resolve()},function(e,r){o._disposed||d.reject(new Error(t+": "+(r&&r.message?r.message:e||"Failed to load texture")))});return i.push(d.promise),c||i.push(this.loadImageAsync("/images/"+u.index,u).then(function(e){var t=u.uri||o._fileName+"#image"+u.index,r="data:"+o._uniqueRootUrl+t;h.updateURL(r,new Blob([e],{type:u.mimeType}))})),h.wrapU=l.wrapU,h.wrapV=l.wrapV,a(h),this.logClose(),Promise.all(i).then(function(){return h})},v.prototype._loadSampler=function(e,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:v._GetTextureSamplingMode(e,t),wrapU:v._GetTextureWrapMode(e+"/wrapS",t.wrapS),wrapV:v._GetTextureWrapMode(e+"/wrapT",t.wrapT)}),t._data},v.prototype.loadImageAsync=function(e,t){if(!t._data){if(this.logOpen(e+" "+(t.name||"")),t.uri)t._data=this.loadUriAsync(e+"/uri",t.uri);else{var r=g.Get(e+"/bufferView",this.gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/"+r.index,r)}this.logClose()}return t._data},v.prototype.loadUriAsync=function(e,t){var n=this,a=this._extensionsLoadUriAsync(e,t);if(a)return a;if(!v._ValidateUri(t))throw new Error(e+": '"+t+"' is invalid");if(r.Tools.IsBase64(t)){var o=new Uint8Array(r.Tools.DecodeBase64(t));return this.log("Decoded "+t.substr(0,64)+"... ("+o.length+" bytes)"),Promise.resolve(o)}return this.log("Loading "+t),this._parent.preprocessUrlAsync(this._rootUrl+t).then(function(a){return new Promise(function(o,i){if(!n._disposed){var s=r.Tools.LoadFile(a,function(e){if(!n._disposed){var r=new Uint8Array(e);n.log("Loaded "+t+" ("+r.length+" bytes)"),o(r)}},function(e){if(!n._disposed&&(s&&(s._lengthComputable=e.lengthComputable,s._loaded=e.loaded,s._total=e.total),n._state===A.GLTFLoaderState.LOADING))try{n._onProgress()}catch(t){i(t)}},n.babylonScene.offlineProvider,!0,function(a,o){n._disposed||i(new r.LoadFileError(e+": Failed to load '"+t+"'"+(a?": "+a.status+" "+a.statusText:""),a))});n._requests.push(s)}})})},v.prototype._onProgress=function(){if(this._progressCallback){for(var e=!0,t=0,r=0,n=0,a=this._requests;n<a.length;n++){var o=a[n];if(void 0===o._lengthComputable||void 0===o._loaded||void 0===o._total)return;e=e&&o._lengthComputable,t+=o._loaded,r+=o._total}this._progressCallback(new b.SceneLoaderProgressEvent(e,t,e?r:0))}},v.AddPointerMetadata=function(e,t){var r=e.metadata=e.metadata||{},n=r.gltf=r.gltf||{};(n.pointers=n.pointers||[]).push(t)},v._GetTextureWrapMode=function(e,t){switch(t=null==t?10497:t){case 33071:return f.Texture.CLAMP_ADDRESSMODE;case 33648:return f.Texture.MIRROR_ADDRESSMODE;case 10497:return f.Texture.WRAP_ADDRESSMODE;default:return r.Tools.Warn(e+": Invalid value ("+t+")"),f.Texture.WRAP_ADDRESSMODE}},v._GetTextureSamplingMode=function(e,t){var n=null==t.magFilter?9729:t.magFilter,a=null==t.minFilter?9987:t.minFilter;if(9729===n)switch(a){case 9728:return f.Texture.LINEAR_NEAREST;case 9729:return f.Texture.LINEAR_LINEAR;case 9984:return f.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return f.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return f.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return f.Texture.LINEAR_LINEAR_MIPLINEAR;default:return r.Tools.Warn(e+"/minFilter: Invalid value ("+a+")"),f.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==n&&r.Tools.Warn(e+"/magFilter: Invalid value ("+n+")"),a){case 9728:return f.Texture.NEAREST_NEAREST;case 9729:return f.Texture.NEAREST_LINEAR;case 9984:return f.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return f.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return f.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return f.Texture.NEAREST_LINEAR_MIPLINEAR;default:return r.Tools.Warn(e+"/minFilter: Invalid value ("+a+")"),f.Texture.NEAREST_NEAREST_MIPNEAREST}},v._GetTypedArray=function(e,t,r,n,a){var o=r.buffer;n=r.byteOffset+(n||0);try{switch(t){case 5120:return new Int8Array(o,n,a);case 5121:return new Uint8Array(o,n,a);case 5122:return new Int16Array(o,n,a);case 5123:return new Uint16Array(o,n,a);case 5125:return new Uint32Array(o,n,a);case 5126:return new Float32Array(o,n,a);default:throw new Error("Invalid component type "+t)}}catch(i){throw new Error(e+": "+i)}},v._GetNumComponents=function(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(e+": Invalid type ("+t+")")},v._ValidateUri=function(e){return r.Tools.IsBase64(e)||-1===e.indexOf("..")},v._GetDrawMode=function(e,t){switch(null==t&&(t=4),t){case 0:return u.Material.PointListDrawMode;case 1:return u.Material.LineListDrawMode;case 2:return u.Material.LineLoopDrawMode;case 3:return u.Material.LineStripDrawMode;case 4:return u.Material.TriangleFillMode;case 5:return u.Material.TriangleStripDrawMode;case 6:return u.Material.TriangleFanDrawMode}throw new Error(e+": Invalid mesh primitive mode ("+t+")")},v.prototype._compileMaterialsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile materials");var t=new Array;if(this.gltf.materials)for(var r=0,n=this.gltf.materials;r<n.length;r++){var a=n[r];if(a._data)for(var o in a._data)for(var i=a._data[o],s=0,l=i.babylonMeshes;s<l.length;s++){var u=l[s];u.computeWorldMatrix(!0);var c=i.babylonMaterial;t.push(c.forceCompilationAsync(u)),this._parent.useClipPlane&&t.push(c.forceCompilationAsync(u,{clipPlane:!0}))}}return Promise.all(t).then(function(){e._parent._endPerformanceCounter("Compile materials")})},v.prototype._compileShadowGeneratorsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var t=new Array,r=0,n=this.babylonScene.lights;r<n.length;r++){var a=n[r].getShadowGenerator();a&&t.push(a.forceCompilationAsync())}return Promise.all(t).then(function(){e._parent._endPerformanceCounter("Compile shadow generators")})},v.prototype._forEachExtensions=function(e){for(var t=0,r=v._ExtensionNames;t<r.length;t++){var n=r[t],a=this._extensions[n];a.enabled&&e(a)}},v.prototype._applyExtensions=function(e,t){for(var r=0,n=v._ExtensionNames;r<n.length;r++){var a=n[r],o=this._extensions[a];if(o.enabled){var i=e;i._activeLoaderExtensions=i._activeLoaderExtensions||{};var s=i._activeLoaderExtensions;if(!s[a]){s[a]=!0;try{var l=t(o);if(l)return l}finally{delete s[a]}}}}return null},v.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(e){return e.onLoading&&e.onLoading()})},v.prototype._extensionsOnReady=function(){this._forEachExtensions(function(e){return e.onReady&&e.onReady()})},v.prototype._extensionsLoadSceneAsync=function(e,t){return this._applyExtensions(t,function(r){return r.loadSceneAsync&&r.loadSceneAsync(e,t)})},v.prototype._extensionsLoadNodeAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.loadNodeAsync&&n.loadNodeAsync(e,t,r)})},v.prototype._extensionsLoadCameraAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.loadCameraAsync&&n.loadCameraAsync(e,t,r)})},v.prototype._extensionsLoadVertexDataAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n._loadVertexDataAsync&&n._loadVertexDataAsync(e,t,r)})},v.prototype._extensionsLoadMaterialAsync=function(e,t,r,n,a){return this._applyExtensions(t,function(o){return o._loadMaterialAsync&&o._loadMaterialAsync(e,t,r,n,a)})},v.prototype._extensionsCreateMaterial=function(e,t,r){return this._applyExtensions({},function(n){return n.createMaterial&&n.createMaterial(e,t,r)})},v.prototype._extensionsLoadMaterialPropertiesAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(e,t,r)})},v.prototype._extensionsLoadTextureInfoAsync=function(e,t,r){return this._applyExtensions(t,function(n){return n.loadTextureInfoAsync&&n.loadTextureInfoAsync(e,t,r)})},v.prototype._extensionsLoadAnimationAsync=function(e,t){return this._applyExtensions(t,function(r){return r.loadAnimationAsync&&r.loadAnimationAsync(e,t)})},v.prototype._extensionsLoadUriAsync=function(e,t){return this._applyExtensions({},function(r){return r._loadUriAsync&&r._loadUriAsync(e,t)})},v.LoadExtensionAsync=function(e,t,r,n){if(!t.extensions)return null;var a=t.extensions[r];return a?n(e+"/extensions/"+r,a):null},v.LoadExtraAsync=function(e,t,r,n){if(!t.extras)return null;var a=t.extras[r];return a?n(e+"/extras/"+r,a):null},v.prototype.logOpen=function(e){this._parent._logOpen(e)},v.prototype.logClose=function(){this._parent._logClose()},v.prototype.log=function(e){this._parent._log(e)},v.prototype.startPerformanceCounter=function(e){this._parent._startPerformanceCounter(e)},v.prototype.endPerformanceCounter=function(e){this._parent._endPerformanceCounter(e)},v._DefaultSampler={index:-1},v._ExtensionNames=new Array,v._ExtensionFactories={},v}();exports.GLTFLoader=v,A.GLTFFileLoader._CreateGLTF2Loader=function(e){return new v(e)};
},{"@babylonjs/core/Misc/deferred":"zhzd","@babylonjs/core/Maths/math":"Iizi","@babylonjs/core/Misc/tools":"RkuS","@babylonjs/core/Cameras/camera":"ZyNI","@babylonjs/core/Cameras/freeCamera":"1Ewv","@babylonjs/core/Animations/animationGroup":"QrbQ","@babylonjs/core/Animations/animation":"8SP4","@babylonjs/core/Bones/bone":"cReH","@babylonjs/core/Bones/skeleton":"f/YG","@babylonjs/core/Materials/material":"v46b","@babylonjs/core/Materials/PBR/pbrMaterial":"0yWt","@babylonjs/core/Materials/Textures/texture":"KNsj","@babylonjs/core/Meshes/transformNode":"XiAM","@babylonjs/core/Meshes/buffer":"YHhW","@babylonjs/core/Meshes/geometry":"QQcI","@babylonjs/core/Meshes/mesh":"aXN+","@babylonjs/core/Morph/morphTarget":"e3lx","@babylonjs/core/Morph/morphTargetManager":"l5Nr","@babylonjs/core/Loading/sceneLoader":"tpk9","../glTFFileLoader":"1AHo"}],"gYPO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.rgbdEncodePixelShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/helperFunctions");var r="rgbdEncodePixelShader",n="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}";e.Effect.ShadersStore[r]=n;var t={name:r,shader:n};exports.rgbdEncodePixelShader=t;
},{"../Materials/effect":"Ru7D","./ShadersInclude/helperFunctions":"yU4e"}],"Ve8w":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.rgbdDecodePixelShader=void 0;var e=require("../Materials/effect");require("./ShadersInclude/helperFunctions");var r="rgbdDecodePixelShader",a="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";e.Effect.ShadersStore[r]=a;var d={name:r,shader:a};exports.rgbdDecodePixelShader=d;
},{"../Materials/effect":"Ru7D","./ShadersInclude/helperFunctions":"yU4e"}],"9VJq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EnvironmentTextureTools=void 0;var e=require("./tools"),r=require("../Maths/math"),t=require("../Maths/math.scalar"),n=require("../Maths/sphericalPolynomial"),a=require("../Materials/Textures/internalTexture"),o=require("../Materials/Textures/baseTexture"),i=require("../Engines/constants"),s=require("../scene"),l=require("../PostProcesses/postProcess"),u=require("../Misc/logger");require("../Shaders/rgbdEncode.fragment"),require("../Shaders/rgbdDecode.fragment");var c=function(){function c(){}return c.GetEnvInfo=function(e){for(var r=new DataView(e),t=0,n=0;n<c._MagicBytes.length;n++)if(r.getUint8(t++)!==c._MagicBytes[n])return u.Logger.Error("Not a babylon environment map"),null;for(var a="",o=0;o=r.getUint8(t++);)a+=String.fromCharCode(o);var i=JSON.parse(a);return i.specular&&(i.specular.specularDataPosition=t,i.specular.lodGenerationScale=i.specular.lodGenerationScale||.8),i},c.CreateEnvTextureAsync=function(r){var n=this,a=r.getInternalTexture();if(!a)return Promise.reject("The cube texture is invalid.");if(!r._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var o=a.getEngine();if(o&&o.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(r.textureType===i.Constants.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var u=o.getRenderingCanvas();if(!u)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var T=i.Constants.TEXTURETYPE_FLOAT;if(!o.getCaps().textureFloatRender&&(T=i.Constants.TEXTURETYPE_HALF_FLOAT,!o.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var d=a.width,f=new s.Scene(o),p={},y=[],x=t.Scalar.Log2(a.width);x=Math.round(x);for(var E=function(t){for(var n=Math.pow(2,x-t),a=function(a){var s=r.readPixels(a,t),c=o.createRawTexture(s,n,n,i.Constants.TEXTUREFORMAT_RGBA,!1,!1,i.Constants.TEXTURE_NEAREST_SAMPLINGMODE,null,T),d=new Promise(function(r,s){var T=new l.PostProcess("rgbdEncode","rgbdEncode",null,null,1,null,i.Constants.TEXTURE_NEAREST_SAMPLINGMODE,o,!1,void 0,i.Constants.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);T.getEffect().executeWhenCompiled(function(){T.onApply=function(e){e._bindTexture("textureSampler",c)};var i=o.getRenderWidth(),s=o.getRenderHeight();o.setSize(n,n),f.postProcessManager.directRender([T],null),e.Tools.ToBlob(u,function(e){var n=new FileReader;n.onload=function(e){var n=e.target.result;p[6*t+a]=n,r()},n.readAsArrayBuffer(e)}),o.setSize(i,s)})});y.push(d)},s=0;s<6;s++)a(s)},_=0;_<=x;_++)E(_);return Promise.all(y).then(function(){f.dispose();for(var e={version:1,width:d,irradiance:n._CreateEnvTextureIrradiance(r),specular:{mipmaps:[],lodGenerationScale:r.lodGenerationScale}},t=0,a=0;a<=x;a++)for(var o=0;o<6;o++){var i=p[6*a+o].byteLength;e.specular.mipmaps.push({length:i,position:t}),t+=i}for(var s=JSON.stringify(e),l=new ArrayBuffer(s.length+1),u=new Uint8Array(l),T=(a=0,s.length);a<T;a++)u[a]=s.charCodeAt(a);u[s.length]=0;var y=c._MagicBytes.length+t+l.byteLength,E=new ArrayBuffer(y),_=new Uint8Array(E),g=new DataView(E),h=0;for(a=0;a<c._MagicBytes.length;a++)g.setUint8(h++,c._MagicBytes[a]);_.set(new Uint8Array(l),h),h+=l.byteLength;for(a=0;a<=x;a++)for(o=0;o<6;o++){var v=p[6*a+o];_.set(new Uint8Array(v),h),h+=v.byteLength}return E})},c._CreateEnvTextureIrradiance=function(e){var r=e.sphericalPolynomial;return null==r?null:{x:[r.x.x,r.x.y,r.x.z],y:[r.y.x,r.y.y,r.y.z],z:[r.z.x,r.z.y,r.z.z],xx:[r.xx.x,r.xx.y,r.xx.z],yy:[r.yy.x,r.yy.y,r.yy.z],zz:[r.zz.x,r.zz.y,r.zz.z],yz:[r.yz.x,r.yz.y,r.yz.z],zx:[r.zx.x,r.zx.y,r.zx.z],xy:[r.xy.x,r.xy.y,r.xy.z]}},c.UploadEnvLevelsAsync=function(e,r,n){if(1!==n.version)throw new Error('Unsupported babylon environment map version "'+n.version+'"');var a=n.specular;if(!a)return Promise.resolve();var o=t.Scalar.Log2(n.width);if(o=Math.round(o)+1,a.mipmaps.length!==6*o)throw new Error('Unsupported specular mipmaps number "'+a.mipmaps.length+'"');e._lodGenerationScale=a.lodGenerationScale;for(var i=new Array(o),s=0;s<o;s++){i[s]=new Array(6);for(var l=0;l<6;l++){var u=a.mipmaps[6*s+l];i[s][l]=new Uint8Array(r,a.specularDataPosition+u.position,u.length)}}return c.UploadLevelsAsync(e,i)},c.UploadLevelsAsync=function(r,n){if(!e.Tools.IsExponentOfTwo(r.width))throw new Error("Texture size must be a power of two");var s=Math.round(t.Scalar.Log2(r.width))+1,u=r.getEngine(),c=!1,T=!1,d=null,f=null,p=null,y=u.getCaps();if(r.format=i.Constants.TEXTUREFORMAT_RGBA,r.type=i.Constants.TEXTURETYPE_UNSIGNED_INT,r.generateMipMaps=!0,u.updateTextureSamplingMode(i.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,r),y.textureLOD?u.webGLVersion<2?c=!1:y.textureHalfFloatRender&&y.textureHalfFloatLinearFiltering?(c=!0,r.type=i.Constants.TEXTURETYPE_HALF_FLOAT):y.textureFloatRender&&y.textureFloatLinearFiltering&&(c=!0,r.type=i.Constants.TEXTURETYPE_FLOAT):(c=!1,T=!0,p={}),c)d=new l.PostProcess("rgbdDecode","rgbdDecode",null,null,1,null,i.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,u,!1,void 0,r.type,void 0,null,!1),r._isRGBD=!1,r.invertY=!1,f=u.createRenderTargetCubeTexture(r.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:i.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,type:r.type,format:i.Constants.TEXTUREFORMAT_RGBA});else if(r._isRGBD=!0,r.invertY=!0,T)for(var x=r._lodGenerationScale,E=r._lodGenerationOffset,_=0;_<3;_++){var g=(s-1)*x+E,h=E+(g-E)*(1-_/2),v=Math.round(Math.min(Math.max(h,0),g)),R=new a.InternalTexture(u,a.InternalTexture.DATASOURCE_TEMP);R.isCube=!0,R.invertY=!0,R.generateMipMaps=!1,u.updateTextureSamplingMode(i.Constants.TEXTURE_LINEAR_LINEAR,R);var A=new o.BaseTexture(null);switch(A.isCube=!0,A._texture=R,p[v]=A,_){case 0:r._lodTextureLow=A;break;case 1:r._lodTextureMid=A;break;case 2:r._lodTextureHigh=A}}var m=[],w=function(e){for(var t=function(t){var a=n[e][t],o=new Blob([a],{type:"image/png"}),s=URL.createObjectURL(o),l=new Image;l.src=s;var y=new Promise(function(n,a){l.onload=function(){if(c){var o=u.createTexture(null,!0,!0,null,i.Constants.TEXTURE_NEAREST_SAMPLINGMODE,null,function(e){a(e)},l);d.getEffect().executeWhenCompiled(function(){d.onApply=function(e){e._bindTexture("textureSampler",o),e.setFloat2("scale",1,1)},u.scenes[0].postProcessManager.directRender([d],f,!0,t,e),u.restoreDefaultFramebuffer(),o.dispose(),window.URL.revokeObjectURL(s),n()})}else{if(u._uploadImageToTexture(r,l,t,e),T){var y=p[e];y&&u._uploadImageToTexture(y._texture,l,t,0)}n()}},l.onerror=function(e){a(e)}});m.push(y)},a=0;a<6;a++)t(a)};for(_=0;_<n.length;_++)w(_);if(n.length<s){var M=void 0,U=Math.pow(2,s-1-n.length),P=U*U*4;switch(r.type){case i.Constants.TEXTURETYPE_UNSIGNED_INT:M=new Uint8Array(P);break;case i.Constants.TEXTURETYPE_HALF_FLOAT:M=new Uint16Array(P);break;case i.Constants.TEXTURETYPE_FLOAT:M=new Float32Array(P)}for(_=n.length;_<s;_++)for(var b=0;b<6;b++)u._uploadArrayBufferViewToTexture(r,M,b,_)}return Promise.all(m).then(function(){f&&(u._releaseFramebufferObjects(f),f._swapAndDie(r)),d&&d.dispose(),T&&(r._lodTextureHigh&&r._lodTextureHigh._texture&&(r._lodTextureHigh._texture.isReady=!0),r._lodTextureMid&&r._lodTextureMid._texture&&(r._lodTextureMid._texture.isReady=!0),r._lodTextureLow&&r._lodTextureLow._texture&&(r._lodTextureLow._texture.isReady=!0))})},c.UploadEnvSpherical=function(e,t){1!==t.version&&u.Logger.Warn('Unsupported babylon environment map version "'+t.version+'"');var a=t.irradiance;if(a){var o=new n.SphericalPolynomial;r.Vector3.FromArrayToRef(a.x,0,o.x),r.Vector3.FromArrayToRef(a.y,0,o.y),r.Vector3.FromArrayToRef(a.z,0,o.z),r.Vector3.FromArrayToRef(a.xx,0,o.xx),r.Vector3.FromArrayToRef(a.yy,0,o.yy),r.Vector3.FromArrayToRef(a.zz,0,o.zz),r.Vector3.FromArrayToRef(a.yz,0,o.yz),r.Vector3.FromArrayToRef(a.zx,0,o.zx),r.Vector3.FromArrayToRef(a.xy,0,o.xy),e._sphericalPolynomial=o}},c._UpdateRGBDAsync=function(e,r,t,n,o){return e._dataSource=a.InternalTexture.DATASOURCE_CUBERAW_RGBD,e._bufferViewArrayArray=r,e._lodGenerationScale=n,e._lodGenerationOffset=o,e._sphericalPolynomial=t,c.UploadLevelsAsync(e,r).then(function(){e.isReady=!0})},c._MagicBytes=[134,22,135,150,246,214,150,54],c}();exports.EnvironmentTextureTools=c,a.InternalTexture._UpdateRGBDAsync=c._UpdateRGBDAsync;
},{"./tools":"RkuS","../Maths/math":"Iizi","../Maths/math.scalar":"7Iig","../Maths/sphericalPolynomial":"CUgp","../Materials/Textures/internalTexture":"KfUh","../Materials/Textures/baseTexture":"K2LE","../Engines/constants":"vn8z","../scene":"FKAx","../PostProcesses/postProcess":"pczz","../Misc/logger":"Fvml","../Shaders/rgbdEncode.fragment":"gYPO","../Shaders/rgbdDecode.fragment":"Ve8w"}],"7SC7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RawCubeTexture=void 0;var e=u(require("tslib")),t=require("../../Misc/decorators"),r=require("../../Misc/environmentTextureTools"),n=require("../../Materials/Textures/internalTexture"),o=require("../../Materials/Textures/cubeTexture"),i=require("../../Engines/constants");function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}var a=function(o){function u(e,t,r,n,u,a,s,l,c){void 0===n&&(n=i.Constants.TEXTUREFORMAT_RGBA),void 0===u&&(u=i.Constants.TEXTURETYPE_UNSIGNED_INT),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===l&&(l=i.Constants.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===c&&(c=null);var d=o.call(this,"",e)||this;return d._texture=e.getEngine().createRawCubeTexture(t,r,n,u,a,s,l,c),d}return e.__extends(u,o),u.prototype.update=function(e,t,r,n,o){void 0===o&&(o=null),this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,r,n,o)},u.prototype.updateRGBDAsync=function(e,t,r,n){return void 0===t&&(t=null),void 0===r&&(r=.8),void 0===n&&(n=0),u._UpdateRGBDAsync(this._texture,e,t,r,n)},u.prototype.clone=function(){var e=this;return t.SerializationHelper.Clone(function(){var t=e.getScene(),r=e._texture,o=new u(t,r._bufferViewArray,r.width,r.format,r.type,r.generateMipMaps,r.invertY,r.samplingMode,r._compression);return r.dataSource===n.InternalTexture.DATASOURCE_CUBERAW_RGBD&&o.updateRGBDAsync(r._bufferViewArrayArray,r._sphericalPolynomial,r._lodGenerationScale,r._lodGenerationOffset),o},this)},u._UpdateRGBDAsync=function(e,t,o,i,u){return e._dataSource=n.InternalTexture.DATASOURCE_CUBERAW_RGBD,e._bufferViewArrayArray=t,e._lodGenerationScale=i,e._lodGenerationOffset=u,e._sphericalPolynomial=o,r.EnvironmentTextureTools.UploadLevelsAsync(e,t).then(function(){e.isReady=!0})},u}(o.CubeTexture);exports.RawCubeTexture=a;
},{"tslib":"vCxL","../../Misc/decorators":"knvU","../../Misc/environmentTextureTools":"9VJq","../../Materials/Textures/internalTexture":"KfUh","../../Materials/Textures/cubeTexture":"5aEd","../../Engines/constants":"vn8z"}],"+i3Q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EXT_lights_image_based=void 0;var e=require("@babylonjs/core/Maths/math.scalar"),r=require("@babylonjs/core/Maths/sphericalPolynomial"),a=require("@babylonjs/core/Maths/math"),n=require("@babylonjs/core/Materials/Textures/rawCubeTexture"),t=require("../glTFLoader"),o="EXT_lights_image_based",i=function(){function i(e){this.name=o,this.enabled=!0,this._loader=e}return i.prototype.dispose=function(){delete this._loader,delete this._lights},i.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var r=e[this.name];this._lights=r.lights}},i.prototype.loadSceneAsync=function(e,r){var a=this;return t.GLTFLoader.LoadExtensionAsync(e,r,this.name,function(n,o){var i=new Array;i.push(a._loader.loadSceneAsync(e,r)),a._loader.logOpen(""+n);var l=t.ArrayItem.Get(n+"/light",a._lights,o.light);return i.push(a._loadLightAsync("#/extensions/"+a.name+"/lights/"+o.light,l).then(function(e){a._loader.babylonScene.environmentTexture=e})),a._loader.logClose(),Promise.all(i).then(function(){})})},i.prototype._loadLightAsync=function(o,i){var l=this;if(!i._loaded){var s=new Array;this._loader.logOpen(""+o);for(var u=new Array(i.specularImages.length),c=function(e){var r=i.specularImages[e];u[e]=new Array(r.length);for(var a=function(a){var n=o+"/specularImages/"+e+"/"+a;h._loader.logOpen(""+n);var i=r[a],l=t.ArrayItem.Get(n,h._loader.gltf.images,i);s.push(h._loader.loadImageAsync("#/images/"+i,l).then(function(r){u[e][a]=r})),h._loader.logClose()},n=0;n<r.length;n++)a(n)},h=this,d=0;d<i.specularImages.length;d++)c(d);this._loader.logClose(),i._loaded=Promise.all(s).then(function(){var t=new n.RawCubeTexture(l._loader.babylonScene,null,i.specularImageSize);if(i._babylonTexture=t,null!=i.intensity&&(t.level=i.intensity),i.rotation){var o=a.Quaternion.FromArray(i.rotation);l._loader.babylonScene.useRightHandedSystem||(o=a.Quaternion.Inverse(o)),a.Matrix.FromQuaternionToRef(o,t.getReflectionTextureMatrix())}var s=r.SphericalHarmonics.FromArray(i.irradianceCoefficients);s.scale(i.intensity),s.convertIrradianceToLambertianRadiance();var c=r.SphericalPolynomial.FromHarmonics(s),h=(u.length-1)/e.Scalar.Log2(i.specularImageSize);return t.updateRGBDAsync(u,c,h)})}return i._loaded.then(function(){return i._babylonTexture})},i}();exports.EXT_lights_image_based=i,t.GLTFLoader.RegisterExtension(o,function(e){return new i(e)});
},{"@babylonjs/core/Maths/math.scalar":"7Iig","@babylonjs/core/Maths/sphericalPolynomial":"CUgp","@babylonjs/core/Maths/math":"Iizi","@babylonjs/core/Materials/Textures/rawCubeTexture":"7SC7","../glTFLoader":"9HbH"}],"nTY2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DracoCompression=void 0;var e=require("../../Misc/tools"),r=require("../../Meshes/mesh.vertexData"),o=function(){function o(){}return Object.defineProperty(o,"DecoderAvailable",{get:function(){if("undefined"!=typeof DracoDecoderModule)return!0;var e=o.Configuration.decoder;if(e){if(e.wasmUrl&&e.wasmBinaryUrl&&"object"==typeof WebAssembly)return!0;if(e.fallbackUrl)return!0}return!1},enumerable:!0,configurable:!0}),o.prototype.dispose=function(){},o.prototype.decodeMeshAsync=function(e,n){var t=e instanceof ArrayBuffer?new Uint8Array(e):e;return o._GetDecoderModule().then(function(e){var o=e.module,a=new r.VertexData,i=new o.DecoderBuffer;i.Init(t,t.byteLength);var c,l,s=new o.Decoder;try{var d=s.GetEncodedGeometryType(i);switch(d){case o.TRIANGULAR_MESH:c=new o.Mesh,l=s.DecodeBufferToMesh(i,c);break;case o.POINT_CLOUD:c=new o.PointCloud,l=s.DecodeBufferToPointCloud(i,c);break;default:throw new Error("Invalid geometry type "+d)}if(!l.ok()||!c.ptr)throw new Error(l.error_msg());var u=c.num_points();if(d===o.TRIANGULAR_MESH){var f=c.num_faces(),y=new o.DracoInt32Array;try{for(var m=new Uint32Array(3*f),w=0;w<f;w++){s.GetFaceFromMesh(c,w,y);var p=3*w;m[p+0]=y.GetValue(0),m[p+1]=y.GetValue(1),m[p+2]=y.GetValue(2)}a.indices=m}finally{o.destroy(y)}}for(var b in n){var v=n[b],_=s.GetAttributeByUniqueId(c,v),D=new o.DracoFloat32Array;try{s.GetAttributeFloatForAllPoints(c,_,D);var A=new Float32Array(u*_.num_components());for(w=0;w<A.length;w++)A[w]=D.GetValue(w);a.set(A,b)}finally{o.destroy(D)}}}finally{c&&o.destroy(c),o.destroy(s),o.destroy(i)}return a})},o._GetDecoderModule=function(){if(!o._DecoderModulePromise){var e=null,r={};if("undefined"!=typeof DracoDecoderModule)e=Promise.resolve();else{var n=o.Configuration.decoder;n&&(n.wasmUrl&&n.wasmBinaryUrl&&"object"==typeof WebAssembly?e=Promise.all([o._LoadScriptAsync(n.wasmUrl),o._LoadFileAsync(n.wasmBinaryUrl).then(function(e){r.wasmBinary=e})]):n.fallbackUrl&&(e=o._LoadScriptAsync(n.fallbackUrl)))}if(!e)throw new Error("Draco decoder module is not available");o._DecoderModulePromise=e.then(function(){return new Promise(function(e){r.onModuleLoaded=function(r){e({module:r})},DracoDecoderModule(r)})})}return o._DecoderModulePromise},o._LoadScriptAsync=function(r){return new Promise(function(o,n){e.Tools.LoadScript(r,function(){o()},function(e){n(new Error(e))})})},o._LoadFileAsync=function(r){return new Promise(function(o,n){e.Tools.LoadFile(r,function(e){o(e)},void 0,void 0,!0,function(e,r){n(r)})})},o.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},o}();exports.DracoCompression=o;
},{"../../Misc/tools":"RkuS","../../Meshes/mesh.vertexData":"+kld"}],"6yhU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KHR_draco_mesh_compression=void 0;var e=require("@babylonjs/core/Meshes/Compression/dracoCompression"),r=require("@babylonjs/core/Meshes/buffer"),o=require("@babylonjs/core/Meshes/geometry"),n=require("../glTFLoader"),s="KHR_draco_mesh_compression",t=function(){function t(r){this.name=s,this.enabled=e.DracoCompression.DecoderAvailable,this._loader=r}return t.prototype.dispose=function(){this._dracoCompression&&(this._dracoCompression.dispose(),delete this._dracoCompression),delete this._loader},t.prototype._loadVertexDataAsync=function(s,t,i){var a=this;return n.GLTFLoader.LoadExtensionAsync(s,t,this.name,function(d,c){if(null!=t.mode){if(5!==t.mode&&4!==t.mode)throw new Error(s+": Unsupported mode "+t.mode);if(5===t.mode)throw new Error(s+": Mode "+t.mode+" is not currently supported")}var f={},u=function(e,r){var o=c.attributes[e];null!=o&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(r)&&i._delayInfo.push(r),f[r]=o)};u("POSITION",r.VertexBuffer.PositionKind),u("NORMAL",r.VertexBuffer.NormalKind),u("TANGENT",r.VertexBuffer.TangentKind),u("TEXCOORD_0",r.VertexBuffer.UVKind),u("TEXCOORD_1",r.VertexBuffer.UV2Kind),u("JOINTS_0",r.VertexBuffer.MatricesIndicesKind),u("WEIGHTS_0",r.VertexBuffer.MatricesWeightsKind),u("COLOR_0",r.VertexBuffer.ColorKind);var l=n.ArrayItem.Get(d,a._loader.gltf.bufferViews,c.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=a._loader.loadBufferViewAsync("#/bufferViews/"+l.index,l).then(function(r){return a._dracoCompression||(a._dracoCompression=new e.DracoCompression),a._dracoCompression.decodeMeshAsync(r,f).then(function(e){var r=new o.Geometry(i.name,a._loader.babylonScene);return e.applyToGeometry(r),r}).catch(function(e){throw new Error(s+": "+e.message)})})),l._dracoBabylonGeometry})},t}();exports.KHR_draco_mesh_compression=t,n.GLTFLoader.RegisterExtension(s,function(e){return new t(e)});
},{"@babylonjs/core/Meshes/Compression/dracoCompression":"nTY2","@babylonjs/core/Meshes/buffer":"YHhW","@babylonjs/core/Meshes/geometry":"QQcI","../glTFLoader":"9HbH"}],"8Hbg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DirectionalLight=void 0;var t=s(require("tslib")),o=require("../Misc/decorators"),e=require("../Maths/math"),r=require("../node"),i=require("./light"),h=require("./shadowLight");function s(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,e):{};r.get||r.set?Object.defineProperty(o,e,r):o[e]=t[e]}return o.default=t,o}r.Node.AddNodeConstructor("Light_Type_1",function(t,o){return function(){return new a(t,e.Vector3.Zero(),o)}});var a=function(r){function h(t,o,e){var i=r.call(this,t,e)||this;return i._shadowFrustumSize=0,i._shadowOrthoScale=.1,i.autoUpdateExtends=!0,i._orthoLeft=Number.MAX_VALUE,i._orthoRight=Number.MIN_VALUE,i._orthoTop=Number.MIN_VALUE,i._orthoBottom=Number.MAX_VALUE,i.position=o.scale(-1),i.direction=o,i}return t.__extends(h,r),Object.defineProperty(h.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(t){this._shadowFrustumSize=t,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(t){this._shadowOrthoScale=t,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),h.prototype.getClassName=function(){return"DirectionalLight"},h.prototype.getTypeID=function(){return i.Light.LIGHTTYPEID_DIRECTIONALLIGHT},h.prototype._setDefaultShadowProjectionMatrix=function(t,o,e){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(t):this._setDefaultAutoExtendShadowProjectionMatrix(t,o,e)},h.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(t){var o=this.getScene().activeCamera;o&&e.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:o.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,t)},h.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(t,o,r){var i=this.getScene().activeCamera;if(i){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var h=e.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var s=0;s<r.length;s++){var a=r[s];if(a)for(var n=a.getBoundingInfo().boundingBox,u=0;u<n.vectorsWorld.length;u++)e.Vector3.TransformCoordinatesToRef(n.vectorsWorld[u],o,h),h.x<this._orthoLeft&&(this._orthoLeft=h.x),h.y<this._orthoBottom&&(this._orthoBottom=h.y),h.x>this._orthoRight&&(this._orthoRight=h.x),h.y>this._orthoTop&&(this._orthoTop=h.y)}}var f=this._orthoRight-this._orthoLeft,d=this._orthoTop-this._orthoBottom;e.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-f*this.shadowOrthoScale,this._orthoRight+f*this.shadowOrthoScale,this._orthoBottom-d*this.shadowOrthoScale,this._orthoTop+d*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:i.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:i.maxZ,t)}},h.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},h.prototype.transferToEffect=function(t,o){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,o),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,o),this)},h.prototype.getDepthMinZ=function(t){return 1},h.prototype.getDepthMaxZ=function(t){return 1},h.prototype.prepareLightSpecificDefines=function(t,o){t["DIRLIGHT"+o]=!0},t.__decorate([(0,o.serialize)()],h.prototype,"shadowFrustumSize",null),t.__decorate([(0,o.serialize)()],h.prototype,"shadowOrthoScale",null),t.__decorate([(0,o.serialize)()],h.prototype,"autoUpdateExtends",void 0),h}(h.ShadowLight);exports.DirectionalLight=a;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi","../node":"P+He","./light":"U3iz","./shadowLight":"S8Iy"}],"BHDn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PointLight=void 0;var t=s(require("tslib")),e=require("../Misc/decorators"),r=require("../Maths/math"),i=require("../node"),o=require("./light"),n=require("./shadowLight");function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var i=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,r):{};i.get||i.set?Object.defineProperty(e,r,i):e[r]=t[r]}return e.default=t,e}i.Node.AddNodeConstructor("Light_Type_0",function(t,e){return function(){return new a(t,r.Vector3.Zero(),e)}});var a=function(i){function n(t,e,r){var o=i.call(this,t,r)||this;return o._shadowAngle=Math.PI/2,o.position=e,o}return t.__extends(n,i),Object.defineProperty(n.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(t){this._shadowAngle=t,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"direction",{get:function(){return this._direction},set:function(t){var e=this.needCube();this._direction=t,this.needCube()!==e&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),n.prototype.getClassName=function(){return"PointLight"},n.prototype.getTypeID=function(){return o.Light.LIGHTTYPEID_POINTLIGHT},n.prototype.needCube=function(){return!this.direction},n.prototype.getShadowDirection=function(t){if(this.direction)return i.prototype.getShadowDirection.call(this,t);switch(t){case 0:return new r.Vector3(1,0,0);case 1:return new r.Vector3(-1,0,0);case 2:return new r.Vector3(0,-1,0);case 3:return new r.Vector3(0,1,0);case 4:return new r.Vector3(0,0,1);case 5:return new r.Vector3(0,0,-1)}return r.Vector3.Zero()},n.prototype._setDefaultShadowProjectionMatrix=function(t,e,i){var o=this.getScene().activeCamera;o&&r.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(o),this.getDepthMaxZ(o),t)},n.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},n.prototype.transferToEffect=function(t,e){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,e):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,e),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,e),this},n.prototype.prepareLightSpecificDefines=function(t,e){t["POINTLIGHT"+e]=!0},t.__decorate([(0,e.serialize)()],n.prototype,"shadowAngle",null),n}(n.ShadowLight);exports.PointLight=a;
},{"tslib":"vCxL","../Misc/decorators":"knvU","../Maths/math":"Iizi","../node":"P+He","./light":"U3iz","./shadowLight":"S8Iy"}],"dbAE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KHR_lights=void 0;var e,t=require("@babylonjs/core/Maths/math"),o=require("@babylonjs/core/Lights/directionalLight"),r=require("@babylonjs/core/Lights/pointLight"),n=require("@babylonjs/core/Lights/spotLight"),i=require("@babylonjs/core/Lights/light"),a=require("../glTFLoader"),s="KHR_lights_punctual";!function(e){e.DIRECTIONAL="directional",e.POINT="point",e.SPOT="spot"}(e||(e={}));var l=function(){function l(e){this.name=s,this.enabled=!0,this._loader=e}return l.prototype.dispose=function(){delete this._loader,delete this._lights},l.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},l.prototype.loadNodeAsync=function(s,l,c){var h=this;return a.GLTFLoader.LoadExtensionAsync(s,l,this.name,function(d,g){return h._loader.loadNodeAsync(s,l,function(s){var l,u=a.ArrayItem.Get(d,h._lights,g.light),p=u.name||s.name;switch(u.type){case e.DIRECTIONAL:l=new o.DirectionalLight(p,t.Vector3.Backward(),h._loader.babylonScene);break;case e.POINT:l=new r.PointLight(p,t.Vector3.Zero(),h._loader.babylonScene);break;case e.SPOT:var L=new n.SpotLight(p,t.Vector3.Zero(),t.Vector3.Backward(),0,1,h._loader.babylonScene);L.angle=2*(u.spot&&u.spot.outerConeAngle||Math.PI/4),L.innerAngle=2*(u.spot&&u.spot.innerConeAngle||0),l=L;break;default:throw new Error(d+": Invalid light type ("+u.type+")")}l.falloffType=i.Light.FALLOFF_GLTF,l.diffuse=u.color?t.Color3.FromArray(u.color):t.Color3.White(),l.intensity=null==u.intensity?1:u.intensity,l.range=null==u.range?Number.MAX_VALUE:u.range,l.parent=s,a.GLTFLoader.AddPointerMetadata(l,d),c(s)})})},l}();exports.KHR_lights=l,a.GLTFLoader.RegisterExtension(s,function(e){return new l(e)});
},{"@babylonjs/core/Maths/math":"Iizi","@babylonjs/core/Lights/directionalLight":"8Hbg","@babylonjs/core/Lights/pointLight":"BHDn","@babylonjs/core/Lights/spotLight":"mO+F","@babylonjs/core/Lights/light":"U3iz","../glTFLoader":"9HbH"}],"Zq79":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KHR_materials_pbrSpecularGlossiness=void 0;var e=require("@babylonjs/core/Maths/math"),r=require("@babylonjs/core/Materials/PBR/pbrMaterial"),s=require("../glTFLoader"),o="KHR_materials_pbrSpecularGlossiness",t=function(){function t(e){this.name=o,this.enabled=!0,this._loader=e}return t.prototype.dispose=function(){delete this._loader},t.prototype.loadMaterialPropertiesAsync=function(e,r,o){var t=this;return s.GLTFLoader.LoadExtensionAsync(e,r,this.name,function(s,a){var l=new Array;return l.push(t._loader.loadMaterialBasePropertiesAsync(e,r,o)),l.push(t._loadSpecularGlossinessPropertiesAsync(s,r,a,o)),t._loader.loadMaterialAlphaProperties(e,r,o),Promise.all(l).then(function(){})})},t.prototype._loadSpecularGlossinessPropertiesAsync=function(s,o,t,a){if(!(a instanceof r.PBRMaterial))throw new Error(s+": Material type not supported");var l=new Array;return a.metallic=null,a.roughness=null,t.diffuseFactor?(a.albedoColor=e.Color3.FromArray(t.diffuseFactor),a.alpha=t.diffuseFactor[3]):a.albedoColor=e.Color3.White(),a.reflectivityColor=t.specularFactor?e.Color3.FromArray(t.specularFactor):e.Color3.White(),a.microSurface=null==t.glossinessFactor?1:t.glossinessFactor,t.diffuseTexture&&l.push(this._loader.loadTextureInfoAsync(s+"/diffuseTexture",t.diffuseTexture,function(e){e.name=a.name+" (Diffuse)",a.albedoTexture=e})),t.specularGlossinessTexture&&(l.push(this._loader.loadTextureInfoAsync(s+"/specularGlossinessTexture",t.specularGlossinessTexture,function(e){e.name=a.name+" (Specular Glossiness)",a.reflectivityTexture=e})),a.reflectivityTexture.hasAlpha=!0,a.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(l).then(function(){})},t}();exports.KHR_materials_pbrSpecularGlossiness=t,s.GLTFLoader.RegisterExtension(o,function(e){return new t(e)});
},{"@babylonjs/core/Maths/math":"Iizi","@babylonjs/core/Materials/PBR/pbrMaterial":"0yWt","../glTFLoader":"9HbH"}],"AhoU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KHR_materials_unlit=void 0;var e=require("@babylonjs/core/Maths/math"),r=require("@babylonjs/core/Materials/PBR/pbrMaterial"),o=require("../glTFLoader"),t="KHR_materials_unlit",a=function(){function a(e){this.name=t,this.enabled=!0,this._loader=e}return a.prototype.dispose=function(){delete this._loader},a.prototype.loadMaterialPropertiesAsync=function(e,r,t){var a=this;return o.GLTFLoader.LoadExtensionAsync(e,r,this.name,function(){return a._loadUnlitPropertiesAsync(e,r,t)})},a.prototype._loadUnlitPropertiesAsync=function(o,t,a){if(!(a instanceof r.PBRMaterial))throw new Error(o+": Material type not supported");var n=new Array;a.unlit=!0;var i=t.pbrMetallicRoughness;return i&&(i.baseColorFactor?(a.albedoColor=e.Color3.FromArray(i.baseColorFactor),a.alpha=i.baseColorFactor[3]):a.albedoColor=e.Color3.White(),i.baseColorTexture&&n.push(this._loader.loadTextureInfoAsync(o+"/baseColorTexture",i.baseColorTexture,function(e){e.name=a.name+" (Base Color)",a.albedoTexture=e}))),t.doubleSided&&(a.backFaceCulling=!1,a.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(o,t,a),Promise.all(n).then(function(){})},a}();exports.KHR_materials_unlit=a,o.GLTFLoader.RegisterExtension(t,function(e){return new a(e)});
},{"@babylonjs/core/Maths/math":"Iizi","@babylonjs/core/Materials/PBR/pbrMaterial":"0yWt","../glTFLoader":"9HbH"}],"NhEI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KHR_texture_transform=void 0;var e=require("@babylonjs/core/Materials/Textures/texture"),t=require("../glTFLoader"),o="KHR_texture_transform",r=function(){function r(e){this.name=o,this.enabled=!0,this._loader=e}return r.prototype.dispose=function(){delete this._loader},r.prototype.loadTextureInfoAsync=function(o,r,n){var s=this;return t.GLTFLoader.LoadExtensionAsync(o,r,this.name,function(t,a){return s._loader.loadTextureInfoAsync(o,r,function(o){if(!(o instanceof e.Texture))throw new Error(t+": Texture type not supported");a.offset&&(o.uOffset=a.offset[0],o.vOffset=a.offset[1]),o.uRotationCenter=0,o.vRotationCenter=0,a.rotation&&(o.wAng=-a.rotation),a.scale&&(o.uScale=a.scale[0],o.vScale=a.scale[1]),null!=a.texCoord&&(o.coordinatesIndex=a.texCoord),n(o)})})},r}();exports.KHR_texture_transform=r,t.GLTFLoader.RegisterExtension(o,function(e){return new r(e)});
},{"@babylonjs/core/Materials/Textures/texture":"KNsj","../glTFLoader":"9HbH"}],"T/0a":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sound=void 0;var e=require("../Misc/tools"),t=require("../Misc/observable"),n=require("../Maths/math"),i=require("../Engines/engine"),o=require("../Misc/logger"),s=function(){function s(a,r,u,d,h){void 0===d&&(d=null);var c=this;if(this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.onEndedObservable=new t.Observable,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=n.Vector3.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new n.Vector3(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=a,this._scene=u,s._SceneComponentInitialization(u),this._readyToPlayCallback=d,this._customAttenuationFunction=function(e,t,n,i,o){return t<n?e*(1-t/n):0},h&&(this.autoplay=h.autoplay||!1,this.loop=h.loop||!1,void 0!==h.volume&&(this._volume=h.volume),this.spatialSound=h.spatialSound||!1,this.maxDistance=h.maxDistance||100,this.useCustomAttenuation=h.useCustomAttenuation||!1,this.rolloffFactor=h.rolloffFactor||1,this.refDistance=h.refDistance||1,this.distanceModel=h.distanceModel||"linear",this._playbackRate=h.playbackRate||1,this._streaming=h.streaming||!1),i.Engine.audioEngine.canUseWebAudio&&i.Engine.audioEngine.audioContext){this._soundGain=i.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var l=!0;if(r)try{"string"==typeof r?this._urlType="String":r instanceof ArrayBuffer?this._urlType="ArrayBuffer":r instanceof MediaStream?this._urlType="MediaStream":Array.isArray(r)&&(this._urlType="Array");var _=[],p=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=i.Engine.audioEngine.audioContext.createMediaElementSource(r),this.autoplay&&this.play(),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":r.byteLength>0&&(p=!0,this._soundLoaded(r));break;case"String":_.push(r);case"Array":0===_.length&&(_=r);for(var g=0;g<_.length;g++){var f=_[g];if(-1!==f.indexOf(".mp3",f.length-4)&&i.Engine.audioEngine.isMP3supported&&(p=!0),-1!==f.indexOf(".ogg",f.length-4)&&i.Engine.audioEngine.isOGGsupported&&(p=!0),-1!==f.indexOf(".wav",f.length-4)&&(p=!0),-1!==f.indexOf("blob:")&&(p=!0),p){this._streaming?(this._htmlAudioElement=new Audio(f),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,e.Tools.SetCorsBehavior(f,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){c._isReadyToPlay=!0,c.autoplay&&c.play(),c._readyToPlayCallback&&c._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(f,function(e){c._soundLoaded(e)},void 0,!0,!0,function(e){e&&o.Logger.Error("XHR "+e.status+" error on: "+f+"."),o.Logger.Error("Sound creation aborted."),c._scene.mainSoundTrack.RemoveSound(c)});break}}break;default:l=!1}l?p||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){c._readyToPlayCallback&&c._readyToPlayCallback()},1e3)):o.Logger.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(m){o.Logger.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.RemoveSound(this)}}else this._scene.mainSoundTrack.AddSound(this),i.Engine.audioEngine.WarnedWebAudioUnsupported||(o.Logger.Error("Web Audio is not supported by your browser."),i.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){c._readyToPlayCallback&&c._readyToPlayCallback()},1e3)}return s.prototype.dispose=function(){i.Engine.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},s.prototype.isReady=function(){return this._isReadyToPlay},s.prototype._soundLoaded=function(e){var t=this;i.Engine.audioEngine.audioContext&&i.Engine.audioEngine.audioContext.decodeAudioData(e,function(e){t._audioBuffer=e,t._isReadyToPlay=!0,t.autoplay&&t.play(),t._readyToPlayCallback&&t._readyToPlayCallback()},function(e){o.Logger.Error("Error while decoding audio data for: "+t.name+" / Error: "+e)})},s.prototype.setAudioBuffer=function(e){i.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=e,this._isReadyToPlay=!0)},s.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},s.prototype._createSpatialParameters=function(){i.Engine.audioEngine.canUseWebAudio&&i.Engine.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=i.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner)},s.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},s.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},s.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},s.prototype._switchPanningModel=function(){i.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},s.prototype.connectToSoundTrackAudioNode=function(e){i.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(e),this._isOutputConnected=!0)},s.prototype.setDirectionalCone=function(e,t,n){t<e?o.Logger.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=e,this._coneOuterAngle=t,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play()))},Object.defineProperty(s.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(e){if(e!=this._coneInnerAngle){if(this._coneOuterAngle<e)return void o.Logger.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e,i.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(e){if(e!=this._coneOuterAngle){if(e<this._coneInnerAngle)return void o.Logger.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e,i.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!0,configurable:!0}),s.prototype.setPosition=function(e){this._position=e,i.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},s.prototype.setLocalDirectionToMesh=function(e){this._localDirection=e,i.Engine.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},s.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var e=this._connectedTransformNode.getWorldMatrix(),t=n.Vector3.TransformNormal(this._localDirection,e);t.normalize(),this._soundPanner.setOrientation(t.x,t.y,t.z)}},s.prototype.updateDistanceFromListener=function(){if(i.Engine.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var e=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,e,this.maxDistance,this.refDistance,this.rolloffFactor)}},s.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},s.prototype.play=function(e,t){var n=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&i.Engine.audioEngine.audioContext)try{this._startOffset<0&&(e=-this._startOffset,this._startOffset=0);var s=e?i.Engine.audioEngine.audioContext.currentTime+e:i.Engine.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=i.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){n._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){var a=function(){if(i.Engine.audioEngine.unlocked){var e=n._htmlAudioElement.play();void 0!==e&&e.catch(function(e){i.Engine.audioEngine.lock(),i.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){a()})})}else i.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){a()})};a()}}else this._soundSource=i.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){n._onended()},this._soundSource.buffer&&this._soundSource.start(s,this.isPaused?this._startOffset%this._soundSource.buffer.duration:t||0);this._startTime=s,this.isPlaying=!0,this.isPaused=!1}catch(r){o.Logger.Error("Error while trying to play audio: "+this.name+", "+r.message)}},s.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},s.prototype.stop=function(e){if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect();else if(i.Engine.audioEngine.audioContext&&this._soundSource){var t=e?i.Engine.audioEngine.audioContext.currentTime+e:i.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(t),this._soundSource.onended=function(){},this.isPaused||(this._startOffset=0)}this.isPlaying=!1}},s.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():i.Engine.audioEngine.audioContext&&(this.stop(0),this._startOffset+=i.Engine.audioEngine.audioContext.currentTime-this._startTime))},s.prototype.setVolume=function(e,t){i.Engine.audioEngine.canUseWebAudio&&this._soundGain&&(t&&i.Engine.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(i.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,i.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(e,i.Engine.audioEngine.audioContext.currentTime+t)):this._soundGain.gain.value=e),this._volume=e},s.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},s.prototype.getVolume=function(){return this._volume},s.prototype.attachToMesh=function(e){var t=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},s.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},s.prototype._onRegisterAfterWorldMatrixUpdate=function(e){if(e.getBoundingInfo){var t=e;if(this._positionInEmitterSpace)t.worldMatrixFromCache.invertToRef(n.Tmp.Matrix[0]),this.setPosition(n.Tmp.Matrix[0].getTranslation());else{var o=t.getBoundingInfo();this.setPosition(o.boundingSphere.centerWorld)}i.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},s.prototype.clone=function(){var e=this;if(this._streaming)return null;var t=function(){e._isReadyToPlay?(i._audioBuffer=e.getAudioBuffer(),i._isReadyToPlay=!0,i.autoplay&&i.play()):window.setTimeout(t,300)},n={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},i=new s(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,n);return this.useCustomAttenuation&&i.setAttenuationFunction(this._customAttenuationFunction),i.setPosition(this._position),i.setPlaybackRate(this._playbackRate),t(),i},s.prototype.getAudioBuffer=function(){return this._audioBuffer},s.prototype.serialize=function(){var e={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedTransformNode&&(e.connectedMeshId=this._connectedTransformNode.id),e.position=this._position.asArray(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.asArray(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e},s.Parse=function(e,t,i,o){var a,r=e.name;a=e.url?i+e.url:i+r;var u,d={autoplay:e.autoplay,loop:e.loop,volume:e.volume,spatialSound:e.spatialSound,maxDistance:e.maxDistance,rolloffFactor:e.rolloffFactor,refDistance:e.refDistance,distanceModel:e.distanceModel,playbackRate:e.playbackRate};if(o){var h=function(){o._isReadyToPlay?(u._audioBuffer=o.getAudioBuffer(),u._isReadyToPlay=!0,u.autoplay&&u.play()):window.setTimeout(h,300)};u=new s(r,new ArrayBuffer(0),t,null,d),h()}else u=new s(r,a,t,function(){t._removePendingData(u)},d),t._addPendingData(u);if(e.position){var c=n.Vector3.FromArray(e.position);u.setPosition(c)}if(e.isDirectional&&(u.setDirectionalCone(e.coneInnerAngle||360,e.coneOuterAngle||360,e.coneOuterGain||0),e.localDirectionToMesh)){var l=n.Vector3.FromArray(e.localDirectionToMesh);u.setLocalDirectionToMesh(l)}if(e.connectedMeshId){var _=t.getMeshByID(e.connectedMeshId);_&&u.attachToMesh(_)}return u},s._SceneComponentInitialization=function(e){throw"Import AudioSceneComponent before creating sound."},s}();exports.Sound=s;
},{"../Misc/tools":"RkuS","../Misc/observable":"gtkL","../Maths/math":"Iizi","../Engines/engine":"Z5lb","../Misc/logger":"Fvml"}],"Y3BJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WeightedSound=void 0;var e=require("../Misc/logger"),t=function(){function t(e,t,n){var i=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=n;for(var o=0,r=0,s=n;r<s.length;r++){o+=s[r]}for(var u=o>0?1/o:0,h=0;h<this._weights.length;h++)this._weights[h]*=u;this._sounds=t;for(var l=0,d=this._sounds;l<d.length;l++){d[l].onEndedObservable.add(function(){i._onended()})}}return Object.defineProperty(t.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void e.Logger.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(var n=0,i=this._sounds;n<i.length;n++){i[n].directionalConeInnerAngle=t}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void e.Logger.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(var n=0,i=this._sounds;n<i.length;n++){i[n].directionalConeOuterAngle=t}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){if(e!==this._volume)for(var t=0,n=this._sounds;t<n.length;t++){n[t].setVolume(e)}},enumerable:!0,configurable:!0}),t.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},t.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},t.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},t.prototype.play=function(e){if(!this.isPaused){this.stop();for(var t=Math.random(),n=0,i=0;i<this._weights.length;i++)if(t<=(n+=this._weights[i])){this._currentIndex=i;break}}var o=this._sounds[this._currentIndex];o.isReady()?o.play(0,this.isPaused?void 0:e):o.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},t}();exports.WeightedSound=t;
},{"../Misc/logger":"Fvml"}],"tqha":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MSFT_audio_emitter=void 0;var e=require("@babylonjs/core/Maths/math"),n=require("@babylonjs/core/Misc/tools"),t=require("@babylonjs/core/Animations/animation"),o=require("@babylonjs/core/Audio/sound"),r=require("@babylonjs/core/Audio/weightedsound"),i=require("../glTFLoader"),a="MSFT_audio_emitter",s=function(){function s(e){this.name=a,this.enabled=!0,this._loader=e}return s.prototype.dispose=function(){delete this._loader,delete this._clips,delete this._emitters},s.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var n=e[this.name];this._clips=n.clips,this._emitters=n.emitters,i.ArrayItem.Assign(this._clips),i.ArrayItem.Assign(this._emitters)}},s.prototype.loadSceneAsync=function(e,n){var t=this;return i.GLTFLoader.LoadExtensionAsync(e,n,this.name,function(o,r){var a=new Array;a.push(t._loader.loadSceneAsync(e,n));for(var s=0,l=r.emitters;s<l.length;s++){var u=l[s],c=i.ArrayItem.Get(o+"/emitters",t._emitters,u);if(null!=c.refDistance||null!=c.maxDistance||null!=c.rolloffFactor||null!=c.distanceModel||null!=c.innerAngle||null!=c.outerAngle)throw new Error(o+": Direction or Distance properties are not allowed on emitters attached to a scene");a.push(t._loadEmitterAsync(o+"/emitters/"+c.index,c))}return Promise.all(a).then(function(){})})},s.prototype.loadNodeAsync=function(t,o,r){var a=this;return i.GLTFLoader.LoadExtensionAsync(t,o,this.name,function(t,s){var l=new Array;return a._loader.loadNodeAsync(t,o,function(o){for(var u=function(r){var s=i.ArrayItem.Get(t+"/emitters",a._emitters,r);l.push(a._loadEmitterAsync(t+"/emitters/"+s.index,s).then(function(){for(var t=0,r=s._babylonSounds;t<r.length;t++){var i=r[t];i.attachToMesh(o),null==s.innerAngle&&null==s.outerAngle||(i.setLocalDirectionToMesh(e.Vector3.Forward()),i.setDirectionalCone(2*n.Tools.ToDegrees(null==s.innerAngle?Math.PI:s.innerAngle),2*n.Tools.ToDegrees(null==s.outerAngle?Math.PI:s.outerAngle),0))}}))},c=0,d=s.emitters;c<d.length;c++){u(d[c])}r(o)}).then(function(e){return Promise.all(l).then(function(){return e})})})},s.prototype.loadAnimationAsync=function(e,n){var t=this;return i.GLTFLoader.LoadExtensionAsync(e,n,this.name,function(o,r){return t._loader.loadAnimationAsync(e,n).then(function(a){var s=new Array;i.ArrayItem.Assign(r.events);for(var l=0,u=r.events;l<u.length;l++){var c=u[l];s.push(t._loadAnimationEventAsync(o+"/events/"+c.index,e,n,c,a))}return Promise.all(s).then(function(){return a})})})},s.prototype._loadClipAsync=function(e,n){if(n._objectURL)return n._objectURL;var t;if(n.uri)t=this._loader.loadUriAsync(e,n.uri);else{var o=i.ArrayItem.Get(e+"/bufferView",this._loader.gltf.bufferViews,n.bufferView);t=this._loader.loadBufferViewAsync("#/bufferViews/"+o.index,o)}return n._objectURL=t.then(function(e){return URL.createObjectURL(new Blob([e],{type:n.mimeType}))}),n._objectURL},s.prototype._loadEmitterAsync=function(e,t){var a=this;if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){for(var s=new Array,l=t.name||"emitter"+t.index,u={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume},c=function(e){var n="#/extensions/"+d.name+"/clips",r=i.ArrayItem.Get(n,d._clips,t.clips[e].clip);s.push(d._loadClipAsync(n+"/"+t.clips[e].clip,r).then(function(n){var r=t._babylonSounds[e]=new o.Sound(l,n,a._loader.babylonScene,null,u);r.refDistance=t.refDistance||1,r.maxDistance=t.maxDistance||256,r.rolloffFactor=t.rolloffFactor||1,r.distanceModel=t.distanceModel||"exponential",r._positionInEmitterSpace=!0}))},d=this,m=0;m<t.clips.length;m++)c(m);var f=Promise.all(s).then(function(){var e=t.clips.map(function(e){return e.weight||1}),o=new r.WeightedSound(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(o.directionalConeInnerAngle=2*n.Tools.ToDegrees(t.innerAngle)),t.outerAngle&&(o.directionalConeOuterAngle=2*n.Tools.ToDegrees(t.outerAngle)),t.volume&&(o.volume=t.volume),t._babylonData.sound=o});t._babylonData={loaded:f}}return t._babylonData.loaded},s.prototype._getEventAction=function(e,n,t,o,r){switch(t){case"play":return function(e){var t=(r||0)+(e-o);n.play(t)};case"stop":return function(e){n.stop()};case"pause":return function(e){n.pause()};default:throw new Error(e+": Unsupported action "+t)}},s.prototype._loadAnimationEventAsync=function(e,n,o,r,a){var s=this;if(0==a.targetedAnimations.length)return Promise.resolve();var l=a.targetedAnimations[0],u=r.emitter,c=i.ArrayItem.Get("#/extensions/"+this.name+"/emitters",this._emitters,u);return this._loadEmitterAsync(e,c).then(function(){var n=c._babylonData.sound;if(n){var o=new t.AnimationEvent(r.time,s._getEventAction(e,n,r.action,r.time,r.startOffset));l.animation.addEvent(o),a.onAnimationGroupEndObservable.add(function(){n.stop()}),a.onAnimationGroupPauseObservable.add(function(){n.pause()})}})},s}();exports.MSFT_audio_emitter=s,i.GLTFLoader.RegisterExtension(a,function(e){return new s(e)});
},{"@babylonjs/core/Maths/math":"Iizi","@babylonjs/core/Misc/tools":"RkuS","@babylonjs/core/Animations/animation":"8SP4","@babylonjs/core/Audio/sound":"T/0a","@babylonjs/core/Audio/weightedsound":"Y3BJ","../glTFLoader":"9HbH"}],"ZDGC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MSFT_lod=void 0;var e=require("@babylonjs/core/Misc/observable"),r=require("@babylonjs/core/Misc/deferred"),n=require("../glTFLoader"),o="MSFT_lod",a=function(){function a(r){this.name=o,this.enabled=!0,this.maxLODsToLoad=Number.MAX_VALUE,this.onNodeLODsLoadedObservable=new e.Observable,this.onMaterialLODsLoadedObservable=new e.Observable,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._loader=r}return a.prototype.dispose=function(){delete this._loader,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},a.prototype.onReady=function(){for(var e=this,r=function(r){var o=Promise.all(n._nodePromiseLODs[r]).then(function(){0!==r&&e._loader.endPerformanceCounter("Node LOD "+r),e._loader.log("Loaded node LOD "+r),e.onNodeLODsLoadedObservable.notifyObservers(r),r!==e._nodePromiseLODs.length-1&&(e._loader.startPerformanceCounter("Node LOD "+(r+1)),e._nodeSignalLODs[r]&&e._nodeSignalLODs[r].resolve())});n._loader._completePromises.push(o)},n=this,o=0;o<this._nodePromiseLODs.length;o++)r(o);var a=function(r){var n=Promise.all(t._materialPromiseLODs[r]).then(function(){0!==r&&e._loader.endPerformanceCounter("Material LOD "+r),e._loader.log("Loaded material LOD "+r),e.onMaterialLODsLoadedObservable.notifyObservers(r),r!==e._materialPromiseLODs.length-1&&(e._loader.startPerformanceCounter("Material LOD "+(r+1)),e._materialSignalLODs[r]&&e._materialSignalLODs[r].resolve())});t._loader._completePromises.push(n)},t=this;for(o=0;o<this._materialPromiseLODs.length;o++)a(o)},a.prototype.loadNodeAsync=function(e,o,a){var t=this;return n.GLTFLoader.LoadExtensionAsync(e,o,this.name,function(e,n){var a,s=t._getLODs(e,o,t._loader.gltf.nodes,n.ids);t._loader.logOpen(""+e);for(var i=function(e){var n=s[e];0!==e&&(t._nodeIndexLOD=e,t._nodeSignalLODs[e]=t._nodeSignalLODs[e]||new r.Deferred);var o=t._loader.loadNodeAsync("#/nodes/"+n.index,n,function(e){e.setEnabled(!1)}).then(function(r){if(0!==e){var n=s[e-1];n._babylonTransformNode&&(n._babylonTransformNode.dispose(),delete n._babylonTransformNode,t._disposeUnusedMaterials())}return r.setEnabled(!0),r});0===e?a=o:t._nodeIndexLOD=null,t._nodePromiseLODs[e]=t._nodePromiseLODs[e]||[],t._nodePromiseLODs[e].push(o)},l=0;l<s.length;l++)i(l);return t._loader.logClose(),a})},a.prototype._loadMaterialAsync=function(e,r,o,a,t){var s=this;return this._nodeIndexLOD?null:n.GLTFLoader.LoadExtensionAsync(e,r,this.name,function(e,n){var i,l=s._getLODs(e,r,s._loader.gltf.materials,n.ids);s._loader.logOpen(""+e);for(var d=function(e){var r=l[e];0!==e&&(s._materialIndexLOD=e);var n=s._loader._loadMaterialAsync("#/materials/"+r.index,r,o,a,function(r){0===e&&t(r)}).then(function(r){if(0!==e){t(r);var n=l[e-1]._data;n[a]&&(n[a].babylonMaterial.dispose(),delete n[a])}return r});0===e?i=n:s._materialIndexLOD=null,s._materialPromiseLODs[e]=s._materialPromiseLODs[e]||[],s._materialPromiseLODs[e].push(n)},_=0;_<l.length;_++)d(_);return s._loader.logClose(),i})},a.prototype._loadUriAsync=function(e,n){var o=this;if(null!==this._materialIndexLOD){this._loader.log("deferred");var a=this._materialIndexLOD-1;return this._materialSignalLODs[a]=this._materialSignalLODs[a]||new r.Deferred,this._materialSignalLODs[a].promise.then(function(){return o._loader.loadUriAsync(e,n)})}if(null!==this._nodeIndexLOD){this._loader.log("deferred");a=this._nodeIndexLOD-1;return this._nodeSignalLODs[a]=this._nodeSignalLODs[a]||new r.Deferred,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return o._loader.loadUriAsync(e,n)})}return null},a.prototype._getLODs=function(e,r,o,a){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var t=new Array,s=a.length-1;s>=0;s--)if(t.push(n.ArrayItem.Get(e+"/ids/"+a[s],o,a[s])),t.length===this.maxLODsToLoad)return t;return t.push(r),t},a.prototype._disposeUnusedMaterials=function(){var e=this._loader.gltf.materials;if(e)for(var r=0,n=e;r<n.length;r++){var o=n[r];if(o._data)for(var a in o._data){var t=o._data[a];0===t.babylonMeshes.length&&(t.babylonMaterial.dispose(!1,!0),delete o._data[a])}}},a}();exports.MSFT_lod=a,n.GLTFLoader.RegisterExtension(o,function(e){return new a(e)});
},{"@babylonjs/core/Misc/observable":"gtkL","@babylonjs/core/Misc/deferred":"zhzd","../glTFLoader":"9HbH"}],"bCaZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MSFT_minecraftMesh=void 0;var e=require("@babylonjs/core/Materials/PBR/pbrMaterial"),r=require("../glTFLoader"),t="MSFT_minecraftMesh",i=function(){function i(e){this.name=t,this.enabled=!0,this._loader=e}return i.prototype.dispose=function(){delete this._loader},i.prototype.loadMaterialPropertiesAsync=function(t,i,n){var a=this;return r.GLTFLoader.LoadExtraAsync(t,i,this.name,function(r,o){if(o){if(!(n instanceof e.PBRMaterial))throw new Error(r+": Material type not supported");var s=a._loader.loadMaterialPropertiesAsync(t,i,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.backFaceCulling=n.forceDepthWrite,n.twoSidedLighting=!0,s}return null})},i}();exports.MSFT_minecraftMesh=i,r.GLTFLoader.RegisterExtension(t,function(e){return new i(e)});
},{"@babylonjs/core/Materials/PBR/pbrMaterial":"0yWt","../glTFLoader":"9HbH"}],"hfn8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MSFT_sRGBFactors=void 0;var e=require("@babylonjs/core/Materials/PBR/pbrMaterial"),r=require("../glTFLoader"),t="MSFT_sRGBFactors",o=function(){function o(e){this.name=t,this.enabled=!0,this._loader=e}return o.prototype.dispose=function(){delete this._loader},o.prototype.loadMaterialPropertiesAsync=function(t,o,a){var i=this;return r.GLTFLoader.LoadExtraAsync(t,o,this.name,function(r,n){if(n){if(!(a instanceof e.PBRMaterial))throw new Error(r+": Material type not supported");var s=i._loader.loadMaterialPropertiesAsync(t,o,a);return a.albedoTexture||a.albedoColor.toLinearSpaceToRef(a.albedoColor),a.reflectivityTexture||a.reflectivityColor.toLinearSpaceToRef(a.reflectivityColor),s}return null})},o}();exports.MSFT_sRGBFactors=o,r.GLTFLoader.RegisterExtension(t,function(e){return new o(e)});
},{"@babylonjs/core/Materials/PBR/pbrMaterial":"0yWt","../glTFLoader":"9HbH"}],"W+0l":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./EXT_lights_image_based");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}})});var r=require("./KHR_draco_mesh_compression");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return r[e]}})});var t=require("./KHR_lights_punctual");Object.keys(t).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})});var u=require("./KHR_materials_pbrSpecularGlossiness");Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return u[e]}})});var n=require("./KHR_materials_unlit");Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return n[e]}})});var o=require("./KHR_texture_transform");Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return o[e]}})});var c=require("./MSFT_audio_emitter");Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return c[e]}})});var a=require("./MSFT_lod");Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return a[e]}})});var f=require("./MSFT_minecraftMesh");Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return f[e]}})});var i=require("./MSFT_sRGBFactors");Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return i[e]}})});
},{"./EXT_lights_image_based":"+i3Q","./KHR_draco_mesh_compression":"6yhU","./KHR_lights_punctual":"dbAE","./KHR_materials_pbrSpecularGlossiness":"Zq79","./KHR_materials_unlit":"AhoU","./KHR_texture_transform":"NhEI","./MSFT_audio_emitter":"tqha","./MSFT_lod":"ZDGC","./MSFT_minecraftMesh":"bCaZ","./MSFT_sRGBFactors":"hfn8"}],"rXry":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./glTFLoader");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}})});var r=require("./Extensions");Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return r[e]}})});
},{"./glTFLoader":"9HbH","./Extensions":"W+0l"}],"p00e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@babylonjs/core/Loading/sceneLoader");require("@babylonjs/loaders/glTF/2.0");var r=require("@babylonjs/core/Maths/math");function a(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var o=function e(r){a(this,e)};exports.default=o;
},{"@babylonjs/core/Loading/sceneLoader":"tpk9","@babylonjs/loaders/glTF/2.0":"rXry","@babylonjs/core/Maths/math":"Iizi"}],"xrbn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@babylonjs/core/Meshes/mesh");function s(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var t=function t(r){s(this,t),this.mesh=e.Mesh.CreateBox("Mur",1,r)};exports.default=t;
},{"@babylonjs/core/Meshes/mesh":"aXN+"}],"VfDR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@babylonjs/core/Loading/sceneLoader"),o=require("@babylonjs/core/Maths/math");function s(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}require("@babylonjs/loaders/glTF/2.0");var n=function n(a){s(this,n),e.SceneLoader.ImportMeshAsync(null,"assets/models/","kid.glb",a).then(function(e){e.meshes[0].receiveShadows=!0,e.meshes[0].position.x=-10,e.meshes[0].position.y=-10,console.log(" * * * The player mesh is now loaded."),console.log(e),e.meshes[0].scaling=new o.Vector3(4,4,4)})};function a(e){console.log(" * * * The player mesh is now loaded.")}exports.default=n;
},{"@babylonjs/core/Loading/sceneLoader":"tpk9","@babylonjs/core/Maths/math":"Iizi","@babylonjs/loaders/glTF/2.0":"rXry"}],"QM74":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@babylonjs/core/Meshes/meshBuilder"),r=require("@babylonjs/core/Engines/constants");function s(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var o=function r(o){var t;s(this,r),this.mesh=((t=e.MeshBuilder.CreateSphere("playerSphere",{diameter:12},o)).checkCollisions=!0,t.receiveShadows=!0,t.position.y=-10,t)};exports.default=o;
},{"@babylonjs/core/Meshes/meshBuilder":"vVKK","@babylonjs/core/Engines/constants":"vn8z"}],"JXWX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("@babylonjs/core/Engines/engine"),r=require("@babylonjs/core/scene"),n=require("@babylonjs/core/Engines/constants"),t=require("@babylonjs/core/Cameras/freeCamera"),i=require("@babylonjs/core/Cameras/arcRotateCamera"),s=require("@babylonjs/core/Gamepads/gamepadManager"),o=require("@babylonjs/core/Cameras/universalCamera"),a=require("@babylonjs/core/Maths/math"),c=require("@babylonjs/core/Lights/hemisphericLight"),u=require("@babylonjs/core/Lights/spotLight"),l=require("@babylonjs/core/Meshes/meshBuilder"),h=require("@babylonjs/core/Meshes/mesh"),d=require("@babylonjs/core/Lights/Shadows/shadowGenerator"),b=require("@babylonjs/core/Lights/Shadows/shadowGeneratorSceneComponent"),f=require("@babylonjs/core/Animations/animationPropertiesOverride"),g=require("@babylonjs/core/Materials/standardMaterial"),p=require("@babylonjs/core/Materials/Textures/texture"),w=require("@babylonjs/core/Materials/Textures/cubeTexture"),y=S(require("../Controls/Inputs/Gamepad")),m=S(require("../Controls/Inputs/TouchJoysticks")),j=L(require("pixi.js")),q=L(require("screenfull")),C=S(require("../GameObjects/Sprite")),x=S(require("../GameObjects/Ground")),v=S(require("../GameObjects/Land")),O=S(require("../GameObjects/Wall")),G=S(require("../Player/Player")),M=S(require("../GameObjects/PlayerSphere"));function L(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var t=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};t.get||t.set?Object.defineProperty(r,n,t):r[n]=e[n]}return r.default=e,r}function S(e){return e&&e.__esModule?e:{default:e}}function R(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var P=function n(i){var s,o,c,l,b,f,m,C,L=this;R(this,n),this.canvas=i,this.fullscreen=!1,this.engine=(s=this.canvas,(o=new e.Engine(s,!0)).enableOfflineSupport=!1,o),this.pixiRenderer=function(e){return new j.WebGLRenderer({context:e._gl,view:e.getRenderingCanvas(),width:e.getRenderWidth(),height:e.getRenderHeight(),clearBeforeRender:!1,roundPixels:!0,autoStart:!1})}(this.engine),this.pixiContainer=new j.Container,this.scene=function(e){var n=new r.Scene(e);return n.clearColor=new a.Color3(1,1,1),n.ambientColor=new a.Color3(.2,0,.9),n.fogMode=r.Scene.FOGMODE_LINEAR,n.fogColor=new a.Color3(1,1,5),n.fogStart=20,n.fogEnd=800,n.fogDensity=.1,n.gravity=new a.Vector3(0,-.9,0),n.collisionsEnabled=!0,n}(this.engine),this.camera=function(e,r){var n=new t.FreeCamera("FreeCamera",new a.Vector3(-20,0,-10),r);return n.attachControl(e,!0),n.setTarget(new a.Vector3(0,-5,0)),n.minZ=0,n.maxZ=1e5,n.ellipsoid=new a.Vector3(1,1,1),n.checkCollisions=!0,n.applyGravity=!0,n}(this.canvas,this.scene),this.skybox=(c=this.scene,l=h.Mesh.CreateBox("skyBox",100,c),(b=new g.StandardMaterial("skyBox",c)).backFaceCulling=!1,b.disableLighting=!0,b.reflectionTexture=new w.CubeTexture("./assets/textures/skybox",c),b.reflectionTexture.coordinatesMode=p.Texture.SKYBOX_MODE,l.material=b,l.infiniteDistance=!0,l.renderingGroupId=0,l),this.lights=function(e){return new u.SpotLight("spotLight",new a.Vector3(3,40,0),new a.Vector3(0,-1,0),180,64,e)}(this.scene),this.shadowGenerator=(this.scene,f=this.lights,(m=new d.ShadowGenerator(1024,f)).setDarkness(.5),m),this.gameObjects=function(e,r){new G.default(e),new M.default(e),new v.default(e),new x.default(e);var n=new O.default(e);return r.getShadowMap().renderList.push(n.mesh),e.meshes}(this.scene,this.shadowGenerator),this.ui=void this.pixiContainer,this.controls=((C=new y.default).listenForGamepads,C),this.render=function(){return L.engine.runRenderLoop(function(){L.scene.render(),L.engine.wipeCaches(!0),L.pixiRenderer.reset(),L.pixiRenderer.render(L.pixiContainer)}),L},this.onToggleFullscreen=function(){return window.addEventListener("keydown",function(e){"KeyF"===e.code&&q.enabled&&(!1===L.fullscreen?(q.request(),L.fullscreen=!0):(q.exit(L.canvas),L.fullscreen=!1))})},this.onWindowResize=function(){L.engine.resize()}};exports.default=P;
},{"@babylonjs/core/Engines/engine":"Z5lb","@babylonjs/core/scene":"FKAx","@babylonjs/core/Engines/constants":"vn8z","@babylonjs/core/Cameras/freeCamera":"1Ewv","@babylonjs/core/Cameras/arcRotateCamera":"7z64","@babylonjs/core/Gamepads/gamepadManager":"f8eF","@babylonjs/core/Cameras/universalCamera":"X50r","@babylonjs/core/Maths/math":"Iizi","@babylonjs/core/Lights/hemisphericLight":"N8Ph","@babylonjs/core/Lights/spotLight":"mO+F","@babylonjs/core/Meshes/meshBuilder":"vVKK","@babylonjs/core/Meshes/mesh":"aXN+","@babylonjs/core/Lights/Shadows/shadowGenerator":"ssXa","@babylonjs/core/Lights/Shadows/shadowGeneratorSceneComponent":"M/Ri","@babylonjs/core/Animations/animationPropertiesOverride":"t+y2","@babylonjs/core/Materials/standardMaterial":"PbGh","@babylonjs/core/Materials/Textures/texture":"KNsj","@babylonjs/core/Materials/Textures/cubeTexture":"5aEd","../Controls/Inputs/Gamepad":"A0Sd","../Controls/Inputs/TouchJoysticks":"NqyQ","pixi.js":"ix37","screenfull":"BNKO","../GameObjects/Sprite":"yx/u","../GameObjects/Ground":"9Nig","../GameObjects/Land":"p00e","../GameObjects/Wall":"xrbn","../Player/Player":"VfDR","../GameObjects/PlayerSphere":"QM74"}],"W/BG":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=function t(){e(this,t)};exports.default=t;
},{}],"pBns":[function(require,module,exports) {
"use strict";var e=r(require("./Core/Game")),n=r(require("./Player/Player")),o=r(require("./Web/ServiceWorker"));function r(e){return e&&e.__esModule?e:{default:e}}function d(){var e=document.body.children;e.length>0&&document.body.removeChild(e.item(0))}function t(){d();var e=document.createElement("canvas");return e.id="renderCanvas",document.body.appendChild(e),e}function a(){var n=t(),o=window.game=new e.default(n);o.onToggleFullscreen(),o.render(),window.addEventListener("resize",function(){o.onWindowResize()})}window.addEventListener("DOMContentLoaded",a()),Modernizr.gamepads&&console.log("Gamepads Supported!"),module.hot&&module.hot.accept(function(){console.clear(),console.log(" * * *  New Canvas!"),a()});
},{"./Core/Game":"JXWX","./Player/Player":"VfDR","./Web/ServiceWorker":"W/BG"}]},{},["pBns"], null)